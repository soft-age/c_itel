!function(a){"use strict";function b(a){return I.each(I.slice.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a}function c(a){var b=[];if(r(a)){for(var c=0,d=a.length;d>c;c++)b.push(a[c]);return b}return[]}function d(a){return/^(http:|https:)/.test(a)?a.replace(/^(http:|https:)/,window.location.protocol):a}function e(){var a;try{a=new XMLHttpRequest,I.has(a,"withCredentials")||l(window.XDomainRequest)||(a=new XDomainRequest)}catch(b){}return a}function f(a,c){var d,f,g,h;d=e(),d&&(d.open(c.method,c.url),d instanceof XMLHttpRequest&&I.each(c.headers,function(a,b){d.setRequestHeader(b,a)}),f=function(a,b,c,d,e){var f;(f=P[a])&&(delete P[a],setTimeout(function(){f.callback.call({},{eventId:a,status:c,deliverySatusCode:d,deliveryStatusDescription:e,responseProperties:b})},0))},g=function(a,b,d,e){c.callback.call({},{eventId:null,status:a,deliveryStatusCode:b,deliveryStatusDescription:d,responseProperties:null},e)},h=function(b){return function(){if(h){var e,i;try{e=JSON.parse(d.responseText)}catch(j){e={}
}h=d.onload=d.onerror=null,"error"===b?(i="Failed to send event due to network issue",s(a)?g(!1,d.status||0,i,null):f(a,null,!1,d.status||0,i)):I.has(d,"status")&&200!==d.status?(i=e.reason,s(a)?g(!1,d.status,i,e):f(a,null,!1,d.status,i)):I.has(e,"results")?I.each(e.results,function(a,b){f(b,a,!0,d.status||200,null)}):"GET"===c.method&&g(!0,d.status||200,d.statusText,e)}}},d.onload=h(),d.onerror=h("error"),s(a)||(P[a]=b({},c.data,{callback:c.callback})),d.send(u(c.data)||null))}function g(a,b){f(null,{method:"GET",url:a,callback:b||I.noop})}function h(a,b,c){f(b.event_id,{method:"POST",url:a,data:b,headers:{"Content-Type":"text/plain"},callback:c||I.noop})}function i(a){var b;return s(a)?void 0:(b=sjcl.hash.sha1.hash(a),sjcl.codec.hex.fromBits(b))}function j(){var a,b,c;return a=window.screen.width+"x"+window.screen.height,b=navigator.userAgent,c=navigator.platform,{session_screen_size:a,session_dua:b,session_platform:c}}function k(){}var l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F="2.0.0",G="javascript",H=a,I={},J=Array.prototype,K=Object.prototype,L=K.hasOwnProperty,M=J.forEach,N=Object.keys,O=Array.isArray;
C=!1,x=[],D=!1,E=!0,I.slice=J.slice,I.concat=J.concat,I.push=J.push,I.noop=function(){},I.toString=K.toString,I.each=function(a,b,c){if(null==a)return a;if(M&&a.forEach===M)a.forEach(b,c);else if(a.length===+a.length){for(var d=0,e=a.length;e>d;d++)if(b.call(c,a[d],d,a)==={})return}else for(var f=I.keys(a),d=0,e=f.length;e>d;d++)if(b.call(c,a[f[d]],f[d],a)==={})return;return a},I.every=J.every||function(a){var b,c,d;if(void 0===this||null===this)throw new TypeError;if(b=Object(this),c=b.length>>>0,"function"!=typeof a)throw new TypeError;d=arguments.length>=2?arguments[1]:void 0;for(var e=0;c>e;e++)if(e in b&&!a.call(d,b[e],e,b))return!1;return!0},I.extract=function(a){var b,c;return c={},b=I.slice.call(arguments,1),I.each(b,function(b){I.has(a,b)&&(c[b]=a[[b]])}),c},I.has=function(a,b){return L.call(a,b)},I.keys=function(a){if(!o(a))return[];if(N)return N(a);var b=[];for(var c in a)I.has(a,c)&&b.push(c);return b},I.stamp=function(a){var b,c,d;return d=arguments[0],b=I.slice.call(arguments,1),d.length!==b.length?!1:(c={string:n,"function":m,object:o,number:p},I.every.call(b,function(b,d){var e;
return(e=c[b])?e(a[d]):!1}))},I.zipObject=function(a,b){var c=-1,d=a?a.length:0,e={};for(b||!d||q(a[0])||(b=[]);++c<d;){var f=a[c];b?e[f]=b[c]:f&&(e[f[0]]=f[1])}return e},m=function(a){return"function"==typeof a},n=function(a){return"[object String]"==I.toString.call(a)},p=function(a){return"[object Number]"==I.toString.call(a)},o=function(a){return"[object Object]"==I.toString.call(a)},q=O||function(a){return"[object Array]"==I.toString.call(a)},r=function(a){return!(!a||!L.call(a,"callee"))},l=function(a){return void 0===a},s=function(a){return n(a)?0===a.length:!0},t=function(a){var b;for(b in a)return!1;return!0},u=function(a){try{return JSON.stringify(a)}catch(b){if(-1!==b.message.indexOf("circular"))throw TypeError("A circular reference was detected while serializing an object of type. Check the reference: http://webreflection.blogspot.co.il/2013/03/solving-cycles-recursions-and-circulars.html");throw new TypeError(b.message)}},v={serviceEndPoint:"https://ec01.cooladata.com",queueMaxSize:3e4,maxEventsPerRequest:1e3,maxSingleRequestRetries:3,maxTotalRequestRetries:24,eventsPublishBackoffIntervalMilis:5e3,eventsOutageBackoffIntervalMilis:15e3,eventsPublishIntervalMilis:5e3,maxQueueSizeTriggerPercent:85},w={api_token:"5f159b097bbe47b592cd48697073b6dc",service_end_point:"",user_id:"",session_id:""},y=function(a){var c;
if(E){if(s(a))throw new Error("apiToken cannot be empty");w.api_token!==a&&(w.api_token=a,C=!1);var e=I.slice.call(arguments,1);return w.service_end_point=s(e[0])?w.service_end_point:e[0],w.user_id=s(e[1])?w.user_id:e[1],w.session_id=s(e[2])?w.session_id:e[2],w.service_end_point=d(w.service_end_point),v.serviceEndPoint=d(v.serviceEndPoint),A=(w.service_end_point||v.serviceEndPoint)+"/egw/2/"+w.api_token+"/config?r=",c=e[e.length-1],m(c)||(c=I.noop),g(A+1*new Date,function(a,e){a.status===!0&&(b(v,e.configuration),v.serviceEndPoint=d(v.serviceEndPoint),w.service_end_point=v.serviceEndPoint,B=(w.service_end_point||v.serviceEndPoint)+"/egw/2/"+w.api_token+"/single/json?r=",A=(w.service_end_point||v.serviceEndPoint)+"/egw/2/"+w.api_token+"/config?r=",C=a.status,I.each(x,function(a){z.apply(k,a)}),x=[]),c.call({},a),403===a.deliveryStatusCode&&console.error(a.deliveryStatusDescription)}),this}};var P={};l(window.XDomainRequest)?l(e())&&(E=!1):D=e()instanceof XDomainRequest;var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message
},this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message},this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message},this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message},this.message=a}}};sjcl.bitArray={bitSlice:function(a,b,c){return a=sjcl.bitArray._shiftRight(a.slice(b/32),32-(31&b)).slice(1),void 0===c?a:sjcl.bitArray.clamp(a,c-b)},extract:function(a,b,c){var d,e=Math.floor(-b-c&31);return d=-32&(b+c-1^b)?a[b/32|0]<<32-e^a[b/32+1|0]>>>e:a[b/32|0]>>>e,d&(1<<c)-1},concat:function(a,b){if(0===a.length||0===b.length)return a.concat(b);var c=a[a.length-1],d=sjcl.bitArray.getPartial(c);return 32===d?a.concat(b):sjcl.bitArray._shiftRight(b,d,0|c,a.slice(0,a.length-1))},bitLength:function(a){var b,c=a.length;return 0===c?0:(b=a[c-1],32*(c-1)+sjcl.bitArray.getPartial(b))},clamp:function(a,b){if(32*a.length<b)return a;a=a.slice(0,Math.ceil(b/32));var c=a.length;return b=31&b,c>0&&b&&(a[c-1]=sjcl.bitArray.partial(b,a[c-1]&2147483648>>b-1,1)),a
},partial:function(a,b,c){return 32===a?b:(c?0|b:b<<32-a)+1099511627776*a},getPartial:function(a){return Math.round(a/1099511627776)||32},equal:function(a,b){if(sjcl.bitArray.bitLength(a)!==sjcl.bitArray.bitLength(b))return!1;var c,d=0;for(c=0;c<a.length;c++)d|=a[c]^b[c];return 0===d},_shiftRight:function(a,b,c,d){var e,f,g=0;for(void 0===d&&(d=[]);b>=32;b-=32)d.push(c),c=0;if(0===b)return d.concat(a);for(e=0;e<a.length;e++)d.push(c|a[e]>>>b),c=a[e]<<32-b;return g=a.length?a[a.length-1]:0,f=sjcl.bitArray.getPartial(g),d.push(sjcl.bitArray.partial(b+f&31,b+f>32?c:d.pop(),1)),d},_xor4:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]}},sjcl.codec.utf8String={fromBits:function(a){var b,c,d="",e=sjcl.bitArray.bitLength(a);for(b=0;e/8>b;b++)0===(3&b)&&(c=a[b/4]),d+=String.fromCharCode(c>>>24),c<<=8;return decodeURIComponent(escape(d))},toBits:function(a){a=unescape(encodeURIComponent(a));var b,c=[],d=0;for(b=0;b<a.length;b++)d=d<<8|a.charCodeAt(b),3===(3&b)&&(c.push(d),d=0);return 3&b&&c.push(sjcl.bitArray.partial(8*(3&b),d)),c
}},sjcl.codec.hex={fromBits:function(a){var b,c="";for(b=0;b<a.length;b++)c+=((0|a[b])+0xf00000000000).toString(16).substr(4);return c.substr(0,sjcl.bitArray.bitLength(a)/4)},toBits:function(a){var b,c,d=[];for(a=a.replace(/\s|0x/g,""),c=a.length,a+="00000000",b=0;b<a.length;b+=8)d.push(0^parseInt(a.substr(b,8),16));return sjcl.bitArray.clamp(d,4*c)}},sjcl.hash.sha1=function(a){a?(this._h=a._h.slice(0),this._buffer=a._buffer.slice(0),this._length=a._length):this.reset()},sjcl.hash.sha1.hash=function(a){return(new sjcl.hash.sha1).update(a).finalize()},sjcl.hash.sha1.prototype={blockSize:512,reset:function(){return this._h=this._init.slice(0),this._buffer=[],this._length=0,this},update:function(a){"string"==typeof a&&(a=sjcl.codec.utf8String.toBits(a));var b,c=this._buffer=sjcl.bitArray.concat(this._buffer,a),d=this._length,e=this._length=d+sjcl.bitArray.bitLength(a);for(b=this.blockSize+d&-this.blockSize;e>=b;b+=this.blockSize)this._block(c.splice(0,16));return this},finalize:function(){var a,b=this._buffer,c=this._h;
for(b=sjcl.bitArray.concat(b,[sjcl.bitArray.partial(1,1)]),a=b.length+2;15&a;a++)b.push(0);for(b.push(Math.floor(this._length/4294967296)),b.push(0|this._length);b.length;)this._block(b.splice(0,16));return this.reset(),c},_init:[1732584193,4023233417,2562383102,271733878,3285377520],_key:[1518500249,1859775393,2400959708,3395469782],_f:function(a,b,c,d){return 19>=a?b&c|~b&d:39>=a?b^c^d:59>=a?b&c|b&d|c&d:79>=a?b^c^d:void 0},_S:function(a,b){return b<<a|b>>>32-a},_block:function(a){{var b,c,d,e,f,g,h,i=a.slice(0),j=this._h;this._key}for(d=j[0],e=j[1],f=j[2],g=j[3],h=j[4],b=0;79>=b;b++)b>=16&&(i[b]=this._S(1,i[b-3]^i[b-8]^i[b-14]^i[b-16])),c=this._S(5,d)+this._f(b,e,f,g)+h+i[b]+this._key[Math.floor(b/20)]|0,h=g,g=f,f=this._S(30,e),e=d,d=c;j[0]=j[0]+d|0,j[1]=j[1]+e|0,j[2]=j[2]+f|0,j[3]=j[3]+g|0,j[4]=j[4]+h|0}},z=function(){var a,d,e,f,g,i,k;if(E){if(a=c(arguments),s(a[0]))throw new Error("A trackEvent function expects an event name as a first parameter");if(0==C)return void x.push(a);k=new Date,g=1*k,d=B+g,e={event_name:a[0],user_id:w.user_id||"",session_id:w.session_id||""};
var l=0,m=0;try{m=k.getTime(),l=1*(k.getTimezoneOffset()/60)}catch(n){}if(f=b({event_timestamp_epoch:m,event_timezone_offset:l,tracker_type:G,tracker_version:F,r:g},j()),i=function(a){I.each(a,function(a,b){I.has(w,b)&&w[b]!==a&&(w[b]=a)})},I.stamp(a,"string")){if(b(e,f),s(e.session_id)&&delete e.session_id,s(e.user_id))throw new Error("User ID must be provided over the setup function");return h(d,e)}if(I.stamp(a,"string","object")){if(b(e,a[1],f),s(e.session_id)&&delete e.session_id,s(e.user_id))throw new Error("User ID must be provided over the setup function");return h(d,e)}if(I.stamp(a,"string","string","string","object")){if(b(e,{user_id:a[1],session_id:a[2]},a[3],f),s(e.user_id))throw new Error("User ID must be provided as second parameter");return s(e.session_id)&&delete e.session_id,i(I.extract(e,"user_id","session_id")),h(d,e)}if(I.stamp(a,"string","object","string","function")){if(b(e,{event_id:a[2]},a[1],f),s(e.user_id))throw new Error("User ID must be provided over the setup function");if(s(e.event_id))throw new Error("Callback event id must be provided");
return s(e.session_id)&&delete e.session_id,h(d,e,a[3])}if(I.stamp(a,"string","string","string","object","string","function")){if(b(e,{user_id:a[1],session_id:a[2],event_id:a[4]},a[3],f),s(e.user_id))throw new Error("User ID must be provided as second parameter");if(s(e.event_id))throw new Error("Callback event id must be provided");return s(e.session_id)&&delete e.session_id,i(I.extract(e,"user_id","session_id")),h(d,e,a[5])}}},b(k.prototype,{getInstance:function(){return this},setup:y,getHashedValue:i,trackEvent:z}),H._cdt=H.CoolaDataTracker=H.CoolaDataTracker||new k}.call({},window);