function UUID(){}angular.module("ui.bootstrap",["ui.bootstrap.tpls","ui.bootstrap.dialog","ui.bootstrap.dropdownToggle"]);var dialogModule=angular.module("ui.bootstrap.dialog",["ui.bootstrap.transition"]);dialogModule.controller("MessageBoxController",["$scope","dialog","model",function($scope,dialog,model){$scope.title=model.title,$scope.message=model.message,$scope.buttons=model.buttons,$scope.close=function(res){dialog.close(res)}}]),dialogModule.provider("$dialog",function(){var defaults={backdrop:!0,dialogClass:"modal",backdropClass:"modal-backdrop",transitionClass:"fade",triggerClass:"in",dialogOpenClass:"modal-open",resolve:{},backdropFade:!1,dialogFade:!1,keyboard:!0,backdropClick:!0},globalOptions={},activeBackdrops={value:0};this.options=function(value){globalOptions=value},this.$get=["$http","$document","$compile","$rootScope","$controller","$templateCache","$q","$transition","$injector",function($http,$document,$compile,$rootScope,$controller,$templateCache,$q,$transition,$injector){function createElement(clazz){var el=angular.element("<div>");return el.addClass(clazz),el}function Dialog(opts){var self=this,options=this.options=angular.extend({},defaults,globalOptions,opts);this.backdropEl=createElement(options.backdropClass),options.backdropFade&&(this.backdropEl.addClass(options.transitionClass),this.backdropEl.removeClass(options.triggerClass)),this.modalEl=createElement(options.dialogClass),options.dialogFade&&(this.modalEl.addClass(options.transitionClass),this.modalEl.removeClass(options.triggerClass)),this.handledEscapeKey=function(e){27===e.which?(self.close(),self.$scope.$apply(),e.preventDefault(),e.stopPropagation()):13===e.which&&(self.close("yes"),e.preventDefault(),self.$scope.$apply())},this.handleBackDropClick=function(e){self.close(),e.preventDefault(),self.$scope.$apply()}}var body=$document.find("body");return Dialog.prototype.isOpen=function(){return this._open},Dialog.prototype.open=function(templateUrl,controller){var self=this,options=this.options;if(templateUrl&&(options.templateUrl=templateUrl),controller&&(options.controller=controller),!options.template&&!options.templateUrl)throw new Error("Dialog.open expected template or templateUrl, neither found. Use options or open method to specify them.");return this._loadResolves().then(function(locals){var $scope=locals.$scope=self.$scope=locals.$scope?locals.$scope:$rootScope.$new();if(self.modalEl.html(locals.$template),self.options.controller){var ctrl=$controller(self.options.controller,locals);self.modalEl.contents().data("ngControllerController",ctrl)}$compile(self.modalEl)($scope),self._addElementsToDom(),body.addClass(self.options.dialogOpenClass),setTimeout(function(){self.options.dialogFade&&self.modalEl.addClass(self.options.triggerClass),self.options.backdropFade&&self.backdropEl.addClass(self.options.triggerClass)}),self._bindEvents()}),this.deferred=$q.defer(),this.deferred.promise},Dialog.prototype.close=function(result){function removeTriggerClass(el){el.removeClass(self.options.triggerClass)}function onCloseComplete(){self._open&&self._onCloseComplete(result)}var self=this,fadingElements=this._getFadingElements();if(body.removeClass(self.options.dialogOpenClass),fadingElements.length>0)for(var i=fadingElements.length-1;i>=0;i--)$transition(fadingElements[i],removeTriggerClass).then(onCloseComplete);else this._onCloseComplete(result)},Dialog.prototype._getFadingElements=function(){var elements=[];return this.options.dialogFade&&elements.push(this.modalEl),this.options.backdropFade&&elements.push(this.backdropEl),elements},Dialog.prototype._bindEvents=function(){this.options.keyboard&&body.bind("keyup",this.handledEscapeKey),this.options.backdrop&&this.options.backdropClick&&this.backdropEl.bind("click",this.handleBackDropClick)},Dialog.prototype._unbindEvents=function(){this.options.keyboard&&body.unbind("keyup",this.handledEscapeKey),this.options.backdrop&&this.options.backdropClick&&this.backdropEl.unbind("click",this.handleBackDropClick)},Dialog.prototype._onCloseComplete=function(result){this._removeElementsFromDom(),this._unbindEvents(),this.deferred.resolve(result)},Dialog.prototype._addElementsToDom=function(){body.append(this.modalEl),this.options.backdrop&&(0===activeBackdrops.value&&body.append(this.backdropEl),activeBackdrops.value++),this._open=!0},Dialog.prototype._removeElementsFromDom=function(){this.modalEl.remove(),this.options.backdrop&&(activeBackdrops.value--,0===activeBackdrops.value&&this.backdropEl.remove()),this._open=!1},Dialog.prototype._loadResolves=function(){var templatePromise,values=[],keys=[],self=this;return this.options.template?templatePromise=$q.when(this.options.template):this.options.templateUrl&&(templatePromise=$http.get(this.options.templateUrl,{cache:$templateCache}).then(function(response){return response.data})),angular.forEach(this.options.resolve||[],function(value,key){keys.push(key),values.push(angular.isString(value)?$injector.get(value):$injector.invoke(value))}),keys.push("$template"),values.push(templatePromise),$q.all(values).then(function(values){var locals={};return angular.forEach(values,function(value,index){locals[keys[index]]=value}),locals.dialog=self,locals})},{dialog:function(opts){return new Dialog(opts)},messageBox:function(title,message,buttons){return new Dialog({templateUrl:"template/dialog/message.html",controller:"MessageBoxController",resolve:{model:function(){return{title:title,message:message,buttons:buttons}}}})}}}]}),angular.module("ui.bootstrap.dropdownToggle",[]).directive("dropdownToggle",["$document","$location",function($document){var openElement=null,closeMenu=angular.noop;return{restrict:"CA",link:function(scope,element){scope.$watch("$location.path",function(){closeMenu()}),element.parent().bind("click",function(){closeMenu()}),element.bind("click",function(event){if(!element.hasClass("disabled")){var elementWasOpen=element===openElement;event.preventDefault(),event.stopPropagation(),openElement&&closeMenu(),elementWasOpen||(element.parent().addClass("open"),openElement=element,closeMenu=function(event){event&&(event.preventDefault(),event.stopPropagation()),$document.unbind("click",closeMenu),element.parent().removeClass("open"),closeMenu=angular.noop,openElement=null},$document.bind("click",closeMenu))}})}}}]),angular.module("ui.bootstrap.tpls",["template/dialog/message.html"]),angular.module("template/dialog/message.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("template/dialog/message.html",'<div class="modal-header">	<h1>{{ title }}</h1></div><div class="modal-body">	<p>{{ message }}</p></div><div class="modal-footer">	<button ng-repeat="btn in buttons" ng-click="close(btn.result)" class=btn ng-class="btn.cssClass">{{ btn.label }}</button></div>')}]),angular.module("ui.bootstrap.transition",[]).factory("$transition",["$q","$timeout","$rootScope",function($q,$timeout,$rootScope){function findEndEventName(endEventNames){for(var name in endEventNames)if(void 0!==transElement.style[name])return endEventNames[name]}var $transition=function(element,trigger,options){options=options||{};var deferred=$q.defer(),endEventName=$transition[options.animation?"animationEndEventName":"transitionEndEventName"],transitionEndHandler=function(){$rootScope.$apply(function(){element.unbind(endEventName,transitionEndHandler),deferred.resolve(element)})};return endEventName&&element.bind(endEventName,transitionEndHandler),$timeout(function(){angular.isString(trigger)?element.addClass(trigger):angular.isFunction(trigger)?trigger(element):angular.isObject(trigger)&&element.css(trigger),endEventName||deferred.resolve(element)}),deferred.promise.cancel=function(){endEventName&&element.unbind(endEventName,transitionEndHandler),deferred.reject("Transition cancelled")},deferred.promise},transElement=document.createElement("trans"),transitionEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",transition:"transitionend"},animationEndEventNames={WebkitTransition:"webkitAnimationEnd",MozTransition:"animationend",OTransition:"oAnimationEnd",msTransition:"MSAnimationEnd",transition:"animationend"};return $transition.transitionEndEventName=findEndEventName(transitionEndEventNames),$transition.animationEndEventName=findEndEventName(animationEndEventNames),$transition}]),function(window){"use strict";var CanvasPrototype=window.HTMLCanvasElement&&window.HTMLCanvasElement.prototype,hasBlobConstructor=window.Blob&&function(){try{return Boolean(new Blob)}catch(e){return!1}}(),hasArrayBufferViewSupport=hasBlobConstructor&&window.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(e){return!1}}(),BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder,dataURLtoBlob=(hasBlobConstructor||BlobBuilder)&&window.atob&&window.ArrayBuffer&&window.Uint8Array&&function(dataURI){var byteString,arrayBuffer,intArray,i,mimeString,bb;for(byteString=dataURI.split(",")[0].indexOf("base64")>=0?atob(dataURI.split(",")[1]):decodeURIComponent(dataURI.split(",")[1]),arrayBuffer=new ArrayBuffer(byteString.length),intArray=new Uint8Array(arrayBuffer),i=0;i<byteString.length;i+=1)intArray[i]=byteString.charCodeAt(i);return mimeString=dataURI.split(",")[0].split(":")[1].split(";")[0],hasBlobConstructor?new Blob([hasArrayBufferViewSupport?intArray:arrayBuffer],{type:mimeString}):(bb=new BlobBuilder,bb.append(arrayBuffer),bb.getBlob(mimeString))};window.HTMLCanvasElement&&!CanvasPrototype.toBlob&&(CanvasPrototype.mozGetAsFile?CanvasPrototype.toBlob=function(callback,type,quality){callback(quality&&CanvasPrototype.toDataURL&&dataURLtoBlob?dataURLtoBlob(this.toDataURL(type,quality)):this.mozGetAsFile("blob",type))}:CanvasPrototype.toDataURL&&dataURLtoBlob&&(CanvasPrototype.toBlob=function(callback,type,quality){callback(dataURLtoBlob(this.toDataURL(type,quality)))})),"function"==typeof define&&define.amd?define(function(){return dataURLtoBlob}):window.dataURLtoBlob=dataURLtoBlob}(this),function($,undefined){function focusable(element,isTabIndexNotNaN){var map,mapName,img,nodeName=element.nodeName.toLowerCase();return"area"===nodeName?(map=element.parentNode,mapName=map.name,element.href&&mapName&&"map"===map.nodeName.toLowerCase()?(img=$("img[usemap=#"+mapName+"]")[0],!!img&&visible(img)):!1):(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element)}function visible(element){return $.expr.filters.visible(element)&&!$(element).parents().addBack().filter(function(){return"hidden"===$.css(this,"visibility")}).length}var uuid=0,runiqueId=/^ui-id-\d+$/;$.ui=$.ui||{},$.extend($.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),$.fn.extend({focus:function(orig){return function(delay,fn){return"number"==typeof delay?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus(),fn&&fn.call(elem)},delay)}):orig.apply(this,arguments)}}($.fn.focus),scrollParent:function(){var scrollParent;return scrollParent=$.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test($.css(this,"position"))&&/(auto|scroll)/.test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!scrollParent.length?$(document):scrollParent},zIndex:function(zIndex){if(zIndex!==undefined)return this.css("zIndex",zIndex);if(this.length)for(var position,value,elem=$(this[0]);elem.length&&elem[0]!==document;){if(position=elem.css("position"),("absolute"===position||"relative"===position||"fixed"===position)&&(value=parseInt(elem.css("zIndex"),10),!isNaN(value)&&0!==value))return value;elem=elem.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++uuid)})},removeUniqueId:function(){return this.each(function(){runiqueId.test(this.id)&&$(this).removeAttr("id")})}}),$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName)}}):function(elem,i,match){return!!$.data(elem,match[3])},focusable:function(element){return focusable(element,!isNaN($.attr(element,"tabindex")))},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN)}}),$("<a>").outerWidth(1).jquery||$.each(["Width","Height"],function(i,name){function reduce(elem,size,border,margin){return $.each(side,function(){size-=parseFloat($.css(elem,"padding"+this))||0,border&&(size-=parseFloat($.css(elem,"border"+this+"Width"))||0),margin&&(size-=parseFloat($.css(elem,"margin"+this))||0)}),size}var side="Width"===name?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};$.fn["inner"+name]=function(size){return size===undefined?orig["inner"+name].call(this):this.each(function(){$(this).css(type,reduce(this,size)+"px")})},$.fn["outer"+name]=function(size,margin){return"number"!=typeof size?orig["outer"+name].call(this,size):this.each(function(){$(this).css(type,reduce(this,size,!0,margin)+"px")})}}),$.fn.addBack||($.fn.addBack=function(selector){return this.add(null==selector?this.prevObject:this.prevObject.filter(selector))}),$("<a>").data("a-b","a").removeData("a-b").data("a-b")&&($.fn.removeData=function(removeData){return function(key){return arguments.length?removeData.call(this,$.camelCase(key)):removeData.call(this)}}($.fn.removeData)),$.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),$.support.selectstart="onselectstart"in document.createElement("div"),$.fn.extend({disableSelection:function(){return this.bind(($.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(event){event.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),$.extend($.ui,{plugin:{add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set)proto.plugins[i]=proto.plugins[i]||[],proto.plugins[i].push([option,set[i]])},call:function(instance,name,args){var i,set=instance.plugins[name];if(set&&instance.element[0].parentNode&&11!==instance.element[0].parentNode.nodeType)for(i=0;i<set.length;i++)instance.options[set[i][0]]&&set[i][1].apply(instance.element,args)}},hasScroll:function(el,a){if("hidden"===$(el).css("overflow"))return!1;var scroll=a&&"left"===a?"scrollLeft":"scrollTop",has=!1;return el[scroll]>0?!0:(el[scroll]=1,has=el[scroll]>0,el[scroll]=0,has)}})}(jQuery),function($,undefined){var uuid=0,slice=Array.prototype.slice,_cleanData=$.cleanData;$.cleanData=function(elems){for(var elem,i=0;null!=(elem=elems[i]);i++)try{$(elem).triggerHandler("remove")}catch(e){}_cleanData(elems)},$.widget=function(name,base,prototype){var fullName,existingConstructor,constructor,basePrototype,proxiedPrototype={},namespace=name.split(".")[0];name=name.split(".")[1],fullName=namespace+"-"+name,prototype||(prototype=base,base=$.Widget),$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName)},$[namespace]=$[namespace]||{},existingConstructor=$[namespace][name],constructor=$[namespace][name]=function(options,element){return this._createWidget?void(arguments.length&&this._createWidget(options,element)):new constructor(options,element)},$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]}),basePrototype=new base,basePrototype.options=$.widget.extend({},basePrototype.options),$.each(prototype,function(prop,value){return $.isFunction(value)?void(proxiedPrototype[prop]=function(){var _super=function(){return base.prototype[prop].apply(this,arguments)},_superApply=function(args){return base.prototype[prop].apply(this,args)};return function(){var returnValue,__super=this._super,__superApply=this._superApply;return this._super=_super,this._superApply=_superApply,returnValue=value.apply(this,arguments),this._super=__super,this._superApply=__superApply,returnValue}}()):void(proxiedPrototype[prop]=value)}),constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:existingConstructor?basePrototype.widgetEventPrefix:name},proxiedPrototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetFullName:fullName}),existingConstructor?($.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto)}),delete existingConstructor._childConstructors):base._childConstructors.push(constructor),$.widget.bridge(name,constructor)},$.widget.extend=function(target){for(var key,value,input=slice.call(arguments,1),inputIndex=0,inputLength=input.length;inputLength>inputIndex;inputIndex++)for(key in input[inputIndex])value=input[inputIndex][key],input[inputIndex].hasOwnProperty(key)&&value!==undefined&&(target[key]=$.isPlainObject(value)?$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value):value);return target},$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName||name;$.fn[name]=function(options){var isMethodCall="string"==typeof options,args=slice.call(arguments,1),returnValue=this;return options=!isMethodCall&&args.length?$.widget.extend.apply(null,[options].concat(args)):options,this.each(isMethodCall?function(){var methodValue,instance=$.data(this,fullName);return instance?$.isFunction(instance[options])&&"_"!==options.charAt(0)?(methodValue=instance[options].apply(instance,args),methodValue!==instance&&methodValue!==undefined?(returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue,!1):void 0):$.error("no such method '"+options+"' for "+name+" widget instance"):$.error("cannot call methods on "+name+" prior to initialization; attempted to call method '"+options+"'")}:function(){var instance=$.data(this,fullName);instance?instance.option(options||{})._init():$.data(this,fullName,new object(options,this))}),returnValue}},$.Widget=function(){},$.Widget._childConstructors=[],$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0],this.element=$(element),this.uuid=uuid++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=$.widget.extend({},this.options,this._getCreateOptions(),options),this.bindings=$(),this.hoverable=$(),this.focusable=$(),element!==this&&($.data(element,this.widgetFullName,this),this._on(!0,this.element,{remove:function(event){event.target===element&&this.destroy()}}),this.document=$(element.style?element.ownerDocument:element.document||element),this.window=$(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:$.noop,widget:function(){return this.element},option:function(key,value){var parts,curOption,i,options=key;if(0===arguments.length)return $.widget.extend({},this.options);if("string"==typeof key)if(options={},parts=key.split("."),key=parts.shift(),parts.length){for(curOption=options[key]=$.widget.extend({},this.options[key]),i=0;i<parts.length-1;i++)curOption[parts[i]]=curOption[parts[i]]||{},curOption=curOption[parts[i]];if(key=parts.pop(),value===undefined)return curOption[key]===undefined?null:curOption[key];curOption[key]=value}else{if(value===undefined)return this.options[key]===undefined?null:this.options[key];options[key]=value}return this._setOptions(options),this},_setOptions:function(options){var key;for(key in options)this._setOption(key,options[key]);return this},_setOption:function(key,value){return this.options[key]=value,"disabled"===key&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!value).attr("aria-disabled",value),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(suppressDisabledCheck,element,handlers){var delegateElement,instance=this;"boolean"!=typeof suppressDisabledCheck&&(handlers=element,element=suppressDisabledCheck,suppressDisabledCheck=!1),handlers?(element=delegateElement=$(element),this.bindings=this.bindings.add(element)):(handlers=element,element=this.element,delegateElement=this.widget()),$.each(handlers,function(event,handler){function handlerProxy(){return suppressDisabledCheck||instance.options.disabled!==!0&&!$(this).hasClass("ui-state-disabled")?("string"==typeof handler?instance[handler]:handler).apply(instance,arguments):void 0}"string"!=typeof handler&&(handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++);var match=event.match(/^(\w+)\s*(.*)$/),eventName=match[1]+instance.eventNamespace,selector=match[2];selector?delegateElement.delegate(selector,eventName,handlerProxy):element.bind(eventName,handlerProxy)})},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,element.unbind(eventName).undelegate(eventName)},_delay:function(handler,delay){function handlerProxy(){return("string"==typeof handler?instance[handler]:handler).apply(instance,arguments)}var instance=this;return setTimeout(handlerProxy,delay||0)},_hoverable:function(element){this.hoverable=this.hoverable.add(element),this._on(element,{mouseenter:function(event){$(event.currentTarget).addClass("ui-state-hover")},mouseleave:function(event){$(event.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(element){this.focusable=this.focusable.add(element),this._on(element,{focusin:function(event){$(event.currentTarget).addClass("ui-state-focus")},focusout:function(event){$(event.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(type,event,data){var prop,orig,callback=this.options[type];if(data=data||{},event=$.Event(event),event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase(),event.target=this.element[0],orig=event.originalEvent)for(prop in orig)prop in event||(event[prop]=orig[prop]);return this.element.trigger(event,data),!($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===!1||event.isDefaultPrevented())}},$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){"string"==typeof options&&(options={effect:options});var hasOptions,effectName=options?options===!0||"number"==typeof options?defaultEffect:options.effect||defaultEffect:method;options=options||{},"number"==typeof options&&(options={duration:options}),hasOptions=!$.isEmptyObject(options),options.complete=callback,options.delay&&element.delay(options.delay),hasOptions&&$.effects&&$.effects.effect[effectName]?element[method](options):effectName!==method&&element[effectName]?element[effectName](options.duration,options.easing,callback):element.queue(function(next){$(this)[method](),callback&&callback.call(element[0]),next()})}})}(jQuery),function($){var mouseHandled=!1;$(document).mouseup(function(){mouseHandled=!1}),$.widget("ui.mouse",{version:"1.10.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var that=this;this.element.bind("mousedown."+this.widgetName,function(event){return that._mouseDown(event)}).bind("click."+this.widgetName,function(event){return!0===$.data(event.target,that.widgetName+".preventClickEvent")?($.removeData(event.target,that.widgetName+".preventClickEvent"),event.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&$(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(event){if(!mouseHandled){this._mouseStarted&&this._mouseUp(event),this._mouseDownEvent=event;var that=this,btnIsLeft=1===event.which,elIsCancel="string"==typeof this.options.cancel&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:!1;return btnIsLeft&&!elIsCancel&&this._mouseCapture(event)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(event)&&this._mouseDelayMet(event)&&(this._mouseStarted=this._mouseStart(event)!==!1,!this._mouseStarted)?(event.preventDefault(),!0):(!0===$.data(event.target,this.widgetName+".preventClickEvent")&&$.removeData(event.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(event){return that._mouseMove(event)},this._mouseUpDelegate=function(event){return that._mouseUp(event)},$(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),event.preventDefault(),mouseHandled=!0,!0)):!0}},_mouseMove:function(event){return $.ui.ie&&(!document.documentMode||document.documentMode<9)&&!event.button?this._mouseUp(event):this._mouseStarted?(this._mouseDrag(event),event.preventDefault()):(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,event)!==!1,this._mouseStarted?this._mouseDrag(event):this._mouseUp(event)),!this._mouseStarted)},_mouseUp:function(event){return $(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,event.target===this._mouseDownEvent.target&&$.data(event.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(event)),!1},_mouseDistanceMet:function(event){return Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function($){$.widget("ui.draggable",$.ui.mouse,{version:"1.10.3",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(event){var o=this.options;return this.helper||o.disabled||$(event.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(event),this.handle?($(o.iframeFix===!0?"iframe":o.iframeFix).each(function(){$("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css($(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(event){var o=this.options;return this.helper=this._createHelper(event),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),$.ui.ddmanager&&($.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(event),this.originalPageX=event.pageX,this.originalPageY=event.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this._setContainment(),this._trigger("start",event)===!1?(this._clear(),!1):(this._cacheHelperProportions(),$.ui.ddmanager&&!o.dropBehaviour&&$.ui.ddmanager.prepareOffsets(this,event),this._mouseDrag(event,!0),$.ui.ddmanager&&$.ui.ddmanager.dragStart(this,event),!0)},_mouseDrag:function(event,noPropagation){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(event),this.positionAbs=this._convertPositionTo("absolute"),!noPropagation){var ui=this._uiHash();if(this._trigger("drag",event,ui)===!1)return this._mouseUp({}),!1;this.position=ui.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),$.ui.ddmanager&&$.ui.ddmanager.drag(this,event),!1},_mouseStop:function(event){var that=this,dropped=!1;return $.ui.ddmanager&&!this.options.dropBehaviour&&(dropped=$.ui.ddmanager.drop(this,event)),this.dropped&&(dropped=this.dropped,this.dropped=!1),"original"!==this.options.helper||$.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!dropped||"valid"===this.options.revert&&dropped||this.options.revert===!0||$.isFunction(this.options.revert)&&this.options.revert.call(this.element,dropped)?$(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){that._trigger("stop",event)!==!1&&that._clear()}):this._trigger("stop",event)!==!1&&this._clear(),!1):!1},_mouseUp:function(event){return $("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),$.ui.ddmanager&&$.ui.ddmanager.dragStop(this,event),$.ui.mouse.prototype._mouseUp.call(this,event)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(event){return this.options.handle?!!$(event.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(event){var o=this.options,helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event])):"clone"===o.helper?this.element.clone().removeAttr("id"):this.element;return helper.parents("body").length||helper.appendTo("parent"===o.appendTo?this.element[0].parentNode:o.appendTo),helper[0]===this.element[0]||/(fixed|absolute)/.test(helper.css("position"))||helper.css("position","absolute"),helper
},_adjustOffsetFromHelper:function(obj){"string"==typeof obj&&(obj=obj.split(" ")),$.isArray(obj)&&(obj={left:+obj[0],top:+obj[1]||0}),"left"in obj&&(this.offset.click.left=obj.left+this.margins.left),"right"in obj&&(this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left),"top"in obj&&(this.offset.click.top=obj.top+this.margins.top),"bottom"in obj&&(this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top)},_getParentOffset:function(){var po=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])&&(po.left+=this.scrollParent.scrollLeft(),po.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&$.ui.ie)&&(po={top:0,left:0}),{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var p=this.element.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var over,c,ce,o=this.options;return o.containment?"window"===o.containment?void(this.containment=[$(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,$(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,$(window).scrollLeft()+$(window).width()-this.helperProportions.width-this.margins.left,$(window).scrollTop()+($(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):"document"===o.containment?void(this.containment=[0,0,$(document).width()-this.helperProportions.width-this.margins.left,($(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]):o.containment.constructor===Array?void(this.containment=o.containment):("parent"===o.containment&&(o.containment=this.helper[0].parentNode),c=$(o.containment),ce=c[0],void(ce&&(over="hidden"!==c.css("overflow"),this.containment=[(parseInt(c.css("borderLeftWidth"),10)||0)+(parseInt(c.css("paddingLeft"),10)||0),(parseInt(c.css("borderTopWidth"),10)||0)+(parseInt(c.css("paddingTop"),10)||0),(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt(c.css("borderRightWidth"),10)||0)-(parseInt(c.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt(c.css("borderBottomWidth"),10)||0)-(parseInt(c.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=c))):void(this.containment=null)},_convertPositionTo:function(d,pos){pos||(pos=this.position);var mod="absolute"===d?1:-1,scroll="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:scroll.scrollTop(),left:scroll.scrollLeft()}),{top:pos.top+this.offset.relative.top*mod+this.offset.parent.top*mod-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*mod,left:pos.left+this.offset.relative.left*mod+this.offset.parent.left*mod-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*mod}},_generatePosition:function(event){var containment,co,top,left,o=this.options,scroll="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,pageX=event.pageX,pageY=event.pageY;return this.offset.scroll||(this.offset.scroll={top:scroll.scrollTop(),left:scroll.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(co=this.relative_container.offset(),containment=[this.containment[0]+co.left,this.containment[1]+co.top,this.containment[2]+co.left,this.containment[3]+co.top]):containment=this.containment,event.pageX-this.offset.click.left<containment[0]&&(pageX=containment[0]+this.offset.click.left),event.pageY-this.offset.click.top<containment[1]&&(pageY=containment[1]+this.offset.click.top),event.pageX-this.offset.click.left>containment[2]&&(pageX=containment[2]+this.offset.click.left),event.pageY-this.offset.click.top>containment[3]&&(pageY=containment[3]+this.offset.click.top)),o.grid&&(top=o.grid[1]?this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,pageY=containment?top-this.offset.click.top>=containment[1]||top-this.offset.click.top>containment[3]?top:top-this.offset.click.top>=containment[1]?top-o.grid[1]:top+o.grid[1]:top,left=o.grid[0]?this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,pageX=containment?left-this.offset.click.left>=containment[0]||left-this.offset.click.left>containment[2]?left:left-this.offset.click.left>=containment[0]?left-o.grid[0]:left+o.grid[0]:left)),{top:pageY-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:pageX-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(type,event,ui){return ui=ui||this._uiHash(),$.ui.plugin.call(this,type,[event,ui]),"drag"===type&&(this.positionAbs=this._convertPositionTo("absolute")),$.Widget.prototype._trigger.call(this,type,event,ui)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),$.ui.plugin.add("draggable","connectToSortable",{start:function(event,ui){var inst=$(this).data("ui-draggable"),o=inst.options,uiSortable=$.extend({},ui,{item:inst.element});inst.sortables=[],$(o.connectToSortable).each(function(){var sortable=$.data(this,"ui-sortable");sortable&&!sortable.options.disabled&&(inst.sortables.push({instance:sortable,shouldRevert:sortable.options.revert}),sortable.refreshPositions(),sortable._trigger("activate",event,uiSortable))})},stop:function(event,ui){var inst=$(this).data("ui-draggable"),uiSortable=$.extend({},ui,{item:inst.element});$.each(inst.sortables,function(){this.instance.isOver?(this.instance.isOver=0,inst.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(event),this.instance.options.helper=this.instance.options._helper,"original"===inst.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",event,uiSortable))})},drag:function(event,ui){var inst=$(this).data("ui-draggable"),that=this;$.each(inst.sortables,function(){var innermostIntersecting=!1,thisSortable=this;this.instance.positionAbs=inst.positionAbs,this.instance.helperProportions=inst.helperProportions,this.instance.offset.click=inst.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(innermostIntersecting=!0,$.each(inst.sortables,function(){return this.instance.positionAbs=inst.positionAbs,this.instance.helperProportions=inst.helperProportions,this.instance.offset.click=inst.offset.click,this!==thisSortable&&this.instance._intersectsWith(this.instance.containerCache)&&$.contains(thisSortable.instance.element[0],this.instance.element[0])&&(innermostIntersecting=!1),innermostIntersecting})),innermostIntersecting?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=$(that).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return ui.helper[0]},event.target=this.instance.currentItem[0],this.instance._mouseCapture(event,!0),this.instance._mouseStart(event,!0,!0),this.instance.offset.click.top=inst.offset.click.top,this.instance.offset.click.left=inst.offset.click.left,this.instance.offset.parent.left-=inst.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=inst.offset.parent.top-this.instance.offset.parent.top,inst._trigger("toSortable",event),inst.dropped=this.instance.element,inst.currentItem=inst.element,this.instance.fromOutside=inst),this.instance.currentItem&&this.instance._mouseDrag(event)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",event,this.instance._uiHash(this.instance)),this.instance._mouseStop(event,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),inst._trigger("fromSortable",event),inst.dropped=!1)})}}),$.ui.plugin.add("draggable","cursor",{start:function(){var t=$("body"),o=$(this).data("ui-draggable").options;t.css("cursor")&&(o._cursor=t.css("cursor")),t.css("cursor",o.cursor)},stop:function(){var o=$(this).data("ui-draggable").options;o._cursor&&$("body").css("cursor",o._cursor)}}),$.ui.plugin.add("draggable","opacity",{start:function(event,ui){var t=$(ui.helper),o=$(this).data("ui-draggable").options;t.css("opacity")&&(o._opacity=t.css("opacity")),t.css("opacity",o.opacity)},stop:function(event,ui){var o=$(this).data("ui-draggable").options;o._opacity&&$(ui.helper).css("opacity",o._opacity)}}),$.ui.plugin.add("draggable","scroll",{start:function(){var i=$(this).data("ui-draggable");i.scrollParent[0]!==document&&"HTML"!==i.scrollParent[0].tagName&&(i.overflowOffset=i.scrollParent.offset())},drag:function(event){var i=$(this).data("ui-draggable"),o=i.options,scrolled=!1;i.scrollParent[0]!==document&&"HTML"!==i.scrollParent[0].tagName?(o.axis&&"x"===o.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-event.pageY<o.scrollSensitivity?i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop+o.scrollSpeed:event.pageY-i.overflowOffset.top<o.scrollSensitivity&&(i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop-o.scrollSpeed)),o.axis&&"y"===o.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-event.pageX<o.scrollSensitivity?i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft+o.scrollSpeed:event.pageX-i.overflowOffset.left<o.scrollSensitivity&&(i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft-o.scrollSpeed))):(o.axis&&"x"===o.axis||(event.pageY-$(document).scrollTop()<o.scrollSensitivity?scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed):$(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity&&(scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed))),o.axis&&"y"===o.axis||(event.pageX-$(document).scrollLeft()<o.scrollSensitivity?scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed):$(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity&&(scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed)))),scrolled!==!1&&$.ui.ddmanager&&!o.dropBehaviour&&$.ui.ddmanager.prepareOffsets(i,event)}}),$.ui.plugin.add("draggable","snap",{start:function(){var i=$(this).data("ui-draggable"),o=i.options;i.snapElements=[],$(o.snap.constructor!==String?o.snap.items||":data(ui-draggable)":o.snap).each(function(){var $t=$(this),$o=$t.offset();this!==i.element[0]&&i.snapElements.push({item:this,width:$t.outerWidth(),height:$t.outerHeight(),top:$o.top,left:$o.left})})},drag:function(event,ui){var ts,bs,ls,rs,l,r,t,b,i,first,inst=$(this).data("ui-draggable"),o=inst.options,d=o.snapTolerance,x1=ui.offset.left,x2=x1+inst.helperProportions.width,y1=ui.offset.top,y2=y1+inst.helperProportions.height;for(i=inst.snapElements.length-1;i>=0;i--)l=inst.snapElements[i].left,r=l+inst.snapElements[i].width,t=inst.snapElements[i].top,b=t+inst.snapElements[i].height,l-d>x2||x1>r+d||t-d>y2||y1>b+d||!$.contains(inst.snapElements[i].item.ownerDocument,inst.snapElements[i].item)?(inst.snapElements[i].snapping&&inst.options.snap.release&&inst.options.snap.release.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})),inst.snapElements[i].snapping=!1):("inner"!==o.snapMode&&(ts=Math.abs(t-y2)<=d,bs=Math.abs(b-y1)<=d,ls=Math.abs(l-x2)<=d,rs=Math.abs(r-x1)<=d,ts&&(ui.position.top=inst._convertPositionTo("relative",{top:t-inst.helperProportions.height,left:0}).top-inst.margins.top),bs&&(ui.position.top=inst._convertPositionTo("relative",{top:b,left:0}).top-inst.margins.top),ls&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:l-inst.helperProportions.width}).left-inst.margins.left),rs&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:r}).left-inst.margins.left)),first=ts||bs||ls||rs,"outer"!==o.snapMode&&(ts=Math.abs(t-y1)<=d,bs=Math.abs(b-y2)<=d,ls=Math.abs(l-x1)<=d,rs=Math.abs(r-x2)<=d,ts&&(ui.position.top=inst._convertPositionTo("relative",{top:t,left:0}).top-inst.margins.top),bs&&(ui.position.top=inst._convertPositionTo("relative",{top:b-inst.helperProportions.height,left:0}).top-inst.margins.top),ls&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:l}).left-inst.margins.left),rs&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:r-inst.helperProportions.width}).left-inst.margins.left)),!inst.snapElements[i].snapping&&(ts||bs||ls||rs||first)&&inst.options.snap.snap&&inst.options.snap.snap.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})),inst.snapElements[i].snapping=ts||bs||ls||rs||first)}}),$.ui.plugin.add("draggable","stack",{start:function(){var min,o=this.data("ui-draggable").options,group=$.makeArray($(o.stack)).sort(function(a,b){return(parseInt($(a).css("zIndex"),10)||0)-(parseInt($(b).css("zIndex"),10)||0)});group.length&&(min=parseInt($(group[0]).css("zIndex"),10)||0,$(group).each(function(i){$(this).css("zIndex",min+i)}),this.css("zIndex",min+group.length))}}),$.ui.plugin.add("draggable","zIndex",{start:function(event,ui){var t=$(ui.helper),o=$(this).data("ui-draggable").options;t.css("zIndex")&&(o._zIndex=t.css("zIndex")),t.css("zIndex",o.zIndex)},stop:function(event,ui){var o=$(this).data("ui-draggable").options;o._zIndex&&$(ui.helper).css("zIndex",o._zIndex)}})}(jQuery),function($){function isOverAxis(x,reference,size){return x>reference&&reference+size>x}$.widget("ui.droppable",{version:"1.10.3",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var o=this.options,accept=o.accept;this.isover=!1,this.isout=!0,this.accept=$.isFunction(accept)?accept:function(d){return d.is(accept)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},$.ui.ddmanager.droppables[o.scope]=$.ui.ddmanager.droppables[o.scope]||[],$.ui.ddmanager.droppables[o.scope].push(this),o.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var i=0,drop=$.ui.ddmanager.droppables[this.options.scope];i<drop.length;i++)drop[i]===this&&drop.splice(i,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(key,value){"accept"===key&&(this.accept=$.isFunction(value)?value:function(d){return d.is(value)}),$.Widget.prototype._setOption.apply(this,arguments)},_activate:function(event){var draggable=$.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),draggable&&this._trigger("activate",event,this.ui(draggable))},_deactivate:function(event){var draggable=$.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),draggable&&this._trigger("deactivate",event,this.ui(draggable))},_over:function(event){var draggable=$.ui.ddmanager.current;draggable&&(draggable.currentItem||draggable.element)[0]!==this.element[0]&&this.accept.call(this.element[0],draggable.currentItem||draggable.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",event,this.ui(draggable)))},_out:function(event){var draggable=$.ui.ddmanager.current;draggable&&(draggable.currentItem||draggable.element)[0]!==this.element[0]&&this.accept.call(this.element[0],draggable.currentItem||draggable.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",event,this.ui(draggable)))},_drop:function(event,custom){var draggable=custom||$.ui.ddmanager.current,childrenIntersection=!1;return draggable&&(draggable.currentItem||draggable.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var inst=$.data(this,"ui-droppable");return inst.options.greedy&&!inst.options.disabled&&inst.options.scope===draggable.options.scope&&inst.accept.call(inst.element[0],draggable.currentItem||draggable.element)&&$.ui.intersect(draggable,$.extend(inst,{offset:inst.element.offset()}),inst.options.tolerance)?(childrenIntersection=!0,!1):void 0}),childrenIntersection?!1:this.accept.call(this.element[0],draggable.currentItem||draggable.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",event,this.ui(draggable)),this.element):!1):!1},ui:function(c){return{draggable:c.currentItem||c.element,helper:c.helper,position:c.position,offset:c.positionAbs}}}),$.ui.intersect=function(draggable,droppable,toleranceMode){if(!droppable.offset)return!1;var draggableLeft,draggableTop,x1=(draggable.positionAbs||draggable.position.absolute).left,x2=x1+draggable.helperProportions.width,y1=(draggable.positionAbs||draggable.position.absolute).top,y2=y1+draggable.helperProportions.height,l=droppable.offset.left,r=l+droppable.proportions.width,t=droppable.offset.top,b=t+droppable.proportions.height;switch(toleranceMode){case"fit":return x1>=l&&r>=x2&&y1>=t&&b>=y2;case"intersect":return l<x1+draggable.helperProportions.width/2&&x2-draggable.helperProportions.width/2<r&&t<y1+draggable.helperProportions.height/2&&y2-draggable.helperProportions.height/2<b;case"pointer":return draggableLeft=(draggable.positionAbs||draggable.position.absolute).left+(draggable.clickOffset||draggable.offset.click).left,draggableTop=(draggable.positionAbs||draggable.position.absolute).top+(draggable.clickOffset||draggable.offset.click).top,isOverAxis(draggableTop,t,droppable.proportions.height)&&isOverAxis(draggableLeft,l,droppable.proportions.width);case"touch":return(y1>=t&&b>=y1||y2>=t&&b>=y2||t>y1&&y2>b)&&(x1>=l&&r>=x1||x2>=l&&r>=x2||l>x1&&x2>r);default:return!1}},$.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,event){var i,j,m=$.ui.ddmanager.droppables[t.options.scope]||[],type=event?event.type:null,list=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();droppablesLoop:for(i=0;i<m.length;i++)if(!(m[i].options.disabled||t&&!m[i].accept.call(m[i].element[0],t.currentItem||t.element))){for(j=0;j<list.length;j++)if(list[j]===m[i].element[0]){m[i].proportions.height=0;continue droppablesLoop}m[i].visible="none"!==m[i].element.css("display"),m[i].visible&&("mousedown"===type&&m[i]._activate.call(m[i],event),m[i].offset=m[i].element.offset(),m[i].proportions={width:m[i].element[0].offsetWidth,height:m[i].element[0].offsetHeight})}},drop:function(draggable,event){var dropped=!1;return $.each(($.ui.ddmanager.droppables[draggable.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&$.ui.intersect(draggable,this,this.options.tolerance)&&(dropped=this._drop.call(this,event)||dropped),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],draggable.currentItem||draggable.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,event)))}),dropped},dragStart:function(draggable,event){draggable.element.parentsUntil("body").bind("scroll.droppable",function(){draggable.options.refreshPositions||$.ui.ddmanager.prepareOffsets(draggable,event)})},drag:function(draggable,event){draggable.options.refreshPositions&&$.ui.ddmanager.prepareOffsets(draggable,event),$.each($.ui.ddmanager.droppables[draggable.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var parentInstance,scope,parent,intersects=$.ui.intersect(draggable,this,this.options.tolerance),c=!intersects&&this.isover?"isout":intersects&&!this.isover?"isover":null;c&&(this.options.greedy&&(scope=this.options.scope,parent=this.element.parents(":data(ui-droppable)").filter(function(){return $.data(this,"ui-droppable").options.scope===scope}),parent.length&&(parentInstance=$.data(parent[0],"ui-droppable"),parentInstance.greedyChild="isover"===c)),parentInstance&&"isover"===c&&(parentInstance.isover=!1,parentInstance.isout=!0,parentInstance._out.call(parentInstance,event)),this[c]=!0,this["isout"===c?"isover":"isout"]=!1,this["isover"===c?"_over":"_out"].call(this,event),parentInstance&&"isout"===c&&(parentInstance.isout=!1,parentInstance.isover=!0,parentInstance._over.call(parentInstance,event)))}})},dragStop:function(draggable,event){draggable.element.parentsUntil("body").unbind("scroll.droppable"),draggable.options.refreshPositions||$.ui.ddmanager.prepareOffsets(draggable,event)}}}(jQuery),function($){function isOverAxis(x,reference,size){return x>reference&&reference+size>x}function isFloating(item){return/left|right/.test(item.css("float"))||/inline|table-cell/.test(item.css("display"))}$.widget("ui.sortable",$.ui.mouse,{version:"1.10.3",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var o=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===o.axis||isFloating(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var i=this.items.length-1;i>=0;i--)this.items[i].item.removeData(this.widgetName+"-item");return this},_setOption:function(key,value){"disabled"===key?(this.options[key]=value,this.widget().toggleClass("ui-sortable-disabled",!!value)):$.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(event,overrideHandle){var currentItem=null,validHandle=!1,that=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(event),$(event.target).parents().each(function(){return $.data(this,that.widgetName+"-item")===that?(currentItem=$(this),!1):void 0}),$.data(event.target,that.widgetName+"-item")===that&&(currentItem=$(event.target)),currentItem&&(!this.options.handle||overrideHandle||($(this.options.handle,currentItem).find("*").addBack().each(function(){this===event.target&&(validHandle=!0)}),validHandle))?(this.currentItem=currentItem,this._removeCurrentsFromItems(),!0):!1)},_mouseStart:function(event,overrideHandle,noActivation){var i,body,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(event),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(event),this.originalPageX=event.pageX,this.originalPageY=event.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&"auto"!==o.cursor&&(body=this.document.find("body"),this.storedCursor=body.css("cursor"),body.css("cursor",o.cursor),this.storedStylesheet=$("<style>*{ cursor: "+o.cursor+" !important; }</style>").appendTo(body)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",event,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!noActivation)for(i=this.containers.length-1;i>=0;i--)this.containers[i]._trigger("activate",event,this._uiHash(this));return $.ui.ddmanager&&($.ui.ddmanager.current=this),$.ui.ddmanager&&!o.dropBehaviour&&$.ui.ddmanager.prepareOffsets(this,event),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(event),!0},_mouseDrag:function(event){var i,item,itemElement,intersection,o=this.options,scrolled=!1;for(this.position=this._generatePosition(event),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-event.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop+o.scrollSpeed:event.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-event.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft+o.scrollSpeed:event.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(event.pageY-$(document).scrollTop()<o.scrollSensitivity?scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed):$(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity&&(scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed)),event.pageX-$(document).scrollLeft()<o.scrollSensitivity?scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed):$(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity&&(scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed))),scrolled!==!1&&$.ui.ddmanager&&!o.dropBehaviour&&$.ui.ddmanager.prepareOffsets(this,event)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(item=this.items[i],itemElement=item.item[0],intersection=this._intersectsWithPointer(item),intersection&&item.instance===this.currentContainer&&itemElement!==this.currentItem[0]&&this.placeholder[1===intersection?"next":"prev"]()[0]!==itemElement&&!$.contains(this.placeholder[0],itemElement)&&("semi-dynamic"===this.options.type?!$.contains(this.element[0],itemElement):!0)){if(this.direction=1===intersection?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(item))break;this._rearrange(event,item),this._trigger("change",event,this._uiHash());break}return this._contactContainers(event),$.ui.ddmanager&&$.ui.ddmanager.drag(this,event),this._trigger("sort",event,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(event,noPropagation){if(event){if($.ui.ddmanager&&!this.options.dropBehaviour&&$.ui.ddmanager.drop(this,event),this.options.revert){var that=this,cur=this.placeholder.offset(),axis=this.options.axis,animation={};axis&&"x"!==axis||(animation.left=cur.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),axis&&"y"!==axis||(animation.top=cur.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,$(this.helper).animate(animation,parseInt(this.options.revert,10)||500,function(){that._clear(event)})}else this._clear(event,noPropagation);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var i=this.containers.length-1;i>=0;i--)this.containers[i]._trigger("deactivate",null,this._uiHash(this)),this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",null,this._uiHash(this)),this.containers[i].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),$.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?$(this.domPosition.prev).after(this.currentItem):$(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(o){var items=this._getItemsAsjQuery(o&&o.connected),str=[];return o=o||{},$(items).each(function(){var res=($(o.item||this).attr(o.attribute||"id")||"").match(o.expression||/(.+)[\-=_](.+)/);res&&str.push((o.key||res[1]+"[]")+"="+(o.key&&o.expression?res[1]:res[2]))}),!str.length&&o.key&&str.push(o.key+"="),str.join("&")},toArray:function(o){var items=this._getItemsAsjQuery(o&&o.connected),ret=[];return o=o||{},items.each(function(){ret.push($(o.item||this).attr(o.attribute||"id")||"")}),ret},_intersectsWith:function(item){var x1=this.positionAbs.left,x2=x1+this.helperProportions.width,y1=this.positionAbs.top,y2=y1+this.helperProportions.height,l=item.left,r=l+item.width,t=item.top,b=t+item.height,dyClick=this.offset.click.top,dxClick=this.offset.click.left,isOverElementHeight="x"===this.options.axis||y1+dyClick>t&&b>y1+dyClick,isOverElementWidth="y"===this.options.axis||x1+dxClick>l&&r>x1+dxClick,isOverElement=isOverElementHeight&&isOverElementWidth;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>item[this.floating?"width":"height"]?isOverElement:l<x1+this.helperProportions.width/2&&x2-this.helperProportions.width/2<r&&t<y1+this.helperProportions.height/2&&y2-this.helperProportions.height/2<b},_intersectsWithPointer:function(item){var isOverElementHeight="x"===this.options.axis||isOverAxis(this.positionAbs.top+this.offset.click.top,item.top,item.height),isOverElementWidth="y"===this.options.axis||isOverAxis(this.positionAbs.left+this.offset.click.left,item.left,item.width),isOverElement=isOverElementHeight&&isOverElementWidth,verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();
return isOverElement?this.floating?horizontalDirection&&"right"===horizontalDirection||"down"===verticalDirection?2:1:verticalDirection&&("down"===verticalDirection?2:1):!1},_intersectsWithSides:function(item){var isOverBottomHalf=isOverAxis(this.positionAbs.top+this.offset.click.top,item.top+item.height/2,item.height),isOverRightHalf=isOverAxis(this.positionAbs.left+this.offset.click.left,item.left+item.width/2,item.width),verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();return this.floating&&horizontalDirection?"right"===horizontalDirection&&isOverRightHalf||"left"===horizontalDirection&&!isOverRightHalf:verticalDirection&&("down"===verticalDirection&&isOverBottomHalf||"up"===verticalDirection&&!isOverBottomHalf)},_getDragVerticalDirection:function(){var delta=this.positionAbs.top-this.lastPositionAbs.top;return 0!==delta&&(delta>0?"down":"up")},_getDragHorizontalDirection:function(){var delta=this.positionAbs.left-this.lastPositionAbs.left;return 0!==delta&&(delta>0?"right":"left")},refresh:function(event){return this._refreshItems(event),this.refreshPositions(),this},_connectWith:function(){var options=this.options;return options.connectWith.constructor===String?[options.connectWith]:options.connectWith},_getItemsAsjQuery:function(connected){var i,j,cur,inst,items=[],queries=[],connectWith=this._connectWith();if(connectWith&&connected)for(i=connectWith.length-1;i>=0;i--)for(cur=$(connectWith[i]),j=cur.length-1;j>=0;j--)inst=$.data(cur[j],this.widgetFullName),inst&&inst!==this&&!inst.options.disabled&&queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element):$(inst.options.items,inst.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),inst]);for(queries.push([$.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):$(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),i=queries.length-1;i>=0;i--)queries[i][0].each(function(){items.push(this)});return $(items)},_removeCurrentsFromItems:function(){var list=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=$.grep(this.items,function(item){for(var j=0;j<list.length;j++)if(list[j]===item.item[0])return!1;return!0})},_refreshItems:function(event){this.items=[],this.containers=[this];var i,j,cur,inst,targetData,_queries,item,queriesLength,items=this.items,queries=[[$.isFunction(this.options.items)?this.options.items.call(this.element[0],event,{item:this.currentItem}):$(this.options.items,this.element),this]],connectWith=this._connectWith();if(connectWith&&this.ready)for(i=connectWith.length-1;i>=0;i--)for(cur=$(connectWith[i]),j=cur.length-1;j>=0;j--)inst=$.data(cur[j],this.widgetFullName),inst&&inst!==this&&!inst.options.disabled&&(queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element[0],event,{item:this.currentItem}):$(inst.options.items,inst.element),inst]),this.containers.push(inst));for(i=queries.length-1;i>=0;i--)for(targetData=queries[i][1],_queries=queries[i][0],j=0,queriesLength=_queries.length;queriesLength>j;j++)item=$(_queries[j]),item.data(this.widgetName+"-item",targetData),items.push({item:item,instance:targetData,width:0,height:0,left:0,top:0})},refreshPositions:function(fast){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,item,t,p;for(i=this.items.length-1;i>=0;i--)item=this.items[i],item.instance!==this.currentContainer&&this.currentContainer&&item.item[0]!==this.currentItem[0]||(t=this.options.toleranceElement?$(this.options.toleranceElement,item.item):item.item,fast||(item.width=t.outerWidth(),item.height=t.outerHeight()),p=t.offset(),item.left=p.left,item.top=p.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)p=this.containers[i].element.offset(),this.containers[i].containerCache.left=p.left,this.containers[i].containerCache.top=p.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(that){that=that||this;var className,o=that.options;o.placeholder&&o.placeholder.constructor!==String||(className=o.placeholder,o.placeholder={element:function(){var nodeName=that.currentItem[0].nodeName.toLowerCase(),element=$("<"+nodeName+">",that.document[0]).addClass(className||that.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===nodeName?that.currentItem.children().each(function(){$("<td>&#160;</td>",that.document[0]).attr("colspan",$(this).attr("colspan")||1).appendTo(element)}):"img"===nodeName&&element.attr("src",that.currentItem.attr("src")),className||element.css("visibility","hidden"),element},update:function(container,p){(!className||o.forcePlaceholderSize)&&(p.height()||p.height(that.currentItem.innerHeight()-parseInt(that.currentItem.css("paddingTop")||0,10)-parseInt(that.currentItem.css("paddingBottom")||0,10)),p.width()||p.width(that.currentItem.innerWidth()-parseInt(that.currentItem.css("paddingLeft")||0,10)-parseInt(that.currentItem.css("paddingRight")||0,10)))}}),that.placeholder=$(o.placeholder.element.call(that.element,that.currentItem)),that.currentItem.after(that.placeholder),o.placeholder.update(that,that.placeholder)},_contactContainers:function(event){var i,j,dist,itemWithLeastDistance,posProperty,sizeProperty,base,cur,nearBottom,floating,innermostContainer=null,innermostIndex=null;for(i=this.containers.length-1;i>=0;i--)if(!$.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(innermostContainer&&$.contains(this.containers[i].element[0],innermostContainer.element[0]))continue;innermostContainer=this.containers[i],innermostIndex=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",event,this._uiHash(this)),this.containers[i].containerCache.over=0);if(innermostContainer)if(1===this.containers.length)this.containers[innermostIndex].containerCache.over||(this.containers[innermostIndex]._trigger("over",event,this._uiHash(this)),this.containers[innermostIndex].containerCache.over=1);else{for(dist=1e4,itemWithLeastDistance=null,floating=innermostContainer.floating||isFloating(this.currentItem),posProperty=floating?"left":"top",sizeProperty=floating?"width":"height",base=this.positionAbs[posProperty]+this.offset.click[posProperty],j=this.items.length-1;j>=0;j--)$.contains(this.containers[innermostIndex].element[0],this.items[j].item[0])&&this.items[j].item[0]!==this.currentItem[0]&&(!floating||isOverAxis(this.positionAbs.top+this.offset.click.top,this.items[j].top,this.items[j].height))&&(cur=this.items[j].item.offset()[posProperty],nearBottom=!1,Math.abs(cur-base)>Math.abs(cur+this.items[j][sizeProperty]-base)&&(nearBottom=!0,cur+=this.items[j][sizeProperty]),Math.abs(cur-base)<dist&&(dist=Math.abs(cur-base),itemWithLeastDistance=this.items[j],this.direction=nearBottom?"up":"down"));if(!itemWithLeastDistance&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[innermostIndex])return;itemWithLeastDistance?this._rearrange(event,itemWithLeastDistance,null,!0):this._rearrange(event,null,this.containers[innermostIndex].element,!0),this._trigger("change",event,this._uiHash()),this.containers[innermostIndex]._trigger("change",event,this._uiHash(this)),this.currentContainer=this.containers[innermostIndex],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[innermostIndex]._trigger("over",event,this._uiHash(this)),this.containers[innermostIndex].containerCache.over=1}},_createHelper:function(event){var o=this.options,helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event,this.currentItem])):"clone"===o.helper?this.currentItem.clone():this.currentItem;return helper.parents("body").length||$("parent"!==o.appendTo?o.appendTo:this.currentItem[0].parentNode)[0].appendChild(helper[0]),helper[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!helper[0].style.width||o.forceHelperSize)&&helper.width(this.currentItem.width()),(!helper[0].style.height||o.forceHelperSize)&&helper.height(this.currentItem.height()),helper},_adjustOffsetFromHelper:function(obj){"string"==typeof obj&&(obj=obj.split(" ")),$.isArray(obj)&&(obj={left:+obj[0],top:+obj[1]||0}),"left"in obj&&(this.offset.click.left=obj.left+this.margins.left),"right"in obj&&(this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left),"top"in obj&&(this.offset.click.top=obj.top+this.margins.top),"bottom"in obj&&(this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])&&(po.left+=this.scrollParent.scrollLeft(),po.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&$.ui.ie)&&(po={top:0,left:0}),{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var p=this.currentItem.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var ce,co,over,o=this.options;"parent"===o.containment&&(o.containment=this.helper[0].parentNode),("document"===o.containment||"window"===o.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,$("document"===o.containment?document:window).width()-this.helperProportions.width-this.margins.left,($("document"===o.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(o.containment)||(ce=$(o.containment)[0],co=$(o.containment).offset(),over="hidden"!==$(ce).css("overflow"),this.containment=[co.left+(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0)-this.margins.left,co.top+(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0)-this.margins.top,co.left+(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,co.top+(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(d,pos){pos||(pos=this.position);var mod="absolute"===d?1:-1,scroll="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,scrollIsRootNode=/(html|body)/i.test(scroll[0].tagName);return{top:pos.top+this.offset.relative.top*mod+this.offset.parent.top*mod-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():scrollIsRootNode?0:scroll.scrollTop())*mod,left:pos.left+this.offset.relative.left*mod+this.offset.parent.left*mod-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod}},_generatePosition:function(event){var top,left,o=this.options,pageX=event.pageX,pageY=event.pageY,scroll="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&$.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,scrollIsRootNode=/(html|body)/i.test(scroll[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(event.pageX-this.offset.click.left<this.containment[0]&&(pageX=this.containment[0]+this.offset.click.left),event.pageY-this.offset.click.top<this.containment[1]&&(pageY=this.containment[1]+this.offset.click.top),event.pageX-this.offset.click.left>this.containment[2]&&(pageX=this.containment[2]+this.offset.click.left),event.pageY-this.offset.click.top>this.containment[3]&&(pageY=this.containment[3]+this.offset.click.top)),o.grid&&(top=this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1],pageY=this.containment?top-this.offset.click.top>=this.containment[1]&&top-this.offset.click.top<=this.containment[3]?top:top-this.offset.click.top>=this.containment[1]?top-o.grid[1]:top+o.grid[1]:top,left=this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0],pageX=this.containment?left-this.offset.click.left>=this.containment[0]&&left-this.offset.click.left<=this.containment[2]?left:left-this.offset.click.left>=this.containment[0]?left-o.grid[0]:left+o.grid[0]:left)),{top:pageY-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():scrollIsRootNode?0:scroll.scrollTop()),left:pageX-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())}},_rearrange:function(event,i,a,hardRefresh){a?a[0].appendChild(this.placeholder[0]):i.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?i.item[0]:i.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var counter=this.counter;this._delay(function(){counter===this.counter&&this.refreshPositions(!hardRefresh)})},_clear:function(event,noPropagation){this.reverting=!1;var i,delayedTriggers=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)("auto"===this._storedCSS[i]||"static"===this._storedCSS[i])&&(this._storedCSS[i]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!noPropagation&&delayedTriggers.push(function(event){this._trigger("receive",event,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||noPropagation||delayedTriggers.push(function(event){this._trigger("update",event,this._uiHash())}),this!==this.currentContainer&&(noPropagation||(delayedTriggers.push(function(event){this._trigger("remove",event,this._uiHash())}),delayedTriggers.push(function(c){return function(event){c._trigger("receive",event,this._uiHash(this))}}.call(this,this.currentContainer)),delayedTriggers.push(function(c){return function(event){c._trigger("update",event,this._uiHash(this))}}.call(this,this.currentContainer)))),i=this.containers.length-1;i>=0;i--)noPropagation||delayedTriggers.push(function(c){return function(event){c._trigger("deactivate",event,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over&&(delayedTriggers.push(function(c){return function(event){c._trigger("out",event,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!noPropagation){for(this._trigger("beforeStop",event,this._uiHash()),i=0;i<delayedTriggers.length;i++)delayedTriggers[i].call(this,event);this._trigger("stop",event,this._uiHash())}return this.fromOutside=!1,!1}if(noPropagation||this._trigger("beforeStop",event,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!noPropagation){for(i=0;i<delayedTriggers.length;i++)delayedTriggers[i].call(this,event);this._trigger("stop",event,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){$.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(_inst){var inst=_inst||this;return{helper:inst.helper,placeholder:inst.placeholder||$([]),position:inst.position,originalPosition:inst.originalPosition,offset:inst.positionAbs,item:inst.currentItem,sender:_inst?_inst.element:null}}})}(jQuery),window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));var swfobject=function(){function callDomLoadFunctions(){if(!isDomLoaded){try{var t=doc.getElementsByTagName("body")[0].appendChild(createElement("span"));t.parentNode.removeChild(t)}catch(e){return}isDomLoaded=!0;for(var dl=domLoadFnArr.length,i=0;dl>i;i++)domLoadFnArr[i]()}}function addDomLoadEvent(fn){isDomLoaded?fn():domLoadFnArr[domLoadFnArr.length]=fn}function addLoadEvent(fn){if(typeof win.addEventListener!=UNDEF)win.addEventListener("load",fn,!1);else if(typeof doc.addEventListener!=UNDEF)doc.addEventListener("load",fn,!1);else if(typeof win.attachEvent!=UNDEF)addListener(win,"onload",fn);else if("function"==typeof win.onload){var fnOld=win.onload;win.onload=function(){fnOld(),fn()}}else win.onload=fn}function main(){plugin?testPlayerVersion():matchVersions()}function testPlayerVersion(){var b=doc.getElementsByTagName("body")[0],o=createElement(OBJECT);o.setAttribute("type",FLASH_MIME_TYPE);var t=b.appendChild(o);if(t){var counter=0;!function(){if(typeof t.GetVariable!=UNDEF){var d=t.GetVariable("$version");d&&(d=d.split(" ")[1].split(","),ua.pv=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)])}else if(10>counter)return counter++,void setTimeout(arguments.callee,10);b.removeChild(o),t=null,matchVersions()}()}else matchVersions()}function matchVersions(){var rl=regObjArr.length;if(rl>0)for(var i=0;rl>i;i++){var id=regObjArr[i].id,cb=regObjArr[i].callbackFn,cbObj={success:!1,id:id};if(ua.pv[0]>0){var obj=getElementById(id);if(obj)if(!hasPlayerVersion(regObjArr[i].swfVersion)||ua.wk&&ua.wk<312)if(regObjArr[i].expressInstall&&canExpressInstall()){var att={};att.data=regObjArr[i].expressInstall,att.width=obj.getAttribute("width")||"0",att.height=obj.getAttribute("height")||"0",obj.getAttribute("class")&&(att.styleclass=obj.getAttribute("class")),obj.getAttribute("align")&&(att.align=obj.getAttribute("align"));for(var par={},p=obj.getElementsByTagName("param"),pl=p.length,j=0;pl>j;j++)"movie"!=p[j].getAttribute("name").toLowerCase()&&(par[p[j].getAttribute("name")]=p[j].getAttribute("value"));showExpressInstall(att,par,id,cb)}else displayAltContent(obj),cb&&cb(cbObj);else setVisibility(id,!0),cb&&(cbObj.success=!0,cbObj.ref=getObjectById(id),cb(cbObj))}else if(setVisibility(id,!0),cb){var o=getObjectById(id);o&&typeof o.SetVariable!=UNDEF&&(cbObj.success=!0,cbObj.ref=o),cb(cbObj)}}}function getObjectById(objectIdStr){var r=null,o=getElementById(objectIdStr);if(o&&"OBJECT"==o.nodeName)if(typeof o.SetVariable!=UNDEF)r=o;else{var n=o.getElementsByTagName(OBJECT)[0];n&&(r=n)}return r}function canExpressInstall(){return!isExpressInstallActive&&hasPlayerVersion("6.0.65")&&(ua.win||ua.mac)&&!(ua.wk&&ua.wk<312)}function showExpressInstall(att,par,replaceElemIdStr,callbackFn){isExpressInstallActive=!0,storedCallbackFn=callbackFn||null,storedCallbackObj={success:!1,id:replaceElemIdStr};var obj=getElementById(replaceElemIdStr);if(obj){"OBJECT"==obj.nodeName?(storedAltContent=abstractAltContent(obj),storedAltContentId=null):(storedAltContent=obj,storedAltContentId=replaceElemIdStr),att.id=EXPRESS_INSTALL_ID,(typeof att.width==UNDEF||!/%$/.test(att.width)&&parseInt(att.width,10)<310)&&(att.width="310"),(typeof att.height==UNDEF||!/%$/.test(att.height)&&parseInt(att.height,10)<137)&&(att.height="137"),doc.title=doc.title.slice(0,47)+" - Flash Player Installation";var pt=ua.ie&&ua.win?"ActiveX":"PlugIn",fv="MMredirectURL="+win.location.toString().replace(/&/g,"%26")+"&MMplayerType="+pt+"&MMdoctitle="+doc.title;if(typeof par.flashvars!=UNDEF?par.flashvars+="&"+fv:par.flashvars=fv,ua.ie&&ua.win&&4!=obj.readyState){var newObj=createElement("div");replaceElemIdStr+="SWFObjectNew",newObj.setAttribute("id",replaceElemIdStr),obj.parentNode.insertBefore(newObj,obj),obj.style.display="none",function(){4==obj.readyState?obj.parentNode.removeChild(obj):setTimeout(arguments.callee,10)}()}createSWF(att,par,replaceElemIdStr)}}function displayAltContent(obj){if(ua.ie&&ua.win&&4!=obj.readyState){var el=createElement("div");obj.parentNode.insertBefore(el,obj),el.parentNode.replaceChild(abstractAltContent(obj),el),obj.style.display="none",function(){4==obj.readyState?obj.parentNode.removeChild(obj):setTimeout(arguments.callee,10)}()}else obj.parentNode.replaceChild(abstractAltContent(obj),obj)}function abstractAltContent(obj){var ac=createElement("div");if(ua.win&&ua.ie)ac.innerHTML=obj.innerHTML;else{var nestedObj=obj.getElementsByTagName(OBJECT)[0];if(nestedObj){var c=nestedObj.childNodes;if(c)for(var cl=c.length,i=0;cl>i;i++)1==c[i].nodeType&&"PARAM"==c[i].nodeName||8==c[i].nodeType||ac.appendChild(c[i].cloneNode(!0))}}return ac}function createSWF(attObj,parObj,id){var r,el=getElementById(id);if(ua.wk&&ua.wk<312)return r;if(el)if(typeof attObj.id==UNDEF&&(attObj.id=id),ua.ie&&ua.win){var att="";for(var i in attObj)attObj[i]!=Object.prototype[i]&&("data"==i.toLowerCase()?parObj.movie=attObj[i]:"styleclass"==i.toLowerCase()?att+=' class="'+attObj[i]+'"':"classid"!=i.toLowerCase()&&(att+=" "+i+'="'+attObj[i]+'"'));var par="";for(var j in parObj)parObj[j]!=Object.prototype[j]&&(par+='<param name="'+j+'" value="'+parObj[j]+'" />');el.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+att+">"+par+"</object>",objIdArr[objIdArr.length]=attObj.id,r=getElementById(attObj.id)}else{var o=createElement(OBJECT);o.setAttribute("type",FLASH_MIME_TYPE);for(var m in attObj)attObj[m]!=Object.prototype[m]&&("styleclass"==m.toLowerCase()?o.setAttribute("class",attObj[m]):"classid"!=m.toLowerCase()&&o.setAttribute(m,attObj[m]));for(var n in parObj)parObj[n]!=Object.prototype[n]&&"movie"!=n.toLowerCase()&&createObjParam(o,n,parObj[n]);el.parentNode.replaceChild(o,el),r=o}return r}function createObjParam(el,pName,pValue){var p=createElement("param");p.setAttribute("name",pName),p.setAttribute("value",pValue),el.appendChild(p)}function removeSWF(id){var obj=getElementById(id);obj&&"OBJECT"==obj.nodeName&&(ua.ie&&ua.win?(obj.style.display="none",function(){4==obj.readyState?removeObjectInIE(id):setTimeout(arguments.callee,10)}()):obj.parentNode.removeChild(obj))}function removeObjectInIE(id){var obj=getElementById(id);if(obj){for(var i in obj)"function"==typeof obj[i]&&(obj[i]=null);obj.parentNode.removeChild(obj)}}function getElementById(id){var el=null;try{el=doc.getElementById(id)}catch(e){}return el}function createElement(el){return doc.createElement(el)}function addListener(target,eventType,fn){target.attachEvent(eventType,fn),listenersArr[listenersArr.length]=[target,eventType,fn]}function hasPlayerVersion(rv){var pv=ua.pv,v=rv.split(".");return v[0]=parseInt(v[0],10),v[1]=parseInt(v[1],10)||0,v[2]=parseInt(v[2],10)||0,pv[0]>v[0]||pv[0]==v[0]&&pv[1]>v[1]||pv[0]==v[0]&&pv[1]==v[1]&&pv[2]>=v[2]?!0:!1}function createCSS(sel,decl,media,newStyle){if(!ua.ie||!ua.mac){var h=doc.getElementsByTagName("head")[0];if(h){var m=media&&"string"==typeof media?media:"screen";if(newStyle&&(dynamicStylesheet=null,dynamicStylesheetMedia=null),!dynamicStylesheet||dynamicStylesheetMedia!=m){var s=createElement("style");s.setAttribute("type","text/css"),s.setAttribute("media",m),dynamicStylesheet=h.appendChild(s),ua.ie&&ua.win&&typeof doc.styleSheets!=UNDEF&&doc.styleSheets.length>0&&(dynamicStylesheet=doc.styleSheets[doc.styleSheets.length-1]),dynamicStylesheetMedia=m}ua.ie&&ua.win?dynamicStylesheet&&typeof dynamicStylesheet.addRule==OBJECT&&dynamicStylesheet.addRule(sel,decl):dynamicStylesheet&&typeof doc.createTextNode!=UNDEF&&dynamicStylesheet.appendChild(doc.createTextNode(sel+" {"+decl+"}"))}}}function setVisibility(id,isVisible){if(autoHideShow){var v=isVisible?"visible":"hidden";isDomLoaded&&getElementById(id)?getElementById(id).style.visibility=v:createCSS("#"+id,"visibility:"+v)}}function urlEncodeIfNecessary(s){var regex=/[\\\"<>\.;]/,hasBadChars=null!=regex.exec(s);return hasBadChars&&typeof encodeURIComponent!=UNDEF?encodeURIComponent(s):s}{var storedAltContent,storedAltContentId,storedCallbackFn,storedCallbackObj,dynamicStylesheet,dynamicStylesheetMedia,UNDEF="undefined",OBJECT="object",SHOCKWAVE_FLASH="Shockwave Flash",SHOCKWAVE_FLASH_AX="ShockwaveFlash.ShockwaveFlash",FLASH_MIME_TYPE="application/x-shockwave-flash",EXPRESS_INSTALL_ID="SWFObjectExprInst",ON_READY_STATE_CHANGE="onreadystatechange",win=window,doc=document,nav=navigator,plugin=!1,domLoadFnArr=[main],regObjArr=[],objIdArr=[],listenersArr=[],isDomLoaded=!1,isExpressInstallActive=!1,autoHideShow=!0,ua=function(){var w3cdom=typeof doc.getElementById!=UNDEF&&typeof doc.getElementsByTagName!=UNDEF&&typeof doc.createElement!=UNDEF,u=nav.userAgent.toLowerCase(),p=nav.platform.toLowerCase(),windows=/win/.test(p?p:u),mac=/mac/.test(p?p:u),webkit=/webkit/.test(u)?parseFloat(u.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,ie=!1,playerVersion=[0,0,0],d=null;if(typeof nav.plugins!=UNDEF&&typeof nav.plugins[SHOCKWAVE_FLASH]==OBJECT)d=nav.plugins[SHOCKWAVE_FLASH].description,!d||typeof nav.mimeTypes!=UNDEF&&nav.mimeTypes[FLASH_MIME_TYPE]&&!nav.mimeTypes[FLASH_MIME_TYPE].enabledPlugin||(plugin=!0,ie=!1,d=d.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),playerVersion[0]=parseInt(d.replace(/^(.*)\..*$/,"$1"),10),playerVersion[1]=parseInt(d.replace(/^.*\.(.*)\s.*$/,"$1"),10),playerVersion[2]=/[a-zA-Z]/.test(d)?parseInt(d.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof win.ActiveXObject!=UNDEF)try{var a=new ActiveXObject(SHOCKWAVE_FLASH_AX);a&&(d=a.GetVariable("$version"),d&&(ie=!0,d=d.split(" ")[1].split(","),playerVersion=[parseInt(d[0],10),parseInt(d[1],10),parseInt(d[2],10)]))}catch(e){}return{w3:w3cdom,pv:playerVersion,wk:webkit,ie:ie,win:windows,mac:mac}}();!function(){ua.w3&&((typeof doc.readyState!=UNDEF&&"complete"==doc.readyState||typeof doc.readyState==UNDEF&&(doc.getElementsByTagName("body")[0]||doc.body))&&callDomLoadFunctions(),isDomLoaded||(typeof doc.addEventListener!=UNDEF&&doc.addEventListener("DOMContentLoaded",callDomLoadFunctions,!1),ua.ie&&ua.win&&(doc.attachEvent(ON_READY_STATE_CHANGE,function(){"complete"==doc.readyState&&(doc.detachEvent(ON_READY_STATE_CHANGE,arguments.callee),callDomLoadFunctions())}),win==top&&!function(){if(!isDomLoaded){try{doc.documentElement.doScroll("left")}catch(e){return void setTimeout(arguments.callee,0)}callDomLoadFunctions()}}()),ua.wk&&!function(){return isDomLoaded?void 0:/loaded|complete/.test(doc.readyState)?void callDomLoadFunctions():void setTimeout(arguments.callee,0)}(),addLoadEvent(callDomLoadFunctions)))}(),function(){ua.ie&&ua.win&&window.attachEvent("onunload",function(){for(var ll=listenersArr.length,i=0;ll>i;i++)listenersArr[i][0].detachEvent(listenersArr[i][1],listenersArr[i][2]);for(var il=objIdArr.length,j=0;il>j;j++)removeSWF(objIdArr[j]);for(var k in ua)ua[k]=null;ua=null;for(var l in swfobject)swfobject[l]=null;swfobject=null})}()}return{registerObject:function(objectIdStr,swfVersionStr,xiSwfUrlStr,callbackFn){if(ua.w3&&objectIdStr&&swfVersionStr){var regObj={};regObj.id=objectIdStr,regObj.swfVersion=swfVersionStr,regObj.expressInstall=xiSwfUrlStr,regObj.callbackFn=callbackFn,regObjArr[regObjArr.length]=regObj,setVisibility(objectIdStr,!1)}else callbackFn&&callbackFn({success:!1,id:objectIdStr})},getObjectById:function(objectIdStr){return ua.w3?getObjectById(objectIdStr):void 0},embedSWF:function(swfUrlStr,replaceElemIdStr,widthStr,heightStr,swfVersionStr,xiSwfUrlStr,flashvarsObj,parObj,attObj,callbackFn){var callbackObj={success:!1,id:replaceElemIdStr};ua.w3&&!(ua.wk&&ua.wk<312)&&swfUrlStr&&replaceElemIdStr&&widthStr&&heightStr&&swfVersionStr?(setVisibility(replaceElemIdStr,!1),addDomLoadEvent(function(){widthStr+="",heightStr+="";var att={};if(attObj&&typeof attObj===OBJECT)for(var i in attObj)att[i]=attObj[i];att.data=swfUrlStr,att.width=widthStr,att.height=heightStr;var par={};if(parObj&&typeof parObj===OBJECT)for(var j in parObj)par[j]=parObj[j];if(flashvarsObj&&typeof flashvarsObj===OBJECT)for(var k in flashvarsObj)typeof par.flashvars!=UNDEF?par.flashvars+="&"+k+"="+flashvarsObj[k]:par.flashvars=k+"="+flashvarsObj[k];if(hasPlayerVersion(swfVersionStr)){var obj=createSWF(att,par,replaceElemIdStr);att.id==replaceElemIdStr&&setVisibility(replaceElemIdStr,!0),callbackObj.success=!0,callbackObj.ref=obj}else{if(xiSwfUrlStr&&canExpressInstall())return att.data=xiSwfUrlStr,void showExpressInstall(att,par,replaceElemIdStr,callbackFn);setVisibility(replaceElemIdStr,!0)}callbackFn&&callbackFn(callbackObj)})):callbackFn&&callbackFn(callbackObj)},switchOffAutoHideShow:function(){autoHideShow=!1},ua:ua,getFlashPlayerVersion:function(){return{major:ua.pv[0],minor:ua.pv[1],release:ua.pv[2]}},hasFlashPlayerVersion:hasPlayerVersion,createSWF:function(attObj,parObj,replaceElemIdStr){return ua.w3?createSWF(attObj,parObj,replaceElemIdStr):void 0},showExpressInstall:function(att,par,replaceElemIdStr,callbackFn){ua.w3&&canExpressInstall()&&showExpressInstall(att,par,replaceElemIdStr,callbackFn)},removeSWF:function(objElemIdStr){ua.w3&&removeSWF(objElemIdStr)},createCSS:function(selStr,declStr,mediaStr,newStyleBoolean){ua.w3&&createCSS(selStr,declStr,mediaStr,newStyleBoolean)},addDomLoadEvent:addDomLoadEvent,addLoadEvent:addLoadEvent,getQueryParamValue:function(param){var q=doc.location.search||doc.location.hash;if(q){if(/\?/.test(q)&&(q=q.split("?")[1]),null==param)return urlEncodeIfNecessary(q);for(var pairs=q.split("&"),i=0;i<pairs.length;i++)if(pairs[i].substring(0,pairs[i].indexOf("="))==param)return urlEncodeIfNecessary(pairs[i].substring(pairs[i].indexOf("=")+1))}return""},expressInstallCallback:function(){if(isExpressInstallActive){var obj=getElementById(EXPRESS_INSTALL_ID);obj&&storedAltContent&&(obj.parentNode.replaceChild(storedAltContent,obj),storedAltContentId&&(setVisibility(storedAltContentId,!0),ua.ie&&ua.win&&(storedAltContent.style.display="block")),storedCallbackFn&&storedCallbackFn(storedCallbackObj)),isExpressInstallActive=!1}}}}();UUID.generate=function(){var rand=UUID._gri,hex=UUID._ha;return hex(rand(32),8)+"-"+hex(rand(16),4)+"-"+hex(16384|rand(12),4)+"-"+hex(32768|rand(14),4)+"-"+hex(rand(48),12)},UUID._gri=function(x){return 0>x?0/0:30>=x?0|Math.random()*(1<<x):53>=x?(0|Math.random()*(1<<30))+(0|Math.random()*(1<<x-30))*(1<<30):0/0},UUID._ha=function(num,length){for(var str=num.toString(16),i=length-str.length,z="0";i>0;i>>>=1,z+=z)1&i&&(str=z+str);return str};var Protocol=function(){var PostMessageProtocol=function(otherWindow,currentWindow){this._otherWindow=otherWindow,this._currentWindow=currentWindow,this._callbacks={},this._listenToPostMessage()};PostMessageProtocol.prototype.trigger=function(type,payload){var message=JSON.stringify({type:type,payload:payload});
window.debug&&console.log("PostMessage sent:",message),this._otherWindow.postMessage(message,"*")},PostMessageProtocol.prototype.on=function(type,callback){this._callbacks[type]=this._callbacks[type]||[],this._callbacks[type].push(callback)},PostMessageProtocol.prototype._listenToPostMessage=function(){var protocol=this,handleMessage=function(event){protocol._handleMessage(event)};this._currentWindow.addEventListener("message",handleMessage,!1)},PostMessageProtocol.prototype._handleMessage=function(event){var callbacks,message,i;if(event.source===this._otherWindow&&(window.debug&&console.log("PostMessage received:",event.data),message=JSON.parse(event.data),callbacks=this._callbacks[message.type]))for(i=0;i<callbacks.length;i++)callbacks[i](message)};var EditorProtocol=function(protocol){this._protocol=protocol};EditorProtocol.prototype.onReady=function(callback){this._protocol.on("ready",callback)},EditorProtocol.prototype.onItems=function(callback){this._protocol.on("items",function(message){callback(message.payload)})},EditorProtocol.prototype.onCancel=function(callback){this._protocol.on("cancel",callback)},EditorProtocol.prototype.onHelp=function(callback){this._protocol.on("help",callback)},EditorProtocol.prototype.onOpen=function(callback){this._protocol.on("open",callback)},EditorProtocol.prototype.onStartedJSLoading=function(callback){this._protocol.on("startedJSLoading",callback)},EditorProtocol.prototype.onFinishedJSLoading=function(callback){this._protocol.on("finishedJSLoading",callback)},EditorProtocol.prototype.close=function(settings){this._protocol.trigger("close",settings)},EditorProtocol.prototype.initialize=function(settings){this._protocol.trigger("settings",settings)};var MediaGalleryProtocol=function(protocol){this._protocol=protocol};return MediaGalleryProtocol.prototype.onInitialize=function(callback){this._protocol.on("settings",function(message){callback(message.payload)})},MediaGalleryProtocol.prototype.onClose=function(callback){this._protocol.on("close",function(message){callback(message.payload)})},MediaGalleryProtocol.prototype.sendReady=function(){this._protocol.trigger("ready")},MediaGalleryProtocol.prototype.sendFinishedJSLoading=function(){this._protocol.trigger("finishedJSLoading")},MediaGalleryProtocol.prototype.sendItems=function(items){window.debug&&console.log(JSON.stringify(items)),this._protocol.trigger("items",{items:items})},MediaGalleryProtocol.prototype.sendCancel=function(){this._protocol.trigger("cancel")},MediaGalleryProtocol.prototype.sendHelp=function(){this._protocol.trigger("help")},MediaGalleryProtocol.prototype.sendOpen=function(){this._protocol.trigger("open")},{forEditor:function(otherWindow,currentWindow){return new EditorProtocol(new PostMessageProtocol(otherWindow,currentWindow))},forMediaGallery:function(otherWindow,currentWindow){var protocol=new MediaGalleryProtocol(new PostMessageProtocol(otherWindow,currentWindow));return protocol.onInitialize(function(message){window.mediaGallerySettings=message}),protocol}}}();(function(){this.MediaGallery||(this.MediaGallery={}),MediaGallery.ConductorCtrl||(MediaGallery.ConductorCtrl={}),MediaGallery.ConductorCtrl.Root=function(r,location,conductor){var defaultTab,defaultTabId,tabsList;return tabsList=[{id:"my",path:"/my",canShow:function(){return conductor.hasPrivateMedia()}},{id:"free",path:"/free",canShow:function(){return conductor.hasPublicMedia()}},{id:"external_for_free",path:"/external_for_free",canShow:function(){return conductor.hasExternalForFree()}},{id:"photo_stock",path:"/photo_stock",canShow:function(){return conductor.hasPhotoStock()}}],defaultTabId=conductor.getStartingTab(),defaultTab=_.find(tabsList,function(tab){return tab.id===defaultTabId}),defaultTab&&defaultTab.canShow()||(defaultTab=_.find(tabsList,function(tab){return tab.canShow()})),defaultTab?location.path(defaultTab.path):console.log("All tabs are disabled. Please check the settings"),r.$$phase?void 0:r.$apply()},MediaGallery.ConductorCtrl.PublicMedia=function(location,conductor){return MediaGallery.appLoadNotifiers.tabsSelected(),location.path("/"+conductor.getPublicMediaPath())}}).call(this),function(){this.MediaGallery||(this.MediaGallery={}),MediaGallery.NotificationsCtrl=function(s,uiNotifier){return s.notifications=uiNotifier.notifications,s.expire=function(notification){return uiNotifier.expireNotification(notification.id)}}}.call(this),function(){this.MediaGallery||(this.MediaGallery={}),MediaGallery.NotificationsCtrl=function(s,uiNotifier){return s.notifications=uiNotifier.notifications,s.expire=function(notification){return uiNotifier.expireNotification(notification.id)}}}.call(this),function(){this.MediaGallery||(this.MediaGallery={}),MediaGallery.privateMedia||(MediaGallery.privateMedia={}),MediaGallery.privateMedia.EditItemCtrl=function(s,aviary,folderRepository){return s.editItem=function(item){return folderRepository.getFolderByName(item).then(function(foundFolder){var folder,url;return folder=foundFolder||MediaGallery.AllFolder(),url=item.getThumbnailer().fullUrl(),aviary(item.getTitle(),url,folder)})},s.download=function(item){var downloadLink,getExt,itemTitle;return getExt=function(fileName){var m;return m=fileName.split("."),1===m.length?"":m.pop()},itemTitle=item.getTitle().replace("&","_"),getExt(itemTitle)!==getExt(item.id)&&(itemTitle+="."+getExt(item.id)),downloadLink=item.getThumbnailer().fullUrl()+"?dn="+encodeURIComponent(itemTitle),top.location.replace(downloadLink)}}}.call(this),function(){this.MediaGallery||(this.MediaGallery={}),MediaGallery.privateMedia||(MediaGallery.privateMedia={}),MediaGallery.privateMedia.FoldersListCtrl=function(s,domainEventPublisher,folderRepository,removeFolder,moveItemsToUnsorted,moveItems,addFolder,guard,uiNotifier,i18n,renameFolder,selectedItems,apis,dialog){return folderRepository.getFolders().then(function(foldersCollection){return s.foldersCollection=foldersCollection}),apis.getUploadTransaction().register({collectionUploadCompleted:function(){return folderRepository.getFolders().then(function(foldersCollection){var folders,newSelected,selected;return selected=s.selectedFolder,s.foldersCollection=foldersCollection,null!=selected&&(folders=foldersCollection.values(),newSelected=_.find(folders,function(f){return f.getId()===selected.getId()}),null!=newSelected)?s.selectFolder(newSelected):void 0})}}),s.hideAddFolder=function(){return s.isAddingFolder=!1},s.canShowActions=function(folder){return guard.allowUpdate(folder)},s.getFolders=function(){return s.foldersCollection?s.foldersCollection.values():[]},s.getUserFolders=function(){return _.select(s.getFolders(),function(folder){return"/"!==folder.getName()})},s.getSystemFolders=function(){return _.select(s.getFolders(),function(folder){return"/"===folder.getName()})},s.removeFolder=function(folder){var btns,cancelText,confirmText,msg,title;return title=i18n.translate("private_media.delete_folder_dialog.title"),msg=i18n.translate("private_media.delete_folder_dialog.text"),confirmText=i18n.translate("private_media.delete_folder_dialog.confirm"),cancelText=i18n.translate("private_media.delete_folder_dialog.cancel"),btns=[{result:"yes",label:confirmText,cssClass:"confirm"},{result:"no",label:cancelText,cssClass:"cancel"}],dialog.messageBox(title,msg,btns).open().then(function(result){return"yes"===result?removeFolder.perform(s.foldersCollection,folder).then(function(){var _ref;return(null!=(_ref=s.selectedFolder)?_ref.getId():void 0)===folder.getId()&&s.selectAll(),s.updateFoldersSizes()}):void 0})},s.notifyCantMoveToExternalService=function(service){var serviceName;return serviceName=service.getName(),uiNotifier.sendNotification(i18n.translate("error.cant_move_to_external_folder",[serviceName[0].toUpperCase()+serviceName.slice(1)]),5e3,"info")},s.moveSelectedItemsToUnsorted=function(){return s.getSelectedExternalService()?s.importingService()["import"]().then(function(){return moveItemsToUnsorted.perform(s.importingService().getImportedItems())},function(){return uiNotifier.sendNotification(i18n.translate("error.import_failed"))}):selectedItems.values().then(function(items){return moveItemsToUnsorted.perform(items)})},s.moveSelectedItems=function(destinationFolder){return s.getSelectedExternalService()?s.importingService()["import"]().then(function(){return moveItems.perform(s.importingService().getImportedItems(),destinationFolder,MediaGallery.AllFolder())},function(){return uiNotifier.sendNotification(i18n.translate("error.import_failed"))}):selectedItems.values().then(function(items){return moveItems.perform(items,destinationFolder,s.getSelectedFolder())})},s.isAddingFolder=!1,s.addFolder=function(flow){return s.isAddingFolder?s.folderName?addFolder.perform(s.foldersCollection,s.folderName.trim(),flow).then(function(){return s.isAddingFolder=!1},function(){}):s.isAddingFolder=!1:void 0},s.newFolder=function(){return s.folderName&&s.addFolder("AddFolder"),s.isAddingFolder=!0,s.folderName=""},s.cancel=function(){return s.isAddingFolder=!1,s.folderName=""},domainEventPublisher.$on("FolderChanged",function(){return s.isAddingFolder=!1}),s.renameFolder=function(folder,newName,flow){return newName=newName.trim(),newName!==folder.getName()?renameFolder.perform(folder,newName,flow,s.foldersCollection):void 0}}}.call(this),function(){this.MediaGallery||(this.MediaGallery={}),MediaGallery.privateMedia||(MediaGallery.privateMedia={}),MediaGallery.privateMedia.MoveItemsCtrl=function(s,selectedItems){return s.moveSelectedItems=function(){},s.canMoveSelectedItems=function(){return!selectedItems.isEmpty()}}}.call(this),function(){this.MediaGallery||(this.MediaGallery={}),MediaGallery.privateMedia||(MediaGallery.privateMedia={}),MediaGallery.privateMedia.ProceedCtrl=function(s){return s.proceed=function(){return s.getSelectedExternalService()?s.importAndProceedSelected():s.$parent.proceed()}}}.call(this),function(){this.MediaGallery||(this.MediaGallery={}),MediaGallery.privateMedia||(MediaGallery.privateMedia={}),MediaGallery.privateMedia.RemoveItemsCtrl=function(eventNotifier,s,removeItem,removeItemCollection,selectedItems,dialog,i18n){var canRemoveSelectedItems,confirm,confirmDeleteMultiple,confirmDeleteSingle;return canRemoveSelectedItems=function(){return!selectedItems.isEmpty()&&!s.selectedExternalService},confirm=function(fn,texts){var btns,msg,title;return title=texts.title,msg=texts.msg,btns=[{result:"yes",label:texts.confirm,cssClass:"confirm"},{result:"no",label:texts.cancel,cssClass:"cancel"}],dialog.messageBox(title,msg,btns).open().then(function(result){return"yes"===result?fn():void 0})},confirmDeleteSingle=function(fn){return confirm(fn,{title:i18n.translate("private_media.delete_single_dialog.title"),msg:i18n.translate("private_media.delete_single_dialog.text"),confirm:i18n.translate("private_media.delete_single_dialog.confirm"),cancel:i18n.translate("private_media.delete_single_dialog.cancel")})},confirmDeleteMultiple=function(fn){return confirm(fn,{title:i18n.translate("private_media.delete_multiple_dialog.title"),msg:i18n.translate("private_media.delete_multiple_dialog.text"),confirm:i18n.translate("private_media.delete_multiple_dialog.confirm"),cancel:i18n.translate("private_media.delete_multiple_dialog.cancel")})},s.removeSelectedItems=function(){var confirmFn;if(canRemoveSelectedItems())return eventNotifier("privateMediaRemoveItemsClicked",{filesCount:selectedItems.size()}),(confirmFn=1===selectedItems.size()?confirmDeleteSingle:confirmDeleteMultiple)(function(){return selectedItems.values().then(function(items){return removeItemCollection.perform(items).then(function(){return selectedItems.clear(),s.cleanUpAfterRemove(items)})})})},s.canRemoveSelectedItems=canRemoveSelectedItems}}.call(this),function(){this.MediaGallery||(this.MediaGallery={}),MediaGallery.privateMedia||(MediaGallery.privateMedia={}),MediaGallery.privateMedia.RootCtrl=function(eventNotifier,s,location,domainEventPublisher,removeItem,folderRepository,itemRepository,selectedItems,dndHelper,i18n,chooseItems,filter,featureDetection,allItemsSelection,apis,flashUploader,getTranscodedFile,getExternalServices,notify,importService,ImportAndProceed,allSettled,q,aviary,renameItem,dialog,mediaTypeFactory,SearchService,moveItems,moveItemsToUnsorted,removeItemCollection,removeFolder,renameFolder){var allExternalServices,allItems,attachImport,confirm,confirmDeleteSingle,importer,isItemsLoaded,itemsLoadSuccess,loadFolderItems,loadedExternalServices,onMoveItems,paginatedCollection,scopeItems,showAllItems,sortField,toggleAllItemsSelection;return MediaGallery.appLoadNotifiers.tabsSelected(),allItems=paginatedCollection=s.items=void 0,isItemsLoaded=!1,itemRepository.register({privateMediaItemsLoadingSucceeded:function(items){return _.each(items,function(item){return"TranscodableItem"!==item.type||item.isProcessed()?void 0:getTranscodedFile.perform(item)})}}),itemsLoadSuccess=function(items){var filterItems,searchQuery,sortItems;return searchQuery=s.search.getQuery().toLowerCase(),filterItems=function(items){return _.filter(items,function(item){return-1!==item.title.toLowerCase().indexOf(searchQuery)})},sortItems=function(items){var sortField;return sortField=s.getSelectedSortField(),sortField?filter("orderBy")(items,sortField.name,sortField.isSortDesc):items},allItems=filterItems(sortItems(items)),paginatedCollection=WixPix.PaginatedCollection(function(){return allItems}),s.items=paginatedCollection.itemsOfPage(0)},loadFolderItems=function(early){var itemsPromise,resetItems;return null==early&&(early=!0),isItemsLoaded=!1,("function"==typeof s.getSelectedExternalService?s.getSelectedExternalService():void 0)&&s.selectAll(),resetItems=function(){return allItems=[],paginatedCollection=WixPix.PaginatedCollection(function(){return allItems}),s.items=[]},early&&resetItems(),itemsPromise=s.selectedAll?itemRepository.getItems():itemRepository.allForFolder(s.selectedFolder),itemsPromise.then(function(response){return s.updateFoldersSizes(),early||resetItems(),response},function(){throw early||resetItems(),isItemsLoaded=!0,"privateMediaItemsLoadingFailed"}).then(function(items){return itemsLoadSuccess(items),isItemsLoaded=!0})},scopeItems=function(){return _.filter(s.items,function(item){return"TranscodableItem"===item.type&&!!item.getSampleUrl()||"Item"===item.type})},showAllItems=function(){return s.items=paginatedCollection.all()},toggleAllItemsSelection=function(){return showAllItems(),allItemsSelection.toggle(scopeItems())},s.getItems=function(){return s.items},s.selection=WixPix.SelectionHelper(selectedItems,dndHelper,s),s.$on("CtrlAPressed",function(){return s.canToggleSelection()?(toggleAllItemsSelection(),s.$apply()):void 0}),s.canSort=function(){return!s.selectedExternalService||s.selectedExternalFolder},s.canToggleSelection=function(){return s.canSelectItems()&&!s.selectedExternalService},s.selectAllItems=function(){return s.canToggleSelection()?(showAllItems(),allItemsSelection.selectAll(s.items)):void 0},s.selectNoneItems=function(){return s.canToggleSelection()?(showAllItems(),allItemsSelection.selectNone()):void 0},s.isAllItemsSelected=function(){return s.isItemsLoaded()?s.hasNoItems()?!1:0===s.items.length?!1:allItemsSelection.allSelected(s.items):!1},s.supportsHtml5Uploads=featureDetection.html5Uploads(),s.showMoreItems=function(){return s.items.length!==paginatedCollection.all().length?s.items=s.items.concat(paginatedCollection.nextPage()):void 0},s.selectedFolderName=function(){return s.selectedAll?i18n.translate("private_media.all"):null!=s.selectedFolder?"/"===s.selectedFolder.getName()?i18n.translate("private_media.unsorted"):s.selectedFolder.getName():""},s.getSelectedFolder=function(){return s.selectedFolder},s.canSelectItems=function(){return s.isItemsLoaded()?!s.hasNoItems():!1},s.removeItemsFromCurrentScope=function(theItemsMoved){return allItems=_.difference(allItems,theItemsMoved),s.items=_.difference(s.items,theItemsMoved)},s.sortFields=[{name:"timestamp",isSortDesc:!0,biEventName:"SortByDateClicked",translationKey:"private_media.sort_by.timestamp"},{name:"title",isSortDesc:!1,biEventName:"SortByTitleClicked",translationKey:"private_media.sort_by.title"}],sortField=null,s.selectSortField=function(field){return sortField=field,itemsLoadSuccess(allItems)},s.getSelectedSortField=function(){return sortField},s.isItemsLoaded=function(){return isItemsLoaded},s.hasNoItems=function(){return 0===s.items.length},s.isWorkStart=function(){return s.isItemsLoaded()&&s.hasNoItems()&&!s.hasConnectedExternalServices()&&!s.search.getQuery()},s.selectAll=function(){return s.selectedAll=!0,s.selectedFolder=null,s.selectedExternalService=null,selectedItems.clear(),loadFolderItems()},s.isSelectedFolder=function(folder){var _ref;return null!=(_ref=s.selectedFolder)?_ref.equals(folder):void 0},s.selectFolder=function(folder){return s.selectedAll=!1,s.selectedExternalService=null,s.selectedFolder=folder,domainEventPublisher.$broadcast("FolderChanged",folder),selectedItems.clear(),loadFolderItems()},s.selectItemAndProceed=function(item){return chooseItems.perform([item],{source:"doubleClick"})},s.itemSelected=function(item){return selectedItems.has(item)},s.getFolderSize=function(folder){var _ref,_ref1;return(null!=(_ref=s.foldersItemsCache)&&null!=(_ref1=_ref[folder.getId()])?_ref1.length:void 0)||0},s.getAllItemsCount=function(){return _.inject(s.foldersItemsCache,function(acc,items){return acc+=_.size(items)},0)},s.updateFoldersSizes=function(){return folderRepository.getFolderItemsCount().then(function(itemsByFolders){return s.foldersItemsCache=itemsByFolders})},apis.getUploadTransaction().register({fileUploadSucceeded:function(item){var _base,_name;return(_base=s.foldersItemsCache)[_name=item.getFolderId()]||(_base[_name]=[]),s.foldersItemsCache[item.getFolderId()].unshift(item)}}),s.selectAll(),onMoveItems={success:function(data){var _ref,_ref1;return selectedItems.clear(),s.selectedAll||s.removeItemsFromCurrentScope(data.items),(null!=(_ref=s.selectedFolder)?_ref.getId():void 0)===(null!=(_ref1=data.destinationFolder)?_ref1.getId():void 0)&&(s.items=_.union(s.items,data.items)),s.updateFoldersSizes()},fail:function(){var early;return loadFolderItems(early=!0),s.updateFoldersSizes()}},moveItems.register(onMoveItems),removeItem.register(onMoveItems),removeItemCollection.register(onMoveItems),removeFolder.register(onMoveItems),renameFolder.register(onMoveItems),getTranscodedFile.register({success:function(){var early;return loadFolderItems(early=!1)},fail:function(){var early;return loadFolderItems(early=!1)}}),flashUploader.register({collectionUploadCompleted:function(){var early;return loadFolderItems(early=!1)}}),apis.getUploadTransaction().register({collectionUploadCompleted:function(){var early;return loadFolderItems(early=!1)},fileUploadSucceeded:function(item){return s.items!==allItems&&(s.selectedAll||s.selectedFolder&&item.getFolderId()===s.selectedFolder.getId())&&s.items.unshift(item),allItems.unshift(item),paginatedCollection=WixPix.PaginatedCollection(function(){return allItems})}}),s.noItemsTemplate=mediaTypeFactory.getMediaType().getNoItemsTemplate(),s.search=SearchService(s,s.getItems,function(){return selectedItems.clear(),s.selectedExternalService?void 0:(loadFolderItems(),itemsLoadSuccess(allItems))}),s.canEditItemAtAviary=function(){return featureDetection.html5Uploads()&&!featureDetection.safariFive()&&mediaTypeFactory.getMediaType().canEditItem()},s.editItemAtAviary=function(item){return folderRepository.getFolderByName(item).then(function(foundFolder){var folder,url;return folder=foundFolder||MediaGallery.AllFolder(),url=item.getThumbnailer().fullUrl(),aviary(item.getTitle(),url,folder)})},s.canDownloadItem=function(){return mediaTypeFactory.getMediaType().canDownloadItem()},s.linkToDownloadable=function(item){var downloadLink,getExt,itemTitle;return getExt=function(fileName){var m;return m=fileName.split("."),1===m.length?"":m.pop()},itemTitle=item.getTitle().replace(/[&\\\/:\*\?"'<>| ]/g,"_"),getExt(itemTitle)!==getExt(item.id)&&(itemTitle+="."+getExt(item.id)),downloadLink=item.getThumbnailer().fullUrl()+"?dn="+encodeURIComponent(itemTitle)},s.canRenameItem=function(){return mediaTypeFactory.getMediaType().canRenameItem()},s.renameItem=function(item,newName,flow){return item.getTitle()!==newName?renameItem.perform(item,newName,flow,s.items):void 0},s.canRemoveItem=function(){return mediaTypeFactory.getMediaType().canRemoveItem()},confirm=function(fn,texts){var btns,msg,title;return title=texts.title,msg=texts.msg,btns=[{result:"yes",label:texts.confirm,cssClass:"confirm"},{result:"no",label:texts.cancel,cssClass:"cancel"}],dialog.messageBox(title,msg,btns).open().then(function(result){return"yes"===result?fn():void 0})},confirmDeleteSingle=function(fn){return confirm(fn,{title:i18n.translate("private_media.delete_single_dialog.title"),msg:i18n.translate("private_media.delete_single_dialog.text"),confirm:i18n.translate("private_media.delete_single_dialog.confirm"),cancel:i18n.translate("private_media.delete_single_dialog.cancel")})},s.cleanUpAfterRemove=function(items){return selectedItems.remove(items),s.updateFoldersSizes(),s.removeItemsFromCurrentScope(items)},s.removeItem=function(item){return confirmDeleteSingle(function(){return removeItem.perform(item).then(function(data){return s.cleanUpAfterRemove([data.item])})})},s.canDrag=function(){return!0},loadedExternalServices=[],allExternalServices=getExternalServices(),s.connectExternalServices=function(){return domainEventPublisher.$broadcast("showExternalServicesConnection")},s.loadExternalService=function(service){return service.getRepository().isLoaded()?q.when(service.getRepository().getFolders()):notify.loading(""+service.getName()+"Loading",service.getRepository().loadFolders().then(function(folders){return["picasa","flickr"].indexOf(service.getName())>=0?folders:q.all(_.map(folders,function(folder){return service.getRepository().loadItems(folder)}))}))},s.loadAllExternalServices=function(){var deferred,loadableServices;return loadableServices=_.select(allExternalServices,function(service){return service.isConnected()&&!service.getRepository().isLoaded()}),loadableServices.length?allSettled(_.map(loadableServices,function(){return s.loadExternalService()})):(deferred=q.defer(),deferred.resolve(),allSettled(deferred.promise))},s.getExternalServices=function(){return _.select(allExternalServices,function(service){return service.isConnected()})},s.selectedExternalFolder=null,s.selectedExternalService=null,s.hasConnectedExternalServices=function(){return!!_.find(allExternalServices,function(s){return s.isConnected()})},s.selectExternalService=function(serviceToSelect){var service;return(service=_.find(s.getExternalServices(),function(serv){return serv.getId()===serviceToSelect.getId()}))?(s.selectedAll=!1,s.selectedFolder=null,s.selectedExternalFolder=null,s.selectedExternalService=service,s.search.clear(),allItemsSelection.selectNone(),s.loadExternalService(service)):void 0},s.isAnyExternalServiceSelected=function(){return!!s.selectedExternalService},s.isSelectedExternalService=function(service){return service===s.selectedExternalService},s.getExternalServiceItemsCount=function(service){return service.isConnected()&&service.getRepository().isLoaded()?_.reduce(service.getRepository().getFolders(),function(count,folder){return count+folder.getItemsCount()},0):null},s.selectExternalFolder=function(folder){return s.selectedExternalFolder=folder,allItemsSelection.selectNone(),attachImport()},s.getSelectedExternalFolder=function(){return s.selectedExternalFolder},s.getSelectedExternalService=function(){return s.selectedExternalService},s.isSelectedExternalServiceItemsLoaded=function(){var _ref;return null!=(_ref=s.selectedExternalService)?_ref.getRepository().isLoaded():void 0},_.each(s.getExternalServices(),function(service){return service.onAuthError(function(){var _ref;return(null!=(_ref=s.getSelectedExternalService())?_ref.getId():void 0)===service.getId()?s.selectAll():void 0})}),importer=null,attachImport=function(){var folderName,serviceName;return serviceName="",folderName="",s.getSelectedExternalService()&&(serviceName=s.getSelectedExternalService().getName()),s.getSelectedExternalFolder()&&(folderName=s.getSelectedExternalFolder().getName()),importer=importService(selectedItems,folderName,serviceName),s.importAndProceedSelected=ImportAndProceed(importer)},attachImport(),s.importingService=function(){return importer}}}.call(this),function(){var _base;this.MediaGallery||(this.MediaGallery={}),(_base=this.MediaGallery).privateMedia||(_base.privateMedia={}),this.MediaGallery.privateMedia.SelectionCtrl=function(s,selectedItems){return s.supportsMultipleItems=function(){return selectedItems.supportsMultipleItems()},s.selectedCount=function(){return selectedItems.size()}}}.call(this),function(){this.MediaGallery||(this.MediaGallery={}),MediaGallery.privateMedia||(MediaGallery.privateMedia={}),MediaGallery.privateMedia.UploadCtrl=function(s,q,apis,buildsPreview,filesToUpload,i18n,location,mediaTypeFactory,flashUploader){var buildPreview,getRetriableFiles,onProgress,throttleCounter,upload;return s.getAcceptedFileTypes=mediaTypeFactory.getMediaType().getAcceptedFileTypes,s.getFlashAcceptedFileTypes=mediaTypeFactory.getMediaType().getFlashAcceptedFileTypes,s.getStaticCode=mediaTypeFactory.getMediaType().getStaticCode,s.getMediaTypeName=mediaTypeFactory.getMediaType().getMediaTypeName,s.filePreviewClass=function(file){var classes,_ref;if(classes=[],file.hasPreview())switch(null!=(_ref=file.getPreview())?_ref.type:void 0){case"image":classes.push("has-preview");break;case"error":classes.push("error")}return file.isInFolder()?classes.push("uploaded"):file.isFailed()&&classes.push("failed"),classes},s.isRetryable=function(failureReason){var errorMessage;return errorMessage=failureReason&&failureReason.errorMessage,-1===["InvalidFileSize","UnsupportedMediaType","ExpectationFailed","PreconditionFailed","NotAcceptable","FlashError","CorruptedFile"].indexOf(errorMessage)},s.canShowUploads=function(){return!filesToUpload.isEmpty()},s.canHideUploads=function(folderName){return filesToUpload.hasOnlyFailedFiles(folderName)},s.clearUploads=function(folderName){return filesToUpload.clearForFolderName(folderName)},throttleCounter=0,onProgress=function(event){return 3===throttleCounter||100===event.percentLoaded?(s.$apply(),throttleCounter=0):throttleCounter++},apis.getUploadTransaction().register({fileUploadProgress:onProgress}),upload=function(chunk){return apis.getUploadTransaction().upload(chunk.files,chunk.folder)},s.retry=function(fileToUpload){var selectedFolder;return selectedFolder=s.selectedFolder||MediaGallery.AllFolder(),apis.getUploadTransaction().upload([fileToUpload],selectedFolder)},getRetriableFiles=function(files){return _.select(files,function(fileToUpload){return fileToUpload.isFailed()&&s.isRetryable(fileToUpload.getFailureReason())})},s.retryAll=function(files){var retriable,selectedFolder;return retriable=getRetriableFiles(files),(null!=retriable?retriable.length:void 0)?(_.each(retriable,function(fileToUpload){return fileToUpload.makeUploading()}),selectedFolder=s.selectedFolder||MediaGallery.AllFolder(),apis.getUploadTransaction().upload(retriable,selectedFolder)):void 0},buildPreview=function(chunk){return buildsPreview(chunk.files,function(){return s.$$phase?void 0:s.$apply()})},flashUploader.init(s,filesToUpload),s.handleFileSelect=function(files){var currentChunk,selectedFolder;return selectedFolder="/my"===location.path()?s.selectedFolder||MediaGallery.AllFolder():MediaGallery.AllFolder(),currentChunk=filesToUpload.addFiles(files,selectedFolder),upload(currentChunk),location.path("my"),buildPreview(currentChunk)},s.hasRetriable=function(files){return!!_.find(files,function(fileToUpload){return fileToUpload.isFailed()&&s.isRetryable(fileToUpload.getFailureReason())})},s.filesToUpload=filesToUpload}}.call(this),function(){this.MediaGallery||(this.MediaGallery={}),MediaGallery.ProtocolCtrl={},MediaGallery.ProtocolCtrl.Items=function(eventNotifier,s,protocol,selectedItems,chooseItems,location,guard,i18n){return s.proceed=function(){return s.canProceed()?guard.confirm().then(function(){return selectedItems.values().then(function(items){return chooseItems.perform(items,{source:"button"})})}):void 0},s.proceedError=function(){return selectedItems.isManagerMode()?void 0:0===selectedItems.size()?i18n.translate("selected_items.tooltip_error_empty"):selectedItems.isSelectionValid()?void 0:i18n.translate("selected_items.tooltip_error_multiple")},s.hasProceedError=function(){return proceedError()},s.canProceed=function(){return selectedItems.isSelectionValid()},s.buttonName=function(){return selectedItems.actionName()}},MediaGallery.ProtocolCtrl.Cancel=function(eventNotifier,s,protocol,guard){return s.proceed=function(){return eventNotifier("cancelButtonClicked"),guard.confirm().then(function(){return protocol.sendCancel()})},protocol.onClose(s.proceed)},MediaGallery.ProtocolCtrl.Help=function(eventNotifier,s,protocol){return s.proceed=function(){return eventNotifier("helpButtonClicked"),protocol.sendHelp()}}}.call(this),function(){"use strict";window.MediaGallery||(window.MediaGallery={}),MediaGallery.SettingsCtrl=function(s,location,conductor,mediaTypeFactory,i18n){return s.isCurrentTab=function(tab){return"my"===tab?"/my"===location.path():"publicMedia"===tab?location.path()==="/"+conductor.getPublicMediaPath():"/"+tab===location.path()},s.publicMediaPath=conductor.getPublicMediaPath(),s.publicMediaTabName=i18n.translate("public_media",['<span class="logo"></span>']),s.canShowFree=function(){return conductor.hasPublicMedia()},s.canShowExternalForFree=function(){return conductor.hasExternalForFree()},s.canShowPhotoStock=function(){return conductor.hasPhotoStock()},s.canShowExternal=function(){return conductor.hasExternalMedia()},s.canShowFolders=function(){return conductor.hasFolders()},s.canShowPrivate=function(){return conductor.hasPrivateMedia()},s.magnifyingGlassTemplate=mediaTypeFactory.getMediaType().getMagnifyingGlassTemplate(),s.noItemsTemplate=mediaTypeFactory.getMediaType().getNoItemsTemplate()}}.call(this),function(){"use strict";window.MediaGallery||(window.MediaGallery={}),MediaGallery.Aviary=function(r,apis,i18n){var editor,isJpeg,onAviaryError,onAviarySave;return editor=null,onAviarySave=function(){return!1},isJpeg=function(fileName){return-1!==["jpg","peg"].indexOf(fileName.toLowerCase().slice(-3))},onAviaryError=function(){},function(imageName,url,folder){var callback,onAviarySaveButtonClick;return onAviarySaveButtonClick=function(){var canvasElement,_ref;return canvasElement=document.getElementById("avpw_canvas_element"),canvasElement.toBlob(function(blob){var ext,file_name,parts;return-1===imageName.indexOf(".")?blob.name=""+imageName+"_edited":(parts=imageName.split("."),ext=parts.splice(-1).join(),file_name=parts.join("."),blob.name=""+file_name+"_edited."+ext),apis.getUploadTransaction().upload([MediaGallery.FileToUpload(blob,blob.name)],folder).then(function(){return editor.close()}),r.$apply()},null!=(_ref=isJpeg(imageName))?_ref:{"image/jpeg":"image/png"})},callback=function(){var image;return image=new Image,image.src=url,editor.launch({url:url,image:image,onSaveButtonClicked:onAviarySaveButtonClick})},editor?callback():editor=new window.Aviary.Feather({apiKey:"57b23071b",apiVersion:3,tools:"crop,orientation,enhance,effects,frames,brightness,contrast,saturation,warmth,focus,sharpness,draw,redeye,whiten,blemish,stickers,text",theme:"minimum",displayImageSize:!0,onSave:onAviarySave,onError:onAviaryError,language:i18n.getLang(),launchDelay:0,onLoad:callback,maxSize:1920})}}}.call(this),function(){window.MediaGallery||(window.MediaGallery={}),MediaGallery.CloseUploadGuard=function(domainEventPublisher,dialog,q,i18n){var allowUpdate,confirm,occupiedFolder,uploadState;return uploadState="inactive",occupiedFolder=null,domainEventPublisher.$on("UploadStarted",function(event,filesToUploadLength,html5,uploadSessionId,folder){return uploadState="active",occupiedFolder=folder
}),domainEventPublisher.$on("AllFilesUploadComplete",function(){return uploadState="inactive",occupiedFolder=null}),domainEventPublisher.$on("UploadFailed",function(){return uploadState="inactive",occupiedFolder=null}),allowUpdate=function(folder){return occupiedFolder===folder?!1:!0},confirm=function(){var deferred;return deferred=q.defer(),"active"===uploadState?dialog.messageBox(i18n.translate("private_media.confirm_close_upload_active.title"),i18n.translate("private_media.confirm_close_upload_active.text"),[{result:"yes",label:i18n.translate("private_media.confirm_close_upload_active.confirm"),cssClass:"confirm"},{result:"no",label:i18n.translate("private_media.confirm_close_upload_active.cancel"),cssClass:"cancel"}]).open().then(function(result){return"yes"===result?deferred.resolve():deferred.reject()}):deferred.resolve(),deferred.promise},{confirm:confirm,allowUpdate:allowUpdate}}}.call(this),function(){"use strict";!function(){var completeCallback,errorCallback,parseFlashArray,progressCallback,selectedFilesCallback,validationErrorCallback;return completeCallback=null,selectedFilesCallback=null,progressCallback=null,errorCallback=null,validationErrorCallback=null,parseFlashArray=function(array){return eval("(["+array+"])")},window.WixPix||(window.WixPix={}),WixPix.FlashUploader={onComplete:function(callback){return completeCallback=callback},onSelectFiles:function(callback){return selectedFilesCallback=callback},onProgress:function(callback){return progressCallback=callback},onError:function(callback){return errorCallback=callback},onValidationError:function(callback){return validationErrorCallback=callback},selectFiles:function(files){return files=parseFlashArray(files),"function"==typeof selectedFilesCallback?selectedFilesCallback(files):void 0},complete:function(message){return"function"==typeof completeCallback?completeCallback(message):void 0},progress:function(files){return files=parseFlashArray(files),"function"==typeof progressCallback?progressCallback(files):void 0},error:function(){return"function"==typeof errorCallback?errorCallback():void 0},validationError:function(files){return"function"==typeof validationErrorCallback?validationErrorCallback(files):void 0}}}(),this.W={UserMedia:{flashUpdate:function(type,message){return"uploadComplete"===type?WixPix.FlashUploader.complete(message):"numberOfItems"===type?WixPix.FlashUploader.selectFiles(message):"progressUpdate"===type?WixPix.FlashUploader.progress(message):"Error"===type||"UG Error"===message?WixPix.FlashUploader.error():"validationError"===type?WixPix.FlashUploader.validationError(message):void 0}}}}.call(this),function(){window.WixPix||(window.WixPix={}),WixPix.FlashUploaderInit=function(i18n,apis,settings){var finishFlashUpload,init,notifyCollectionUploadCompleted,notifyCollectionUploadFailed,notifyCollectionUploadStarted,notifyCollectionUploadSucceeded,observers,register;return observers=[],notifyCollectionUploadCompleted=function(files){var counts;return counts=WixPix.getUploadFailsCounts(files),_.each(observers,function(o){return"function"==typeof o.collectionUploadCompleted?o.collectionUploadCompleted(files.length,counts.allFailed,counts.failedByAPI):void 0})},notifyCollectionUploadSucceeded=function(){return _.each(observers,function(o){return"function"==typeof o.collectionUploadSucceeded?o.collectionUploadSucceeded():void 0})},notifyCollectionUploadFailed=function(reason){return _.each(observers,function(o){return"function"==typeof o.collectionUploadFailed?o.collectionUploadFailed(reason):void 0})},notifyCollectionUploadStarted=function(nFiles){return _.each(observers,function(o){return"function"==typeof o.collectionUploadStarted?o.collectionUploadStarted(nFiles,void 0,void 0,"flash"):void 0})},finishFlashUpload=function(privateMediaMetadata,folderName){var injectFolderNameIntoPrivateMediaMetadata;return injectFolderNameIntoPrivateMediaMetadata=function(response,folderName){var xml;return folderName?(xml=$($.parseXML(response)),xml.find("mediaItem").attr("tags",folderName),(new XMLSerializer).serializeToString(xml[0])):response},privateMediaMetadata=injectFolderNameIntoPrivateMediaMetadata(privateMediaMetadata,folderName),apis.getPrivateMediaAdapter().uploadMetadata(privateMediaMetadata)},init=function(s,filesToUpload){var chunk,onUploadSuccess,selectedFolder;return selectedFolder=function(){return s.selectedFolder||MediaGallery.AllFolder()},chunk=null,WixPix.FlashUploader.onValidationError(function(failedFiles){var failedFilesToUpload;return failedFilesToUpload=_.map(failedFiles,function(failedFile){var failedFileToUpload;return failedFileToUpload=MediaGallery.FileToUpload(void 0,failedFile.fileName,selectedFolder()),failedFileToUpload.makeFailed({errorCode:"-10413",errorMessage:failedFile.error}),failedFileToUpload}),chunk=filesToUpload.addFilesToUpload(failedFilesToUpload,selectedFolder()),s.$apply()}),WixPix.FlashUploader.onError(function(){return _.each(chunk.files,function(file){return file.makeFailed({errorMessage:"FlashError"})}),filesToUpload.collectionUploadFailed(),notifyCollectionUploadFailed({errorMessage:"FlashError"}),s.$apply()}),onUploadSuccess=function(){return _.each(chunk.files,function(file){return file.makeInFolder()}),filesToUpload.collectionUploadSucceeded(),notifyCollectionUploadSucceeded(),notifyCollectionUploadCompleted(chunk.files)},WixPix.FlashUploader.onComplete(function(message){return _.each(chunk.files,function(file){return file.makeUploaded()}),"restAPI"===settings.getSettingsHash().privateMediaApi?(apis.getPrivateMediaAdapter().purgeCache(),onUploadSuccess()):finishFlashUpload(message,selectedFolder().getName()).then(onUploadSuccess,function(){return filesToUpload.collectionUploadFailed(),notifyCollectionUploadCompleted(chunk.files)}),s.$apply()}),WixPix.FlashUploader.onProgress(function(files){return _.each(files,function(fileInfo){return _.each(chunk.files,function(file){return file.getName()===fileInfo.name?file.percentUploaded=parseInt(fileInfo.loaded/fileInfo.size*100,10):void 0})}),s.$apply()}),WixPix.FlashUploader.onSelectFiles(function(files){return chunk=filesToUpload.addFiles(files,selectedFolder()),_.each(chunk.files,function(file){return file.makeUploading()}),notifyCollectionUploadStarted(files.length),s.$apply()})},register=function(observer){return observers.push(observer)},{init:init,register:register}}}.call(this),function(){"use strict";window.MediaGallery||(window.MediaGallery={}),MediaGallery.HttpErrorInterceptor=function(errorNotifier){return{responseError:function(response){var body,message,_ref,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8;throw response.stack?(message=JSON.stringify(response),errorNotifier.error({message:'Parse error: "'+message+'"',errorCode:WixPix.ErrorCodes.parseError})):(body=angular.isString(response.data)?response.data:JSON.stringify(response.data),null==body&&(body=JSON.stringify(response)),errorNotifier.error({category:null!=(_ref=response.config)&&null!=(_ref1=_ref.custom)?_ref1.category:void 0,message:'HTTP error: "'+body+'" for "'+(null!=(_ref2=response.config)?_ref2.url:void 0)+'"',httpStatus:response.status,errorCode:null!=(_ref3=response.config)&&null!=(_ref4=_ref3.custom)?_ref4.errorCode:void 0,responseTime:null!=(_ref5=response.config)&&null!=(_ref6=_ref5.custom)?_ref6.responseTime:void 0,url:(null!=(_ref7=response.config)?_ref7.url:void 0)||"",params:(null!=(_ref8=response.config)?_ref8.params:void 0)||{}})),response}}}}.call(this),function(){this.MediaGallery||(this.MediaGallery={}),this.MediaGallery.LoadLocales=function(q,http,settingsFactory,i18n){var i18nPromise,loadTranslations;return loadTranslations=function(i18nCode){var deferred;return i18n.areLoaded()&&i18n.getLang()===i18nCode?(deferred=q.defer(),deferred.resolve(),deferred.promise):http.get("../locale/media_gallery_"+i18nCode+".json",{withCredentials:!1}).then(function(response){return MediaGallery.appLoadNotifiers.translationsLoaded(),i18n.updateTranslations(response.data),i18n.setPrefix(settingsFactory.getSettingsHash().i18nPrefix),i18n.setLang(i18nCode)},function(){return q.reject({code:WixPix.ErrorCodes.translationsCannotBeLoaded,message:"Could not load translations"})})},i18nPromise="en"===settingsFactory.getSettingsHash().i18nCode?loadTranslations("en"):loadTranslations(settingsFactory.getSettingsHash().i18nCode).then(null,function(){return loadTranslations("en")})}}.call(this),function(){MediaGallery.notifyCriticalFail=function(errorNotifier,q,dialog,protocol){return function(errorCode,reason){var d;return errorNotifier.error({errorCode:errorCode,message:reason}),d=q.defer(),dialog.messageBox("Fatal error","Error code: "+errorCode+". "+reason,[{result:"ok",label:"Ok",cssClass:"confirm"}]).open().then(function(){return q.reject(),protocol.sendCancel()}),q.promise}}}.call(this),function(){MediaGallery.NewSettings=function(){var defaultSettings,getSettingsHash,globalSettings,isWixUser,mergeSettings,settingsHash;return globalSettings=void 0,settingsHash=defaultSettings={isInitialized:!1,forceFlashUploads:!1,hasExternalMedia:!0,hasExternalForFree:!1,hasPhotoStock:!0,hasFacebook:!0,hasFlickr:!0,hasInstagram:!0,hasPicasa:!0,isSpeedlyItemsGettingEnabled:!0,mediaType:"picture",hasPrivateMedia:!0,publicMediaFile:"",publicMediaRootCategoryName:"photos",selectionType:"multiple",privateMediaApi:"restAPI",publicMediaApi:"restAPI",startingTab:"my",i18nCode:"en",i18nPrefix:"",_deployedExperiments:[],publicMediaPath:"dynamic_public_media"},isWixUser=function(){var clientEmail,cookie;return(cookie=getCookie("wixClient"))?(clientEmail=cookie.split("|")[1],clientEmail?-1!==clientEmail.indexOf("@wix.com"):!1):!1},mergeSettings=function(settings){return settingsHash=_.assign(_.clone(defaultSettings),settings,function(defaultValue,current){return"undefined"==typeof defaultValue?void 0:"undefined"==typeof current?defaultValue:""!==current?current:defaultValue})},getSettingsHash=function(){return mergeSettings(globalSettings.get()),_.contains(settingsHash._deployedExperiments,"mediamgrexpb")&&(settingsHash.hasExternalForFree=!0),settingsHash.hasFacebook||settingsHash.hasFlickr||settingsHash.hasInstagram||settingsHash.hasPicasa||(settingsHash.hasExternalMedia=!1),(navigator.userAgent.indexOf("MSIE 9.0")>=0||document.documentMode&&9===document.documentMode)&&(settingsHash.hasExternalMedia=!1),settingsHash.publicMediaFile&&(settingsHash.publicMediaRootCategoryName=settingsHash.publicMediaFile),settingsHash},this.initialize=function(settings){return globalSettings=settings},this.$get=function(){return{isWixUser:isWixUser,getSettingsHash:getSettingsHash,isInitialized:!1}},this}}.call(this),function(){this.MediaGallery||(this.MediaGallery={}),MediaGallery.Urls=function(){var defaultSettings,getSettingsHash,globalSettings,processBaseHost;return globalSettings=void 0,defaultSettings={dev:{baseHost:"wix.com",staticFiles:"http://static.wix.com",privateMediaRestFiles:"http://static.wixstatic.com",publicMediaRestFiles:"http://static.wixstatic.com",restSecureFiles:"http://secure.wixstatic.com",restVideoFiles:"http://video.wixstatic.com",privateMediaStaticAPI:"http://editor.wix.com/media",privateMediaStaticUploadAPI:"http://0.static.wix.com/api",privateMediaRestAPI:"http://files.wix.com",publicMediaStaticAPI:"http://assets.wix.com",publicMediaRestAPI:"http://publicmedia.wix.com",bigStockPaymentAPI:"http://pix.wix.com"},test:{baseHost:"ten.wixpress.com",staticFiles:"http://static.{baseHost}",privateMediaRestFiles:"http://static-dev.wixstatic.com",publicMediaRestFiles:"http://static-dev.wixstatic.com",restSecureFiles:"http://secure.wixstatic.com",restVideoFiles:"http://video-dev.wixstatic.com",privateMediaStaticAPI:"http://editor.{baseHost}/media",privateMediaStaticUploadAPI:"http://0.static.wix.com/api",privateMediaRestAPI:"http://files.{baseHost}",publicMediaStaticAPI:"http://assets.{baseHost}",publicMediaRestAPI:"http://publicmedia.{baseHost}",bigStockPaymentAPI:"http://pix-test.wix.com"},production:{baseHost:"wix.com",staticFiles:"http://static.wix.com",privateMediaRestFiles:"http://static.wixstatic.com",publicMediaRestFiles:"http://static.wixstatic.com",restSecureFiles:"http://secure.wixstatic.com",restVideoFiles:"http://video.wixstatic.com",privateMediaStaticAPI:"http://editor.wix.com/media",privateMediaStaticUploadAPI:"http://0.static.wix.com/api",privateMediaRestAPI:"http://files.wix.com",publicMediaStaticAPI:"http://assets.wix.com",publicMediaRestAPI:"http://publicmedia.wix.com",bigStockPaymentAPI:"http://pix.wix.com"}},processBaseHost=function(settings){return _.each(settings,function(val,key){return"string"==typeof val?settings[key]=val.replace(/\{baseHost\}/i,settings.baseHost):void 0}),settings},getSettingsHash=function(){var environment;return environment="production",/\.wixpress\.com/i.test(globalSettings.get().baseHost)&&(environment="test"),environment=globalSettings.get().environment||environment,processBaseHost(_.assign(_.clone(defaultSettings[environment]),globalSettings.get(),function(defaultValue,current){return"undefined"==typeof defaultValue?void 0:"undefined"==typeof current?defaultValue:""!==current?current:defaultValue}))},this.initialize=function(settings){return globalSettings=settings},this.$get=["Settings",function(settings){var files,folders,uploadUrlType;return uploadUrlType=function(mediaType){switch(mediaType){case"secure_music":return"music-goods/";case"video":return"video/";default:return""}},files={getUploadURL:function(mediaType){return""+getSettingsHash().privateMediaRestAPI+"/files/"+uploadUrlType(mediaType)+"upload/url"},getFiles:function(){return""+getSettingsHash().privateMediaRestAPI+"/files"},getFilesSpeedly:function(){return""+getSettingsHash().privateMediaRestAPI+"/files/get"},trash:function(){return""+getSettingsHash().privateMediaRestAPI+"/trash"},secureFilesTranscode:function(fileId){return""+getSettingsHash().privateMediaRestAPI+"/secure-files/"+fileId+"/transcode"},secureFilesUpdateStatus:function(fileId){return""+getSettingsHash().privateMediaRestAPI+"/secure-files/"+fileId+"/statusupdate"}},folders={getFolders:function(){return""+getSettingsHash().privateMediaRestAPI+"/folders"}},{files:files,folders:folders,baseHost:function(){return getSettingsHash().baseHost},filesContent:function(isPublicMedia){return null==isPublicMedia&&(isPublicMedia=!1),isPublicMedia?getSettingsHash().publicMediaRestFiles:"restAPI"===settings.getSettingsHash().privateMediaApi?getSettingsHash().privateMediaRestFiles:getSettingsHash().staticFiles},restSecureFilesContent:function(){return getSettingsHash().restSecureFiles},privateMediaStaticAPI:function(){return getSettingsHash().privateMediaStaticAPI},privateMediaStaticUploadAPI:function(){return getSettingsHash().privateMediaStaticUploadAPI},privateMediaRestAPI:function(){return getSettingsHash().privateMediaRestAPI},publicMediaStaticAPI:function(){return getSettingsHash().publicMediaStaticAPI},publicMediaRestAPI:function(){return getSettingsHash().publicMediaRestAPI},bigStockPaymentAPI:function(){return getSettingsHash().bigStockPaymentAPI},videoContent:function(){return getSettingsHash().restVideoFiles}}}],this}}.call(this),function(){"use strict";window.MediaGallery||(window.MediaGallery={}),MediaGallery.VerifyCORSWorks=function(q,urls,featureDetection,BIHelpers){var cachedValue;return cachedValue=void 0,{verifyRegular:function(){var deferred,notifyData,xhr;return deferred=q.defer(),cachedValue===!0?deferred.resolve():cachedValue===!1?deferred.reject():featureDetection.html5Uploads()?(notifyData={startedAt:BIHelpers.getCurrentTime(),responseSize:2},xhr=new XMLHttpRequest,xhr.open("POST",urls.privateMediaStaticUploadAPI()+"/cors_test"),xhr.setRequestHeader("Content-Type","application/json"),xhr.addEventListener("load",function(){return MediaGallery.appLoadNotifiers.CORSCheckCompleted(),cachedValue=!0,BIHelpers.notifyRequestTime(_.extend({},notifyData,{BITimeReportName:"CORSCheckSucceededkCORS"}),!0),deferred.resolve()}),xhr.addEventListener("error",function(){return MediaGallery.appLoadNotifiers.CORSCheckCompleted(),cachedValue=!1,BIHelpers.notifyRequestTime(_.extend({},notifyData,{BITimeReportName:"CheckCORS"}),!1),deferred.reject()}),xhr.send("{}")):(cachedValue=!1,deferred.reject()),deferred.promise}}}}.call(this),function(){"use strict";window.WixPix||(window.WixPix={}),WixPix.allSettled=function(q){return function(promises){var counter,deferred,finalize,results;return deferred=q.defer(),counter=promises.length,results=[],counter?(finalize=function(){return--counter,counter?void 0:deferred.resolve(results)},_.forEach(promises,function(promise,index){return promise.then(function(value){return results[index]={state:"fulfilled",value:value},finalize()},function(reason){return results[index]={state:"rejected",reason:reason},finalize()})})):deferred.resolve(results),deferred.promise}}}.call(this),function(){"use strict";window.WixPix||(window.WixPix={}),WixPix.BuildsPreview=function(q,buildsThumbnail,mediaType){return function(filesToUpload,stateChanged){var buildSinglePreview,promise;return buildSinglePreview=function(file,callbacks){var filePreview,isInvalidFileType,urlAPI;return isInvalidFileType=mediaType.getMediaType().getValidateFile(),filePreview=WixPix.FilePreview(file.size),urlAPI=window.createObjectURL&&window||window.URL&&URL.revokeObjectURL&&URL||window.webkitURL&&webkitURL,urlAPI&&!isInvalidFileType(file)?(filePreview.type="image",buildsThumbnail(urlAPI.createObjectURL(file),{success:function(thumbnail){return filePreview.src=thumbnail,callbacks.thumbnailBuilt()},error:function(){return filePreview.type="error",callbacks.thumbnailBuilt()}})):filePreview.type="error",callbacks.success(filePreview)},promise=q.when(!0),_.each(filesToUpload,function(fileToUpload){return promise=promise.then(function(){var deferred;return deferred=q.defer(),buildSinglePreview(fileToUpload.data,{success:function(filePreview){return fileToUpload.setPreview(filePreview),"image"!==filePreview.type&&deferred.resolve(),stateChanged()},thumbnailBuilt:function(){return setTimeout(function(){return deferred.resolve(),stateChanged()},50)}}),deferred.promise})})}}}.call(this),function(){"use strict";window.WixPix||(window.WixPix={}),WixPix.BuildsThumbnailSameAsOriginal=function(){return function(source,options){return options.success(source)}},WixPix.BuildsThumbnailWithCanvas=function(targetMaxWidth,targetMaxHeight){var resizeImage;return null==targetMaxWidth&&(targetMaxWidth=100),null==targetMaxHeight&&(targetMaxHeight=100),resizeImage=function(image){var canvas,canvasContext,sourceHeight,sourceRatio,sourceWidth,sourceX,sourceY,targetHeight,targetRatio,targetWidth,targetX,targetY;return sourceWidth=image.width,sourceHeight=image.height,sourceRatio=sourceWidth/sourceHeight,targetWidth=targetMaxWidth,targetHeight=targetMaxHeight,targetRatio=targetMaxWidth/targetMaxHeight,targetHeight>sourceHeight||targetWidth>sourceWidth?(targetHeight=sourceHeight,targetWidth=sourceWidth):sourceRatio>targetRatio?sourceWidth=sourceHeight*targetRatio:sourceHeight=sourceWidth/targetRatio,sourceX=(image.width-sourceWidth)/2,sourceY=(image.height-sourceHeight)/2,targetY=(targetMaxHeight-targetHeight)/2,targetX=(targetMaxWidth-targetWidth)/2,canvas=document.getElementById("resizeCanvas")?document.getElementById("resizeCanvas"):document.createElement("canvas"),canvasContext=canvas.getContext("2d"),canvas.getAttribute("id")||canvas.setAttribute("id","resizeCanvas"),canvas.width=targetMaxWidth,canvas.height=targetMaxHeight,canvasContext.drawImage(image,sourceX,sourceY,sourceWidth,sourceHeight,targetX,targetY,targetWidth,targetHeight),canvas.toDataURL("image/png")},function(source,options){var image;return image=new Image,image.onload=function(){return options.success(resizeImage(this))},image.onerror=options.error,image.src=source}}}.call(this),function(){this.WixPix||(this.WixPix={}),this.WixPix.Cache=function(settings){var api,get,isPopulated,mediaType,populated,purge,put,responseCache;return responseCache=[],populated=!1,api=settings.getSettingsHash().privateMediaApi,mediaType=settings.getSettingsHash().mediaType,isPopulated=function(){return(api!==settings.getSettingsHash().privateMediaApi||mediaType!==settings.getSettingsHash().mediaType)&&(api=settings.getSettingsHash().privateMediaApi,mediaType=settings.getSettingsHash().mediaType,purge()),populated},purge=function(){return responseCache=[],populated=!1},put=function(data){return populated=!0,responseCache=data},get=function(){return responseCache},{put:put,get:get,purge:purge,isPopulated:isPopulated}},this.WixPix.SingleKeyCache=function(getKey,getData){var cachedData,key,updateCache;return cachedData=null,key=null,updateCache=function(){return key=getKey(),cachedData=getData()},function(){return key!==getKey()?updateCache():cachedData}}}.call(this),function(){window.MediaGallery||(window.MediaGallery={}),MediaGallery.Conductor=function(mediaTypeFactory,settings){var getPublicMediaPath,getStartingTab,hasExternalForFree,hasExternalMedia,hasFolders,hasPhotoStock,hasPrivateMedia,hasPublicMedia,setStartingTab;return getStartingTab=function(){return settings.getSettingsHash().startingTab},setStartingTab=function(value){return settings.getSettingsHash().startingTab=value},hasPublicMedia=function(){return mediaTypeFactory.getMediaType().hasPublicMedia()},hasExternalMedia=function(){return mediaTypeFactory.getMediaType().hasExternalMedia()},hasExternalForFree=function(){return mediaTypeFactory.getMediaType().hasExternalForFree()},hasPhotoStock=function(){return mediaTypeFactory.getMediaType().hasPhotoStock()},hasFolders=function(){return mediaTypeFactory.getMediaType().hasFolders()},hasPrivateMedia=function(){return mediaTypeFactory.getMediaType().hasPrivateMedia()},getPublicMediaPath=function(){return settings.getSettingsHash().publicMediaPath},{hasPublicMedia:hasPublicMedia,hasFolders:hasFolders,hasPrivateMedia:hasPrivateMedia,hasExternalMedia:hasExternalMedia,hasExternalForFree:hasExternalForFree,hasPhotoStock:hasPhotoStock,getStartingTab:getStartingTab,setStartingTab:setStartingTab,getPublicMediaPath:getPublicMediaPath}}}.call(this),function(){!function(){var method,noop,_base,_i,_len,_ref;for(window.console||(window.console={}),noop=function(){},_ref=["log","debug","info","warn","error"],_i=0,_len=_ref.length;_len>_i;_i++)method=_ref[_i],(_base=window.console)[method]||(_base[method]=noop);return void 0}()}.call(this),function(){this.MediaGallery||(this.MediaGallery={}),MediaGallery.Delegate=function(){function Delegate(subject){this.subject=subject,_.forOwn(this.subject,function(_,methodName){return MediaGallery.Delegate.prototype[methodName]=function(){return this.subject[methodName].apply(this.subject,arguments)}})}return Delegate}()}.call(this),function(){"use strict";window.WixPix||(window.WixPix={}),WixPix.DndHelper=function(templateCache,compile){var helper;return helper=function(item,s){var helperElement,helperScope;return helperElement=$(templateCache.get("dragged-item-preview.html")),helperScope=s.$new(),helperScope.item=item,compile(helperElement)(helperScope),{html:function(){return helperElement}}},{helper:helper}}}.call(this),function(){"use strict";window.MediaGallery||(window.MediaGallery={}),MediaGallery.FeatureDetection=function(settings){var check,safariFive,ua;return ua=navigator.userAgent.toLowerCase(),check=function(r){return r.test(ua)},safariFive=function(){return!check(/\bchrome\b/)&&check(/version\/5.*?safari/)},{safariFive:safariFive,html5Uploads:function(){return!settings.getSettingsHash().forceFlashUploads&&!!window.FormData},flashUploads:function(){return settings.getSettingsHash().forceFlashUploads||swfobject.hasFlashPlayerVersion("10.0.0")&&!safariFive()}}}}.call(this),function(){var __slice=[].slice;window.WixPix||(window.WixPix={}),WixPix.Helpers={synchronize:function(func){var loading;return loading=!1,function(){var args,result;return args=1<=arguments.length?__slice.call(arguments,0):[],loading?void 0:(loading=!0,result=func.apply(null,args),null!=result.then?result.then(function(response){return loading=!1,response},function(response){throw loading=!1,response}):loading=!1)}},encode_folders:function(s){return null!=s?s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;"):void 0}}}.call(this),function(){MediaGallery.i18nWithPrefix=function(){var areLoaded,getKeyWithPrefix,getLang,getTranslation,hasKey,lang,prefix,prefixRegExp,setLang,setPrefix,translate,translations,updateTranslations;return prefix="",lang="en",translations={},prefixRegExp=/_(.*?)_(.*)/,areLoaded=function(){return _.size(translations)},updateTranslations=function(newTranslations){return translations=newTranslations},hasKey=function(key){return!!translations[key]},getTranslation=function(key,args){var value;return value=translations[key],value?value.replace(/%{(\d+?)}/g,function(match,index){return args[index]}):'Key without translation: "'+key+'"'},translate=function(key,args){var keyWithPrefix;return(keyWithPrefix=getKeyWithPrefix(prefix,key))?getTranslation(keyWithPrefix,args):getTranslation(key,args)},getKeyWithPrefix=function(prefix,key){for(;!hasKey(""+prefix+"."+key)&&prefixRegExp.test(prefix);)prefix=prefix.replace(prefixRegExp,"_$2");return hasKey(""+prefix+"."+key)?""+prefix+"."+key:!1},setPrefix=function(value){return value?prefix="_"+value:void 0},setLang=function(code){return lang=code},getLang=function(){return lang},{updateTranslations:updateTranslations,areLoaded:areLoaded,translate:translate,setPrefix:setPrefix,getLang:getLang,setLang:setLang}}}.call(this),function(){"use strict";window.WixPix||(window.WixPix={}),WixPix.ItemFromStaticResponse=function(mediaType){return function(response,folderId){var isPublicMedia,itemFactory,thumbnailerFactory;return thumbnailerFactory=mediaType.getMediaType().getThumbnailerFactory(),(itemFactory=mediaType.getMediaType().getItemFactory())({id:response.fileName||response.file_name,fileName:response.fileName||response.file_name,iconUrl:response.iconUrl||response.icon_url,timestamp:response.created_ts||void 0,title:response.originalFileName||response.original_file_name,width:1*response.width,height:1*response.height,folderId:response.parent_folder_id||folderId,sourceType:"Static",thumbnailer:thumbnailerFactory("/media/"+(response.fileName||response.file_name),response.iconUrl||response.icon_url,response.fileName||response.file_name,isPublicMedia=!1)})}},WixPix.ItemFromGoogleResponse=function(mediaType){return function(response,folderName){var isPublicMedia,itemFactory,thumbnailerFactory;return thumbnailerFactory=mediaType.getMediaType().getThumbnailerFactory(),(itemFactory=mediaType.getMediaType().getItemFactory())({id:response.file_name,iconUrl:response.icon_url,timestamp:response.created_ts||void 0,title:response.original_file_name,width:1*response.width,height:1*response.height,folderName:folderName,sourceType:"Static",thumbnailer:thumbnailerFactory(response.file_name,response.iconUrl,response.file_name,isPublicMedia=!1)})}}}.call(this),function(){"use strict";window.WixPix||(window.WixPix={}),WixPix.NotifyAndReject=function(domainEventPublisher,q){return function(message){return function(response){return domainEventPublisher.$broadcast(message),q.reject(response)}}}}.call(this),function(){"use strict";window.MediaGallery||(window.MediaGallery={}),MediaGallery.ProtocolItemMapper=function(settings){return{mapper:function(item){var mappedItem,mediaType,pathAddition;return mediaType=settings.getSettingsHash().mediaType,mappedItem={mediaType:item.getMediaType()||mediaType,fileName:item.getFileName(),fileUrl:item.getFileUrl(),uri:item.getFileName(),title:item.title.substring(0,80),url:item.getThumbnailer().fullUrl(),thumbnailUrl:item.getThumbnailer().makeEditorThumbnail(),width:item.width,height:item.height},"shapes"===settings.getSettingsHash().publicMediaFile&&(pathAddition=/shapes\//.test(mappedItem.fileName)?"":"shapes/",_.extend(mappedItem,{fileName:pathAddition+item.getFileName(),uri:pathAddition+item.getFileName()})),"secure_music"===mediaType&&(mappedItem.duration=item.getDuration()),"secure_music"===mediaType&&(mappedItem.previewFileName=item.getFileName().replace(".wav","")+"-128.mp3"),mappedItem}}}}.call(this),function(){"use strict";window.WixPix||(window.WixPix={}),WixPix.SelectionHelper=function(selectedItems,dndHelper,s){var dragStart,hasMultipleItems,helper,selectedClass,selectedItemsSize;return dragStart=function(item,folder){return selectedItems.add(item),item.isDragged=!0,{items:selectedItems,folder:folder}},hasMultipleItems=function(){return selectedItems.size()>1},selectedItemsSize=function(){return selectedItems.size()},helper=function(item){return dndHelper.helper(item,s)},selectedClass=function(item){return selectedItems.has(item)?"image-selected":""},{dragStart:dragStart,hasMultipleItems:hasMultipleItems,selectedItemsSize:selectedItemsSize,selectedClass:selectedClass,helper:helper}}}.call(this),function(){"use strict";this.MediaGallery||(this.MediaGallery={}),this.MediaGallery.isConnectionError=function(errorCode){return null==errorCode||!/^[0-9]{3}$/.test(errorCode)||""+errorCode=="403"},this.MediaGallery.SendWithRetry=function(q){return function(sendQuery,intervalTime,retryCount){var d,queryIndex,sendNext;return null==intervalTime&&(intervalTime=2e3),null==retryCount&&(retryCount=1),d=q.defer(),queryIndex=0,sendNext=function(failResult){return queryIndex++,retryCount+1>=queryIndex?sendQuery(queryIndex).then(function(res){return d.resolve(res)},function(res){return MediaGallery.isConnectionError(res.status)?setTimeout(function(){return sendNext(res)},intervalTime):d.reject(res)}):d.reject(failResult)},sendNext(),d.promise}}}.call(this),function(){window.WixPix||(window.WixPix={}),WixPix.Set=function(){var add,clear,data,has,init,remove,size,values;return data=[],has=function(key){return _.any(data,function(el){return el.equals(key)})},init=function(keys){return clear(),_.each(keys,add)},add=function(key){return has(key)?void 0:data.push(key)},remove=function(key){return data=_.reject(data,function(el){return el.equals(key)})},values=function(){return data},clear=function(){return data=[]},size=function(){return data.length},{has:has,add:add,remove:remove,values:values,clear:clear,size:size,init:init}}}.call(this),function(){"use strict";window.WixPix||(window.WixPix={}),function(){var currentTime;return currentTime=function(){return(new Date).getTime()},WixPix.Timer={start:function(){var current;return current=currentTime(),{stop:function(){return currentTime()-current}}}}}()}.call(this),function(){"use strict";this.WixPix||(this.WixPix={}),this.WixPix.getUploadFailsCounts=function(files){var allFailed,clientErrorsCodes,failedByAPI;return clientErrorsCodes=[WixPix.ErrorCodes.invalidFileSize,WixPix.ErrorCodes.unsupportedMediaType],allFailed=0,failedByAPI=0,_.each(files,function(fileToUpload){var errorCode,_base,_ref;return fileToUpload.isFailed()&&(allFailed++,errorCode="function"==typeof(_base=fileToUpload.getFailureReason())?_base(validationCode||(null!=(_ref=fileToUpload.getFailureReason())?_ref.errorCode:void 0)):void 0,errorCode&&clientErrorsCodes.indexOf(""+errorCode)<0)?failedByAPI++:void 0}),{allFailed:allFailed,failedByAPI:failedByAPI}}}.call(this),function(){"use strict";window.WixPix||(window.WixPix={}),WixPix.UploadsFile=function(getUploadsFileHandlers,q,httpErrorInterceptor,BIHelpers){return{uploadFile:function(multipart,url,progressCallback,withCredentials,queryIndex){var deferred,fd,filesSize,notifyBI,notifyData,uploadsFileHandlers,xhr;return null==withCredentials&&(withCredentials=!1),deferred=q.defer(),uploadsFileHandlers=getUploadsFileHandlers(url,deferred,progressCallback,queryIndex),fd=new FormData,filesSize=0,_.each(multipart,function(value,name){var args;return args="file"===name?[name,value,value.name]:[name,value],"file"===name&&(filesSize+=value.size),fd.append.apply(fd,args)}),notifyData={startedAt:BIHelpers.getCurrentTime(),responseSize:filesSize,BITimeReportName:"staticUpload"},notifyBI={success:function(r){return BIHelpers.notifyRequestTime(notifyData,!0),r||q.when(r)
},error:function(r){return BIHelpers.notifyRequestTime(notifyData,!1),httpErrorInterceptor.responseError(r),q.reject(r)}},xhr=new XMLHttpRequest,xhr.open("POST",url),xhr.withCredentials=withCredentials,xhr.addEventListener("error",uploadsFileHandlers.errorHandler),xhr.addEventListener("load",uploadsFileHandlers.loadHandler),xhr.upload.addEventListener("progress",uploadsFileHandlers.progressHandler),xhr.send(fd),deferred.promise.then(notifyBI.success,notifyBI.error)}}}}.call(this),function(){"use strict";window.WixPix||(window.WixPix={}),WixPix.GetUploadsFileHandlers=function(root,settings,BIHelpers){return function(url,deferred,progressCallback,queryIndex){var Response,startTime;return startTime=BIHelpers.getCurrentTime(),Response=function(evt){var code;return code="staticAPI"===settings.getSettingsHash().privateMediaApi?WixPix.ErrorCodes.fileUploadFail:1===queryIndex?WixPix.ErrorCodes.fileUploadFailRest:WixPix.ErrorCodes.fileUploadFailRestTwice,{data:evt.target.responseText,status:evt.target.status,config:{url:url,custom:{category:"privateMedia",errorCode:code,responseTime:BIHelpers.getCurrentTime()-startTime}}}},{errorHandler:function(evt){return root.$apply(function(){return deferred.reject(Response(evt))})},loadHandler:function(evt){var response;return response=Response(evt),200<=response.status&&response.status<300?deferred.resolve(response):deferred.reject(response),root.$apply()},progressHandler:function(evt){var percentComplete;return evt.lengthComputable?(percentComplete=Math.round(100*evt.loaded/evt.total),"function"==typeof progressCallback?progressCallback(percentComplete):void 0):void 0}}}}}.call(this),function(){"use strict";window.WixPix||(window.WixPix={}),WixPix.getParameterByName=function(name){var regex,results;return name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search),null==results?"":decodeURIComponent(results[1].replace(/\+/g," "))}}.call(this),function(){window.MediaGallery||(window.MediaGallery={}),MediaGallery.ValidateDocumentFile=function(validExtensions,maxSize){var fileExtensionInvalid,maxFileSizeInvalid,minFileSizeInvalid;return null==maxSize&&(maxSize=26214400),minFileSizeInvalid=function(file){return file.size<=3},maxFileSizeInvalid=function(file){return file.size>=maxSize},fileExtensionInvalid=function(file){var extension,fileNameWithExtension;return fileNameWithExtension=file.name.split("."),fileNameWithExtension.length<2?!0:(extension=fileNameWithExtension[fileNameWithExtension.length-1].toLowerCase(),-1===validExtensions.indexOf(extension))},function(file){return maxFileSizeInvalid(file)?{code:"-10413",category:"privateMedia",message:"InvalidFileSize",description:"File too big",errorCode:WixPix.ErrorCodes.invalidFileSize}:minFileSizeInvalid(file)?_.merge(defaultError,{code:"-10413",category:"privateMedia",message:"FlashError",description:"File too short",errorCode:WixPix.ErrorCodes.invalidFileSize}):fileExtensionInvalid(file)?{code:"-10413",category:"privateMedia",message:"UnsupportedMediaType",description:"File is of wrong type",errorCode:WixPix.ErrorCodes.unsupportedMediaType}:void 0}}}.call(this),function(){window.MediaGallery||(window.MediaGallery={}),MediaGallery.ValidateImageFile=function(file,maxSize){var defaultError,fileTypeInvalid,maxFileSizeInvalid,minFileSizeInvalid;return null==maxSize&&(maxSize=15728640),minFileSizeInvalid=function(file){return file.size<=3},maxFileSizeInvalid=function(file){return file.size>=maxSize},fileTypeInvalid=function(file){var fileTypeFilter;return fileTypeFilter=/^image\/(?:png|jpe?g|gif)$/,!fileTypeFilter.test(file.type)},defaultError={code:"-10413",category:"privateMedia"},maxFileSizeInvalid(file)?_.merge(defaultError,{message:"InvalidFileSize",description:"File too big",errorCode:WixPix.ErrorCodes.invalidFileSize}):minFileSizeInvalid(file)?_.merge(defaultError,{message:"FlashError",description:"File too short",errorCode:WixPix.ErrorCodes.invalidFileSize}):fileTypeInvalid(file)?_.merge(defaultError,{message:"UnsupportedMediaType",description:"File is of wrong type",errorCode:WixPix.ErrorCodes.unsupportedMediaType}):void 0}}.call(this),function(){"use strict";var _base;window.MediaGallery||(window.MediaGallery={}),(_base=window.MediaGallery).BINotifiers||(_base.BINotifiers={}),MediaGallery.BINotifiers.APIs=function(q,urls,helpers){var canSendBI;return canSendBI=function(config){var _ref;return!(null==(null!=(_ref=config.custom)?_ref.BITimeReportName:void 0))},{request:function(config){return config&&canSendBI(config)&&(config.custom.startedAt=helpers.getCurrentTime(),config.transformResponse||(config.transformResponse=[]),config.transformResponse.unshift(function(responceText){return config.custom.responseSize=(null!=responceText?responceText.length:void 0)||0,responceText})),config||q.when(config)},response:function(response){return response&&canSendBI(response.config)&&helpers.notifyRequestTime(response.config.custom,!0),response||q.when(response)},responseError:function(response){return response&&canSendBI(response.config)&&helpers.notifyRequestTime(response.config.custom,!1),q.reject(response)}}}}.call(this),function(){"use strict";window.MediaGallery||(window.MediaGallery={}),MediaGallery.BIErrorNotifier=function(){var categories,getEntriesByParams,send;return categories={"default":0,privateMedia:1,publicMedia:2,"static":3},getEntriesByParams=function(url,params){var entries;return entries=_.select(performance.getEntries(),function(entry){return entry.name.indexOf(url)>=0}),entries.length?(_.each(params,function(val,key){return entries=_.select(entries,function(entry){return entry.name.indexOf(""+key+"="+encodeURIComponent(val))>=0})}),entries):[]},send=function(severity,options){var params;return params={src:25,evid:10,cat:categories[options.category||"default"],iss:1,sev:severity,errc:""+(options.errorCode||WixPix.ErrorCodes.generalHTTPError)+(options.httpStatus||"000"),ver:MediaGallery.VERSION,did:window.siteId,httpc:options.httpStatus||"",ts:options.responseTime||"",dsc:options.message||""},options.httpStatus&&"000"!==options.httpStatus||null==("undefined"!=typeof performance&&null!==performance?performance.getEntries:void 0)||null==("undefined"!=typeof JSON&&null!==JSON?JSON.stringify:void 0)?MediaGallery.sendBIErrorRequest(params):setTimeout(function(){var requestTimings;return requestTimings=_.last(getEntriesByParams(options.url,options.params)),null!=requestTimings&&(params.dsc+="; request timings: "+JSON.stringify(requestTimings)),MediaGallery.sendBIErrorRequest(params)},300)},{info:function(options){return send(10,options)},warning:function(options){return send(20,options)},error:function(options){return send(30,options)},fatal:function(options){return send(40,options)}}}}.call(this),function(){"use strict";window.MediaGallery||(window.MediaGallery={}),MediaGallery.BIEventNotifier=function(urls,cookies,facebookConnector,flickrConnector,instagramConnector,picasaConnector,Settings){return facebookConnector.onConnectSuccess(function(){return MediaGallery.sendBIRequest(128,{service:"facebook"})}),flickrConnector.onConnectSuccess(function(){return MediaGallery.sendBIRequest(128,{service:"flickr"})}),instagramConnector.onConnectSuccess(function(){return MediaGallery.sendBIRequest(128,{service:"instagram"})}),picasaConnector.onConnectSuccess(function(){return MediaGallery.sendBIRequest(128,{service:"picasa"})}),{dialogOpened:function(attributes){return MediaGallery.sendBIRequest(100,{lngP:attributes.i18nCode,source:"private",selection:attributes.selectionType})},uploadButtonClicked:function(){return MediaGallery.sendBIRequest(101,{source:"button"})},uploadButtonInEmptyFolderClicked:function(){return MediaGallery.sendBIRequest(101,{source:"emptyFolder"})},itemsDropped:function(attributes){var params;return params={source:attributes.tab},"private"===attributes.tab&&(params.is_empty=!attributes.hadItems),MediaGallery.sendBIRequest(102,params)},collectionUploadStarted:function(AllFilesCount,uploadSessionId,folder,mode){return null==mode&&(mode="html5"),MediaGallery.sendBIRequest(103,{files:AllFilesCount,usi:uploadSessionId,mode:mode})},collectionUploadCompleted:function(AllFilesCount,failsCount,APIFailsCount,uploadSessionId){var eventId,options;return options={files:AllFilesCount,errors:failsCount,usi:uploadSessionId},options.is_logged_in=null!=cookies.wixSession?1:0,eventId=failsCount>0?124:104,MediaGallery.sendBIRequest(eventId,options)},tabClicked:function(attributes){return MediaGallery.sendBIRequest(105,{name:attributes.name||"private"})},cancelButtonClicked:function(){return MediaGallery.sendBIRequest(107)},helpButtonClicked:function(){return MediaGallery.sendBIRequest(108)},clickedOutsideOfDialog:function(){return MediaGallery.sendBIRequest(109)},privateMediaNewFolderClicked:function(){return MediaGallery.sendBIRequest(111)},privateMediaRenameFolderClicked:function(){return MediaGallery.sendBIRequest(114)},privateMediaRemoveFolderClicked:function(){return MediaGallery.sendBIRequest(116)},privateMediaRemoveItemClicked:function(){return MediaGallery.sendBIRequest(118,{source:"item",count:1})},privateMediaRemoveItemsClicked:function(attributes){return MediaGallery.sendBIRequest(118,{source:"menu",count:attributes.filesCount})},multipleItemsInSingleModeSelected:function(){return MediaGallery.sendBIRequest(119)},privateMediaDownloadItemClicked:function(){return MediaGallery.sendBIRequest(121,{source:"item"})},privateMediaEditItemClicked:function(){return MediaGallery.sendBIRequest(122,{source:"item"})},photoStockSortByPopularClicked:function(){return MediaGallery.sendBIRequest(129,{name:"popular"})},photoStockSortByRelevantClicked:function(){return MediaGallery.sendBIRequest(129,{name:"relevant"})},photoStockOrientationClicked:function(attributes){return MediaGallery.sendBIRequest(129,{name:attributes.name})},publicMediaSearchCompleted:function(data){var _ref,_ref1,_ref2,_ref3;return MediaGallery.sendBIRequest(126,{type:"public",category_id:null!=(_ref=data.category)?_ref.getId():void 0,category_name:null!=(_ref1=data.category)?_ref1.getTitle():void 0,subcategory_id:null!=(_ref2=data.subcategory)?_ref2.getId():void 0,subcategory_name:null!=(_ref3=data.subcategory)?_ref3.getTitle():void 0,mediatype:Settings.getSettingsHash().mediaType,rootcategory_key:Settings.getSettingsHash().publicMediaFile,query:data.query,num_items:data.itemsCount,http_code:data.responseCode||"000"})},connectExternalServicesClicked:function(){return MediaGallery.sendBIRequest(127)}}},MediaGallery.FunctionalBIEventNotifier=function(oopBiEventNotifier){return function(eventName,attributes){return"function"==typeof oopBiEventNotifier[eventName]?oopBiEventNotifier[eventName](attributes):void 0}}}.call(this),function(){"use strict";window.WixPix||(window.WixPix={}),WixPix.ErrorCodes={invalidFileSize:"101",unsupportedMediaType:"102",publicMediaCategoriesCannotBeLoaded:"103",translationsCannotBeLoaded:"104",getTicketFail:"201",fileUploadFail:"202",addToFolderFailed:"203",getItemsFailed:"204",getDeletedImagesFailed:"205",renameItemFailed:"206",removeItemFailed:"207",restoreItemFailed:"208",purgeItemFailed:"209",createFolderFailed:"210",removeFolderFailed:"211",renameFolderFailed:"212",getUploadUrlFailed:"213",changeItemNameFailed:"214",getFoldersFailed:"215",uploadByURLFailed:"216",flashFileUploadFail:"217",getTicketFailRest:"601",fileUploadFailRest:"602",fileUploadFailRestTwice:"702",addToFolderFailedRest:"603",getSingleItemFailedRest:"604",getSingleItemFailedRestTwice:"704",getDeletedImagesFailedRest:"605",getDeletedImagesFailedRestTwice:"705",renameItemFailedRest:"606",removeItemFailedRest:"607",restoreItemFailedRest:"608",purgeItemFailedRest:"609",createFolderFailedRest:"610",removeFolderFailedRest:"611",renameFolderFailedRest:"612",getUploadUrlFailedRest:"613",getUploadUrlFailedRestTwice:"713",changeItemNameFailedRest:"614",getItemsFailedRest:"615",getItemsFailedRestTwice:"715",getRootFolderFailedRest:"616",getRootFolderFailedRestTwice:"716",getItemsCountFailedRest:"617",getItemsCountFailedRestTwice:"717",getFoldersFailedRest:"618",getFoldersFailedRestTwice:"718",flashFileUploadFailRest:"619",uploadByURLFailedFailRest:"620",generalHTTPError:"401",parseError:"402",getItemsForSubFolderFailed:"501",getPublicItemsFailed:"502",getPublicItemsFailedTwice:"505",getPublicCategoriesFailed:"503",getPublicCategoriesFailedTwice:"506",getPublicSearchItemsFailed:"504",getPublicSearchItemsFailedTwice:"507",getFacebookFoldersFailed:"800",getFacebookItemsFailed:"801",getMoreFacebookItemsFailed:"802",getFlickrFoldersFailed:"810",getFlickrItemsFailed:"811",getMoreFlickrItemsFailed:"812",getInstagramUserInfoFailed:"820",getInstagramItemsFailed:"821",getMoreInstagramItemsFailed:"822",getPicasaFoldersFailed:"830",getPicasaItemsFailed:"831",getMorePicasaItemsFailed:"832",flickrSearchFailed:"871",getMoreFlickrSearchItemsFailed:"872",googleSearchFailed:"881",getMoreGoogleSearchItemsFailed:"882"}}.call(this),function(){"use strict";window.MediaGallery||(window.MediaGallery={}),MediaGallery.BINotifyHelpers=function(eventNotifier,Timer,q){return{getCurrentTime:function(){return(new Date).getTime()},loading:function(eventName,promise){var timer;return eventNotifier(""+eventName+"Started"),timer=Timer.start(),promise.then(function(r){return eventNotifier(""+eventName+"Succeeded",{responseTime:timer.stop()}),r},function(r){return eventNotifier(""+eventName+"Failed",{responseTime:timer.stop()}),q.reject(r)})},notifyRequestTime:function(data,isSuccess){var responseTime,resultText;return null==isSuccess&&(isSuccess=!0),responseTime=this.getCurrentTime()-data.startedAt,resultText=isSuccess?"success":"fail",MediaGallery.sendBIRequest(110,{call_name:data.BITimeReportName,ts:responseTime,result:resultText,response_speed:Math.floor(data.responseSize/(responseTime/1e3)),response_size:data.responseSize})}}}}.call(this),function(){"use strict";var _base;window.MediaGallery||(window.MediaGallery={}),(_base=window.MediaGallery).BINotifiers||(_base.BINotifiers={}),MediaGallery.BINotifiers.Transactions=function(urls,settings,errorNotifier,addFolder,removeFolder,renameFolder,chooseItems,removeItem,flashFileUpload,location,Settings){return{subscribe:function(){return addFolder.register({success:function(data){return MediaGallery.sendBIRequest(112,{flow:data.flow,result:"success"})},fail:function(data){return MediaGallery.sendBIRequest(112,{flow:data.flow,result:"fail",reason:data.errorName})}}),removeFolder.register({success:function(){return MediaGallery.sendBIRequest(117,{result:"success"})},fail:function(data){return MediaGallery.sendBIRequest(117,{result:"fail",reason:data.errorName})}}),renameFolder.register({success:function(data){return MediaGallery.sendBIRequest(115,{flow:data.flow,result:"success"})},fail:function(data){return MediaGallery.sendBIRequest(115,{flow:data.flow,result:"fail",reason:data.errorName})}}),chooseItems.register({success:function(data){var BIData,_ref,_ref1,_ref2,_ref3;return BIData={source:data.BIData.source||"button",titles:_.pluck(data.items,"title").join("|"),files:data.items.length,mediatype:Settings.getSettingsHash().mediaType},["/static_public_media","/breadcrumbs_dynamic_public_media","/dynamic_public_media"].indexOf(location.path())>=0?(BIData.privateMediaItemsCount=0,BIData.publicMediaItemsCount=data.items.length,BIData.type="public",BIData.category_id=null!=(_ref=data.BIData.category)?_ref.getId():void 0,BIData.category_name=null!=(_ref1=data.BIData.category)?_ref1.getTitle():void 0,BIData.subcategory_id=null!=(_ref2=data.BIData.subcategory)?_ref2.getId():void 0,BIData.subcategory_name=null!=(_ref3=data.BIData.subcategory)?_ref3.getTitle():void 0):(BIData.privateMediaItemsCount=data.items.length,BIData.publicMediaItemsCount=0,BIData.type="private","/external_for_free"===location.path()&&(BIData.type="external_for_free"),"/photo_stock"===location.path()&&(BIData.type="photo_stock"),data.BIData.isImported&&"private"===BIData.type&&(BIData.type="external")),MediaGallery.sendBIRequest(106,BIData)}}),removeItem.register({success:function(){return MediaGallery.sendBIRequest(118,{source:"item",count:1})}}),flashFileUpload.register({collectionUploadFailed:function(){var code;return code="staticAPI"===settings.getSettingsHash().privateMediaApi?WixPix.ErrorCodes.flashFileUploadFail:WixPix.ErrorCodes.flashFileUploadFailRest,errorNotifier.error({category:"privateMedia",message:"HTTP error",errorCode:code})}})}}}}.call(this),function(){window.WixPix||(window.WixPix={}),WixPix.MediaTypes||(WixPix.MediaTypes={}),WixPix.MediaTypes.Document=function(mediaTypeConstructor,urls,itemFactory){return function(settings,fileExtensions,itemActions){return mediaTypeConstructor({mediaTypeName:"document",hasPrivateMedia:settings.hasPrivateMedia,hasFolders:!1,hasPublicMedia:!1,acceptedFileTypes:"application/pdf,application/vnd.ms-excel,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.ms-powerpoint,application/vnd.openxmlformats-officedocument.presentationml.presentation,application/vnd.oasis.opendocument.formula,application/vnd.oasis.opendocument.text",flashAcceptedFileTypes:fileExtensions,thumbnailerFactory:WixPix.PrivateMediaDocumentThumbnailer(urls,settings.privateMediaApi),validateFile:MediaGallery.ValidateDocumentFile(fileExtensions),staticCode:"ugd",magnifyingGlassTemplate:"magnifying-glass-no-template.html",noItemsTemplate:"no-documents",itemFactory:itemFactory,itemActionsList:itemActions,hasExternalMedia:!1,hasExternalForFree:!1,hasPhotoStock:!1})}}}.call(this),function(){window.WixPix||(window.WixPix={}),WixPix.MediaTypes||(WixPix.MediaTypes={}),WixPix.MediaTypes.Font=function(mediaTypeConstructor,urls,itemFactory){return function(settings,fileExtensions,itemActions){return mediaTypeConstructor({mediaTypeName:"ufonts",hasPrivateMedia:settings.hasPrivateMedia,hasPublicMedia:!1,hasFolders:!1,acceptedFileTypes:"application/x-font-ttf,font/ttf",flashAcceptedFileTypes:fileExtensions,thumbnailerFactory:WixPix.PrivateMediaFontThumbnailer(urls,settings.privateMediaApi),validateFile:MediaGallery.ValidateDocumentFile(fileExtensions),staticCode:"ufonts",magnifyingGlassTemplate:"font_magnifying_glass.html",noItemsTemplate:"no-fonts",itemFactory:itemFactory,itemActionsList:itemActions,hasExternalMedia:!1,hasExternalForFree:!1,hasPhotoStock:!1})}}}.call(this),function(){window.WixPix||(window.WixPix={}),WixPix.MediaTypes||(WixPix.MediaTypes={}),WixPix.MediaTypes.Icon=function(mediaTypeConstructor,urls,itemFactory){return function(settings,imageFileExtensions,itemActions){return mediaTypeConstructor({mediaTypeName:"site_icon",hasPrivateMedia:settings.hasPrivateMedia,hasPublicMedia:!1,hasFolders:!1,acceptedFileTypes:"image/*",flashAcceptedFileTypes:imageFileExtensions,thumbnailerFactory:WixPix.PrivateMediaImageThumbnailer(urls,settings.privateMediaApi),validateFile:MediaGallery.ValidateImageFile,staticCode:"ficons",magnifyingGlassTemplate:"magnifying_glass.html",noItemsTemplate:"no-icons",itemFactory:itemFactory,itemActionsList:itemActions,hasExternalMedia:!1,hasExternalForFree:settings.hasExternalForFree,hasPhotoStock:settings.hasPhotoStock})}}}.call(this),function(){this.WixPix||(this.WixPix={}),this.WixPix.MediaTypeConstructor=function(params){var flashAllowedFileExtensionsString;return flashAllowedFileExtensionsString=function(fileExtensions){return _.map(fileExtensions,function(extension){return"*."+extension}).join(";")},{hasPublicMedia:function(){return params.hasPublicMedia},hasExternalMedia:function(){return params.hasExternalMedia},hasExternalForFree:function(){return params.hasExternalForFree},hasPhotoStock:function(){return params.hasPhotoStock},hasPrivateMedia:function(){return params.hasPrivateMedia},hasFolders:function(){return params.hasFolders},getMediaTypeName:function(){return params.mediaTypeName},getAcceptedFileTypes:function(){return params.acceptedFileTypes},getFlashAcceptedFileTypes:function(){return flashAllowedFileExtensionsString(params.flashAcceptedFileTypes)},getValidateFile:function(){return params.validateFile},getStaticCode:function(){return params.staticCode},getThumbnailerFactory:function(){return params.thumbnailerFactory},getMagnifyingGlassTemplate:function(){return params.magnifyingGlassTemplate},getNoItemsTemplate:function(){return params.noItemsTemplate},getItemFactory:function(){return params.itemFactory},canEditItem:function(){return params.itemActionsList.indexOf("edit")>=0},canRenameItem:function(){return params.itemActionsList.indexOf("rename")>=0},canRemoveItem:function(){return params.itemActionsList.indexOf("remove")>=0},canDownloadItem:function(){return params.itemActionsList.indexOf("download")>=0}}}}.call(this),function(){"use strict";window.WixPix||(window.WixPix={}),WixPix.MediaTypeInitialization=function(protocol,settingsFactory,picture,shape,watermark,icon,doc,secureMusic,music,swf,font,video){var getMediaType;return getMediaType=function(){var croppedItemActions,defaultItemActions,fileExtensions,imageFileExtensions,settings;if(settings=settingsFactory.getSettingsHash(),imageFileExtensions=["jpeg","jpe","jpg","gif","png"],defaultItemActions=["edit","remove","rename","download"],croppedItemActions=["remove","rename"],"picture"===settings.mediaType)return"shapes"===settings.publicMediaFile?shape(settings,imageFileExtensions,defaultItemActions):picture(settings,imageFileExtensions,defaultItemActions);if("watermark"===settings.mediaType)return watermark(settings,imageFileExtensions,defaultItemActions);if("site_icon"===settings.mediaType)return icon(settings,imageFileExtensions,croppedItemActions);if("document"===settings.mediaType)return fileExtensions=["pdf","xls","xlsx","doc","docx","ppt","pptx","odp","odt"],doc(settings,fileExtensions,croppedItemActions);if("secure_music"===settings.mediaType)return fileExtensions=["wav"],secureMusic(settings,fileExtensions,croppedItemActions);if("video"===settings.mediaType)return fileExtensions=["mp4","mov","avi","mpg","mpeg"],video(settings,fileExtensions,croppedItemActions);if("music"===settings.mediaType)return fileExtensions=["mp3","mpg","mpeg"],music(settings,fileExtensions,croppedItemActions);if("swf"===settings.mediaType)return fileExtensions=["swf"],swf(settings,fileExtensions,croppedItemActions);if("ufonts"===settings.mediaType)return fileExtensions=["ttf"],font(settings,fileExtensions,croppedItemActions);throw"Not supported media type"},{getMediaType:getMediaType}}}.call(this),function(){window.WixPix||(window.WixPix={}),WixPix.MediaTypes||(WixPix.MediaTypes={}),WixPix.MediaTypes.Music=function(mediaTypeConstructor,urls,itemFactory){return function(settings,fileExtensions,itemActions){return mediaTypeConstructor({mediaTypeName:"music",hasPrivateMedia:settings.hasPrivateMedia,hasPublicMedia:!1,hasFolders:!1,acceptedFileTypes:"audio/*",flashAcceptedFileTypes:fileExtensions,thumbnailerFactory:WixPix.PrivateMediaDocumentThumbnailer(urls,settings.privateMediaApi),validateFile:MediaGallery.ValidateDocumentFile(fileExtensions,52428800),staticCode:"mp3",magnifyingGlassTemplate:"magnifying-glass-no-template.html",noItemsTemplate:"no-music",itemFactory:itemFactory,itemActionsList:itemActions,hasExternalMedia:!1,hasExternalForFree:!1,hasPhotoStock:!1})}}}.call(this),function(){window.WixPix||(window.WixPix={}),WixPix.MediaTypes||(WixPix.MediaTypes={}),WixPix.MediaTypes.Picture=function(mediaTypeConstructor,urls,itemFactory){return function(settings,imageFileExtensions,itemActions){return mediaTypeConstructor({mediaTypeName:"picture",hasPrivateMedia:settings.hasPrivateMedia,hasPublicMedia:!0,hasFolders:!0,acceptedFileTypes:"image/*",flashAcceptedFileTypes:imageFileExtensions,thumbnailerFactory:WixPix.PrivateMediaImageThumbnailer(urls,settings.privateMediaApi),validateFile:MediaGallery.ValidateImageFile,staticCode:"media",magnifyingGlassTemplate:"magnifying_glass.html",noItemsTemplate:"no-images",hasExternalMedia:settings.hasExternalMedia,hasExternalForFree:settings.hasExternalForFree,itemFactory:itemFactory,itemActionsList:itemActions,hasPhotoStock:settings.hasPhotoStock})}}}.call(this),function(){window.WixPix||(window.WixPix={}),WixPix.MediaTypes||(WixPix.MediaTypes={}),WixPix.MediaTypes.SecureMusic=function(mediaTypeConstructor,urls,itemFactory){return function(settings,fileExtensions,itemActions){return mediaTypeConstructor({mediaTypeName:"secure_music",hasPrivateMedia:settings.hasPrivateMedia,hasPublicMedia:!1,hasFolders:!1,acceptedFileTypes:"audio/*",flashAcceptedFileTypes:fileExtensions,thumbnailerFactory:WixPix.PrivateMediaSecureDocumentThumbnailer(urls,settings.privateMediaApi),validateFile:MediaGallery.ValidateDocumentFile(fileExtensions,157286400),staticCode:"smusic",magnifyingGlassTemplate:"magnifying-glass-no-template.html",noItemsTemplate:"no-music",itemFactory:itemFactory,itemActionsList:itemActions,hasExternalMedia:!1,hasExternalForFree:!1,hasPhotoStock:!1})}}}.call(this),function(){window.WixPix||(window.WixPix={}),WixPix.MediaTypes||(WixPix.MediaTypes={}),WixPix.MediaTypes.Shape=function(mediaTypeConstructor,urls,itemFactory){return function(settings,imageFileExtensions,itemActions){return mediaTypeConstructor({mediaTypeName:"picture",hasPrivateMedia:!1,hasPublicMedia:!0,hasFolders:!0,acceptedFileTypes:"image/*",flashAcceptedFileTypes:imageFileExtensions,thumbnailerFactory:WixPix.PrivateMediaShapeThumbnailer(urls,settings),validateFile:MediaGallery.ValidateImageFile,staticCode:"media",magnifyingGlassTemplate:"shape_magnifying_glass.html",noItemsTemplate:"no-images",hasExternalMedia:!0,hasExternalForFre:!0,itemFactory:itemFactory,itemActionsList:itemActions,hasExternalMedia:!1,hasExternalForFree:!1,hasPhotoStock:!1})}}}.call(this),function(){window.WixPix||(window.WixPix={}),WixPix.MediaTypes||(WixPix.MediaTypes={}),WixPix.MediaTypes.Swf=function(mediaTypeConstructor,urls,itemFactory){return function(settings,fileExtensions,itemActions){return mediaTypeConstructor({mediaTypeName:"swf",hasPrivateMedia:settings.hasPrivateMedia,hasPublicMedia:!1,hasFolders:!1,acceptedFileTypes:"application/x-shockwave-flash",flashAcceptedFileTypes:fileExtensions,thumbnailerFactory:WixPix.PrivateMediaSwfThumbnailer(urls,settings.privateMediaApi),validateFile:MediaGallery.ValidateDocumentFile(fileExtensions),staticCode:"media",magnifyingGlassTemplate:"magnifying-glass-no-template.html",noItemsTemplate:"no-swf",itemFactory:itemFactory,itemActionsList:itemActions,hasExternalMedia:!1,hasExternalForFree:!1,hasPhotoStock:!1})}}}.call(this),function(){window.WixPix||(window.WixPix={}),WixPix.MediaTypes||(WixPix.MediaTypes={}),WixPix.MediaTypes.Video=function(mediaTypeConstructor,urls,itemFactory){return function(settings,fileExtensions,itemActions){return mediaTypeConstructor({mediaTypeName:"video",hasPrivateMedia:settings.hasPrivateMedia,hasPublicMedia:!0,hasFolders:!1,acceptedFileTypes:"video/*",flashAcceptedFileTypes:fileExtensions,thumbnailerFactory:WixPix.PrivateMediaVideoThumbnailer(urls,settings.privateMediaApi),validateFile:MediaGallery.ValidateDocumentFile(fileExtensions,262144e3),staticCode:"video",magnifyingGlassTemplate:"magnifying-glass-no-template.html",noItemsTemplate:"no-video",itemFactory:itemFactory,itemActionsList:itemActions,hasExternalMedia:!1,hasExternalForFree:!1,hasPhotoStock:!1})}}}.call(this),function(){window.WixPix||(window.WixPix={}),WixPix.MediaTypes||(WixPix.MediaTypes={}),WixPix.MediaTypes.Watermark=function(mediaTypeConstructor,urls,itemFactory){return function(settings,imageFileExtensions,itemActions){return mediaTypeConstructor({mediaTypeName:"watermark",hasPrivateMedia:settings.hasPrivateMedia,hasPublicMedia:!0,hasFolders:!0,acceptedFileTypes:"image/*",flashAcceptedFileTypes:imageFileExtensions,thumbnailerFactory:WixPix.PrivateMediaWatermarkThumbnailer(urls,settings.privateMediaApi),validateFile:MediaGallery.ValidateImageFile,staticCode:"watermarks",magnifyingGlassTemplate:"magnifying_glass.html",noItemsTemplate:"no-images",itemFactory:itemFactory,itemActionsList:itemActions,hasExternalMedia:!1,hasExternalForFree:!1,hasPhotoStock:!1})}}}.call(this),function(){"use strict";window.WixPix||(window.WixPix={}),WixPix.FilePreview=function(size){return{size:size,type:void 0,src:void 0}}}.call(this),function(){window.MediaGallery||(window.MediaGallery={}),MediaGallery.FileToUpload=function(data,name,uuid){var failureReason,getFailureReason,getName,getPreview,getUUID,hasPreview,isFailed,isInFolder,isUploaded,isUploading,makeFailed,makeInFolder,makeUploaded,makeUploading,percentUploaded,preview,setPreview,state;return percentUploaded=0,preview=null,state="initial",failureReason=null,isUploading=function(){return"uploading"===state},isUploaded=function(){return"uploaded"===state},isInFolder=function(){return"in_folder"===state},isFailed=function(){return"failed"===state},makeInFolder=function(){return state="in_folder"},makeUploading=function(){return state="uploading"},makeUploaded=function(){return state="uploaded"},makeFailed=function(reason){return failureReason=reason,state="failed"},setPreview=function(thePreview){return preview=thePreview},getPreview=function(){return preview},hasPreview=function(){return null!=preview},getName=function(){return name},getFailureReason=function(){return failureReason},getUUID=function(){return uuid},{data:data,percentUploaded:percentUploaded,setPreview:setPreview,getPreview:getPreview,hasPreview:hasPreview,makeUploading:makeUploading,makeUploaded:makeUploaded,makeFailed:makeFailed,makeInFolder:makeInFolder,isUploading:isUploading,isUploaded:isUploaded,isFailed:isFailed,isInFolder:isInFolder,getName:getName,getFailureReason:getFailureReason,type:"FileToUpload",getUUID:getUUID}}}.call(this),function(){window.MediaGallery||(window.MediaGallery={}),MediaGallery.Chunk=function(files,folder){return{files:files,folder:folder}},MediaGallery.FilesToUpload=function(apis,flashUploader,generateUUID){var addFiles,addFilesToUpload,chunks,clear,clearForFolderName,clearUploadedChunks,collection,collectionUploadFailed,collectionUploadSucceeded,files,filesForFolderName,hasOnlyFailedFiles,isEmpty;return collection={},isEmpty=function(){return angular.equals(collection,{})},chunks=function(){return collection},filesForFolderName=function(folderName){return collection[folderName]?collection[folderName].files:void 0},addFilesToUpload=function(filesToUpload,folder){var chunk,folderName;return folderName=folder.getName(),chunk=collection[folderName]||(collection[folderName]=MediaGallery.Chunk([],folder)),chunk.files.push.apply(chunk.files,filesToUpload),MediaGallery.Chunk(filesToUpload,folder)},addFiles=function(files,folder){var chunk,filesToUpload,folderName;return folderName=folder.getName(),filesToUpload=_.map(files,function(file){return MediaGallery.FileToUpload(file,file.name,generateUUID())}),chunk=collection[folderName]||(collection[folderName]=MediaGallery.Chunk([],folder)),chunk.files.push.apply(chunk.files,filesToUpload),MediaGallery.Chunk(filesToUpload,folder)},files=function(){return _.flatten(_.map(collection,function(chunk){return chunk.files}))},hasOnlyFailedFiles=function(folderName){return _.all(filesForFolderName(folderName),function(file){return file.isFailed()||file.isInFolder()})},clearUploadedChunks=function(){return collection=_.reduce(collection,function(result,chunk,folderName){return _.all(chunk.files,function(file){return file.isInFolder()})||(result[folderName]=chunk),result},{})},clearForFolderName=function(folderName){return delete collection[folderName]},clear=function(){return collection={}},collectionUploadSucceeded=function(){return clearUploadedChunks()},collectionUploadFailed=function(){return clear()},apis.getUploadTransaction().register({collectionUploadSucceeded:collectionUploadSucceeded,collectionUploadFailed:collectionUploadSucceeded}),flashUploader.register({collectionUploadSucceeded:collectionUploadSucceeded,collectionUploadFailed:collectionUploadFailed}),{isEmpty:isEmpty,clear:clear,clearForFolderName:clearForFolderName,addFiles:addFiles,addFilesToUpload:addFilesToUpload,chunks:chunks,filesForFolderName:filesForFolderName,hasOnlyFailedFiles:hasOnlyFailedFiles,collectionUploadSucceeded:collectionUploadSucceeded,collectionUploadFailed:collectionUploadFailed}
}}.call(this),function(){var defaultThumbnailer,thumbnailPath;window.MediaGallery||(window.MediaGallery={}),MediaGallery.AllFolder=function(){var equals,getName;return getName=function(){return""},equals=function(folder){return"AllFolder"===folder.type},{getId:getName,getName:getName,equals:equals,type:"AllFolder"}},thumbnailPath="./images/NoPicIcon_110px.png",defaultThumbnailer={makeThumbnail:function(){return thumbnailPath},makeFolderThumbnail:function(){return thumbnailPath},makePreview:function(){return thumbnailPath},makeBigImage:function(){return thumbnailPath}},MediaGallery.Folder=function(id,name,items,thumbnailer,itemsCount){var addItem,equals,getId,getItemsCount,getName,getThumbnailer,removeItem,setId,setName;return null==items&&(items=[]),null==itemsCount&&(itemsCount=null),setId=function(newId){return id=newId},getId=function(){return id},getName=function(){return name},equals=function(folder){return getName()===folder.getName()},setName=function(aName){return name=aName},addItem=function(item){return items.push(item)},removeItem=function(removedItem){return items=_.filter(items,function(item){return item.id!==removedItem.getId()})},getThumbnailer=function(){return null!=thumbnailer?thumbnailer:items.length?_.first(items).getThumbnailer():defaultThumbnailer},getItemsCount=function(){return itemsCount||items.length},{getId:getId,setId:setId,setName:setName,equals:equals,getName:getName,getItemsCount:getItemsCount,addItem:addItem,removeItem:removeItem,getItems:function(){return items},type:"Folder",getThumbnailer:getThumbnailer}}}.call(this),function(){window.MediaGallery||(window.MediaGallery={}),MediaGallery.Item=function(params){var equals,setTitle,setUUID,sourceName,title,urldecode,uuid;return uuid=void 0,sourceName=params.sourceName||"user",equals=function(item){return params.id===item.id},urldecode=function(title){var error;if(null==title)return"";try{return decodeURIComponent(title)}catch(_error){return error=_error,unescape(title)}},title=urldecode(params.title),setUUID=function(value){return uuid=value},setTitle=function(value){return title=urldecode(value)},{id:params.id,iconUrl:params.iconUrl,width:params.width,height:params.height,timestamp:params.timestamp,title:title,folderId:params.folderId,type:"Item",uuid:uuid,sourceType:params.sourceType,sourceName:sourceName,getMediaType:function(){return params.mediaType},getId:function(){return params.id},getIconUrl:function(){return params.iconUrl},getWidth:function(){return params.width},getHeight:function(){return params.height},getTitle:function(){return title},setTitle:setTitle,getType:function(){return type},getFileName:function(){return params.fileName||params.id},getFileUrl:function(){return params.fileUrl},getSourceType:function(){return params.sourceType},getSourceName:function(){return sourceName},getUuid:function(){return uuid},getTimestamp:function(){return params.timestamp},getThumbnailer:function(){return params.thumbnailer},getFolderId:function(){return params.folderId},equals:equals,setUUID:setUUID,getUUID:function(){return uuid}}}}.call(this),function(){"use strict";window.WixPix||(window.WixPix={}),WixPix.PaginatedCollection=function(getAllItems,pageSize){var itemsFromStartToPage,itemsOfPage,nextPage,page;return null==pageSize&&(pageSize=25),page=0,itemsOfPage=function(page){return getAllItems().slice(page*pageSize,(page+1)*pageSize)},nextPage=function(){return page+=1,itemsOfPage(page)},itemsFromStartToPage=function(page){return getAllItems().slice(0,(page+1)*pageSize)},{itemsOfPage:itemsOfPage,itemsFromStartToPage:itemsFromStartToPage,nextPage:nextPage,all:getAllItems}}}.call(this),function(){window.MediaGallery||(window.MediaGallery={}),MediaGallery.SelectedItems=function(domainEventPublisher,q,settings,itemSource){var actionName,add,addAll,checkMultipleSelectionInSingleMode,clear,collection,currentSelected,has,isEmpty,isManagerMode,isSelectionValid,remove,selectAdditional,selectRange,selectSingle,setCurrentSelected,size,supportsMultipleItems,toggle,values;return currentSelected=null,collection=WixPix.Set(),checkMultipleSelectionInSingleMode=function(){return collection.size()>1&&!supportsMultipleItems()?domainEventPublisher.$broadcast("MultipleSelectionInSingleMode"):void 0},size=function(){return collection.size()},isEmpty=function(){return 0===size()},add=function(val){return collection.add(val)},addAll=function(items){var item,_i,_len;for(_i=0,_len=items.length;_len>_i;_i++)item=items[_i],add(item);return checkMultipleSelectionInSingleMode()},has=function(val){return collection.has(val)},remove=function(val){return collection.remove(val)},toggle=function(val){return has(val)?remove(val):add(val)},setCurrentSelected=function(item){return currentSelected=item},selectRange=function(selectedItem,allItems){var firstNum,highNum,i,lastNum,lowNum,_i;for(clear(),currentSelected||(currentSelected=allItems[0]),add(currentSelected),firstNum=-1===_.indexOf(allItems,currentSelected)?0:_.indexOf(allItems,currentSelected),lastNum=_.indexOf(allItems,selectedItem),lowNum=Math.min(firstNum,lastNum),highNum=Math.max(firstNum,lastNum),i=_i=lowNum;highNum>=lowNum?highNum>=_i:_i>=highNum;i=highNum>=lowNum?++_i:--_i)add(allItems[i]);return checkMultipleSelectionInSingleMode()},selectSingle=function(val){var wasInCollection;return supportsMultipleItems()?toggle(val):(wasInCollection=has(val),clear(),wasInCollection||add(val)),setCurrentSelected(val)},selectAdditional=function(val){return has(val)?remove(val):(add(val),setCurrentSelected(val)),checkMultipleSelectionInSingleMode()},values=function(){return isManagerMode()?itemSource.getItems():q.when(collection.values())},clear=function(){return collection.clear()},supportsMultipleItems=function(){return"multiple"===settings.getSettingsHash().selectionType||isManagerMode()},isManagerMode=function(){return"manager"===settings.getSettingsHash().selectionType},isSelectionValid=function(){return isManagerMode()?!0:supportsMultipleItems()?!isEmpty():1===size()},actionName=function(){return isManagerMode()?"ok":"change"},{size:size,has:has,add:add,addAll:addAll,remove:remove,clear:clear,values:values,selectRange:selectRange,selectSingle:selectSingle,selectAdditional:selectAdditional,supportsMultipleItems:supportsMultipleItems,isEmpty:isEmpty,isSelectionValid:isSelectionValid,actionName:actionName,isManagerMode:isManagerMode}}}.call(this),function(){window.WixPix||(window.WixPix={}),WixPix.PrivateMediaDocumentThumbnailer=function(urls,apiName,isPublicMedia){return function(fileUrl,iconUrl){var fullIconUrl,fullUrl,makeEditorThumbnail,makeUrlOfSize,parseFileUrl;return parseFileUrl=function(fileUrl){return"/"===fileUrl[0]?fileUrl:"/"+fileUrl},fullIconUrl=function(){return""+urls.filesContent(isPublicMedia)+"/"+iconUrl},fullUrl=function(){return""+urls.filesContent(isPublicMedia)+parseFileUrl(fileUrl)},makeUrlOfSize=function(){return fullIconUrl()},makeEditorThumbnail=makeUrlOfSize,{type:"DocumentThumbnailer",makeUrlOfSize:makeUrlOfSize,makePreviewUrlOfSize:makeUrlOfSize,makePublicUrlOfSize:makeUrlOfSize,fullUrl:fullUrl,makeEditorThumbnail:makeEditorThumbnail,makeThumbnail:makeEditorThumbnail}}},window.WixPix||(window.WixPix={}),WixPix.PrivateMediaSecureDocumentThumbnailer=function(urls){return function(fileUrl,iconUrl,fileName,isPublicMedia){var fullIconUrl,fullUrl,makeEditorThumbnail,makeUrlOfSize;return fullIconUrl=function(){return""+urls.filesContent(isPublicMedia)+"/"+iconUrl},fullUrl=function(){return""+urls.filesContent(isPublicMedia)+"/media/"+fileUrl},makeUrlOfSize=function(){return fullIconUrl()},makeEditorThumbnail=makeUrlOfSize,{type:"DocumentThumbnailer",makeUrlOfSize:makeUrlOfSize,makePreviewUrlOfSize:makeUrlOfSize,makePublicUrlOfSize:makeUrlOfSize,fullUrl:fullUrl,makeEditorThumbnail:makeEditorThumbnail,makeThumbnail:makeEditorThumbnail}}}}.call(this),function(){window.WixPix||(window.WixPix={}),WixPix.PrivateMediaFontThumbnailer=function(urls){return function(fileUrl,iconUrl,fileName,isPublicMedia){var fullIconUrl,fullUrl,makeEditorThumbnail,makePreviewUrlOfSize,makeUrlOfSize;return fullIconUrl=function(){return""+urls.filesContent(isPublicMedia)+"/"+iconUrl},fullUrl=function(){return""+urls.filesContent(isPublicMedia)+fileUrl},makeUrlOfSize=function(){return fullIconUrl()},makePreviewUrlOfSize=function(){var withoutExtension;return withoutExtension=fileName.replace(/\..*/,""),""+urls.filesContent(isPublicMedia)+"/media/"+withoutExtension+"_prvw.jpg"},makeEditorThumbnail=makeUrlOfSize,{type:"FontThumbnailer",makeUrlOfSize:makeUrlOfSize,makePreviewUrlOfSize:makePreviewUrlOfSize,makePublicUrlOfSize:makeUrlOfSize,fullUrl:fullUrl,makeEditorThumbnail:makeEditorThumbnail,makeThumbnail:makeEditorThumbnail}}}}.call(this),function(){window.WixPix||(window.WixPix={}),WixPix.PrivateMediaImageThumbnailer=function(urls){return function(fileUrl,iconUrl,fileName,isPublicMedia){var fullUrl,makeBigImage,makeEditorThumbnail,makeFolderThumbnail,makePreview,makePublicUrlOfSize,makeThumbnail,makeUrlOfSize,parseFileUrl,resizeMethodString;return parseFileUrl=function(fileUrl){return"/"===fileUrl[0]?fileUrl:"/"+fileUrl},fullUrl=function(url){return null==url&&(url=fileUrl),""+urls.filesContent(isPublicMedia)+parseFileUrl(url)},resizeMethodString=function(width,height,resizeMethod){return""+resizeMethod+"_"+width+"_"+height+"_75_22_0.2_0.20_0.00_jpg_"+resizeMethod},makeUrlOfSize=function(width,height,resizeMethod){var url;return null==resizeMethod&&(resizeMethod="srb"),isPublicMedia&&iconUrl?(url="micons/"+iconUrl,""+fullUrl(iconUrl)+"_"+resizeMethodString(width,height,resizeMethod)):url=fileUrl,""+fullUrl(url)+"_"+resizeMethodString(width,height,resizeMethod)},makePublicUrlOfSize=function(width,height,resizeMethod){return null==resizeMethod&&(resizeMethod="srb"),""+fullUrl()+"_"+resizeMethodString(width,height,resizeMethod)},makeFolderThumbnail=function(){return makeUrlOfSize(50,50,"srz")},makeThumbnail=function(){return makeUrlOfSize(170,170,"srz")},makePreview=function(){return makeUrlOfSize(375,375,"srb")},makeBigImage=function(){return makeUrlOfSize(800,600,"srb")},makeEditorThumbnail=function(){return makeUrlOfSize(210,210,"srz")},{makeThumbnail:makeThumbnail,makePreview:makePreview,makeFolderThumbnail:makeFolderThumbnail,makeBigImage:makeBigImage,makeUrlOfSize:makeUrlOfSize,makePreviewUrlOfSize:makeUrlOfSize,fullUrl:fullUrl,makePublicUrlOfSize:makePublicUrlOfSize,makeEditorThumbnail:makeEditorThumbnail}}}}.call(this),function(){window.WixPix||(window.WixPix={}),WixPix.PrivateMediaShapeThumbnailer=function(urls,settings){return function(fileUrl,iconUrl,fileName,isPublicMedia){var fullIconUrl,fullUrl;return fullUrl=function(){return isPublicMedia&&"staticAPI"===settings.publicMediaApi?""+urls.filesContent(isPublicMedia)+"/"+fileName:""+urls.filesContent(isPublicMedia)+"/shapes/"+fileName},fullIconUrl=function(){return isPublicMedia&&"staticAPI"===settings.publicMediaApi?""+urls.filesContent(isPublicMedia)+"/"+iconUrl:""+urls.filesContent(isPublicMedia)+"/shapes/"+iconUrl},{type:"ShapeThumbnailer",makeUrlOfSize:fullUrl,fullUrl:fullUrl,makePreviewUrlOfSize:fullIconUrl,makePublicUrlOfSize:fullIconUrl,makeEditorThumbnail:fullIconUrl,makeThumbnail:fullIconUrl}}}}.call(this),function(){window.WixPix||(window.WixPix={}),WixPix.PrivateMediaSwfThumbnailer=function(urls){return function(fileUrl,iconUrl,fileName,isPublicMedia){var fullIconUrl,fullUrl,makeEditorThumbnail,makeUrlOfSize;return fullIconUrl=function(){return"http://static.wix.com/services/web/2.690.2/images/web/flash_swf_icon.png"},fullUrl=function(){return""+urls.filesContent(isPublicMedia)+fileUrl},makeUrlOfSize=fullIconUrl,makeEditorThumbnail=fullIconUrl,{type:"DocumentThumbnailer",makeUrlOfSize:makeUrlOfSize,makePreviewUrlOfSize:makeUrlOfSize,makePublicUrlOfSize:makeUrlOfSize,fullUrl:fullUrl,makeEditorThumbnail:makeEditorThumbnail,makeThumbnail:makeEditorThumbnail}}}}.call(this),function(){window.WixPix||(window.WixPix={}),WixPix.PrivateMediaVideoThumbnailer=function(urls){return function(fileUrl,iconUrl,sourceUrl){var fullIconUrl,fullUrl,makeEditorThumbnail,makeUrlOfSize;return fullIconUrl=function(){var source;return source=sourceUrl.replace(/\..*/,""),""+urls.videoContent()+"/video/"+source+"-2.png"},fullUrl=function(){return""+urls.videoContent()+"/video/"+sourceUrl},makeUrlOfSize=function(){return fullIconUrl()},makeEditorThumbnail=makeUrlOfSize,{type:"VideoThumbnailer",makeUrlOfSize:makeUrlOfSize,makePreviewUrlOfSize:makeUrlOfSize,makePublicUrlOfSize:makeUrlOfSize,fullUrl:fullUrl,makeEditorThumbnail:makeEditorThumbnail,makeThumbnail:makeEditorThumbnail}}}}.call(this),function(){window.WixPix||(window.WixPix={}),WixPix.PrivateMediaWatermarkThumbnailer=function(urls,settings){return function(fileUrl,iconUrl,fileName,isPublicMedia){var fullIconUrl,fullUrl;return fullUrl=function(){return isPublicMedia&&"staticAPI"===settings.publicMediaApi?""+urls.filesContent(isPublicMedia)+"/"+fileName:""+urls.filesContent(isPublicMedia)+"/wtrmrk/"+fileName},fullIconUrl=function(){return isPublicMedia&&"staticAPI"===settings.publicMediaApi?""+urls.filesContent(isPublicMedia)+"/"+iconUrl:""+urls.filesContent(isPublicMedia)+"/wtrmrk/"+iconUrl},{type:"WatermarkThumbnailer",makeUrlOfSize:fullUrl,fullUrl:fullUrl,makePreviewUrlOfSize:fullIconUrl,makePublicUrlOfSize:fullIconUrl,makeEditorThumbnail:fullIconUrl,makeThumbnail:fullIconUrl}}}}.call(this),function(){window.MediaGallery||(window.MediaGallery={}),MediaGallery.TranscodableItem=function(params){return _.extend(MediaGallery.Item(params),{type:"TranscodableItem",getTranscodingStatus:function(){return params.transcodingStatus},isProcessed:function(){return!params.transcodingStatus||["READY","FAILED"].indexOf(params.transcodingStatus)>=0},getDuration:function(){return params.duration}})}}.call(this),function(){var _base;this.MediaGallery||(this.MediaGallery={}),(_base=this.MediaGallery).privateMedia||(_base.privateMedia={}),MediaGallery.privateMedia.FolderRepository=function(){function FolderRepository(apis,q){this.apis=apis,this.q=q,this.observers=[]}return FolderRepository.prototype.register=function(listener){return this.observers.push(listener)},FolderRepository.prototype.getFolders=function(){var _this=this;return this.apis.getPrivateMediaAdapter().getFolderNames().then(function(folders){var set;return _.each(_this.observers,function(o){return"function"==typeof o.privateMediaFoldersLoadingSucceeded?o.privateMediaFoldersLoadingSucceeded():void 0}),set=WixPix.Set(),set.init(_.map(folders,function(folder){return MediaGallery.Folder(folder.folder_id,folder.folder_name)})),set},function(reason){return _.each(_this.observers,function(o){return"function"==typeof o.privateMediaFoldersLoadingFailed?o.privateMediaFoldersLoadingFailed():void 0}),_this.q.reject(reason)})},FolderRepository.prototype.getFolderByName=function(item){return this.getFolders().then(function(folders){return _.find(folders.values(),function(folder){return folder.getId()===item.getFolderId()})})},FolderRepository.prototype.getFolderItemsCount=function(){return this.apis.getPrivateMediaAdapter().getFolderItemsCount()},FolderRepository.prototype.getUnsortedItemsCount=function(){return this.apis.getPrivateMediaAdapter().getUnsortedItems()},FolderRepository}()}.call(this),function(){var _base;this.MediaGallery||(this.MediaGallery={}),(_base=this.MediaGallery).privateMedia||(_base.privateMedia={}),MediaGallery.privateMedia.ItemRepository=function(apis,q){var allForFolder,deleted,getItems,notifyDeletedItemsLoadingFailed,notifyItemsForFolderLoadingFailed,notifyItemsLoadingFailed,notifyItemsLoadingSucceeded,notifyUnsortedItemsLoadingFailed,observers,register,unsorted;return observers=[],register=function(listener){return observers.push(listener)},getItems=function(){return apis.getPrivateMediaAdapter().getItems().then(function(result){return notifyItemsLoadingSucceeded(result),result},function(reason){return notifyItemsLoadingFailed(),q.reject(reason)})},unsorted=function(){return apis.getPrivateMediaAdapter().getUnsortedItems().then(function(result){return notifyItemsLoadingSucceeded(result),result},function(reason){return notifyUnsortedItemsLoadingFailed(),q.reject(reason)})},deleted=function(){return apis.getPrivateMediaAdapter().getDeletedItems().then(void 0,function(reason){return notifyDeletedItemsLoadingFailed(),q.reject(reason)})},allForFolder=function(folder){return apis.getPrivateMediaAdapter().getItemsForFolder(folder).then(function(result){return notifyItemsLoadingSucceeded(result),result},function(reason){return notifyItemsForFolderLoadingFailed(),q.reject(reason)})},notifyItemsLoadingSucceeded=function(items){return _.each(observers,function(o){return"function"==typeof o.privateMediaItemsLoadingSucceeded?o.privateMediaItemsLoadingSucceeded(items):void 0})},notifyItemsLoadingFailed=function(){return _.each(observers,function(o){return"function"==typeof o.privateMediaItemsLoadingFailed?o.privateMediaItemsLoadingFailed():void 0})},notifyUnsortedItemsLoadingFailed=function(){return _.each(observers,function(o){return"function"==typeof o.privateMediaUnsortedItemsLoadingFailed?o.privateMediaUnsortedItemsLoadingFailed():void 0})},notifyDeletedItemsLoadingFailed=function(){return _.each(observers,function(o){return"function"==typeof o.privateMediaDeletedItemsLoadingFailed?o.privateMediaDeletedItemsLoadingFailed():void 0})},notifyItemsForFolderLoadingFailed=function(){return _.each(observers,function(o){return"function"==typeof o.privateMediaItemsForFolderLoadingFailed?o.privateMediaItemsForFolderLoadingFailed():void 0})},{getItems:getItems,unsorted:unsorted,allForFolder:allForFolder,deleted:deleted,register:register}}}.call(this),function(){this.WixPix||(this.WixPix={}),WixPix.BaseTransaction=function(q){var BaseTransaction,getdeferred,isValid,runTransaction;return getdeferred=function(settings,notify){var deferred;return deferred=q.defer(),deferred.promise.then(function(notifyAttributes){return notify("success",notifyAttributes),notifyAttributes},function(notifyAttributes){return notify("fail",notifyAttributes),q.reject(notifyAttributes)}),deferred.promise.cancel=function(reason){return settings.fail(reason||"canceled"),deferred.reject(reason||"canceled")},deferred},isValid=function(settings,deferred){return!_.find(settings.validators,function(hasError,errorName){return hasError()?(deferred.reject(_.extend({errorName:errorName},settings.notifyAttributes)),!0):!1})},runTransaction=function(settings,deferred){return settings.before(),q.when(settings.getPromise()).then(function(){return settings.success.apply(this,arguments),deferred.resolve(settings.notifyAttributes)},function(errorName){return settings.fail.apply(this,arguments),deferred.reject(_.extend({errorName:errorName},settings.notifyAttributes))})},BaseTransaction=function(){function BaseTransaction(getCurrentSettings){var defaultSettings,_this=this;this._observers=[],defaultSettings={validators:{},getPromise:function(){},before:function(){},success:function(){return arguments},fail:function(){return q.reject(arguments)},notifyAttributes:{}},this.perform=function(){var deferred,settings;return settings=_.extend({},defaultSettings,getCurrentSettings.apply(_this,arguments)),_this.notify("start",settings.notifyAttributes),deferred=getdeferred(settings,function(){return _this.notify.apply(_this,arguments)}),isValid(settings,deferred)&&runTransaction(settings,deferred),deferred.promise}}return BaseTransaction.prototype.register=function(observers){return this._observers.push(observers)},BaseTransaction.prototype.notify=function(name,data){return _.each(this._observers,function(observer){return"function"==typeof observer[name]?observer[name](data):void 0})},BaseTransaction}()}}.call(this),function(){window.MediaGallery||(window.MediaGallery={}),MediaGallery.AddFolder=function(BaseTransaction,apis){return new BaseTransaction(function(foldersCollection,folderName,flow){var folder,notifyAttributes;return folder=MediaGallery.Folder(folderName,folderName),notifyAttributes={folder:folder,flow:flow},{validators:{alreadyExists:function(){return _.find(foldersCollection.values(),function(f){return f.getName()===folderName})}},getPromise:function(){return apis.getPrivateMediaAdapter().addFolder(folderName)},notifyAttributes:notifyAttributes,before:function(){},success:function(newFolder){return newFolder.folder_id?(notifyAttributes.folder=MediaGallery.Folder(newFolder.folder_id,folderName),foldersCollection.add(notifyAttributes.folder)):foldersCollection.add(notifyAttributes.folder)},fail:function(){return foldersCollection.remove(folder)}}})}}.call(this),function(){window.MediaGallery||(window.MediaGallery={}),MediaGallery.AllItemsSelection=function(selectedItems){var allSelected,selectAll,selectNone,toggle;return allSelected=function(items){return selectedItems.size()===items.length},toggle=function(items){return allSelected(items)?selectNone():selectAll(items)},selectAll=function(items){return selectedItems.addAll(items)},selectNone=function(){return selectedItems.clear()},{toggle:toggle,allSelected:allSelected,selectAll:selectAll,selectNone:selectNone}}}.call(this),function(){window.MediaGallery||(window.MediaGallery={}),MediaGallery.ChooseItems=function(BaseTransaction,protocol,protocolItemMapper,settings){return new BaseTransaction(function(items,BIData){return{validators:{fewItemsChosenAtSingleMode:function(){var isSupportMultiple;return isSupportMultiple=["multiple","manager"].indexOf(settings.getSettingsHash().selectionType)>=0,items.length>1&&!isSupportMultiple}},notifyAttributes:{items:items,isSupportMultiple:["multiple","manager"].indexOf(settings.getSettingsHash().selectionType)>=0,BIData:BIData},getPromise:function(){return protocol.sendItems(_.map(items,protocolItemMapper.mapper))}}})}}.call(this),function(){this.MediaGallery||(this.MediaGallery={}),this.MediaGallery.GetTranscodedFile=function(BaseTransaction,apis){return new BaseTransaction(function(item){var currentQueue;return currentQueue=[],{validators:{alreadyInProcess:function(){return _.contains(currentQueue,item.getId())}},notifyAttributes:{item:item},getPromise:function(){var transcodePromise;return transcodePromise=apis.getPrivateMediaAdapter().getTranscodedFile(item),transcodePromise.then(function(){return apis.getPrivateMediaAdapter().purgeCache()}),transcodePromise},before:function(){return currentQueue.push(item.getId())},success:function(item){return _.remove(currentQueue,item.getId())},fail:function(item){return _.remove(currentQueue,item.getId())}}})}}.call(this),function(){window.MediaGallery||(window.MediaGallery={}),MediaGallery.MoveItems=function(BaseTransaction,apis){return new BaseTransaction(function(items,destinationFolder){return{validators:{noItemsSelected:function(){return!items.length},cantMoveToSameFolder:function(){return _.first(items).getFolderId()===destinationFolder.getId()}},notifyAttributes:{items:items,destinationFolder:destinationFolder},getPromise:function(){return apis.getPrivateMediaAdapter().moveToFolder(items,destinationFolder)}}})}}.call(this),function(){"use strict";window.WixPix||(window.WixPix={}),MediaGallery.MoveItemsToUnsorted=function(BaseTransaction,apis){return new BaseTransaction(function(items){return{validators:{noItemsSelected:function(){return!items.length}},notifyAttributes:{items:items},getPromise:function(){return apis.getPrivateMediaAdapter().moveToUnsorted(items)}}})}}.call(this),function(){window.MediaGallery||(window.MediaGallery={}),MediaGallery.PurgeItem=function(BaseTransaction,apis){return new BaseTransaction(function(item){return{notifyAttributes:{item:item},getPromise:function(){return apis.getPrivateMediaAdapter().purgeItem(item.id)}}})},MediaGallery.PurgeItemCollection=function(BaseTransaction,apis){return new BaseTransaction(function(items){return{notifyAttributes:{items:items},getPromise:function(){return apis.getPrivateMediaAdapter().purgeItems(items)}}})}}.call(this),function(){this.MediaGallery||(this.MediaGallery={}),MediaGallery.RemoveFolder=function(BaseTransaction,apis,uploadGuard){return new BaseTransaction(function(foldersCollection,folder){return{validators:{notAllowedWhileUploading:function(){return!uploadGuard.allowUpdate(folder)}},notifyAttributes:{folder:folder},getPromise:function(){return apis.getPrivateMediaAdapter().removeFolder(folder)},before:function(){return foldersCollection.remove(folder)},fail:function(){return foldersCollection.add(folder)}}})}}.call(this),function(){window.MediaGallery||(window.MediaGallery={}),MediaGallery.RemoveItem=function(BaseTransaction,apis){return new BaseTransaction(function(item,folder){return{notifyAttributes:{item:item,folder:folder},getPromise:function(){return apis.getPrivateMediaAdapter().removeItem(item)},before:function(){return null!=folder?folder.removeItem(item):void 0},fail:function(){return null!=folder?folder.addItem(item):void 0}}})},MediaGallery.RemoveItemCollection=function(BaseTransaction,removeItem,q){return new BaseTransaction(function(items){return{notifyAttributes:{items:items},getPromise:function(){return q.all(_.map(items,function(item){return removeItem.perform(item)}))}}})}}.call(this),function(){window.MediaGallery||(window.MediaGallery={}),MediaGallery.RenameFolder=function(BaseTransaction,apis,uploadGuard){return new BaseTransaction(function(folder,newName,flow,foldersCollection){var oldName;return oldName=folder.getName(),{validators:{emptyName:function(){return 0===newName.length},alreadyExists:function(){return!!_.find(foldersCollection.values(),function(f){return f.getName()===newName})},notAllowedWhileUploading:function(){return!uploadGuard.allowUpdate(folder)}},notifyAttributes:{folder:folder,newName:newName,flow:flow},getPromise:function(){return apis.getPrivateMediaAdapter().renameFolder(folder,newName)},success:function(){return folder.setName(newName)},fail:function(){return folder.setName(oldName)}}})}}.call(this),function(){window.MediaGallery||(window.MediaGallery={}),MediaGallery.RenameItem=function(BaseTransaction,apis){return new BaseTransaction(function(currentItem,newTitle,flow){var oldTitle;return oldTitle=currentItem.getTitle(),{validators:{emptyName:function(){return 0===newTitle.length}},notifyAttributes:{item:currentItem,newTitle:newTitle,flow:flow},getPromise:function(){return apis.getPrivateMediaAdapter().changeItemName(currentItem,newTitle)},before:function(){return currentItem.setTitle(newTitle)},fail:function(){return currentItem.setTitle(oldTitle)}}})}}.call(this),function(){window.MediaGallery||(window.MediaGallery={}),MediaGallery.RestoreItem=function(BaseTransaction,restPrivateMediaAdapter){return new BaseTransaction(function(item){return{notifyAttributes:{item:item},getPromise:function(){return restPrivateMediaAdapter.restoreItem(item.id)}}})},MediaGallery.RestoreItemCollection=function(BaseTransaction,restPrivateMediaAdapter){return new BaseTransaction(function(items){return{notifyAttributes:{items:items},getPromise:function(){return restPrivateMediaAdapter.restoreItems(items)}}})}}.call(this),function(){this.MediaGallery||(this.MediaGallery={}),MediaGallery.UINotifiers||(MediaGallery.UINotifiers={}),MediaGallery.UINotifiers.GlobalEvents=function(domainEventPublisher,q,uiNotifier,i18n,addFolder,removeFolder,apis,itemRepository,folderRepository,flashUploader){return{subscribe:function(){var sendError;return sendError=function(errorKey,timeout){return uiNotifier.sendNotification(i18n.translate("error."+errorKey),timeout)},window.sayIt=sendError,apis.getUploadTransaction().register({collectionUploadFailed:function(reason){return(null!=reason?reason.errorMessage:void 0)?uiNotifier.sendNotification(i18n.translate("private_media.static_upload_error."+reason.errorMessage,[reason.errorCode])):sendError("UploadItemsFailed")}}),folderRepository.register({privateMediaFoldersLoadingFailed:function(){return sendError("GetFoldersFailed")}}),itemRepository.register({privateMediaItemsLoadingFailed:function(){return sendError("GetItemsFailed")},privateMediaItemsForFolderLoadingFailed:function(){return sendError("GetImagesForFolderFailed")},privateMediaUnsortedItemsLoadingFailed:function(){return sendError("GetUnsortedImagesFailed")}}),flashUploader.register({collectionUploadFailed:function(){return sendError("UploadItemsFailed")}}),_.each(["GetFoldersFailed","GetFolderByNameFailed","GetItemsForSubFolderFailed"],function(error){return domainEventPublisher.$on(error,function(){return sendError(error)})})}}}}.call(this),function(){"use strict";window.WixPix||(window.WixPix={}),WixPix.uiNotifier=function(domainEventPublisher,angTimeout){var expireNotification,notifications,sendNotification;return notifications=[],sendNotification=function(message,timeout,type){var messageId;return null==timeout&&(timeout=!1),null==type&&(type="error"),messageId=UUID.generate(),message={id:messageId,message:message,type:type},notifications.push(message),timeout&&angTimeout(function(){return expireNotification(messageId)},timeout),domainEventPublisher.$emit("UiNotificationReceived",notifications),messageId},expireNotification=function(id){return _.remove(notifications,function(notification){return notification.id===id}),domainEventPublisher.$emit("UiNotificationExpired",notifications)},{sendNotification:sendNotification,expireNotification:expireNotification,notifications:notifications}}}.call(this),function(){this.MediaGallery||(this.MediaGallery={}),MediaGallery.UINotifiers||(MediaGallery.UINotifiers={}),MediaGallery.UINotifiers.Transactions=function(uiNotifier,i18n,addFolder,removeFolder,renameFolder,moveItems,moveItemsToUnsorted,removeItem,renameItem){var sendError;return sendError=function(errorKey,timeout){return null==timeout&&(timeout=7e3),uiNotifier.sendNotification(i18n.translate("error."+errorKey),timeout)},{subscribe:function(){return addFolder.register({fail:function(data){switch(data.errorName){case"alreadyExists":return sendError("FolderAddFailedAlreadyExists",3e3);default:return sendError("FolderAddFailed")}}}),removeFolder.register({fail:function(){return sendError("FolderRemoveFailed")}}),renameFolder.register({fail:function(data){switch(data.errorName){case"alreadyExists":return sendError("FolderRenameFailedAlreadyExists",3e3);case"emptyName":return sendError("FolderRenameFailedCantBeEmpty",3e3);default:return sendError("FolderRenameFailed")}}}),moveItems.register({fail:function(){return sendError("ItemsMoveFailed")}}),moveItemsToUnsorted.register({fail:function(){return sendError("ItemsMoveFailed")}}),removeItem.register({fail:function(){return sendError("ItemRemoveFailed")}}),renameItem.register({fail:function(){return sendError("ChangeImageNameFailed")}})}}}}.call(this),function(){this.MediaGallery.externalForFree=angular.module("externalForFree",["base","search","paginatedAPIs"])}.call(this),function(){this.MediaGallery.externalServices=angular.module("externalServices",["base","search","wix.base.dnd","paginatedAPIs"])}.call(this),function(){this.MediaGallery.paginatedAPIs=angular.module("paginatedAPIs",["base"])}.call(this),function(){this.MediaGallery.photoStock=angular.module("photoStock",["base","search","apiSwitcher","paginatedAPIs"])}.call(this),function(){var _base;this.WixPix||(this.WixPix={}),(_base=this.WixPix).apiSwitcher||(_base.apiSwitcher={}),this.WixPix.apiSwitcher.apis=function(settings,staticUploadTransaction,staticPrivateMediaAdapter,staticUploadAdapter,staticFolderAdapter,restUploadTransaction,restPrivateMediaAdapter,restUploadAdapter,restFolderAdapter,staticImportTransaction,restImportTransaction){return{getUploadTransaction:function(){return{upload:function(){return"staticAPI"===settings.getSettingsHash().privateMediaApi?staticUploadTransaction.upload.apply(this,arguments):"restAPI"===settings.getSettingsHash().privateMediaApi?restUploadTransaction.upload.apply(this,arguments):void 0},register:function(){return staticUploadTransaction.register.apply(this,arguments),restUploadTransaction.register.apply(this,arguments)}}},getImportItemsTransaction:function(){return{perform:function(){return"staticAPI"===settings.getSettingsHash().privateMediaApi?staticImportTransaction.perform.apply(this,arguments):"restAPI"===settings.getSettingsHash().privateMediaApi?restImportTransaction.perform.apply(this,arguments):void 0
},register:function(){return staticImportTransaction.register.apply(this,arguments),restImportTransaction.register.apply(this,arguments)}}},getPrivateMediaAdapter:function(){return"staticAPI"===settings.getSettingsHash().privateMediaApi?staticPrivateMediaAdapter:"restAPI"===settings.getSettingsHash().privateMediaApi?restPrivateMediaAdapter:void 0},getUploadAdapter:function(){return"staticAPI"===settings.getSettingsHash().privateMediaApi?staticUploadAdapter:"restAPI"===settings.getSettingsHash().privateMediaApi?restUploadTransaction:void 0}}}}.call(this),function(){this.MediaGallery.externalForFree.factory("EFF_flickrAdapter",function($http,BasePartialAdapter,EFF_config){return function(itemsPerPage){var Thumbnailer,adapter,loadItemsRequest;return Thumbnailer=function(photo){var makeBigImage,makeOriginalImage,makeThumbnail;return makeThumbnail=function(){return photo.url_m||photo.url_s||photo.url_t},makeBigImage=function(){return photo.url_b||makeThumbnail()},makeOriginalImage=function(){return photo.url_o||makeBigImage()},{makeThumbnail:makeThumbnail,makeFolderThumbnail:makeThumbnail,makePreview:makeBigImage,makeBigImage:makeOriginalImage}},loadItemsRequest=function(searchStr,nextPageData){return null==searchStr&&(searchStr=""),$http.jsonp(EFF_config.flickr.apiUrl,{withCredentials:!1,custom:{category:"external_for_free",errorCode:null==nextPageData?WixPix.ErrorCodes.flickrSearchFailed:void 0,errorCode:null!=nextPageData?WixPix.ErrorCodes.getMoreFlickrSearchItemsFailed:void 0},params:{method:"flickr.photos.search",api_key:EFF_config.flickr.apiKey,format:"json",text:searchStr,media:"photos",extras:"url_t,url_s,url_m,url_b,url_o",license:EFF_config.flickr.licenseType,per_page:itemsPerPage,page:null!=nextPageData?nextPageData.page:void 0,jsoncallback:"JSON_CALLBACK"},cache:!0})},adapter=new BasePartialAdapter({toNextPageData:function(res){var _ref;return(null!=(_ref=res.data)?_ref.photos:void 0)&&res.data.photos.page!==res.data.photos.pages?{page:+res.data.photos.page+1}:null},firstPageRequest:loadItemsRequest,nextPageRequest:loadItemsRequest,toModelsData:function(response){var _ref,_ref1;return null==(null!=response&&null!=(_ref=response.data)&&null!=(_ref1=_ref.photos)?_ref1.photo:void 0)?[]:_.map(response.data.photos.photo,function(photo){return{id:photo.id,name:(photo.title||"").replace(/<\/?[a-z][^>]*>/gi,""),timestamp:"",thumbnailer:Thumbnailer(photo),sourceName:"Flickr-search",width:+(photo.width_o||photo.width_m||photo.width_s||photo.width_t),height:+(photo.height_o||photo.height_m||photo.height_s||photo.height_t)}})}}),{loadFirstPage:function(){return adapter.loadFirstPage.apply(adapter,arguments)},loadNextPage:function(){return adapter.loadNextPage.apply(adapter,arguments)}}}})}.call(this),function(){this.MediaGallery.externalForFree.factory("EFF_googleAdapter",function($http,BasePartialAdapter,EFF_config){return function(itemsPerPage){var Thumbnailer,loadItemsRequest;return Thumbnailer=function(photo){var makeBigImage,makeThumbnail;return makeThumbnail=function(){return photo.tbUrl},makeBigImage=function(){return photo.url},{makeThumbnail:makeThumbnail,makeFolderThumbnail:makeThumbnail,makePreview:makeBigImage,makeBigImage:makeBigImage}},itemsPerPage=8,loadItemsRequest=function(searchStr,nextPageData){return null==searchStr&&(searchStr=""),$http.jsonp(EFF_config.google.apiUrl,{withCredentials:!1,custom:{category:"external_for_free",errorCode:null==nextPageData?WixPix.ErrorCodes.googleSearchFailed:void 0,errorCode:null!=nextPageData?WixPix.ErrorCodes.getMoreGoogleSearchItemsFailed:void 0},params:{v:"1.0",q:searchStr,as_rights:EFF_config.google.licenseType,rsz:itemsPerPage,start:null!=nextPageData?nextPageData.startFrom:void 0,callback:"JSON_CALLBACK"}})},new BasePartialAdapter({toNextPageData:function(res){var lastPageStartFrom,startFrom,_ref,_ref1,_ref2;return(null!=(_ref=res.data)&&null!=(_ref1=_ref.responseData)?_ref1.cursor:void 0)&&(null!=(_ref2=res.data.responseData.cursor.pages)?_ref2.length:void 0)?(lastPageStartFrom=+_.last(res.data.responseData.cursor.pages).start,startFrom=(1+res.data.responseData.cursor.currentPageIndex)*itemsPerPage,startFrom>lastPageStartFrom?null:{startFrom:startFrom}):null},firstPageRequest:loadItemsRequest,nextPageRequest:loadItemsRequest,toModelsData:function(response){var _ref,_ref1;return null==(null!=response&&null!=(_ref=response.data)&&null!=(_ref1=_ref.responseData)?_ref1.results:void 0)?[]:_.map(response.data.responseData.results,function(photo){return{id:photo.imageId,name:(photo.titleNoFormatting||photo.title||"").replace(/<\/?[a-z][^>]*>/gi,""),timestamp:"",thumbnailer:Thumbnailer(photo),sourceName:"Google-search",width:+photo.width,height:+photo.height}})}})}})}.call(this),function(){this.MediaGallery.externalForFree.value("EFF_config",{flickr:{apiUrl:"https://api.flickr.com/services/rest/",apiKey:"1de43780e3d311a8790bcb754ba2c2b0",licenseType:4,itemsPerPage:50},google:{apiUrl:"https://ajax.googleapis.com/ajax/services/search/images",licenseType:"-(cc_noncommercial|cc_nonderived)",itemsPerPage:8},searchTimeout:500,itemsPerPage:50})}.call(this),function(){this.MediaGallery.externalForFree.controller("externalForFree.ctrls.Root",["$scope","EFF_servicesList","config","selectedItems","import.services.items","import.services.ImportAndProceed","search.services.Search",function($scope,EFF_servicesList,config,selectedItems,importService,ImportAndProceed,SearchService){var attachImport,importer,isLoadComplete,selectedService;return MediaGallery.appLoadNotifiers.tabsSelected(),$scope.global={},selectedService=void 0,$scope.services=EFF_servicesList,$scope.selectService=function(service){return selectedService=service,attachImport(),$scope.search.getQuery()?$scope.search.perform($scope.search.getQuery()):void 0},$scope.getSelectedService=function(){return selectedService},isLoadComplete=!0,$scope.isLoadComplete=function(){return isLoadComplete},$scope.showMoreItems=function(){return isLoadComplete&&$scope.search.getQuery()&&$scope.getSelectedService().getRepository().getAllLoadedItems().length?(isLoadComplete=!1,$scope.getSelectedService().getRepository().loadNextPageItems()["finally"](function(){return isLoadComplete=!0})):void 0},$scope.getItems=function(){return $scope.search.getQuery()?$scope.getSelectedService().getRepository().getAllLoadedItems():[]},$scope.search=SearchService($scope,$scope.getItems,function(){var rep,service;return selectedItems.clear(),$scope.search.getQuery()&&isLoadComplete?(isLoadComplete=!1,service=$scope.getSelectedService(),rep=$scope.getSelectedService().getRepository(),rep.search($scope.search.getQuery()).then(function(){return service===$scope.getSelectedService()?isLoadComplete=!0:void 0},function(){return service===$scope.getSelectedService()?isLoadComplete=!0:void 0})):void 0}),importer=null,attachImport=function(){var folderName,serviceName;return serviceName="",folderName="",null!=selectedService&&(serviceName=selectedService.getName(),folderName=serviceName),importer=importService(selectedItems,folderName,serviceName),$scope.importAndProceedSelected=ImportAndProceed(importer)},attachImport(),$scope.importingService=function(){return importer},$scope.selectItemAndProceed=function(item){return selectedItems.clear(),selectedItems.add(item),$scope.importAndProceedSelected("doubleClick")},EFF_servicesList.length?$scope.selectService(EFF_servicesList[0]):void 0}])}.call(this),function(){this.MediaGallery.externalForFree.directive("servicesToggles",function(){return{restrict:"E",scope:{services:"=",selectService:"&",selectedService:"="},link:function(s){return s.serviceSortOrder=function(service){return service.getName()},s.isSelected=function(service){return service===s.selectedService}},templateUrl:"scripts/modules/external_for_free/directives/services_toggles.html"}})}.call(this),function(){this.MediaGallery.externalForFree.directive("externalForFreeStartWork",function(){return{restrict:"E",templateUrl:"scripts/modules/external_for_free/directives/start_work.html"}})}.call(this),function(){this.MediaGallery.externalForFree.factory("EFF_compositionService",function(EFF_Service,EFF_compositionRepository){return EFF_Service(EFF_compositionRepository,"All")})}.call(this),function(){this.MediaGallery.externalForFree.factory("EFF_flickrService",function(EFF_Service,EFF_flickrRepository){return EFF_Service(EFF_flickrRepository,"Flickr")})}.call(this),function(){this.MediaGallery.externalForFree.factory("EFF_googleService",function(EFF_Service,EFF_googleRepository){return EFF_Service(EFF_googleRepository,"Google")})}.call(this),function(){this.MediaGallery.externalForFree.value("EFF_Service",function(repository,name){return{getRepository:function(){return repository},getName:function(){return name}}})}.call(this),function(){this.MediaGallery.externalForFree.factory("EFF_servicesList",function(EFF_compositionService,EFF_flickrService,EFF_googleService){return[EFF_compositionService,EFF_flickrService,EFF_googleService]})}.call(this),function(){this.MediaGallery.externalForFree.factory("EFF_BaseRepository",function(Item,PaginatedUnlessCountLoader){return function(adapter,config){var dataToItems,lastSearchedStr,paginatedItems;return dataToItems=function(itemsData){return _.map(itemsData,function(data){return Item({id:data.id,timestamp:data.timestamp,title:data.name,thumbnailer:data.thumbnailer,sourceName:data.sourceName})})},paginatedItems=new PaginatedUnlessCountLoader(function(){return adapter.loadFirstPage.apply(adapter,arguments).then(dataToItems)},function(){return adapter.loadNextPage.apply(adapter,arguments).then(dataToItems)},config.itemsPerPage),lastSearchedStr="",{search:function(searchStr){return lastSearchedStr=searchStr,paginatedItems.loadFirstPage(searchStr)},loadNextPageItems:function(){return paginatedItems.loadNextPage(lastSearchedStr)},getAllLoadedItems:function(){return paginatedItems.getAllLoaded()},getLastPageItems:function(){return paginatedItems.getLastPage()}}}})}.call(this),function(){this.MediaGallery.externalForFree.factory("EFF_compositionRepository",function(EFF_BaseRepository,EFF_flickrAdapter,EFF_googleAdapter,PaginatedUnlessCountLoader,allSettled,EFF_config){var adapters,lastSearchedStr,paginatedItems,repositories,repositoriesConfig,unionItems;return repositoriesConfig=_.extend({},EFF_config,{itemsPerPage:Math.floor(EFF_config.itemsPerPage/2)}),adapters=[EFF_flickrAdapter(Math.min(EFF_config.flickr.itemsPerPage,repositoriesConfig.itemsPerPage)),EFF_googleAdapter(Math.min(EFF_config.google.itemsPerPage,repositoriesConfig.itemsPerPage))],repositories=_.map(adapters,function(adapter){return EFF_BaseRepository(adapter,repositoriesConfig)}),unionItems=function(data){var _ref,_ref1;return(null!=(_ref=data[0].value)?_ref.length:void 0)||(data[0].value=[]),(null!=(_ref1=data[1].value)?_ref1.length:void 0)||(data[1].value=[]),_.union([],data[0].value,data[1].value)},paginatedItems=new PaginatedUnlessCountLoader(function(searchStr){return allSettled(_.map(repositories,function(repository){return repository.search(searchStr)})).then(unionItems)},function(){return allSettled(_.map(repositories,function(repository){return repository.loadNextPageItems()})).then(unionItems)},EFF_config.itemsPerPage),lastSearchedStr="",{search:function(searchStr){return lastSearchedStr=searchStr,paginatedItems.loadFirstPage(searchStr)},loadNextPageItems:function(){return paginatedItems.loadNextPage(lastSearchedStr)},getAllLoadedItems:function(){return paginatedItems.getAllLoaded()},getLastPageItems:function(){return paginatedItems.getLastPage()}}})}.call(this),function(){this.MediaGallery.externalForFree.factory("EFF_flickrRepository",function(EFF_BaseRepository,EFF_flickrAdapter,EFF_config){return EFF_BaseRepository(EFF_flickrAdapter(EFF_config.flickr.itemsPerPage),EFF_config)})}.call(this),function(){this.MediaGallery.externalForFree.factory("EFF_googleRepository",function(EFF_BaseRepository,EFF_googleAdapter,EFF_config){return EFF_BaseRepository(EFF_googleAdapter(EFF_config.google.itemsPerPage),EFF_config)})}.call(this),function(){this.MediaGallery.externalServices.factory("FacebookAdapterFolders",function($http,BasePartialAdapter){return function(hasAuthError,toNextPageData){var loadFoldersRequest;return loadFoldersRequest=function(nextPageData){return $http.get("http://pix.wix.com/services/facebook2/albums",{withCredentials:!0,custom:{category:"external",errorCode:WixPix.ErrorCodes.getFacebookFoldersFailed},params:{after:null!=nextPageData?nextPageData.cursor:void 0}})},new BasePartialAdapter({hasAuthError:hasAuthError,toNextPageData:toNextPageData,firstPageRequest:loadFoldersRequest,nextPageRequest:loadFoldersRequest,toModelsData:function(response){var _ref;return null==(null!=response&&null!=(_ref=response.data)?_ref.data:void 0)?[]:_.map(response.data.data,function(folder){return{id:folder.id,name:folder.name,itemsCount:folder.count}})}})}})}.call(this),function(){this.MediaGallery.externalServices.factory("FacebookAdapterItems",function($http,BasePartialAdapter){return function(hasAuthError,toNextPageData){var Thumbnailer,loadItemsRequest;return Thumbnailer=function(photo){var makeBigImage,makeThumbnail,thumb_320;return thumb_320=_.find(photo.images,function(image){return image.source.indexOf("320x320")>0}),makeThumbnail=function(){return(null!=thumb_320?thumb_320.source:void 0)||photo.source},makeBigImage=function(){return photo.source},{makeThumbnail:makeThumbnail,makeFolderThumbnail:makeThumbnail,makePreview:makeBigImage,makeBigImage:makeBigImage}},loadItemsRequest=function(folderId,nextPageData){return $http.get("http://pix.wix.com/services/facebook2/photos",{withCredentials:!0,custom:{category:"external",errorCode:null==nextPageData?WixPix.ErrorCodes.getFacebookItemsFailed:void 0,errorCode:null!=nextPageData?WixPix.ErrorCodes.getMoreFacebookItemsFailed:void 0},params:{album_id:folderId,after:null!=nextPageData?nextPageData.after:void 0}})},new BasePartialAdapter({hasAuthError:hasAuthError,toNextPageData:toNextPageData,firstPageRequest:loadItemsRequest,nextPageRequest:loadItemsRequest,toModelsData:function(response){var _ref;return null==(null!=response&&null!=(_ref=response.data)?_ref.data:void 0)?[]:_.map(response.data.data,function(photo){return{id:photo.id,name:(photo.name||"").replace(/<\/?[a-z][^>]*>/gi,""),timestamp:photo.created_time,thumbnailer:Thumbnailer(photo),sourceName:"Facebook"}})}})}})}.call(this),function(){this.MediaGallery.externalServices.factory("facebookAdapter",function($http,FacebookAdapterFolders,FacebookAdapterItems){var foldersAdapter,hasAuthError,itemsAdapter,toNextPageData;return hasAuthError=function(response){var _ref,_ref1;return 403===+(null!=response?response.status:void 0)||null!=(null!=response&&null!=(_ref=response.data)&&null!=(_ref1=_ref.error)?_ref1.type:void 0)==="OAuthException"},toNextPageData=function(response){var _ref,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7;return null!=(null!=(_ref=response.data)&&null!=(_ref1=_ref.paging)?_ref1.next:void 0)&&null!=(null!=(_ref2=response.data)&&null!=(_ref3=_ref2.paging)&&null!=(_ref4=_ref3.cursors)?_ref4.after:void 0)?{after:null!=(_ref5=response.data)&&null!=(_ref6=_ref5.paging)&&null!=(_ref7=_ref6.cursors)?_ref7.after:void 0}:null},foldersAdapter=FacebookAdapterFolders(hasAuthError,toNextPageData),itemsAdapter=FacebookAdapterItems(hasAuthError,toNextPageData),{loadFolders:function(){return foldersAdapter.loadFirstPage.apply(foldersAdapter,arguments)},loadMoreFolders:function(){return foldersAdapter.loadNextPage.apply(foldersAdapter,arguments)},loadItems:function(){return itemsAdapter.loadFirstPage.apply(itemsAdapter,arguments)},loadMoreItems:function(){return itemsAdapter.loadNextPage.apply(itemsAdapter,arguments)},onAuthError:function(handler){return foldersAdapter.on("authError",handler),itemsAdapter.on("authError",handler)},disconnect:function(){return $http.get("http://pix.wix.com/services/facebook/disconnect",{withCredentials:!0})}}})}.call(this),function(){this.MediaGallery.externalServices.factory("FlickrAdapterFolders",function($http,BasePartialAdapter,FlickrThumbnailer){return function(hasAuthError,toNextPageData){var loadFoldersRequest;return loadFoldersRequest=function(nextPageData){return $http.get("http://pix.wix.com/services/flickr/albums",{withCredentials:!0,custom:{category:"external",errorCode:WixPix.ErrorCodes.getFlickrFoldersFailed},params:{primary_photo_extras:"url_t,url_s,url_m,url_b,url_o",per_page:500,page:null!=nextPageData?nextPageData.page:void 0}})},new BasePartialAdapter({hasAuthError:hasAuthError,toNextPageData:toNextPageData,firstPageRequest:loadFoldersRequest,nextPageRequest:loadFoldersRequest,toModelsData:function(response){var _ref,_ref1;return null==(null!=response&&null!=(_ref=response.data)&&null!=(_ref1=_ref.photosets)?_ref1.photoset:void 0)?[]:_.map(response.data.photosets.photoset,function(photoSet){var itemsCount,_ref2;return itemsCount=+photoSet.photos+ +photoSet.videos,{id:photoSet.id,name:null!=(_ref2=photoSet.title)?_ref2._content:void 0,itemsCount:itemsCount,thumbnailer:null!=photoSet.primary_photo_extras&&itemsCount?FlickrThumbnailer(photoSet.primary_photo_extras):void 0}})}})}})}.call(this),function(){this.MediaGallery.externalServices.factory("FlickrAdapterItems",function($http,BasePartialAdapter,FlickrThumbnailer){return function(hasAuthError,toNextPageData){var loadItemsRequest;return loadItemsRequest=function(folderId,nextPageData){return $http.get("http://pix.wix.com/services/flickr/photoset",{withCredentials:!0,custom:{category:"external",errorCode:null==nextPageData?WixPix.ErrorCodes.getFlickrItemsFailed:void 0,errorCode:null!=nextPageData?WixPix.ErrorCodes.getMoreFlickrItemsFailed:void 0},params:{set_id:folderId,extras:"url_t,url_s,url_m,url_b,url_o",per_page:50,page:null!=nextPageData?nextPageData.page:void 0}})},new BasePartialAdapter({hasAuthError:hasAuthError,toNextPageData:toNextPageData,firstPageRequest:loadItemsRequest,nextPageRequest:loadItemsRequest,toModelsData:function(response){var _ref,_ref1;return null==(null!=response&&null!=(_ref=response.data)&&null!=(_ref1=_ref.photoset)?_ref1.photo:void 0)?[]:_.map(response.data.photoset.photo,function(photo){return{id:photo.id,name:(photo.title||"").replace(/<\/?[a-z][^>]*>/gi,""),timestamp:"",thumbnailer:FlickrThumbnailer(photo),sourceName:"Flickr",width:+(photo.width_o||photo.width_m||photo.width_s||photo.width_t),height:+(photo.height_o||photo.height_m||photo.height_s||photo.height_t)}})}})}})}.call(this),function(){this.MediaGallery.externalServices.value("FlickrThumbnailer",function(photo){var makeBigImage,makeOriginalImage,makeThumbnail;return makeThumbnail=function(){return photo.url_m||photo.url_s||photo.url_t},makeBigImage=function(){return photo.url_b||makeThumbnail()},makeOriginalImage=function(){return photo.url_o||makeBigImage()},{makeThumbnail:makeThumbnail,makeFolderThumbnail:makeThumbnail,makePreview:makeBigImage,makeBigImage:makeOriginalImage}})}.call(this),function(){this.MediaGallery.externalServices.factory("flickrAdapter",function($http,FlickrAdapterFolders,FlickrAdapterItems){var foldersAdapter,hasAuthError,itemsAdapter,toNextPageData;return hasAuthError=function(response){var _ref;return 403===+(null!=response?response.status:void 0)||null!=(null!=response&&null!=(_ref=response.data)?_ref.stat:void 0)==="fail"&&null!=response.data.message===/auth/i},toNextPageData=function(response){var photoset,_ref;return photoset=null!=(_ref=response.data)?_ref.photoset:void 0,(null!=photoset?photoset.pages:void 0)&&+(null!=photoset?photoset.page:void 0)<+(null!=photoset?photoset.pages:void 0)?{page:1+ +(null!=photoset?photoset.page:void 0)}:null},foldersAdapter=FlickrAdapterFolders(hasAuthError,toNextPageData),itemsAdapter=FlickrAdapterItems(hasAuthError,toNextPageData),{loadFolders:function(){return foldersAdapter.loadFirstPage.apply(foldersAdapter,arguments)},loadMoreFolders:function(){return foldersAdapter.loadNextPage.apply(foldersAdapter,arguments)},loadItems:function(){return itemsAdapter.loadFirstPage.apply(itemsAdapter,arguments)},loadMoreItems:function(){return itemsAdapter.loadNextPage.apply(itemsAdapter,arguments)},onAuthError:function(handler){return foldersAdapter.on("authError",handler),itemsAdapter.on("authError",handler)},disconnect:function(){return $http.get("http://pix.wix.com/services/flickr/disconnect",{withCredentials:!0})}}})}.call(this),function(){this.MediaGallery.externalServices.factory("InstagramAdapterFolders",function($q,$http,instagramConnector,BasePartialAdapter){return function(){return new BasePartialAdapter({hasAuthError:function(){return!1},toNextPageData:function(){return null},firstPageRequest:function(){return $http.get("http://pix.wix.com/services/instagram/user",{withCredentials:!0,custom:{category:"external",errorCode:WixPix.ErrorCodes.getInstagramUserInfoFailed}})},nextPageRequest:function(){return $q.when([])},toModelsData:function(response){var _ref,_ref1;return[{id:"Instagram",name:"Instagram",itemsCount:null!=(_ref=response.data)&&null!=(_ref1=_ref.counts)?_ref1.media:void 0}]}})}})}.call(this),function(){this.MediaGallery.externalServices.factory("InstagramAdapterItems",function($http,BasePartialAdapter){return function(hasAuthError,toNextPageData){var Thumbnailer,loadItemsRequest;return Thumbnailer=function(image){var makeBigImage,makeThumbnail;return makeThumbnail=function(){return image.low_resolution.url},makeBigImage=function(){return image.standard_resolution.url},{makeThumbnail:makeThumbnail,makeFolderThumbnail:makeThumbnail,makePreview:makeBigImage,makeBigImage:makeBigImage}},loadItemsRequest=function(folderId,nextPageData){return $http.get("http://pix.wix.com/services/instagram2/photos",{withCredentials:!0,custom:{category:"external",errorCode:null==nextPageData?WixPix.ErrorCodes.getInstagramItemsFailed:void 0,errorCode:null!=nextPageData?WixPix.ErrorCodes.getMoreInstagramItemsFailed:void 0},params:{count:50,max_id:null!=nextPageData?nextPageData.max_id:void 0}})},new BasePartialAdapter({hasAuthError:hasAuthError,toNextPageData:toNextPageData,firstPageRequest:loadItemsRequest,nextPageRequest:loadItemsRequest,toModelsData:function(response){var _ref;return null==(null!=response&&null!=(_ref=response.data)?_ref.photos:void 0)?[]:_.map(response.data.photos,function(photo){var date,_ref1;return date=new Date(1e3*photo.created_time),{id:photo.id,name:((null!=(_ref1=photo.caption)?_ref1.text:void 0)||"").replace(/<\/?[a-z][^>]*>/gi,""),timestamp:""+date.getFullYear()+"-"+(date.getMonth()+1)+"-"+date.getDate()+"T"+date.getHours()+":"+date.getMinutes()+":"+date.getSeconds(),thumbnailer:Thumbnailer(photo.images),sourceName:"Instagram"}})}})}})}.call(this),function(){this.MediaGallery.externalServices.factory("instagramAdapter",function($http,InstagramAdapterFolders,InstagramAdapterItems){var foldersAdapter,hasAuthError,itemsAdapter,toNextPageData;return hasAuthError=function(response){return 403===+(null!=response?response.status:void 0)||!(null!=response?response.data:void 0)},toNextPageData=function(response){var _ref;return(null!=(_ref=response.data)?_ref.next:void 0)||null},foldersAdapter=InstagramAdapterFolders(),itemsAdapter=InstagramAdapterItems(hasAuthError,toNextPageData),{loadFolders:function(){return foldersAdapter.loadFirstPage.apply(foldersAdapter,arguments)},loadMoreFolders:function(){return foldersAdapter.loadNextPage.apply(foldersAdapter,arguments)},loadItems:function(){return itemsAdapter.loadFirstPage.apply(itemsAdapter,arguments)},loadMoreItems:function(){return itemsAdapter.loadNextPage.apply(itemsAdapter,arguments)},onAuthError:function(handler){return foldersAdapter.on("authError",handler),itemsAdapter.on("authError",handler)},disconnect:function(){return $http.get("http://pix.wix.com/services/instagram/disconnect",{withCredentials:!0})}}})}.call(this),function(){this.MediaGallery.externalServices.factory("PicasaAdapterFolders",function($http,BasePartialAdapter,PicasaThumbnailer){return function(hasAuthError,toNextPageData){var loadFoldersRequest;return loadFoldersRequest=function(nextPageData){return $http.get("http://pix.wix.com/services/google/albums",{withCredentials:!0,custom:{category:"external",errorCode:WixPix.ErrorCodes.getPicasaFoldersFailed},params:{thumbsize:"150c","max-results":500,"start-index":null!=nextPageData?nextPageData.startIndex:void 0}})},new BasePartialAdapter({hasAuthError:hasAuthError,toNextPageData:toNextPageData,firstPageRequest:loadFoldersRequest,nextPageRequest:loadFoldersRequest,toModelsData:function(response){var _ref,_ref1;return null==(null!=response&&null!=(_ref=response.data)&&null!=(_ref1=_ref.feed)?_ref1.entry:void 0)?[]:_.map(response.data.feed.entry,function(folder){var _ref2,_ref3,_ref4,_ref5;return{id:null!=(_ref2=folder.gphoto$id)?_ref2.$t:void 0,name:null!=(_ref3=folder.title)?_ref3.$t:void 0,itemsCount:null!=(_ref4=folder.gphoto$numphotos)?_ref4.$t:void 0,thumbnailer:folder.media$group&&(null!=(_ref5=folder.gphoto$numphotos)?_ref5.$t:void 0)?PicasaThumbnailer(folder.media$group):void 0}})}})}})}.call(this),function(){this.MediaGallery.externalServices.factory("PicasaAdapterItems",function($http,BasePartialAdapter,PicasaThumbnailer){return function(hasAuthError,toNextPageData){var loadItemsRequest;return loadItemsRequest=function(folderId,nextPageData){return $http.get("http://pix.wix.com/services/google/photos",{withCredentials:!0,custom:{category:"external",errorCode:null==nextPageData?WixPix.ErrorCodes.getPicasaItemsFailed:void 0,errorCode:null!=nextPageData?WixPix.ErrorCodes.getMorePicasaItemsFailed:void 0},params:{album_id:folderId,kind:"photo",thumbsize:"150c","max-results":50,"start-index":null!=nextPageData?nextPageData.startIndex:void 0}})},new BasePartialAdapter({hasAuthError:hasAuthError,toNextPageData:toNextPageData,firstPageRequest:loadItemsRequest,nextPageRequest:loadItemsRequest,toModelsData:function(response){var _ref,_ref1;return null==(null!=response&&null!=(_ref=response.data)&&null!=(_ref1=_ref.feed)?_ref1.entry:void 0)?[]:_.map(response.data.feed.entry,function(entry){var _ref10,_ref11,_ref12,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8,_ref9;return{id:null!=(_ref2=entry.id)?_ref2.$t:void 0,name:((null!=(_ref3=entry.summary)?_ref3.$t:void 0)||(null!=(_ref4=entry.title)?_ref4.$t:void 0)||"").replace(/<\/?[a-z][^>]*>/gi,""),timestamp:null!=(_ref5=entry.published)?_ref5.$t:void 0,iconUrl:null!=(_ref6=entry.media$group)&&null!=(_ref7=_ref6.media$thumbnail)&&null!=(_ref8=_ref7[1])?_ref8.url:void 0,thumbnailer:PicasaThumbnailer(entry.media$group,null!=(_ref9=entry.gphoto$width)?_ref9.$t:void 0,null!=(_ref10=entry.gphoto$height)?_ref10.$t:void 0),width:+(null!=(_ref11=entry.gphoto$width)?_ref11.$t:void 0),height:+(null!=(_ref12=entry.gphoto$height)?_ref12.$t:void 0),sourceName:"Picasa"}})}})}})}.call(this),function(){this.MediaGallery.externalServices.value("PicasaThumbnailer",function(mediaGroup,width,height){var images,lastImage,makeBigImage,makePreview,makeThumbnail;return null==width&&(width=1024),null==height&&(height=768),images=_.select(mediaGroup.media$thumbnail,function(item){return!item.medium||"video"!==item.medium}),lastImage=_.last(images).url,makeThumbnail=function(){return lastImage},makePreview=function(){return+width>400?lastImage.replace(/\/s[0-9]+/,"/s400"):makeBigImage()},makeBigImage=function(){return lastImage.replace(/\/s[0-9]+/,"/w"+width+"-h"+height+"-no")},{makeThumbnail:makeThumbnail,makeFolderThumbnail:makeThumbnail,makePreview:makePreview,makeBigImage:makeBigImage}})}.call(this),function(){this.MediaGallery.externalServices.factory("picasaAdapter",function($http,PicasaAdapterFolders,PicasaAdapterItems){var foldersAdapter,hasAuthError,itemsAdapter,toNextPageData;return hasAuthError=function(response){return 403===+(null!=response?response.status:void 0)},toNextPageData=function(response){var feed,_ref,_ref1,_ref2,_ref3,_ref4;return feed=null!=(_ref=response.data)?_ref.feed:void 0,null!=feed&&+(null!=(_ref1=feed.openSearch$startIndex)?_ref1.$t:void 0)+ +(null!=(_ref2=feed.openSearch$itemsPerPage)?_ref2.$t:void 0)<=+(null!=(_ref3=feed.openSearch$totalResults)?_ref3.$t:void 0)?{startIndex:+feed.openSearch$startIndex.$t+ +(null!=(_ref4=feed.openSearch$itemsPerPage)?_ref4.$t:void 0)}:null},foldersAdapter=PicasaAdapterFolders(hasAuthError,toNextPageData),itemsAdapter=PicasaAdapterItems(hasAuthError,toNextPageData),{loadFolders:function(){return foldersAdapter.loadFirstPage.apply(foldersAdapter,arguments)},loadMoreFolders:function(){return foldersAdapter.loadNextPage.apply(foldersAdapter,arguments)},loadItems:function(){return itemsAdapter.loadFirstPage.apply(itemsAdapter,arguments)},loadMoreItems:function(){return itemsAdapter.loadNextPage.apply(itemsAdapter,arguments)},onAuthError:function(handler){return foldersAdapter.on("authError",handler),itemsAdapter.on("authError",handler)},disconnect:function(){return $http.get("http://pix.wix.com/services/google/disconnect",{withCredentials:!0})}}})}.call(this),function(){this.MediaGallery.externalServices.value("config",{foldersPerPage:50,itemsPerPage:50})}.call(this),function(){var getUserID,_this=this;getUserID=function(){var info;return info=_this.getCookie("wixClient"),null==info?"":info.split("|")[6]||""},this.MediaGallery.externalServices.factory("BaseConnector",function($q,$rootScope,Events){return function(parameterName,connectUrl){var completeConnection,connect,disconnect,events,getConnectionToken,getParameterByName,getParameterName,isConnected;return events=new Events(["connectSuccess","disconnectSuccess"]),disconnect=function(){return localStorage.removeItem(parameterName+getUserID()),events.disconnectSuccess()},isConnected=function(){return null!==getConnectionToken()},completeConnection=function(connectionToken){return events.connectSuccess(),localStorage.setItem(parameterName+getUserID(),connectionToken)},getParameterByName=function(searchString,name){var regex,results;return name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(searchString),null==results?"":decodeURIComponent(results[1].replace(/\+/g," "))},connect=function(){var deferred,folder,host,popup;return disconnect(),deferred=$q.defer(),host=location.host.replace(/\/$/,""),folder=location.pathname.replace(/^\/?|\/[^\/]*$/g,"/"),popup=window.open(""+connectUrl+"?return_url="+location.protocol+"//"+host+folder+"service_connected.html","connector","width=950,height=550"),isConnected=!1,window.connectService=function(data){return null==data&&(data=""),isConnected?void 0:$rootScope.$apply(function(){var status,token;return isConnected=!0,token=getParameterByName(data,parameterName),status=getParameterByName(data,"status"),!token||status&&"FAIL"===status?deferred.reject(data):deferred.resolve(token)})},window.addEventListener("message",function(event){return window.debug&&console.log(event),event.source===popup&&event.origin===window.location.origin?window.connectService(event.data):void 0},!1),deferred.promise.then(function(connectionToken){return completeConnection(connectionToken)},$q.reject)},getConnectionToken=function(){return localStorage.getItem(parameterName+getUserID())},getParameterName=function(){return parameterName},{connect:connect,disconnect:disconnect,isConnected:isConnected,completeConnection:completeConnection,getConnectionToken:getConnectionToken,getParameterName:getParameterName,onConnectSuccess:events.connectSuccess,onDisconnectSuccess:events.disconnectSuccess,hasAuthParameter:!0}}})}.call(this),function(){this.MediaGallery.externalServices.factory("facebookConnector",function(BaseConnector){return BaseConnector("fbact","http://pix.wix.com/services/facebook/connect")})}.call(this),function(){this.MediaGallery.externalServices.factory("flickrConnector",function(BaseConnector){return BaseConnector("flact","http://pix.wix.com/services/flickr/connect")})}.call(this),function(){this.MediaGallery.externalServices.factory("instagramConnector",function(BaseConnector){return BaseConnector("instact","http://pix.wix.com/services/instagram/connect")})}.call(this),function(){this.MediaGallery.externalServices.factory("picasaConnector",function(BaseConnector){return BaseConnector("goglact","http://pix.wix.com/services/google/connect")
})}.call(this),function(){this.MediaGallery.externalServices.controller("externalServices.ctrls.Items",function($scope,selectedItems){return $scope.selectedFolderName=function(){return $scope.getSelectedExternalFolder()?$scope.getSelectedExternalFolder().getName():""},$scope.selectItemAndProceed=function(item){return selectedItems.clear(),selectedItems.add(item),$scope.importAndProceedSelected("doubleClick")},$scope.canDrag=function(){return!0}})}.call(this),function(){this.MediaGallery.externalServices.controller("externalServices.ctrls.Root",function($scope,$filter,selectedItems,getExternalServices,featureDetection,Aviary){var filterItems,isLoading,sortItems;return isLoading=!1,$scope.selectFolder=function(folder){var _ref;return $scope.selectExternalFolder(folder),$scope.selectNoneItems(),isLoading=!0,null!=(_ref=$scope.getSelectedExternalService())?_ref.getRepository().loadItems(folder)["finally"](function(){return isLoading=!1}):void 0},$scope.unselectFolder=function(){return $scope.selectExternalFolder(null)},$scope.isAnyFolderSelected=function(){return!!$scope.getSelectedExternalFolder()},$scope.search=_.extend({},$scope.search,{hasNoResults:function(){return""!==this.getQuery()&&0===$scope.getItems().length},hasResults:function(){return""!==this.getQuery()&&0!==$scope.getItems().length}}),$scope.isSelectedFolderEmpty=function(){return $scope.getSelectedExternalFolder()&&0===$scope.getSelectedExternalFolder().getItemsCount()},$scope.getFolders=function(){return $scope.getSelectedExternalService()?$scope.getSelectedExternalService().getRepository().getFolders():[]},filterItems=function(items){var pattern;return""===$scope.search.getQuery()?items:(pattern=$scope.search.getQuery().toLowerCase(),_.filter(items,function(item){return-1!==item.title.toLowerCase().indexOf(pattern)}))},sortItems=function(items){return $filter("orderBy")(items,$scope.getSelectedSortField().name,$scope.getSelectedSortField().isSortDesc)},$scope.getItems=function(){var _ref;return $scope.isSelectedExternalServiceItemsLoaded()&&$scope.getSelectedExternalService()&&$scope.getSelectedExternalFolder()?null!=(_ref=$scope.getSelectedExternalService())?_ref.getRepository().getItems():void 0:[]},$scope.showMore=function(){var promise,repository,_ref;if(!isLoading)return isLoading=!0,repository=null!=(_ref=$scope.getSelectedExternalService())?_ref.getRepository():void 0,promise=$scope.getSelectedExternalFolder()?repository.loadMoreItems($scope.getSelectedExternalFolder()):repository.loadMoreFolders(),promise["finally"](function(){return isLoading=!1})},$scope.isLoading=function(){return isLoading},$scope.canEditItemAtAviary=function(){return featureDetection.html5Uploads()&&!featureDetection.safariFive()},$scope.editItemAtAviary=function(item){var folder;return folder=MediaGallery.AllFolder(),Aviary(""+item.getSourceName()+" - "+(item.getTitle()||"Untitled"),item.getThumbnailer().makeBigImage(),folder)},$scope.getItemDownloadLink=function(item){return item.getThumbnailer().makeBigImage()}})}.call(this),function(){this.MediaGallery.externalServices.controller("externalServices.ctrls.Services",function($scope,getExternalServices,$location){return $scope.services=getExternalServices(),$scope.connectTo=function(service){return service.isConnected()?void 0:service.getConnector().connect().then(function(){return"/my"!==$location.path()?$location.path("my"):$scope.loadExternalService(service).then(function(){return $scope.selectExternalService(service)})})},$scope.disconnectFrom=function(service){return $scope.selectAll&&$scope.selectAll(),service.disconnect()}})}.call(this),function(){this.MediaGallery.externalServices.directive("externalResponsiveGridFolders",function(){return{restrict:"E",scope:{folders:"=",select:"&"},link:function(scope){return"function"==typeof scope.folders?scope.folders=scope.folders():void 0},templateUrl:"scripts/modules/external_services/directives/responsive_grid_folders.html"}})}.call(this),function(){this.MediaGallery.externalServices.directive("externalServicesList",function(){return{restrict:"E",scope:{services:"=",connectService:"&",disconnectService:"&"},controller:function($scope){var hideList;return $scope.isOpened=!1,hideList=function(){return $scope.isOpened=!1,$scope.$apply()},$scope.showList=function(){$scope.isOpened||($scope.isOpened=!0,setTimeout(function(){return $(window).one("click",hideList),100}))},$scope.serviceSortOrder=function(service){return service.getName()},$scope.$on("showExternalServicesConnection",$scope.showList)},templateUrl:"scripts/modules/external_services/directives/services_list.html"}})}.call(this),function(){this.MediaGallery.externalServices.factory("facebookService",function(Service,facebookConnector,facebookRepository,facebookAdapter){return Service("Facebook",!0,facebookConnector,facebookRepository,facebookAdapter)})}.call(this),function(){this.MediaGallery.externalServices.factory("flickrService",function(Service,flickrConnector,flickrRepository,flickrAdapter){return Service("Flickr",!0,flickrConnector,flickrRepository,flickrAdapter)})}.call(this),function(){this.MediaGallery.externalServices.factory("instagramService",function(Service,instagramConnector,instagramRepository,instagramAdapter){return Service("Instagram",!0,instagramConnector,instagramRepository,instagramAdapter)})}.call(this),function(){this.MediaGallery.externalServices.factory("picasaService",function(Service,picasaConnector,picasaRepository,picasaAdapter){return Service("Picasa",!0,picasaConnector,picasaRepository,picasaAdapter)})}.call(this),function(){this.MediaGallery.externalServices.value("Service",function(name,isReadOnly,connector,repository,adapter){var disconnect,getConnector,getName,getRepository,isConnected;return getName=function(){return name},getRepository=function(){return repository},isReadOnly=function(){return isReadOnly},isConnected=function(){return connector.isConnected()},getConnector=function(){return connector},disconnect=function(){return repository.disconnect().then(function(){return connector.disconnect()})},adapter.onAuthError(function(){return disconnect()}),{getId:getName,getName:getName,getRepository:getRepository,isReadOnly:isReadOnly,isConnected:isConnected,getConnector:getConnector,disconnect:disconnect,onAuthError:adapter.onAuthError}})}.call(this),function(){this.MediaGallery.externalServices.factory("BaseRepository",function(Item,Folder,PaginatedUnlessCountLoader,config){return function(adapter){var addNewItemsToFolder,dataToFolders,dataToItems,isLoaded,paginatedFolders,paginatedItems;return isLoaded=!1,dataToFolders=function(foldersData){return _.map(foldersData,function(data){return Folder(data.id,data.name,[],data.thumbnailer,data.itemsCount)})},dataToItems=function(itemsData){return _.map(itemsData,function(data){return Item({id:data.id,timestamp:data.timestamp,title:data.name,thumbnailer:data.thumbnailer,sourceName:data.sourceName})})},addNewItemsToFolder=function(items,folder){var existItems;return existItems=folder.getItems(),_.each(items,function(item){var itemId;return itemId=item.getId(),_.find(existItems,function(i){return i.getId()===itemId})?void 0:folder.addItem(item)})},paginatedFolders=new PaginatedUnlessCountLoader(function(){return isLoaded=!0,adapter.loadFolders().then(dataToFolders)},function(){return adapter.loadMoreFolders().then(dataToFolders)},config.foldersPerPage),paginatedItems=new PaginatedUnlessCountLoader(function(folder){return adapter.loadItems(folder.getId()).then(dataToItems).then(function(items){return addNewItemsToFolder(items,folder),items})},function(folder){return adapter.loadMoreItems(folder.getId()).then(dataToItems).then(function(items){return addNewItemsToFolder(items,folder),items})},config.itemsPerPage),{loadFolders:function(){return paginatedFolders.loadFirstPage()},loadMoreFolders:function(){return paginatedFolders.loadNextPage()},getFolders:function(){return paginatedFolders.getAllLoaded()},loadItems:function(folder){return paginatedItems.loadFirstPage(folder)},loadMoreItems:function(folder){return paginatedItems.loadNextPage(folder)},getItems:function(){return paginatedItems.getAllLoaded()},disconnect:function(){return isLoaded=!1,paginatedFolders.reset(),paginatedItems.reset(),adapter.disconnect()},isLoaded:function(){return isLoaded}}}})}.call(this),function(){this.MediaGallery.externalServices.factory("facebookRepository",function(BaseRepository,facebookAdapter){return BaseRepository(facebookAdapter)})}.call(this),function(){this.MediaGallery.externalServices.factory("flickrRepository",function(BaseRepository,flickrAdapter){return BaseRepository(flickrAdapter)})}.call(this),function(){this.MediaGallery.externalServices.factory("instagramRepository",function(BaseRepository,instagramAdapter){return BaseRepository(instagramAdapter)})}.call(this),function(){this.MediaGallery.externalServices.factory("picasaRepository",function(BaseRepository,picasaAdapter){return BaseRepository(picasaAdapter)})}.call(this),function(){var _base,_base1;this.MediaGallery||(this.MediaGallery={}),(_base=this.MediaGallery)["import"]||(_base["import"]={}),(_base1=this.MediaGallery["import"]).directives||(_base1.directives={}),this.MediaGallery["import"].directives.itemsImportingProgress=function(){return{restrict:"EA",scope:{importingService:"="},controller:function($scope){return $scope.hasFailedItems=function(){return $scope.getFailedItemsCount()>0},$scope.getFailedItemsCount=function(){return $scope.importingService.isFailed()?$scope.getAllItemsCount():_.select($scope.importingService.getImportableItems(),function(i){return i.isFailed()}).length},$scope.getCompletedItemsCount=function(){return $scope.importingService.isFailed()?0:_.select($scope.importingService.getImportableItems(),function(i){return i.isUploaded()}).length},$scope.getAllItemsCount=function(){return $scope.importingService.getImportableItems().length}},templateUrl:"scripts/modules/import/directives/items_importing_progress.html"}}}.call(this),function(){var _base,_base1;this.MediaGallery||(this.MediaGallery={}),(_base=this.MediaGallery)["import"]||(_base["import"]={}),(_base1=this.MediaGallery["import"]).models||(_base1.models={}),this.MediaGallery["import"].models.ImportableItem=function(item){var failureReason,importedItem,state;return state="initial",failureReason=null,importedItem=void 0,{getItem:function(){return item},getURL:function(){return item.getThumbnailer().makeBigImage()},setImportedItem:function(newItem){return importedItem=newItem},getImportedItem:function(){return importedItem},getTitle:function(){return item.getTitle()},isUploading:function(){return"uploading"===state},isUploaded:function(){return"uploaded"===state},isFailed:function(){return"failed"===state},makeUploading:function(){return state="uploading"},makeUploaded:function(){return state="uploaded"},makeFailed:function(reason){return failureReason=reason,state="failed"},getFailureReason:function(){return failureReason}}}}.call(this),function(){var _base,_base1;this.MediaGallery||(this.MediaGallery={}),(_base=this.MediaGallery)["import"]||(_base["import"]={}),(_base1=this.MediaGallery["import"]).services||(_base1.services={}),this.MediaGallery["import"].services.ImportAndProceed=function(chooseItems,eventNotifier,uiNotifier,i18n){return function(importService){return function(sourceName){return null==sourceName&&(sourceName="button"),importService.canImport()?importService["import"]().then(function(){var importedItems;return importedItems=_.map(importService.getImportedItems()),importedItems.length?chooseItems.perform(importedItems,{source:sourceName,isImported:!0}):void 0},function(){return uiNotifier.sendNotification(i18n.translate("error.import_failed"))}):void 0}}}}.call(this),function(){var _base,_base1;this.MediaGallery||(this.MediaGallery={}),(_base=this.MediaGallery)["import"]||(_base["import"]={}),(_base1=this.MediaGallery["import"]).services||(_base1.services={}),this.MediaGallery["import"].services.Items=function(apis,ImportableItem,onCloseGuard,q){return function(selectedItems,folderName,serviceName){var importableItems,isStarted,loadImportableItems,makeFailed,status;return status="",importableItems=[],loadImportableItems=function(){return selectedItems.values().then(function(items){return importableItems=_.map(items,function(item){return ImportableItem(item)})})},makeFailed=function(res){return status="failed",q.reject(res)},isStarted=function(){return""!==status},{canImport:function(){return selectedItems.isSelectionValid()},getImportableItems:function(){return isStarted()||(importableItems=[]),importableItems},getImportedItems:function(){var imported;return imported=_.map(importableItems,function(i){return i.getImportedItem()}),_.select(imported,function(i){return null!=i})},isStarted:isStarted,isSuccess:function(){return"success"===status},isFailed:function(){return"failed"===status},"import":function(){return status="started",onCloseGuard.confirm().then(function(){return loadImportableItems().then(function(){return apis.getImportItemsTransaction().perform(importableItems,folderName,serviceName).then(function(r){return status="success",r},makeFailed)},makeFailed)},makeFailed)}}}}}.call(this),function(){this.MediaGallery.paginatedAPIs.factory("BasePartialAdapter",function($q,Events){var Base;return Base=function(){function Base(methods){var events;this.nextPageData=null,events=new Events(["authError","load"]),_.extend(this,methods,events,{on:events.on,trigger:events.trigger})}return Base.prototype._parseResponse=function(response){var modelData;return this.hasAuthError(response)?(this.trigger("authError",response),this.nextPageData=null,[]):(this.nextPageData=this.toNextPageData(response),modelData=this.toModelsData(response),this.trigger("load",modelData),modelData)},Base.prototype._reject=function(response){return this.hasAuthError(response)&&(this.trigger("authError",response),this.nextPageData=null),$q.reject(response)},Base.prototype.hasAuthError=function(){return!1},Base.prototype.toNextPageData=function(){return null},Base.prototype.toModelsData=function(res){return res},Base.prototype.loadFirstPage=function(){var _this=this;return this.firstPageRequest.apply(this,arguments).then(function(r){return _this._parseResponse(r)},function(){return _this._reject.apply(_this,arguments)})},Base.prototype.loadNextPage=function(){var args,_this=this;return this.canGetNextPage()?(args=_.union([],arguments,[this.nextPageData]),this.nextPageRequest.apply(this,args).then(function(r){return _this._parseResponse(r)},function(){return _this._reject.apply(_this,arguments)})):$q.reject({errorMessage:"Can`t get next page"})},Base.prototype.canGetNextPage=function(){return null!=this.nextPageData},Base}()})}.call(this),function(){var Events;this.MediaGallery.paginatedAPIs.value("Events",Events=function(){function Events(eventNames){var _this=this;null==eventNames&&(eventNames=[]),"string"==typeof eventNames&&(eventNames=[eventNames]),this.eventHandlers={},_.each(eventNames,function(name){return _this[name]=function(){return"function"==typeof arguments[0]?_this.on(name,arguments[0],arguments[1]):_this.trigger(name,arguments[0])}})}return Events.prototype.trigger=function(eventName,data){return _.each(this.eventHandlers[eventName]||[],function(handlerData){return handlerData.listener.call(handlerData.scope,data)})},Events.prototype.on=function(eventName,listener,scope){var _base;return(_base=this.eventHandlers)[eventName]||(_base[eventName]=[]),this.eventHandlers[eventName].push({listener:listener,scope:scope||this})},Events}())}.call(this),function(){this.MediaGallery.paginatedAPIs.factory("PaginatedUnlessCountLoader",function($q){var PaginatedUnlessCountLoader;return PaginatedUnlessCountLoader=function(){function PaginatedUnlessCountLoader(loadFirstPage,loadMore,countPerPage){var rejectOrLastPage,_this=this;this.countPerPage=null!=countPerPage?countPerPage:50,this.reset(),rejectOrLastPage=function(failData){return 1===_this.callCount?$q.reject(failData):$q.when(_this.getLastPage())},this._loadUnlessCount=function(count,loaderArguments){var loader;return null==loaderArguments&&(loaderArguments=[]),_this.callCount++,_this.collection.length>=count?$q.when(_this.getLastPage()):(loader=_this.collection.length?loadMore:loadFirstPage,loader.apply(_this,loaderArguments).then(function(list){return 0===list.length?rejectOrLastPage():(_.each(list,function(item){var itemId;return itemId=item.getId(),_.find(_this.collection,function(i){return i.getId()===itemId})?void 0:_this.collection.push(item)}),_this._loadUnlessCount(count,loaderArguments))},rejectOrLastPage))}}return PaginatedUnlessCountLoader.prototype.reset=function(){return this.currentPage=1,this.callCount=0,this.collection=[]},PaginatedUnlessCountLoader.prototype.loadFirstPage=function(){return this.reset(),this._loadUnlessCount(this.currentPage*this.countPerPage,arguments)},PaginatedUnlessCountLoader.prototype.loadNextPage=function(){return this.currentPage++,this.callCount=0,this._loadUnlessCount(this.currentPage*this.countPerPage,arguments)},PaginatedUnlessCountLoader.prototype.getLastPage=function(){var endItem,startItem;return startItem=(this.currentPage-1)*this.countPerPage,endItem=this.currentPage*this.countPerPage,this.collection.slice(startItem,+endItem+1||9e9)},PaginatedUnlessCountLoader.prototype.getAllLoaded=function(){return this.collection},PaginatedUnlessCountLoader}()})}.call(this),function(){this.MediaGallery.photoStock.factory("_getBigStockFolders",function(i18n){return function(){var data,translateName;return translateName=function(name){return i18n.translate("photo_stock.folder."+name.toLowerCase())},data=[{id:"Abstract",name:translateName("Abstract")},{id:"Animals",name:translateName("Animals")},{id:"Architecture",name:translateName("Architecture")},{id:"Backgrounds",name:translateName("Backgrounds")},{id:"Business",name:translateName("Business")},{id:"Communication",name:translateName("Communication")},{id:"Computers",name:translateName("Computers")},{id:"Conceptual",name:translateName("Conceptual")},{id:"Editorial",name:translateName("Editorial")},{id:"Education",name:translateName("Education")},{id:"Food",name:translateName("Food")},{id:"Health",name:translateName("Health")},{id:"Holidays",name:translateName("Holidays")},{id:"Industry",name:translateName("Industry")},{id:"Internet",name:translateName("Internet")},{id:"Landscapes",name:translateName("Landscapes")},{id:"Maps",name:translateName("Maps")},{id:"Miscellaneous",name:translateName("Miscellaneous")},{id:"Musical",name:translateName("Musical")},{id:"Nature",name:translateName("Nature")},{id:"Objects",name:translateName("Objects")},{id:"People",name:translateName("People")},{id:"Places",name:translateName("Places")},{id:"Sports",name:translateName("Sports")},{id:"Transportation",name:translateName("Transportation")}],_.map(data,function(category){return{id:category.id,name:category.name,sourceName:"BigStock"}})}})}.call(this),function(){this.MediaGallery.photoStock.factory("PS_BigStockAdapter",function($http,BasePartialAdapter,PS_config,_getBigStockFolders,$q){return function(){var Thumbnailer,adapter,loadItemsRequest;return Thumbnailer=function(photo){var makePreview,makeThumbnail;return makeThumbnail=function(){return photo.large_thumb.url},makePreview=function(){return photo.preview.url},{makeThumbnail:makeThumbnail,makeFolderThumbnail:makeThumbnail,makePreview:makePreview,makeBigImage:makePreview}},loadItemsRequest=function(searchStr,settings,nextPageData){var params,searchParams,searchRegex;return null==searchStr&&(searchStr=""),null==settings&&(settings={}),searchRegex=/#(\w+)=(\w+)/g,searchParams=_(searchStr.match(searchRegex)).map(function(el){return searchRegex.exec(el)}).reduce(function(accum,el){return accum[el[1]]=el[2],accum},{}),searchStr=searchStr.replace(searchRegex,"").trim(),params={q:searchStr,callback:"JSON_CALLBACK",response_detail:"all",protocol:"https",limit:50,page:null!=nextPageData?nextPageData.page:void 0,exclude_terms:'nudity nude naked sexy sex sexual erotic bondage lingerie desire provocative sensual sensuality "your text here" '+(settings.excludeQuery||""),illustrations:settings.hasIllustrations?"y":"n",vectors:settings.hasVectors?"y":"n",safesearch:settings.isSafeSearch?"y":"n",order:settings.sortField?settings.sortField:void 0,category:settings.category?settings.category:void 0,orientation:settings.orientation?settings.orientation:void 0,thumb_size:"large_thumb",size:"l"},$http.jsonp(""+PS_config.bigStock.apiUrl+"2/"+PS_config.bigStock.accountId+"/search/",{withCredentials:!1,params:_.assign(params,searchParams),cache:!0})},adapter=new BasePartialAdapter({toNextPageData:function(res){var _ref,_ref1;return(null!=(_ref=res.data)&&null!=(_ref1=_ref.data)?_ref1.paging:void 0)&&res.data.data.paging.page!==res.data.data.paging.total_pages?{page:+res.data.data.paging.page+1}:null},firstPageRequest:loadItemsRequest,nextPageRequest:loadItemsRequest,toModelsData:function(response){var _ref,_ref1;return null==(null!=response&&null!=(_ref=response.data)&&null!=(_ref1=_ref.data)?_ref1.images:void 0)?[]:_.map(response.data.data.images,function(photo){var size;return size=_.find(photo.formats,function(f){return"l"===f.size_code}),null==size&&(size=_.find(photo.formats,function(f){return"m"===f.size_code})),null==size&&(size=_.find(photo.formats,function(f){return"s"===f.size_code})),{id:photo.id,name:photo.title,timestamp:"",thumbnailer:Thumbnailer(photo),sourceName:"BigStock",width:size.width,height:size.height}})}}),{loadFirstPage:function(){return adapter.loadFirstPage.apply(adapter,arguments)},loadNextPage:function(){return adapter.loadNextPage.apply(adapter,arguments)},loadCategories:function(){var deferred;return deferred=$q.defer(),deferred.resolve(_getBigStockFolders()),deferred.promise}}}})}.call(this),function(){this.MediaGallery.photoStock.factory("PS_config",function(Urls){return{bigStock:{apiUrl:"http://api.bigstockphoto.com/",paymentUrl:""+Urls.bigStockPaymentAPI()+"/services/bigstock/",name:"BigStock",accountId:320217,itemsPerPage:50},searchTimeout:500,itemsPerPage:50}})}.call(this),function(){this.MediaGallery.photoStock.controller("photoStock.ctrls.Root",["$scope","PS_config","selectedItems","import.services.items","import.services.ImportAndProceed","search.services.Search","PS_BigStockRepository","PS_bigStockPayment","chooseItems",function($scope,config,selectedItems,importService,ImportAndProceed,SearchService,repository,payment,chooseItems){var filters,folders,isBuying,isLoadComplete,performSearch;return MediaGallery.appLoadNotifiers.tabsSelected(),isLoadComplete=!0,$scope.isLoadComplete=function(){return isLoadComplete},$scope.showMoreItems=function(){return isLoadComplete&&$scope.search.getQuery()&&repository.getAllLoadedItems().length?(isLoadComplete=!1,repository.loadNextPageItems()["finally"](function(){return isLoadComplete=!0})):void 0},$scope.getItems=function(){return repository.getAllLoadedItems()},$scope.search=SearchService($scope,$scope.getItems,function(){return selectedItems.clear(),isLoadComplete?(isLoadComplete=!1,repository.search($scope.search.getQuery(),{orientation:$scope.selectedOrientation?$scope.selectedOrientation.value:void 0,category:$scope.selectedFolder?$scope.selectedFolder.getId():void 0,sortField:$scope.selectedSortField?$scope.selectedSortField.name:void 0,hasIllustrations:!1,hasVectors:!1,isSafeSearch:!0})["finally"](function(){return isLoadComplete=!0})):void 0}),performSearch=function(){return $scope.search.perform($scope.search.getQuery()||" ")},isBuying=!1,$scope.isBuying=function(){return isBuying},$scope.buyAndProceedSelected=function(source){return null==source&&(source="button"),selectedItems.values().then(function(items){var item;if(items.length)return item=_.first(items),isBuying=!1,payment.showPayment(item).then(function(){return isBuying=!0,payment.getBoughtImage(item.getId()).then(function(item){return chooseItems.perform([item],{source:source}),isBuying=!1},function(){return isBuying=!1})})})},$scope.selectItemAndProceed=function(item){return selectedItems.clear(),selectedItems.add(item),$scope.buyAndProceedSelected("doubleClick")},$scope.sortFields=[{name:"popular",biEventName:"SortByPopularClicked",translationKey:"photo_stock.sort_by.popular"},{name:"relevant",biEventName:"SortByRelevantClicked",translationKey:"photo_stock.sort_by.relevant"}],$scope.selectedSortField=null,$scope.selectSortField=function(field){return $scope.selectedSortField=field,performSearch()},$scope.getSelectedSortField=function(){return $scope.selectedSortField},$scope.orientations=[{name:"horizontal",value:"h"},{name:"vertical",value:"v"}],$scope.selectedOrientation=null,$scope.selectOrientation=function(orientation){return $scope.selectedOrientation=$scope.selectedOrientation===orientation?null:orientation,performSearch()},filters={},$scope.changeFilters=function(newFilters){return filters=newFilters,performSearch()},isLoadComplete=!1,folders=[],repository.loadCategories().then(function(categories){return isLoadComplete=!0,folders=_.select(categories,function(c){return"Art-Illustration"!==c.getId()}),performSearch()},function(){return isLoadComplete=!0}),$scope.getFolders=function(){return folders},$scope.selectFolder=function(folder){return $scope.selectedFolder=folder,performSearch()}}])}.call(this),function(){this.MediaGallery.photoStock.directive("photoStockResponsiveGridItems",function(){return{restrict:"E",scope:{getItems:"=",biPrefix:"@",magnifyingGlassTemplate:"@",canEdit:"&",canDownload:"&",selectItemAndProceed:"&",edit:"&",getDownloadLink:"&"},controller:function($scope,selectedItems,DndHelper){var helpersCache;return $scope.isSelected=function(item){return selectedItems.has(item)},$scope.selection=WixPix.SelectionHelper(selectedItems,DndHelper,$scope),helpersCache={},$scope.selectionHelper=function(item){return helpersCache[item.id]||(helpersCache=$scope.selection.helper(item))}},templateUrl:"scripts/modules/photo_stock/directives/responsive_grid_items.html"}})}.call(this),function(){this.MediaGallery.photoStock.value("PS_BigStockCategory",function(data){return{getId:function(){return data.id},getName:function(){return data.name}}})}.call(this),function(){this.MediaGallery.photoStock.factory("PS_BaseRepository",function(Item,PaginatedUnlessCountLoader){return function(adapter,config){var dataToItems,lastSearchedStr,lastSettings,paginatedItems;return dataToItems=function(itemsData){return _.map(itemsData,function(data){return Item({id:data.id,timestamp:data.timestamp,title:data.name,thumbnailer:data.thumbnailer,sourceName:data.sourceName,width:data.width,height:data.height})})},paginatedItems=new PaginatedUnlessCountLoader(function(){return adapter.loadFirstPage.apply(adapter,arguments).then(dataToItems)},function(){return adapter.loadNextPage.apply(adapter,arguments).then(dataToItems)},config.itemsPerPage),lastSearchedStr="",lastSettings={},{search:function(searchStr,settings){return lastSearchedStr=searchStr,lastSettings=settings,paginatedItems.loadFirstPage(searchStr,settings)},loadNextPageItems:function(){return paginatedItems.loadNextPage(lastSearchedStr,lastSettings)},getAllLoadedItems:function(){return paginatedItems.getAllLoaded()},getLastPageItems:function(){return paginatedItems.getLastPage()}}}})}.call(this),function(){this.MediaGallery.photoStock.factory("PS_BigStockRepository",function(PS_BaseRepository,PS_BigStockAdapter,PS_config,PS_BigStockCategory){var adapter,rep;return adapter=PS_BigStockAdapter(PS_config.bigStock.itemsPerPage),rep=PS_BaseRepository(adapter,PS_config),rep.loadCategories=function(){return adapter.loadCategories().then(function(categoriesData){return _.map(categoriesData,function(data){return PS_BigStockCategory(data)})})},rep})}.call(this),function(){this.MediaGallery.photoStock.factory("PS_bigStockPayment",["$q","$rootScope","PS_config","apiSwitcher.apis",function($q,$rootScope,PS_config,apis){var getBoughtImage;return getBoughtImage=function(id,maxTryCount,tryCount){return null==maxTryCount&&(maxTryCount=5),null==tryCount&&(tryCount=0),tryCount++,tryCount>maxTryCount?$q.reject():apis.getPrivateMediaAdapter().getItemsByTag("_bigstock_"+id).then(function(items){return items.length?items[0]:getBoughtImage(id,maxTryCount,tryCount)},function(){return getBoughtImage(id,maxTryCount,tryCount)})},{showPayment:function(item){var deferred,popup;return deferred=$q.defer(),popup=window.open(""+PS_config.bigStock.paymentUrl+"start_purchase?image_id="+item.getId()+"&size_code=l","purchase","width=1000,height=550,scrollbars=1"),popup.blur(),window.focus(),getBoughtImage(item.getId(),1).then(function(){return popup.close(),deferred.resolve({success:!0})},function(){var isCompleted;return popup.focus(),isCompleted=!1,window.processPayment=function(data){return null==data&&(data={}),isCompleted?void 0:$rootScope.$apply(function(){return isCompleted=!0,"string"==typeof data&&(data=JSON.parse(data)),data.success?deferred.resolve(data):deferred.reject(data)})},window.addEventListener("message",function(event){return window.debug&&console.log(event),/premium\./i.test(event.origin)||/pix\./i.test(event.origin)?window.processPayment(event.data):void 0},!1)}),deferred.promise},getBoughtImage:function(id){return getBoughtImage(id)}}}])}.call(this),function(){var _base,_base1;this.WixPix||(this.WixPix={}),(_base=this.WixPix).privateRestApi||(_base.privateRestApi={}),(_base1=this.WixPix.privateRestApi).adapters||(_base1.adapters={}),this.WixPix.privateRestApi.adapters.Folders=function(http,urls,q,sendWithRetry){var all,cache,create,getRootFolder,itemsCount,remove,rename;return cache={},cache.isPopulated=!1,cache.rootFolder={},getRootFolder=function(mediaType){return cache.isPopulated?q.when(cache.rootFolder):sendWithRetry(function(queryIndex){return http.get(urls.folders.getFolders(),{params:{_:Math.random(),wixSession:queryIndex>1?getCookie("wixSession")||"":void 0},custom:{category:"privateMedia",errorCode:queryIndex>1?WixPix.ErrorCodes.getRootFolderFailedRestTwice:WixPix.ErrorCodes.getRootFolderFailedRest},withCredentials:queryIndex>1?!1:void 0})}).then(function(response){var root;return root=_.find(response.data.folders,function(folder){return!folder.parent_folder_id&&folder.media_type===mediaType}),root&&(cache.isPopulated=!0),cache.rootFolder=root||{folder_id:null},cache.rootFolder})},all=function(mediaType){return sendWithRetry(function(queryIndex){return http.get(urls.folders.getFolders(),{custom:{category:"privateMedia",errorCode:queryIndex>1?WixPix.ErrorCodes.getFoldersFailedRestTwice:WixPix.ErrorCodes.getFoldersFailedRest,BITimeReportName:"privateFolders"},params:{_:Math.random(),wixSession:queryIndex>1?getCookie("wixSession")||"":void 0},withCredentials:queryIndex>1?!1:void 0})}).then(function(response){return MediaGallery.appLoadNotifiers.foldersLoaded(),_.filter(response.data.folders,function(folder){return folder.media_type===mediaType})})},itemsCount=function(folder){return sendWithRetry(function(queryIndex){return http.get(""+urls.folders.getFolders()+"/"+folder.getId(),{params:{_:Math.random(),wixSession:queryIndex>1?getCookie("wixSession")||"":void 0},custom:{category:"privateMedia",errorCode:queryIndex>1?WixPix.ErrorCodes.getItemsCountFailedRestTwice:WixPix.ErrorCodes.getItemsCountFailedRest},withCredentials:queryIndex>1?!1:void 0})}).then(function(response){return response.data.files_count})},create=function(folderName,mediaType){return http.post(urls.folders.getFolders(),{folder_name:folderName,media_type:mediaType,tags:""},{params:{_:Math.random()},custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.createFolderFailedRest}}).then(function(response){return response.data})},remove=function(folder){return http.post(""+urls.folders.getFolders()+"/"+folder.getId()+"/delete",{},{params:{_:Math.random()},custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.removeFolderFailedRest}})},rename=function(folder,newName){return http.post(""+urls.folders.getFolders()+"/"+folder.getId()+"/put",{folder_name:newName},{params:{_:Math.random()},custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.renameFolderFailedRest}})
},{all:all,getRootFolder:getRootFolder,create:create,remove:remove,rename:rename,itemsCount:itemsCount,type:"FoldersAdapter"}}}.call(this),function(){"use strict";var _base,_base1;this.WixPix||(this.WixPix={}),(_base=this.WixPix).privateRestApi||(_base.privateRestApi={}),(_base1=this.WixPix.privateRestApi).adapters||(_base1.adapters={}),this.WixPix.privateRestApi.adapters.PrivateMedia=function(foldersAdapter,eventNotifier,errorNotifier,urls,http,q,Timer,log,allSettled,timeout,cache,settings,mediaType,sendWithRetry){var addFolder,addItemToFolder,buildItems,cachedRequest,changeItemName,getDeletedItems,getDeletedResponse,getFile,getFolderItemsCount,getFolderNames,getItems,getItemsByTag,getItemsForFolder,getRawData,getTranscodedFile,getUnsortedItems,getUploadData,itemsByFolderId,moveToFolder,purgeCache,purgeItem,removeFolder,removeItem,renameFolder,restoreItem,restoreItems,toItem,updateFileInCache,withPurge;return cachedRequest={isInProgress:!1,promise:null,purge:function(){return this.isInProgress=!1,this.promise=null},start:function(request){var _this=this;return this.isInProgress=!0,this.promise=request,this.promise["finally"](function(){return _this.purge()}),this.promise}},toItem=function(mediaType){return function(data){var item;return item={id:data.file_name,iconUrl:data.icon_url,timestamp:data.created_ts,title:data.original_file_name,width:data.width,height:data.height,folderId:data.parent_folder_id,mediaType:data.media_type||mediaType.getMediaType().getMediaTypeName(),thumbnailer:mediaType.getMediaType().getThumbnailerFactory()(data.file_url,data.icon_url,data.file_name),sourceName:data.sourceName,fileUrl:data.file_url},["secure_music","video"].indexOf(mediaType.getMediaType().getMediaTypeName())>=0&&_.extend(item,{transcodingStatus:data.op_status,duration:data.duration||0}),mediaType.getMediaType().getItemFactory()(item)}}(mediaType),itemsByFolderId=function(items){var cachedItems;return cachedItems={},_.each(items,function(item){var _name;return cachedItems[_name=item.getFolderId()]||(cachedItems[_name]=[]),cachedItems[item.getFolderId()].push(item)}),cachedItems},withPurge=function(fn){return function(){return fn.apply(this,arguments).then(function(response){return cache.purge(),response})}},moveToFolder=function(items,folder){return allSettled(_.map(items,function(item){return addItemToFolder(item,folder)}))},addItemToFolder=function(item,folder){return http.post(""+urls.files.getFiles()+"/"+item.getId()+"/put",{parent_folder_id:folder.getId()},{custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.addToFolderFailedRest},params:{_:Math.random()}})},buildItems=function(response){return _.map(response,toItem)},getUploadData=function(fileIndex,queryIndex){return http.get(""+urls.files.getUploadURL(mediaType.getMediaType().getMediaTypeName()),{params:{file_index:fileIndex,_:Math.random(),wixSession:2===queryIndex?getCookie("wixSession")||"":void 0},custom:{category:"privateMedia",errorCode:queryIndex>1?WixPix.ErrorCodes.getUploadUrlFailedRestTwice:WixPix.ErrorCodes.getUploadUrlFailedRest},withCredentials:2===queryIndex?!1:void 0}).then(function(response){return{url:response.data.upload_url,mediaType:mediaType.getMediaType().getMediaTypeName()}},function(response){return q.reject({errorCode:void 0,errorMessage:"ServerDown",responseCode:response.status})})},getItems=function(){return cachedRequest.isInProgress?cachedRequest.promise:cachedRequest.start(getRawData().then(buildItems))},getRawData=function(){var url;return cache.isPopulated()?q.when(cache.get()):(url=settings.getSettingsHash().isSpeedlyItemsGettingEnabled?urls.files.getFilesSpeedly():urls.files.getFiles(),sendWithRetry(function(queryIndex){return http.get(url,{params:{media_type:mediaType.getMediaType().getMediaTypeName(),_:Math.random(),wixSession:queryIndex>1?getCookie("wixSession")||"":void 0},custom:{category:"privateMedia",errorCode:queryIndex>1?WixPix.ErrorCodes.getItemsFailedRestTwice:WixPix.ErrorCodes.getItemsFailedRest,BITimeReportName:"privateItems"},withCredentials:queryIndex>1?!1:void 0})}).then(function(response){return MediaGallery.appLoadNotifiers.itemsLoaded(),cache.put(response.data.files)}))},getDeletedResponse=function(){return sendWithRetry(function(queryIndex){return http.get(""+urls.files.trash()+"/files",{params:{_:Math.random(),wixSession:queryIndex>1?getCookie("wixSession")||"":void 0},custom:{category:"privateMedia",errorCode:queryIndex>1?WixPix.ErrorCodes.getDeletedImagesFailedRestTwice:WixPix.ErrorCodes.getDeletedImagesFailedRest},withCredentials:queryIndex>1?!1:void 0})}).then(function(response){return response.data.files})},getDeletedItems=function(){return getDeletedResponse().then(buildItems)},getUnsortedItems=function(){return foldersAdapter.getRootFolder(mediaType.getMediaType().getMediaTypeName()).then(function(rootFolder){return getItems().then(function(items){return itemsByFolderId(items)[rootFolder.folder_id]||[]})})},getItemsForFolder=function(folder){return getItems().then(function(items){return itemsByFolderId(items)[folder.getId()]||[]})},getFolderItemsCount=function(){return getItems().then(function(items){return itemsByFolderId(items)})},getFolderNames=function(){return foldersAdapter.all(mediaType.getMediaType().getMediaTypeName())},addFolder=function(folderName){return foldersAdapter.create(folderName,mediaType.getMediaType().getMediaTypeName())},renameFolder=function(folder,newFolderName){return foldersAdapter.rename(folder,newFolderName)},removeFolder=function(folder){return foldersAdapter.remove(folder)},changeItemName=function(item,newItemTitle){return http.post(""+urls.files.getFiles()+"/"+item.getId()+"/put",{original_file_name:newItemTitle},{params:{_:Math.random()},custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.changeItemNameFailedRest}})},removeItem=function(item){return http.post(""+urls.files.getFiles()+"/"+item.getId()+"/delete",{},{params:{_:Math.random()},custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.removeItemFailedRest}})},restoreItem=function(item){return http.post(""+urls.files.trash()+"/"+item.getId()+"/restore",{},{params:{_:Math.random()},custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.restoreItemFailedRest}})},restoreItems=function(items){return restoreItem(_.map(items,function(item){return item.getId()}))},purgeItem=function(item){return http.post(""+urls.files.trash()+"/"+item.getId()+"/delete",{},{params:{_:Math.random()},custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.purgeItemFailedRest}})},purgeCache=function(){return q.when(cache.purge())},getFile=function(file){return sendWithRetry(function(queryIndex){return http.get(""+urls.files.getFiles()+"/"+file.getId(),{params:{_:Math.random(),wixSession:queryIndex>1?getCookie("wixSession")||"":void 0},custom:{category:"privateMedia",errorCode:queryIndex>1?WixPix.ErrorCodes.getSingleItemFailedRestTwice:WixPix.ErrorCodes.getSingleItemFailedRest},withCredentials:queryIndex>1?!1:void 0})})},getItemsByTag=function(tag){return http.get(""+urls.files.getFiles()+"/get?tag="+tag,{withCredentials:!0,params:{_:Math.random()}}).then(function(responce){var _ref;return null==(null!=responce&&null!=(_ref=responce.data)?_ref.files:void 0)?[]:_.map(responce.data.files,toItem)})},updateFileInCache=function(file){return getItems().then(function(items){return _.each(items,function(cachedFile,index){return cachedFile.file_name===file.file_name?cache.get()[index]=response:void 0})})},getTranscodedFile=function(file){var deferred,poleFile;return deferred=q.defer(),poleFile=function(){return timeout(function(){return getFile(file).then(function(response){return updateFileInCache(response.data),"READY"===response.data.op_status?deferred.resolve(toItem(response.data)):"PENDING"===response.data.op_status||"INPROGRESS"===response.data.op_status||"IN-QUEUE"===response.data.op_status?poleFile():deferred.reject(toItem(response.data))})},5e3)},poleFile(),deferred.promise},{getFolderNames:getFolderNames,getItems:getItems,getItemsByTag:getItemsByTag,getUnsortedItems:getUnsortedItems,getDeletedItems:getDeletedItems,getUploadData:withPurge(getUploadData),getItemsForFolder:getItemsForFolder,getFolderItemsCount:getFolderItemsCount,getTranscodedFile:getTranscodedFile,changeItemName:withPurge(changeItemName),moveToUnsorted:withPurge(moveToFolder),moveToFolder:withPurge(moveToFolder),renameFolder:withPurge(renameFolder),removeFolder:withPurge(removeFolder),addFolder:withPurge(addFolder),removeItem:withPurge(removeItem),restoreItem:withPurge(restoreItem),restoreItems:withPurge(restoreItems),purgeItem:withPurge(purgeItem),purgeCache:purgeCache,type:"rest"}}}.call(this),function(){var _base,_base1;this.WixPix||(this.WixPix={}),(_base=this.WixPix).privateRestApi||(_base.privateRestApi={}),(_base1=this.WixPix.privateRestApi).adapters||(_base1.adapters={}),this.WixPix.privateRestApi.adapters.Upload=function(eventNotifier,errorNotifier,uploadsFile,urls,q,log,mediaType,http){var parseItemData,parseResponse;return parseItemData=function(itemData){return"/"!==itemData.icon_url[0]&&(itemData.icon_url="/"+itemData.icon_url),"/"!==itemData.file_url[0]&&(itemData.file_url="/"+itemData.file_url),itemData},parseResponse=function(response){var itemData;return itemData=JSON.parse(response)[0],parseItemData(itemData)},{uploadFile:function(file,uploadData,progressCallback,queryIndex){var multipart,withCredentials;return multipart={file:file,media_type:uploadData.mediaType},uploadData.folder.getId&&uploadData.folder.getId()&&(multipart.parent_folder_id=uploadData.folder.getId()),withCredentials=!0,2===queryIndex&&(withCredentials=!1,multipart.wixSession=getCookie("wixSession")),uploadsFile.uploadFile(multipart,uploadData.url,progressCallback,withCredentials,queryIndex).then(function(response){return eventNotifier("privateMediaAddingItemsSucceeded"),parseResponse(response.data)},function(response){var error;return eventNotifier("privateMediaAddingItemsFailed"),error={errorCode:void 0,errorMessage:"ServerDown",responseCode:response.status},406===+response.status&&(error.errorMessage="CorruptedFile"),q.reject(error)})},uploadByURL:function(url,name,sourceName,tags){return null==name&&(name="Untitled"),null==sourceName&&(sourceName="externalUnknown"),http.post(""+urls.files.getFiles()+"/upload/external","",{custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.uploadByURLFailedFailRest},params:{media_type:mediaType.getMediaType().getMediaTypeName(),name:name.replace(/(^\s+|\s+$)/g,""),url:url,source_name:sourceName,tags:null!=tags?tags:void 0,_:Math.random()}}).then(function(response){return parseItemData(response.data)},function(response){return q.reject({errorCode:void 0,errorMessage:"ServerDown",responseCode:response.status})})}}}}.call(this),function(){var _base;this.WixPix||(this.WixPix={}),(_base=this.WixPix).privateRestApi||(_base.privateRestApi={}),this.WixPix.privateRestApi.config=function(){return{baseUrl:"wixprivatemedia-gptest.appspot.com"}}}.call(this),function(){var _base,_base1;this.WixPix||(this.WixPix={}),(_base=this.WixPix).privateRestApi||(_base.privateRestApi={}),(_base1=this.WixPix.privateRestApi).transactions||(_base1.transactions={}),this.WixPix.privateRestApi.transactions.ImportItems=function(BaseTransaction,privateAdapter,uploadAdapter,q,allSettled,itemFromStaticResponse){var importItem;return importItem=function(importableItem,folderName){var itemName,sourceName;return importableItem.makeUploading(),sourceName=importableItem.getItem().getSourceName(),itemName=""+sourceName+" - "+(importableItem.getTitle()||"Untitled"),uploadAdapter.uploadByURL(importableItem.getURL(),itemName.slice(0,140),sourceName,("_imported,_social,_"+sourceName+",_"+sourceName+"_"+importableItem.getItem().getId()).toLowerCase()).then(function(response){return importableItem.setImportedItem(itemFromStaticResponse(response,folderName)),privateAdapter.purgeCache(),importableItem.makeUploaded()},function(reason){return importableItem.makeFailed(reason),q.reject(reason)})},new BaseTransaction(function(importableItems,folderName){return _.isArray(importableItems)||(importableItems=[importableItems]),{notifyAttributes:{importableItems:importableItems,folderName:folderName},getPromise:function(){return allSettled(_.map(importableItems,function(importableItem){return importItem(importableItem,folderName)})).then(function(operations){return _.find(operations,function(o){return"rejected"===o.state})?q.reject(operations):operations})}}})}}.call(this),function(){"use strict";var _base,_base1;this.WixPix||(this.WixPix={}),(_base=this.WixPix).privateRestApi||(_base.privateRestApi={}),(_base1=this.WixPix.privateRestApi).transactions||(_base1.transactions={}),this.WixPix.privateRestApi.transactions.Upload=function(privateMediaAdapter,uploadAdapter,q,itemFromStaticResponse,allSettled,generateUploadSessionId,mediaType,BIErrorNotifier,sendWithRetry){var UploadFail,makeFileFailed,notifyCollectionUploadCompleted,notifyCollectionUploadFailed,notifyCollectionUploadStarted,notifyCollectionUploadSucceeded,notifyFileAddedToFolder,notifyFileUploadError,notifyFileUploadFinished,notifyFileUploadProgress,notifyFileUploadStarted,notifyFileUploadSucceeded,notifyTranscodeStarted,observers,register,upload,uploadSuccess;return observers=[],uploadSuccess=function(fileToUpload,response,item){return function(){return fileToUpload.makeUploaded(),notifyFileUploadFinished(fileToUpload),notifyFileUploadSucceeded(item),fileToUpload.makeInFolder(),notifyFileAddedToFolder(fileToUpload),response}},makeFileFailed=function(fileToUpload,reason){return fileToUpload.makeFailed(reason),notifyFileUploadError(fileToUpload,reason)},UploadFail=function(fileToUpload){return function(reason){return makeFileFailed(fileToUpload,reason),q.reject(reason)}},upload=function(filesToUpload,folder){var defered,fileIndex,uploadNextFile,uploadSessionId,validateFile;return validateFile=mediaType.getMediaType().getValidateFile(),_.each(filesToUpload,function(fileToUpload){var error;return error=validateFile(fileToUpload.data),error?makeFileFailed(fileToUpload,{errorCode:error.code,errorMessage:error.message,validationCode:error.errorCode}):void 0}),uploadSessionId=generateUploadSessionId(),notifyCollectionUploadStarted(filesToUpload.length,uploadSessionId,folder),fileIndex=0,defered=q.defer(),uploadNextFile=function(){var error,errorMessage,fileToUpload,hasSameError,onFail,progressCallback;return filesToUpload.length===fileIndex?void(_.select(filesToUpload,function(file){return file.isFailed()}).length===fileIndex?(error=filesToUpload[0].getFailureReason(),errorMessage=null!=error?error.errorMessage:void 0,hasSameError=!_.find(filesToUpload,function(file){var _ref;return file!==filesToUpload[0]&&(null!=(_ref=file.getFailureReason())?_ref.errorMessage:void 0)!==errorMessage}),hasSameError?defered.reject(error):defered.regect()):defered.resolve(filesToUpload)):(fileToUpload=filesToUpload[fileIndex],fileIndex++,fileToUpload.isFailed()?uploadNextFile():(onFail=UploadFail(fileToUpload),progressCallback=function(percentUploaded){return fileToUpload.percentUploaded=percentUploaded,notifyFileUploadProgress(fileToUpload,percentUploaded)},fileToUpload.makeUploading(),notifyFileUploadStarted(fileToUpload),sendWithRetry(function(queryIndex){return privateMediaAdapter.getUploadData(fileIndex,queryIndex).then(function(uploadData){return uploadData.folder=folder,uploadAdapter.uploadFile(fileToUpload.data,uploadData,progressCallback,queryIndex).then(function(response){var item;return item=itemFromStaticResponse(response,folder.getId()),uploadSuccess(fileToUpload,response,item)(),privateMediaAdapter.purgeCache(),response})})}).then(uploadNextFile,function(errorDescr){var unUploaded;return onFail.apply(this,arguments),MediaGallery.isConnectionError(errorDescr.responseCode)?(unUploaded=_.last(filesToUpload,filesToUpload.length-fileIndex),_.each(unUploaded,function(fileToUpload){return makeFileFailed(fileToUpload,errorDescr)})):uploadNextFile.apply(this,arguments)})))},uploadNextFile(),defered.promise.then(function(){var fulfilled;return fulfilled=_.filter(filesToUpload,function(file){return file.isInFolder()}),notifyCollectionUploadCompleted(filesToUpload,uploadSessionId),fulfilled.length===filesToUpload.length&&notifyCollectionUploadSucceeded(),filesToUpload},function(reason){return notifyCollectionUploadFailed(reason),notifyCollectionUploadCompleted(filesToUpload,uploadSessionId)})},register=function(observer){return observers.push(observer)},notifyCollectionUploadStarted=function(nFiles,uploadSessionId,folder){return _.each(observers,function(o){return"function"==typeof o.collectionUploadStarted?o.collectionUploadStarted(nFiles,uploadSessionId,folder):void 0})},notifyCollectionUploadCompleted=function(files,uploadSessionId){var counts;return counts=WixPix.getUploadFailsCounts(files),_.each(observers,function(o){return"function"==typeof o.collectionUploadCompleted?o.collectionUploadCompleted(files.length,counts.allFailed,counts.failedByAPI,uploadSessionId):void 0})},notifyCollectionUploadFailed=function(reason){return _.each(observers,function(o){return"function"==typeof o.collectionUploadFailed?o.collectionUploadFailed(reason):void 0})},notifyCollectionUploadSucceeded=function(){return _.each(observers,function(o){return"function"==typeof o.collectionUploadSucceeded?o.collectionUploadSucceeded():void 0})},notifyFileUploadStarted=function(fileToUpload){return _.each(observers,function(o){return"function"==typeof o.fileUploadStarted?o.fileUploadStarted(fileToUpload):void 0})},notifyFileUploadProgress=function(fileToUpload,percentUploaded){return _.each(observers,function(o){return"function"==typeof o.fileUploadProgress?o.fileUploadProgress(fileToUpload,percentUploaded):void 0})},notifyFileUploadFinished=function(fileToUpload){return _.each(observers,function(o){return"function"==typeof o.fileUploadFinished?o.fileUploadFinished(fileToUpload):void 0})},notifyFileUploadError=function(fileToUpload,reason){return _.each(observers,function(o){return"function"==typeof o.fileUploadError?o.fileUploadError(fileToUpload,reason):void 0})},notifyFileUploadSucceeded=function(fileToUpload){return _.each(observers,function(o){return"function"==typeof o.fileUploadSucceeded?o.fileUploadSucceeded(fileToUpload):void 0})},notifyFileAddedToFolder=function(fileToUpload){return _.each(observers,function(o){return"function"==typeof o.fileAddedToFolder?o.fileAddedToFolder(fileToUpload):void 0})},notifyTranscodeStarted=function(fileToUpload){return _.each(observers,function(o){return"function"==typeof o.fileTranscodeStarted?o.fileTranscodeStarted(fileToUpload):void 0})},{upload:upload,register:register}}}.call(this),function(){"use strict";var __slice=[].slice;window.WixPix||(window.WixPix={}),WixPix.JavaHttpClient=function(q,http,httpErrorInterceptor){var handlingErrors;return handlingErrors=function(methodName){return function(){var args;return args=1<=arguments.length?__slice.call(arguments,0):[],http[methodName].apply(http,args).then(function(response){return response.data.success?response:(httpErrorInterceptor.responseError(response),q.reject(response))})}},{get:handlingErrors("get"),head:handlingErrors("head"),post:handlingErrors("post"),put:handlingErrors("put"),"delete":handlingErrors("delete"),jsonp:handlingErrors("get")}}}.call(this),function(){"use strict";var _base,_base1;this.WixPix||(this.WixPix={}),(_base=this.WixPix).privateStaticApi||(_base.privateStaticApi={}),(_base1=this.WixPix.privateStaticApi).adapters||(_base1.adapters={}),this.WixPix.privateStaticApi.adapters.PrivateMedia=function(foldersAdapter,eventNotifier,errorNotifier,urls,http,q,log,cache,settings,mediaType){var addFolder,buildItems,changeItemName,getDeletedItems,getDeletedResponse,getFolderItemsCount,getFolderNames,getItems,getItemsForFolder,getRawData,getUnsortedItems,getUploadTicket,itemsByFolderName,moveItems,moveToFolder,moveToUnsorted,purgeItem,purgeItems,removeFolder,removeItem,renameFolder,restoreItem,restoreItems,toItem,uploadMetadata,uploadMetadataFromStaticFileInfo,withPurge;return toItem=function(mediaType){return function(data){var isPublicMedia;return mediaType.getMediaType().getItemFactory()({id:data.fileName,iconURL:data.iconURL,timestamp:data.ts,title:data.originalFileName,width:data.width,height:data.height,folderId:data.tags||"/",sourceType:data.mediaType,thumbnailer:mediaType.getMediaType().getThumbnailerFactory()("/media/"+data.fileName,data.iconURL,data.fileName,isPublicMedia=!1),sourceName:data.sourceName})}}(mediaType),itemsByFolderName=function(items){var cachedItems;return cachedItems={},_.each(items,function(item){var _name;return cachedItems[_name=item.getFolderId()]||(cachedItems[_name]=[]),cachedItems[item.getFolderId()].push(item)}),cachedItems},withPurge=function(fn){return function(){return fn.apply(this,arguments).then(function(response){return cache.purge(),response})}},moveToUnsorted=function(items){return moveItems(items)},moveToFolder=function(items,folder){return moveItems(items,WixPix.Helpers.encode_folders(folder.getName()))},moveItems=function(items,folderName){var destinationFolderName,mediaTags,payload;return null==folderName&&(folderName=""),destinationFolderName="/"===folderName?"":folderName,mediaTags=_.map(items,function(item){return'<mediaTags fileName="'+item.getId()+'" tags="'+destinationFolderName+'" />'}).join("\n  "),payload="<mediaTagsList>\n  "+mediaTags+"\n</mediaTagsList>",http.post(""+urls.privateMediaStaticAPI()+"/private/save/tags",payload,{headers:{"Content-Type":"application/xml; charset=UTF-8"},custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.addToFolderFailedRest}})},buildItems=function(response){return _.map(response,toItem)},getItems=function(){return getRawData().then(buildItems)},getRawData=function(){return cache.isPopulated()?q.when(cache.get()):http.get(""+urls.privateMediaStaticAPI()+"/private/get",{params:{mediaType:mediaType.getMediaType().getMediaTypeName()},custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.getItemsFailed,BITimeReportName:"privateItems"}}).then(function(response){return cache.put(response.data.payload.mediaItems)})},getDeletedResponse=function(){return http.get(""+urls.privateMediaStaticAPI()+"/private/get/deleted",{params:{mediaType:mediaType.getMediaType().getMediaTypeName()},custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.getDeletedImagesFailed}}).then(function(response){return response.data.payload.mediaItems})},getDeletedItems=function(){return getDeletedResponse().then(buildItems)},getUnsortedItems=function(){return getItems().then(function(items){return _.filter(items,function(item){return _.isNull(item.getFolderId())})})},getItemsForFolder=function(folder){return getItems().then(function(items){return itemsByFolderName(items)[folder.getId()]||[]})},getFolderItemsCount=function(){return getItems().then(function(items){return itemsByFolderName(items)})},getFolderNames=function(){return foldersAdapter.all()},addFolder=function(folderName){return foldersAdapter.create(folderName)},renameFolder=function(folder,newFolderName){return foldersAdapter.rename(folder,newFolderName)},removeFolder=function(folder){return foldersAdapter.remove(folder)},changeItemName=function(item,newItemTitle){return getRawData().then(function(items){var changedItem,xmlSubstr;return changedItem=_.find(items,function(rawItem){return item.getId()===rawItem.fileName}),changedItem.originalFileName=newItemTitle,_.each(changedItem,function(value,field){return _.isNull(value)||_.isUndefined(value)?delete changedItem[field]:void 0}),xmlSubstr=_.map(changedItem,function(value,key){return(key+'="'+value+'"').toString()}).join(" "),http.post(""+urls.privateMediaStaticAPI()+"/private/save","<mediaItemList><mediaItem "+xmlSubstr+"/></mediaItemList>",{headers:{"Content-Type":"application/xml; charset=UTF-8"},custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.renameItemFailed}}).then(function(response){if(!response.data.success)throw response;return response})})},removeItem=function(item){return http.post(""+urls.privateMediaStaticAPI()+"/private/delete",{},{params:{fileName:item.getId()},custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.removeItemFailed}})},restoreItem=function(toRestore){var itemsIds;return itemsIds=_.isArray(toRestore)?toRestore:toRestore.getId(),http.post(""+urls.privateMediaStaticAPI()+"/private/archived/restore",{},{params:{"fileNames[]":itemsIds},custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.restoreItemFailed}})},restoreItems=function(items){return restoreItem(_.map(items,function(item){return item.getId()}))},purgeItem=function(toPurge){var itemsIds;return itemsIds=_.isArray(toPurge)?toPurge:[toPurge.getId()],http.post(""+urls.privateMediaStaticAPI()+"/private/archived/delete",{},{params:{"fileNames[]":itemsIds},custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.purgeItemFailed}})},purgeItems=function(items){return purgeItem(_.map(items,function(item){return item.getId()}))},uploadMetadataFromStaticFileInfo=function(responses,tag,sourceName){var mediaItemXmls,result,tagString;return null==sourceName&&(sourceName="user"),tagString=tag?'tags="'+tag+'"':"",tagString=WixPix.Helpers.encode_folders(tagString),mediaItemXmls=_.map(responses,function(response){var r;return r='<mediaItem fileName="'+response.fileName+'"\n   originalFileName="'+response.originalFileName+'"\n           fileSize="'+response.fileSize+'"\n           mimeType="'+response.mimeType+'"\n         sourceName="'+sourceName+'"\n            version="'+response.version+'"\n            iconURL="'+response.iconUrl+'"\n          sourceURL="'+response.sourceUrl+'"\n          mediaType="'+mediaType.getMediaType().getMediaTypeName()+'"\n             '+tagString,response.width&&(r+=' width="'+response.width+'"\n'),response.height&&(r+=' height="'+response.height+'"\n'),r+=" />"}),result="<mediaItemList>"+mediaItemXmls.join("\n")+"</mediaItemList>",uploadMetadata(result)},uploadMetadata=function(fileMetadata){return http.post(""+urls.privateMediaStaticAPI()+"/private/add",fileMetadata,{headers:{"Content-Type":"application/xml; charset=UTF-8"},custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.fileUploadFail,BITimeReportName:"addItems"}}).then(function(response){return eventNotifier("privateMediaAddingItemsSucceeded"),response.data.payload.results},function(){return eventNotifier("privateMediaAddingItemsFailed"),q.reject({errorCode:void 0,errorMessage:"ServerDown"})})},getUploadTicket=function(){return http.get(""+urls.privateMediaStaticAPI()+"/tickets/get",{custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.getTicketFail,BITimeReportName:"fetchingTicket"}}).then(function(response){return eventNotifier("fetchingTicketSucceeded"),response.data.responseValue},function(response){var errorCode,errorMessage;return errorCode=response.data.errorCode,eventNotifier("fetchingTicketFailed"),errorNotifier.error({category:"privateMedia",message:'Fetching ticket failed with code: "'+errorCode+'"',errorCode:WixPix.ErrorCodes.getTicketFail}),200===response.status?(errorMessage="private_media.private_media_upload_error."+function(){switch(errorCode){case-7700:return"PrivateMediaServiceException";case-7702:return"MediaItemDoesNotExistException";case-7703:return"MediaItemFailedToSave";case-7704:return"MediaItemFailedToSaveDataIntegrityViolation";case-7705:return"MediaItemFailedToSaveBatchLimitViolation";case-7708:return"MediaQuotaLimitExceeded";default:return log.error(response.data),"Unknown"}}(),q.reject({errorCode:errorCode,errorMessage:errorMessage})):q.reject({errorCode:void 0,errorMessage:"private_media.private_media_upload_error.ServerDown"})})},{getFolderNames:getFolderNames,getItems:getItems,getUnsortedItems:getUnsortedItems,getDeletedItems:getDeletedItems,getItemsForFolder:withPurge(getItemsForFolder),getUploadTicket:getUploadTicket,getFolderItemsCount:withPurge(getFolderItemsCount),uploadMetadataFromStaticFileInfo:withPurge(uploadMetadataFromStaticFileInfo),changeItemName:withPurge(changeItemName),uploadMetadata:withPurge(uploadMetadata),moveToUnsorted:withPurge(moveToUnsorted),moveToFolder:withPurge(moveToFolder),renameFolder:withPurge(renameFolder),removeFolder:withPurge(removeFolder),addFolder:withPurge(addFolder),removeItem:withPurge(removeItem),restoreItem:withPurge(restoreItem),restoreItems:withPurge(restoreItems),purgeItem:withPurge(purgeItem),type:"static"}}}.call(this),function(){var _base,_base1;this.WixPix||(this.WixPix={}),(_base=this.WixPix).privateStaticApi||(_base.privateStaticApi={}),(_base1=this.WixPix.privateStaticApi).adapters||(_base1.adapters={}),this.WixPix.privateStaticApi.adapters.Folders=function(http,urls,q,generateUUID){var all,create,remove,rename,rootFolder,rootId;return rootId=generateUUID(),rootFolder={folder_name:"/",folder_id:"/"},all=function(){return http.get(urls.privateMediaStaticAPI()+"/private/tags/get",{custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.getFoldersFailed,BITimeReportName:"privateFolders"}}).then(function(response){var folders,tagsString;return tagsString=response.data.responseValue,void 0===tagsString||""===tagsString?[rootFolder]:(folders=_.map(tagsString.split(","),function(folderName){var folderId;return folderId=generateUUID(),{folder_name:folderName,folder_id:folderName}}),folders.push(rootFolder),folders)})},create=function(folderName){return http.post(""+urls.privateMediaStaticAPI()+"/private/tags/add",{},{params:{tag:folderName},custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.createFolderFailed}})},remove=function(folder){return http.post(""+urls.privateMediaStaticAPI()+"/private/tags/delete",{},{params:{tag:folder.getName()},custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.removeFolderFailed}})},rename=function(folder,newFolderName){return folder.setId(newFolderName),http.post(""+urls.privateMediaStaticAPI()+"/private/tags/rename",{},{params:{oldTag:folder.getName(),newTag:newFolderName},custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.renameFolderFailed}})},{all:all,create:create,remove:remove,rename:rename,type:"FoldersAdapter"}}}.call(this),function(){var _base,_base1;this.WixPix||(this.WixPix={}),(_base=this.WixPix).privateStaticApi||(_base.privateStaticApi={}),(_base1=this.WixPix.privateStaticApi).adapters||(_base1.adapters={}),this.WixPix.privateStaticApi.adapters.Upload=function(eventNotifier,errorNotifier,uploadsFile,urls,q,log,http,mediaType){var Parser,errorNames,getImageData,notifier,uploadByURL,uploadFile;return errorNames={"-10401":"Unauthorized","-10403":"Forbidden","-10406":"NotAcceptable","-10412":"PreconditionFailed","-10415":"UnsupportedMediaType","-10417":"ExpectationFailed","-10500":"InternalServerError","-10503":"ServiceUnavailable"},getImageData=function(xml,orifinalFileName){var meta,properties;return properties=xml.find("properties"),meta=xml.find("sys_meta"),{fileName:properties.attr("file_name"),fileSize:meta.attr("file_size"),originalFileName:orifinalFileName,width:meta.attr("width"),height:meta.attr("height"),mimeType:meta.attr("mime_type"),sourceUrl:meta.attr("source_url"),iconUrl:meta.attr("icon_url"),version:meta.attr("ver")}},notifier={success:function(response){return eventNotifier("staticUploadSucceeded"),response},error:function(response){return eventNotifier("staticUploadFailed"),errorNotifier.error({category:"static",message:'Static upload failed with code: "'+response.errorCode+'"',errorCode:WixPix.ErrorCodes.fileUploadFail}),q.reject(response)}},Parser=function(deferred,orifinalFileName,sourceName){return{success:function(response){var errorCode,errorMessage,xml;return xml=$($.parseXML(response.data)),"true"===xml.find("upload").attr("success")?deferred.resolve(getImageData(xml,orifinalFileName,sourceName)):(errorCode=xml.find("upload").attr("errorCode"),errorMessage=errorNames[errorCode]||"Unknown","Unknown"!==errorMessage&&log.error(xml[0]),deferred.reject({errorCode:errorCode,errorMessage:errorMessage})),deferred.promise},error:function(){return deferred.reject({errorCode:void 0,errorMessage:"ServerDown"}),deferred.promise
}}},uploadFile=function(file,ticket,progressCallback){var error,mediaTypeStaticCode,parser,url,validateFile;return mediaTypeStaticCode=mediaType.getMediaType().getStaticCode(),validateFile=mediaType.getMediaType().getValidateFile(),url=""+urls.privateMediaStaticUploadAPI()+"/add_file?s="+mediaTypeStaticCode+"&ut="+ticket,(error=validateFile(file))?(errorNotifier.error({category:error.category,message:error.description,errorCode:error.errorCode}),q.reject({errorCode:error.code,errorMessage:error.message,validationCode:error.errorCode})):(parser=Parser(q.defer(),encodeURIComponent(file.name)),uploadsFile.uploadFile({file:file},url,progressCallback).then(parser.success,parser.error).then(notifier.success,notifier.error))},uploadByURL=function(url,ticket,name){var mediaTypeStaticCode,parser;return mediaTypeStaticCode=mediaType.getMediaType().getStaticCode(),parser=Parser(q.defer(),name||encodeURIComponent(url)),http.post(""+urls.privateMediaStaticUploadAPI()+"/add_file","",{params:{s:mediaTypeStaticCode,ut:ticket,surl:url},headers:{"Content-Type":"multipart/form-data"},withCredentials:!1,custom:{category:"privateMedia",errorCode:WixPix.ErrorCodes.uploadByURLFailed}}).then(parser.success,parser.error).then(notifier.success,notifier.error)},{uploadFile:uploadFile,uploadByURL:uploadByURL}}}.call(this),function(){var _base,_base1;this.WixPix||(this.WixPix={}),(_base=this.WixPix).privateStaticApi||(_base.privateStaticApi={}),(_base1=this.WixPix.privateStaticApi).transactions||(_base1.transactions={}),this.WixPix.privateStaticApi.transactions.ImportItems=function(BaseTransaction,privateAdapter,uploadAdapter,q,allSettled,itemFromStaticResponse){var importItem;return importItem=function(importableItem,ticket,folderName,serviceName){var reject,saveMetaData,upload;return reject=function(reason){return importableItem.makeFailed(reason),q.reject(reason)},upload=function(){return importableItem.makeUploading(),uploadAdapter.uploadByURL(importableItem.getURL(),ticket,importableItem.getTitle()).then(function(response){return response},reject)},saveMetaData=function(staticResponse){return privateAdapter.uploadMetadataFromStaticFileInfo([staticResponse],folderName,serviceName).then(function(){return importableItem.setImportedItem(itemFromStaticResponse(staticResponse,folderName)),importableItem.makeUploaded()},reject)},upload().then(saveMetaData)},new BaseTransaction(function(importableItems,folderName,serviceName){return _.isArray(importableItems)||(importableItems=[importableItems]),{notifyAttributes:{importableItems:importableItems,folderName:folderName,serviceName:serviceName},getPromise:function(){return privateAdapter.getUploadTicket().then(function(ticket){return allSettled(_.map(importableItems,function(importableItem){return importItem(importableItem,ticket,folderName,serviceName)}))},q.reject)}}})}}.call(this),function(){"use strict";var _base,_base1;this.WixPix||(this.WixPix={}),(_base=this.WixPix).privateStaticApi||(_base.privateStaticApi={}),(_base1=this.WixPix.privateStaticApi).transactions||(_base1.transactions={}),this.WixPix.privateStaticApi.transactions.Upload=function(privateMediaAdapter,uploadAdapter,q,itemFromStaticResponse,allSettled,generateUploadSessionId){var notifyCollectionUploadCompleted,notifyCollectionUploadFailed,notifyCollectionUploadStarted,notifyCollectionUploadSucceeded,notifyFileAddedToFolder,notifyFileUploadError,notifyFileUploadFinished,notifyFileUploadProgress,notifyFileUploadStarted,notifyFileUploadSucceeded,observers,register,upload;return observers=[],upload=function(filesToUpload,folder){var uploadSessionId;return uploadSessionId=generateUploadSessionId(),notifyCollectionUploadStarted(filesToUpload.length,uploadSessionId,folder),privateMediaAdapter.getUploadTicket().then(function(ticket){return allSettled(_.map(filesToUpload,function(fileToUpload){var progressCallback;return fileToUpload.makeUploading(),notifyFileUploadStarted(fileToUpload),progressCallback=function(percentUploaded){return fileToUpload.percentUploaded=percentUploaded,notifyFileUploadProgress(fileToUpload,percentUploaded)},uploadAdapter.uploadFile(fileToUpload.data,ticket,progressCallback).then(function(response){return fileToUpload.makeUploaded(),notifyFileUploadFinished(fileToUpload),response},function(reason){return fileToUpload.makeFailed(reason),notifyFileUploadError(fileToUpload,reason),q.reject(reason)}).then(function(staticResponse){return staticResponse.originalFileName=fileToUpload.getName(),privateMediaAdapter.uploadMetadataFromStaticFileInfo([staticResponse],folder.getName()).then(function(response){var item;return item=itemFromStaticResponse(staticResponse,folder.getName()),item.setUUID(fileToUpload.getUUID()),notifyFileUploadSucceeded(item),fileToUpload.makeInFolder(),notifyFileAddedToFolder(fileToUpload),response},function(reason){return fileToUpload.makeFailed(reason)})},function(reason){return notifyFileUploadError(fileToUpload,reason),q.reject(reason)})}))},function(reason){return notifyCollectionUploadFailed(reason),q.reject()}).then(function(results){var fulfilled,staticFileInfos;return fulfilled=_.filter(results,function(result){return"fulfilled"===result.state}),0===fulfilled.length?void notifyCollectionUploadCompleted(filesToUpload,uploadSessionId):(staticFileInfos=_.map(fulfilled,function(result){return result.value}),notifyCollectionUploadCompleted(filesToUpload(uploadSessionId)),fulfilled.length===results.length?notifyCollectionUploadSucceeded():void 0)},function(){return notifyCollectionUploadCompleted(filesToUpload,uploadSessionId)})},register=function(observer){return observers.push(observer)},notifyCollectionUploadStarted=function(nFiles,uploadSessionId){return _.each(observers,function(o){return"function"==typeof o.collectionUploadStarted?o.collectionUploadStarted(nFiles,uploadSessionId):void 0})},notifyCollectionUploadCompleted=function(files,uploadSessionId){var counts;return counts=WixPix.getUploadFailsCounts(files),_.each(observers,function(o){return"function"==typeof o.collectionUploadCompleted?o.collectionUploadCompleted(files.length,counts.allFailed,counts.failedByAPI,uploadSessionId):void 0})},notifyCollectionUploadSucceeded=function(){return _.each(observers,function(o){return"function"==typeof o.collectionUploadSucceeded?o.collectionUploadSucceeded():void 0})},notifyCollectionUploadFailed=function(reason){return _.each(observers,function(o){return"function"==typeof o.collectionUploadFailed?o.collectionUploadFailed(reason):void 0})},notifyFileUploadStarted=function(fileToUpload){return _.each(observers,function(o){return"function"==typeof o.fileUploadStarted?o.fileUploadStarted(fileToUpload):void 0})},notifyFileUploadProgress=function(fileToUpload,percentUploaded){return _.each(observers,function(o){return"function"==typeof o.fileUploadProgress?o.fileUploadProgress(fileToUpload,percentUploaded):void 0})},notifyFileUploadFinished=function(fileToUpload){return _.each(observers,function(o){return"function"==typeof o.fileUploadFinished?o.fileUploadFinished(fileToUpload):void 0})},notifyFileUploadError=function(fileToUpload,reason){return _.each(observers,function(o){return"function"==typeof o.fileUploadError?o.fileUploadError(fileToUpload,reason):void 0})},notifyFileUploadSucceeded=function(fileToUpload){return _.each(observers,function(o){return"function"==typeof o.fileUploadSucceeded?o.fileUploadSucceeded(fileToUpload):void 0})},notifyFileAddedToFolder=function(fileToUpload){return _.each(observers,function(o){return"function"==typeof o.fileAddedToFolder?o.fileAddedToFolder(fileToUpload):void 0})},{upload:upload,register:register}}}.call(this),function(){this.MediaGallery||(this.MediaGallery={}),MediaGallery.publicMedia||(MediaGallery.publicMedia={}),MediaGallery.publicMedia.PublicMediaJSONPAdapter=function(q,urls,http){var loadCategoryByName,loadFirstItemsPageByCategoryId,loadItemsPageByPageLink,loadItemsPageBySearchQueryAndCategoryId;return loadCategoryByName=function(name,language,isWixOnly,queryIndex){var errorCode,params,url;return null==queryIndex&&(queryIndex=1),url=""+urls.publicMediaRestAPI()+"/public/categories",params={legacyKey:name,language:language,levels:-1},errorCode=1===queryIndex?WixPix.ErrorCodes.getPublicCategoriesFailed:WixPix.ErrorCodes.getPublicCategoriesFailedTwice,http.get(url,{params:params,custom:{category:"publicMedia",errorCode:errorCode,BITimeReportName:"publicMediaCategory"},withCredentials:!0}).then(function(response){return response.data.category?(MediaGallery.appLoadNotifiers.foldersLoaded(),response.data.category):q.reject("NotFound")})},loadItemsPageBySearchQueryAndCategoryId=function(query,categoryId,language,isWixOnly,queryIndex){var errorCode,pageLink,params;return null==queryIndex&&(queryIndex=1),pageLink=""+urls.publicMediaRestAPI()+"/public/search",params={guid:categoryId,searchString:query,language:language},errorCode=1===queryIndex?WixPix.ErrorCodes.getPublicSearchItemsFailed:WixPix.ErrorCodes.getPublicSearchItemsFailedTwice,http.get(pageLink,{params:params,custom:{category:"publicMedia",errorCode:errorCode,BITimeReportName:"publicMediaItems"},withCredentials:!0}).then(function(response){return{pageLink:pageLink,data:response.data,responseCode:response.status}})},loadFirstItemsPageByCategoryId=function(categoryId,language,isWixOnly,queryIndex){var errorCode,pageLink;return null==queryIndex&&(queryIndex=1),pageLink="/public/items?guid="+categoryId+"&language="+language,errorCode=1===queryIndex?WixPix.ErrorCodes.getPublicItemsFailed:WixPix.ErrorCodes.getPublicItemsFailedTwice,http.get(""+urls.publicMediaRestAPI()+pageLink,{custom:{category:"publicMedia",errorCode:errorCode,BITimeReportName:"publicMediaItems"},withCredentials:!0}).then(function(response){return MediaGallery.appLoadNotifiers.itemsLoaded(),{pageLink:pageLink,data:response.data}})},loadItemsPageByPageLink=function(pageLink,queryIndex){var errorCode;return null==queryIndex&&(queryIndex=1),errorCode=1===queryIndex?WixPix.ErrorCodes.getPublicItemsFailed:WixPix.ErrorCodes.getPublicItemsFailedTwice,http.get(""+urls.publicMediaRestAPI()+pageLink,{custom:{category:"publicMedia",errorCode:errorCode,BITimeReportName:"publicMediaItems"},withCredentials:!0}).then(function(response){return{pageLink:pageLink,data:response.data}})},{loadCategoryByName:loadCategoryByName,loadItemsPageBySearchQueryAndCategoryId:loadItemsPageBySearchQueryAndCategoryId,loadItemsPageByPageLink:loadItemsPageByPageLink,loadFirstItemsPageByCategoryId:loadFirstItemsPageByCategoryId}}}.call(this),function(){this.MediaGallery||(this.MediaGallery={}),MediaGallery.publicMedia||(MediaGallery.publicMedia={}),MediaGallery.publicMedia.NoopPublicMediaAdapter=function(q){return{initialize:function(){return q.when()},getFolders:function(){return q.when([])},getItemsForSubFolder:function(){return q.when([])},type:"NoopPublicMediaAdapter"}},MediaGallery.publicMedia.StaticPublicMediaAdapter=function(http,q,urls,mediaType,settings,errorNotifier,httpErrorNotifier){var folders,getFolders,getItemsForSubFolder,initialize,isInitialized,publicMediaRootCategoryName,toItem;return folders=[],isInitialized=!1,publicMediaRootCategoryName=settings.getSettingsHash().publicMediaRootCategoryName,toItem=function(data){var isPublicMedia;return mediaType.getMediaType().getItemFactory()({id:data.id,iconUrl:data.iconUrl,mediaType:data.mediaType,timestamp:data.dateUpdated||data.dateCreated,title:data.title,width:data.width,height:data.height,sourceType:data.sourceType,thumbnailer:mediaType.getMediaType().getThumbnailerFactory()("/media/"+data.id,data.iconUrl,data.id,isPublicMedia=!0)})},getItemsForSubFolder=function(folder,page,searchQuery){return null==page&&(page=1),initialize().then(function(){var callbackInvoked,deferred,folderParams;return folderParams=function(){return searchQuery.length?_.extend({},folder.params,{tags_set:searchQuery}):folder.params},deferred=q.defer(),callbackInvoked=!1,window.customCallback=function(unused,res){return callbackInvoked=!0,deferred.resolve({items:_.map(res.payload.items,toItem),total:res.payload.total,perPage:24,page:page})},$.ajax({url:""+urls.publicMediaStaticAPI()+"/public-media/media/search",dataType:"jsonp",jsonp:!1,data:$.extend({page_index:page,order_field:"total_rating",page_size:24,order_ascending:!1,format:"jsonp",callback:"customCallback"},folderParams()),error:function(qXHR,textStatus){return callbackInvoked?void 0:("2"!==textStatus[0]&&httpErrorNotifier.responseError({category:"publicMedia",errorCode:WixPix.ErrorCodes.getItemsForSubFolderFailed,httpStatus:textStatus}),errorNotifier.error({category:"publicMedia",errorCode:WixPix.ErrorCodes.getItemsForSubFolderFailed}),deferred.reject("oops"))}}),deferred.promise})},getFolders=function(){return initialize().then(function(){return folders})},initialize=function(){return publicMediaRootCategoryName!==settings.getSettingsHash().publicMediaRootCategoryName&&(isInitialized=!1),isInitialized?q.when():(publicMediaRootCategoryName=settings.getSettingsHash().publicMediaRootCategoryName,http.get("../../assets/db/public_media/"+publicMediaRootCategoryName+".json",{withCredentials:!1,custom:{category:"publicMedia",errorCode:WixPix.ErrorCodes.publicMediaCategoriesCannotBeLoaded,BITimeReportName:"publicMediaCategory"}}).then(function(response){return folders=response.data,isInitialized=!0},function(){var d;return d=q.defer(),d.reject({code:WixPix.ErrorCodes.publicMediaCategoriesCannotBeLoaded,message:"Could not load public categories"}),d.promise}))},{initialize:initialize,getFolders:getFolders,getItemsForSubFolder:getItemsForSubFolder,type:"PublicMediaAdapter"}}}.call(this),function(){this.MediaGallery||(this.MediaGallery={}),MediaGallery.publicMedia||(MediaGallery.publicMedia={}),MediaGallery.publicMedia.PublicItemCollection=function(){var addPage,clear,collection,finishLoading,getNextPageLink,hasFinishedLoading,isFullyLoaded,isLoading,isNothingFound,makeLoading,nextPageLink,state,values;return collection=[],nextPageLink=void 0,state=void 0,values=function(){return collection},addPage=function(pageLink,items,newNextPageLink){return nextPageLink=newNextPageLink,_.each(items,function(item){return collection.push(item)})},getNextPageLink=function(){return nextPageLink},isFullyLoaded=function(){return 0===collection.length||void 0===getNextPageLink()},clear=function(){return collection=[],nextPageLink=void 0},isLoading=function(){return"loading"===state},makeLoading=function(){return state="loading"},finishLoading=function(){return state="finished"},hasFinishedLoading=function(){return"finished"===state},isNothingFound=function(){return hasFinishedLoading()&&0===collection.length},{values:values,addPage:addPage,getNextPageLink:getNextPageLink,isFullyLoaded:isFullyLoaded,clear:clear,isLoading:isLoading,makeLoading:makeLoading,finishLoading:finishLoading,hasFinishedLoading:hasFinishedLoading,isNothingFound:isNothingFound}}}.call(this),function(){var _base;this.MediaGallery||(this.MediaGallery={}),MediaGallery.publicMedia||(MediaGallery.publicMedia={}),(_base=MediaGallery.publicMedia).controllers||(_base.controllers={}),MediaGallery.publicMedia.controllers.BreadcrumbsDynamicPublicMediaRootCtrl=function(s,publicMediaRepository,selectedItems,chooseItems,SearchService){var isItemsLoaded,loadItems;return MediaGallery.appLoadNotifiers.tabsSelected(),isItemsLoaded=!1,loadItems=function(){var query;return isItemsLoaded=!1,query=s.search.getQuery(),""===query?publicMediaRepository.loadItemCollectionByCategory(s.selectedCategory.getId(),s.itemCollection)["finally"](function(){return isItemsLoaded=!0}):publicMediaRepository.loadItemCollectionBySearchQueryAndCategory(s.selectedCategory,query,s.itemCollection)["finally"](function(){return isItemsLoaded=!0})},s.error=void 0,s.itemCollection=MediaGallery.publicMedia.PublicItemCollection(),publicMediaRepository.loadCategoryTree().then(function(categoryTree){return s.categoryTree=categoryTree,s.selectCategory(s.categoryTree)},function(reason){return s.error=reason}),s.selectedBranchPath=function(){return s.selectedCategory?s.selectedCategory.getBranchPathWithoutRoot():[]},s.selectedBranchChildren=function(){return s.selectedCategory?s.selectedCategory.getBranchChildren():[]},s.selectCategory=function(category){return selectedItems.clear(),s.selectedCategory=category,loadItems()},s.getItems=function(){return s.itemCollection.values()},s.getSelectedFolder=function(){return s.selectedCategory},s.canDrag=function(){return!1},s.isSelectedCategory=function(category){return s.selectedCategory===category},s.isSelectedItem=function(item){return selectedItems.has(item)},s.selectItemAndProceed=function(item){var category,parentCategory,_ref;return parentCategory=null!=(_ref=s.selectedCategory)?_ref.getParent():void 0,category=s.selectedCategory,chooseItems.perform([item],{source:"doubleClick",category:parentCategory||category,subcategory:parentCategory?category:void 0})},s.isItemsLoaded=function(){return isItemsLoaded&&!s.itemCollection.isLoading()},s.loadNextPage=function(){return!isItemsLoaded||s.itemCollection.isFullyLoaded()||s.itemCollection.isLoading()?void 0:publicMediaRepository.loadItemCollectionNextPage(s.itemCollection)},s.search=SearchService(s,s.getItems,function(){return selectedItems.clear(),loadItems()}),s.canSearch=function(){return!0}}}.call(this),function(){var _base;this.MediaGallery||(this.MediaGallery={}),MediaGallery.publicMedia||(MediaGallery.publicMedia={}),(_base=MediaGallery.publicMedia).controllers||(_base.controllers={}),MediaGallery.publicMedia.controllers.DynamicPublicMediaRootCtrl=function(s,publicMediaRepository,selectedItems,chooseItems,SearchService){var isItemsLoaded,loadItems;return MediaGallery.appLoadNotifiers.tabsSelected(),isItemsLoaded=!1,s.error=void 0,s.itemCollection=MediaGallery.publicMedia.PublicItemCollection(),s.topLevelCategories=[],loadItems=function(){var query;return isItemsLoaded=!1,query=s.search.getQuery(),""===query?publicMediaRepository.loadItemCollectionByCategory(s.selectedCategory.getId(),s.itemCollection)["finally"](function(){return isItemsLoaded=!0}):publicMediaRepository.loadItemCollectionBySearchQueryAndCategory(s.selectedCategory,query,s.itemCollection)["finally"](function(){return isItemsLoaded=!0})},publicMediaRepository.loadCategoryTree().then(function(categoryTree){return s.categoryTree=categoryTree,s.topLevelCategories=categoryTree.getBranchChildren(),s.selectTopLevelCategory(s.topLevelCategories[0])},function(reason){return s.error=reason}),s.selectedBranchChildren=function(){return s.selectedCategory?s.selectedCategory.getBranchChildren():[]},s.selectTopLevelCategory=function(category){var firstChild;return firstChild=category.getChildren()[0],firstChild?s.selectCategory(firstChild):void 0},s.selectCategory=function(category){return selectedItems.clear(),s.selectedCategory=category,loadItems()},s.getItems=function(){return s.itemCollection.values()},s.getSelectedFolder=function(){return s.selectedCategory},s.canDrag=function(){return!1},s.isSelectedCategory=function(category){return s.selectedCategory===category},s.isSelectedTopLevelCategory=function(category){var _ref;return s.isSelectedCategory(category)||(null!=(_ref=s.selectedCategory)?_ref.getParent():void 0)===category},s.isSelectedItem=function(item){return selectedItems.has(item)},s.selectItemAndProceed=function(item){var category,parentCategory,_ref;return parentCategory=null!=(_ref=s.selectedCategory)?_ref.getParent():void 0,category=s.selectedCategory,chooseItems.perform([item],{source:"doubleClick",category:parentCategory||category,subcategory:parentCategory?category:void 0})},s.nothingFound=function(){return s.error||s.itemCollection.isNothingFound()},s.isItemsLoaded=function(){return isItemsLoaded&&!s.itemCollection.isLoading()},s.loadNextPage=function(){return!isItemsLoaded||s.itemCollection.isFullyLoaded()||s.itemCollection.isLoading()?void 0:publicMediaRepository.loadItemCollectionNextPage(s.itemCollection)},s.search=SearchService(s,s.getItems,function(){return selectedItems.clear(),loadItems()}),s.canSearch=function(){return!0}}}.call(this),function(){var _base;this.MediaGallery||(this.MediaGallery={}),MediaGallery.publicMedia||(MediaGallery.publicMedia={}),(_base=MediaGallery.publicMedia).controllers||(_base.controllers={}),MediaGallery.publicMedia.controllers.ProceedCtrl=function(s,selectedItems,chooseItems){return s.proceed=function(){var category,data,parentCategory,_ref;if(s.canProceed())return data={source:"button"},s.selectedCategory?(parentCategory=null!=(_ref=s.selectedCategory)?_ref.getParent():void 0,category=s.selectedCategory,data.category=parentCategory||category,data.subcategory=parentCategory?category:void 0):(data.category=s.selectedFolder,data.subcategory=s.selectedSubFolder),selectedItems.values().then(function(items){return chooseItems.perform(items,data)})}}}.call(this),function(){var _base;this.MediaGallery||(this.MediaGallery={}),MediaGallery.publicMedia||(MediaGallery.publicMedia={}),(_base=MediaGallery.publicMedia).controllers||(_base.controllers={}),MediaGallery.publicMedia.controllers.StaticPublicMediaRootCtrl=function(eventNotifier,domainEventPublisher,s,location,q,repository,selectedItems,chooseItems){var deferred,isItemsLoaded,noMoreItemsInFolder,resolvedPromise;return MediaGallery.appLoadNotifiers.tabsSelected(),noMoreItemsInFolder=!1,isItemsLoaded=!1,s.selectItemAndProceed=function(item){return chooseItems.perform([item],{source:"doubleClick",category:s.selectedFolder,subcategory:s.selectedSubFolder})},s.isSelectedFolder=function(folder){return angular.equals(s.selectedFolder,folder)},s.selectFolder=function(folder){return s.selectedFolder=folder,s.selectSubFolder(folder.children[0])},s.getItems=function(){return s.items},s.getSelectedFolder=function(){return s.selectedFolder},s.canDrag=function(){return!1},s.isSelectedSubFolder=function(subFolder){return angular.equals(s.selectedSubFolder,subFolder)},s.selectSubFolder=function(subFolder){var promise;return selectedItems.clear(),s.selectedSubFolder=subFolder,s.page=0,s.items=[],noMoreItemsInFolder=!1,isItemsLoaded=!1,promise=s.loadItems(),q.when(promise)["finally"](function(){return isItemsLoaded=!0})},s.isItemsLoaded=function(){return isItemsLoaded},s.isSelectedItem=function(item){return selectedItems.has(item)},deferred=q.defer(),deferred.resolve(void 0),resolvedPromise=deferred.promise,s.loadItems=WixPix.Helpers.synchronize(function(){return noMoreItemsInFolder?resolvedPromise:(s.page+=1,repository.getItemsForSubFolder(s.selectedSubFolder,s.page,"").then(function(result){return eventNotifier("publicMediaItemsLoadingSucceeded"),0===result.items.length&&(noMoreItemsInFolder=!0),s.items=s.items.concat(result.items)},function(){throw eventNotifier("publicMediaItemsLoadingFailed"),"publicMediaItemsLoadingFailed"}))}),repository.getFolders().then(function(folders){return s.folders=folders,s.selectFolder(folders[0])})}}.call(this),function(){this.MediaGallery||(this.MediaGallery={}),MediaGallery.publicMedia||(MediaGallery.publicMedia={}),MediaGallery.publicMedia.Category=function(){function Category(id,title){this.id=id,this.title=title,this.children=[],this.parent=void 0}return Category.prototype.setParent=function(value){return this.parent=value},Category.prototype.getPathToRoot=function(){var node,parentLink,res;for(node=this,res=[node];void 0!==(parentLink=node.getParent());)res.unshift(parentLink),node=node.getParent();return res},Category.prototype.equal=function(o){var childrenChildren;return childrenChildren=_.zip(o.getChildren(),this.getChildren()),o.getId()===this.getId()&&o.getTitle()===this.getTitle()&&_.all(childrenChildren,function(cc){return cc[0]&&cc[1]?cc[0].equal(cc[1]):!1})},Category.prototype.getId=function(){return this.id},Category.prototype.getTitle=function(){return this.title},Category.prototype.addChild=function(child){return child.setParent(this),this.children.push(child)},Category.prototype.getChildren=function(){return this.children},Category.prototype.getParent=function(){return this.parent},Category.prototype.getBranchPathWithoutRoot=function(){return _.rest(this.getBranchPath())},Category.prototype.getBranchPath=function(){return this._leafNotRoot()?this.getParent().getPathToRoot():this.getPathToRoot()},Category.prototype.getBranchChildren=function(){return this._leafNotRoot()?this.getParent().getChildren():this.getChildren()},Category.prototype.isRoot=function(){return void 0===this.parent},Category.prototype.isLeaf=function(){return 0===this.children.length},Category.prototype._leafNotRoot=function(){return this.isLeaf()&&!this.isRoot()},Category}()}.call(this),function(){this.MediaGallery||(this.MediaGallery={}),MediaGallery.publicMedia||(MediaGallery.publicMedia={}),MediaGallery.publicMedia.PublicMediaRepository=function(q,mediaType,settings,publicMediaAdapter,sendWithRetry){var addPage,addPageToCollection,buildCategoryTree,buildItemsFromResponse,isWixOnly,language,loadCategoryTree,loadCategoryTreeByCategoryId,loadItemCollectionByCategory,loadItemCollectionBySearchQueryAndCategory,loadItemCollectionNextPage,notifyCategoryLoadedSuccessfully,notifyCategoryLoadingFailed,notifyItemsLoadedSuccessfully,notifyItemsLoadingBySearchFailed,notifyItemsLoadingFailed,notifySearchCompleted,observers,register,setIsWixOnly,setLanguage;return observers=[],language="en",isWixOnly=!1,register=function(listener){return observers.push(listener)},notifyCategoryLoadedSuccessfully=function(){return _.each(observers,function(o){return"function"==typeof o.publicMediaCategoryLoadingSucceeded?o.publicMediaCategoryLoadingSucceeded():void 0})},notifySearchCompleted=function(data){return _.each(observers,function(o){return"function"==typeof o.publicMediaSearchCompleted?o.publicMediaSearchCompleted(data):void 0})},notifyCategoryLoadingFailed=function(reason){return _.each(observers,function(o){return"function"==typeof o.publicMediaCategoryLoadingFailed?o.publicMediaCategoryLoadingFailed(reason):void 0})},notifyItemsLoadedSuccessfully=function(){return _.each(observers,function(o){return"function"==typeof o.publicMediaItemsLoadingSucceeded?o.publicMediaItemsLoadingSucceeded():void 0})},notifyItemsLoadingFailed=function(reason){return _.each(observers,function(o){return"function"==typeof o.publicMediaItemsLoadingFailed?o.publicMediaItemsLoadingFailed(reason):void 0})},notifyItemsLoadingBySearchFailed=function(reason){return _.each(observers,function(o){return"function"==typeof o.publicMediaItemsLoadingBySearchFailed?o.publicMediaItemsLoadingBySearchFailed(reason):void 0})},setLanguage=function(value){return language=value},setIsWixOnly=function(value){return isWixOnly=value},loadCategoryTree=function(){var rootCategoryName;return rootCategoryName=settings.getSettingsHash().publicMediaRootCategoryName,sendWithRetry(function(queryIndex){return publicMediaAdapter.loadCategoryByName(rootCategoryName,language,isWixOnly,queryIndex)},function(){}).then(function(data){return notifyCategoryLoadedSuccessfully(),buildCategoryTree(data)},function(reason){return notifyCategoryLoadingFailed(reason),q.reject(reason)})},loadCategoryTreeByCategoryId=function(categoryId){return publicMediaAdapter.loadCategoryById(categoryId,language,isWixOnly).then(function(data){return buildCategoryTree(data)})},buildCategoryTree=function(rawCategory){var buildCategory;return(buildCategory=function(rawCategory){var children,res;return res=new MediaGallery.publicMedia.Category(rawCategory.guid,rawCategory.title),children=rawCategory.children===[]?[]:_.map(rawCategory.children,buildCategory),_.each(children,function(child){return res.addChild(child)}),res})(rawCategory)},buildItemsFromResponse=function(response){var items,rawItems,thumbnailerFactory;return thumbnailerFactory=mediaType.getMediaType().getThumbnailerFactory(),rawItems=response.items,items=_.map(rawItems,function(rawItem){var isPublicMedia,item,thumbnailer;return thumbnailer=thumbnailerFactory("/media/"+rawItem.sourceUrl,rawItem.thumbnailUrl,rawItem.sourceUrl,isPublicMedia=!0),item={id:rawItem.guid,mediaType:rawItem.mediaType,fileName:rawItem.sourceUrl,iconUrl:rawItem.thumbnailUrl,title:rawItem.title,width:rawItem.width,height:rawItem.height,thumbnailer:thumbnailer},MediaGallery.Item(item)})},loadItemCollectionBySearchQueryAndCategory=function(category,query,itemCollection){var parentCategory;return null==itemCollection&&(itemCollection=MediaGallery.publicMedia.PublicItemCollection()),itemCollection.clear(),itemCollection.makeLoading(),parentCategory=null!=category?category.getParent():void 0,sendWithRetry(function(queryIndex){return publicMediaAdapter.loadItemsPageBySearchQueryAndCategoryId(query,category.getId(),language,isWixOnly,queryIndex)}).then(function(pageData){var items;return notifyItemsLoadedSuccessfully(),items=buildItemsFromResponse(pageData.data),notifySearchCompleted({query:query,category:parentCategory||category,subcategory:parentCategory?category:void 0,itemsCount:items.length,responseCode:pageData.responseCode},itemCollection.addPage(pageData.data.pageLink,items,pageData.data.nextPage)),itemCollection.finishLoading(),itemCollection},function(reason){return notifyItemsLoadingBySearchFailed(reason),itemCollection.finishLoading(),notifySearchCompleted({query:query,category:parentCategory||category,subcategory:parentCategory?category:void 0,itemsCount:0,responseCode:reason.status}),q.reject(reason)})},addPage=function(itemCollection,pageLink){return publicMediaAdapter.loadItemsPageByPageLink(pageLink).then(function(pageData){return addPageToCollection(itemCollection,pageData)})},addPageToCollection=function(itemCollection,pageData){var items;return items=buildItemsFromResponse(pageData.data),itemCollection.addPage(pageData.pageLink,items,pageData.data.nextPage),itemCollection},loadItemCollectionNextPage=function(itemCollection){return itemCollection.isFullyLoaded()?q.reject("LastPage"):(itemCollection.makeLoading(),sendWithRetry(function(queryIndex){return publicMediaAdapter.loadItemsPageByPageLink(itemCollection.getNextPageLink(),queryIndex)}).then(function(pageData){return notifyItemsLoadedSuccessfully(),addPageToCollection(itemCollection,pageData),itemCollection.finishLoading(),itemCollection},function(reason){return notifyItemsLoadingFailed(reason),itemCollection.finishLoading(),q.reject(reason)}))},loadItemCollectionByCategory=function(categoryId,collection){return null==collection&&(collection=MediaGallery.publicMedia.PublicItemCollection()),collection.clear(),collection.makeLoading(),sendWithRetry(function(queryIndex){return publicMediaAdapter.loadFirstItemsPageByCategoryId(categoryId,language,isWixOnly,queryIndex)}).then(function(pageData){return notifyItemsLoadedSuccessfully(),addPageToCollection(collection,pageData),collection.finishLoading(),collection},function(reason){return notifyItemsLoadingFailed(reason),collection.finishLoading(),q.reject(reason)})},{loadCategoryTree:loadCategoryTree,loadItemCollectionByCategory:loadItemCollectionByCategory,loadItemCollectionNextPage:loadItemCollectionNextPage,loadItemCollectionBySearchQueryAndCategory:loadItemCollectionBySearchQueryAndCategory,register:register,setLanguage:setLanguage,setIsWixOnly:setIsWixOnly}}}.call(this),function(){this.MediaGallery||(this.MediaGallery={}),MediaGallery.publicMedia||(MediaGallery.publicMedia={}),MediaGallery.publicMedia.StaticPublicMediaRepository=function(itemSource,notifyAndReject){var getFolders,getItemsForSubFolder;return getFolders=function(){return itemSource.getFolders().then(null,notifyAndReject("GetFolders"))},getItemsForSubFolder=function(folder,page,searchQuery){return null==page&&(page=1),itemSource.getItemsForSubFolder(folder,page,searchQuery).then(null,notifyAndReject("GetItemsForSubFolder"))},{getFolders:getFolders,getItemsForSubFolder:getItemsForSubFolder}}}.call(this),function(){var _base,_base1;this.MediaGallery||(this.MediaGallery={}),(_base=this.MediaGallery).search||(_base.search={}),(_base1=this.MediaGallery.search).directives||(_base1.directives={}),this.MediaGallery.search.directives.DelayedSearch=function($timeout){return{restrict:"E",scope:{canSearch:"=",search:"&",clearSearch:"&"},link:function(s){var timeoutPromise;
return s.previousQuery="",s.query="",null==s.canSearch&&(s.canSearch=!0),s.isEmpty=function(){return""===s.query},s.clearQuery=function(){return s.query=""},timeoutPromise=void 0,s.$watch("query",function(){return $timeout.cancel(timeoutPromise),timeoutPromise=$timeout(function(){return s.previousQuery!==s.query?(s.previousQuery=s.query,s.isEmpty()?s.clearSearch():s.search({query:s.query})):void 0},500)}),s.$on("clearSearch",function(){return s.query=""})},templateUrl:"scripts/modules/search/directives/delayed_search.html"}}}.call(this),function(){var _base,_base1;this.MediaGallery||(this.MediaGallery={}),(_base=this.MediaGallery).search||(_base.search={}),(_base1=this.MediaGallery.search).directives||(_base1.directives={}),this.MediaGallery.search.directives.SearchResultsTitle=function(){return{restrict:"E",scope:{searchQuery:"=",clearSearch:"&"},templateUrl:"scripts/modules/search/directives/search_results_title.html"}}}.call(this),function(){var _base,_base1;this.MediaGallery||(this.MediaGallery={}),(_base=this.MediaGallery).search||(_base.search={}),(_base1=this.MediaGallery.search).services||(_base1.services={}),this.MediaGallery.search.services.Search=function(q){return function(scope,getResults,search){var isSearching,searchQuery;return searchQuery="",isSearching=!1,{perform:function(query){return isSearching=!0,searchQuery=query,q.when(search())["finally"](function(){return isSearching=!1})},clear:function(){return scope.$broadcast("clearSearch"),this.perform("")},getQuery:function(){return searchQuery},isInProgress:function(){return isSearching},hasNoResults:function(){return""!==this.getQuery()&&0===getResults().length},hasResults:function(){return""!==this.getQuery()&&0!==getResults().length}}}}}.call(this),function(){var module;module=angular.module("apiSwitcher",["privateStaticApi","privateRestApi"]),module.factory("apiSwitcher.apis",["Settings","privateStaticApi.transactions.Upload","privateStaticApi.adapters.PrivateMedia","privateStaticApi.adapters.Upload","privateStaticApi.adapters.Folders","privateRestApi.transactions.Upload","privateRestApi.adapters.PrivateMedia","privateRestApi.adapters.Upload","privateRestApi.adapters.Folders","privateStaticApi.transactions.importItems","privateRestApi.transactions.importItems",this.WixPix.apiSwitcher.apis]),module.factory("apiSwitcher.transactions.Upload",["apiSwitcher.apis",function(apis){return apis.getUploadTransaction}]),module.factory("apiSwitcher.adapters.PrivateMedia",["apiSwitcher.apis",function(apis){return apis.getPrivateMediaAdapter}]),module.factory("apiSwitcher.adapters.Upload",["apiSwitcher.apis",function(apis){return apis.getUploadAdapter}]),module.factory("apiSwitcher.adapters.Folders",["apiSwitcher.apis",function(apis){return apis.getFoldersAdapter}])}.call(this),function(){var module;module=angular.module("base",[])}.call(this),function(){this.MediaGallery.externalServices.factory("getExternalServices",function(Settings,facebookService,flickrService,instagramService,picasaService){return function(){var services;return Settings.getSettingsHash().hasExternalMedia?(services=[],Settings.getSettingsHash().hasFacebook&&services.push(facebookService),Settings.getSettingsHash().hasFlickr&&services.push(flickrService),Settings.getSettingsHash().hasInstagram&&services.push(instagramService),Settings.getSettingsHash().hasPicasa&&services.push(picasaService),services):[]}})}.call(this),function(){var module;module=angular.module("import",["base"]),module.value("import.models.ImportableItem",this.MediaGallery["import"].models.ImportableItem),module.factory("import.services.items",["apiSwitcher.apis","import.models.ImportableItem","CloseUploadGuard","$q",this.MediaGallery["import"].services.Items]),module.factory("import.services.ImportAndProceed",["chooseItems","EventNotifier","uiNotifier","i18n",this.MediaGallery["import"].services.ImportAndProceed]),module.directive("itemsImportingProgress",this.MediaGallery["import"].directives.itemsImportingProgress)}.call(this),function(){var module,_this=this;module=angular.module("privateRestApi",[]),module.factory("privateRestApi.config",this.WixPix.privateRestApi.config),module.factory("privateRestApi.adapters.PrivateMedia",["privateRestApi.adapters.Folders","EventNotifier","ErrorNotifier","Urls","$http","$q","Timer","$log","allSettled","$timeout","Cache","Settings","MediaType","sendWithRetry",this.WixPix.privateRestApi.adapters.PrivateMedia]),module.factory("privateRestApi.adapters.Upload",["EventNotifier","ErrorNotifier","UploadsFile","Urls","$q","$log","MediaType","$http",this.WixPix.privateRestApi.adapters.Upload]),module.factory("privateRestApi.adapters.Folders",["$http","Urls","$q","sendWithRetry",this.WixPix.privateRestApi.adapters.Folders]),module.factory("privateRestApi.transactions.Upload",["privateRestApi.adapters.PrivateMedia","privateRestApi.adapters.Upload","$q","ItemFromStaticResponse","allSettled","generateUploadSessionId","OOPEventNotifier","MediaType","ErrorNotifier","sendWithRetry",function(privateMediaAdapter,uploadAdapter,q,itemFromStaticResponse,allSettled,generateUploadSessionId,oopEventNotifier,mediaType,errorNotifier,sendWithRetry){var t;return t=_this.WixPix.privateRestApi.transactions.Upload(privateMediaAdapter,uploadAdapter,q,itemFromStaticResponse,allSettled,generateUploadSessionId,mediaType,errorNotifier,sendWithRetry),t.register(oopEventNotifier),t}]),module.factory("privateRestApi.transactions.importItems",["BaseTransaction","privateRestApi.adapters.PrivateMedia","privateRestApi.adapters.Upload","$q","allSettled","ItemFromStaticResponse",this.WixPix.privateRestApi.transactions.ImportItems])}.call(this),function(){var module,_this=this;module=angular.module("privateStaticApi",[]),module.factory("JavaHttpClient",["$q","$http","HttpErrorInterceptor",WixPix.JavaHttpClient]),module.factory("privateStaticApi.adapters.PrivateMedia",["privateStaticApi.adapters.Folders","EventNotifier","ErrorNotifier","Urls","JavaHttpClient","$q","$log","Cache","Settings","MediaType",this.WixPix.privateStaticApi.adapters.PrivateMedia]),module.factory("privateStaticApi.adapters.Upload",["EventNotifier","ErrorNotifier","UploadsFile","Urls","$q","$log","$http","MediaType",this.WixPix.privateStaticApi.adapters.Upload]),module.factory("privateStaticApi.adapters.Folders",["JavaHttpClient","Urls","$q","generateUUID",this.WixPix.privateStaticApi.adapters.Folders]),module.factory("privateStaticApi.transactions.Upload",["privateStaticApi.adapters.PrivateMedia","privateStaticApi.adapters.Upload","$q","ItemFromStaticResponse","allSettled","generateUploadSessionId","OOPEventNotifier","Settings",function(privateMediaAdapter,uploadAdapter,q,itemFromStaticResponse,allSettled,generateUploadSessionId,oopEventNotifier,settings){var t;return t=_this.WixPix.privateStaticApi.transactions.Upload(privateMediaAdapter,uploadAdapter,q,itemFromStaticResponse,allSettled,generateUploadSessionId,settings),t.register(oopEventNotifier),t}]),module.factory("privateStaticApi.transactions.importItems",["BaseTransaction","privateStaticApi.adapters.PrivateMedia","privateStaticApi.adapters.Upload","$q","allSettled","ItemFromStaticResponse",this.WixPix.privateStaticApi.transactions.ImportItems])}.call(this),function(){var module;module=angular.module("publicMedia",["base"]),module.factory("StaticPublicMediaAdapter",["$http","$q","Urls","MediaType","Settings","ErrorNotifier","HttpErrorInterceptor",MediaGallery.publicMedia.StaticPublicMediaAdapter]),module.factory("NoopPublicMediaAdapter",["$q",MediaGallery.publicMedia.NoopPublicMediaAdapter]),module.factory("StaticPublicMediaRepository",["StaticPublicMediaAdapter","notifyAndReject",MediaGallery.publicMedia.StaticPublicMediaRepository]),module.factory("ApiPublicMediaRepository",["$q","Urls","Settings","MediaType","i18n","$http","OOPEventNotifier","sendWithRetry",function(q,urls,settings,mediaType,i18n,http,biEventNotifier,sendWithRetry){var repo;return repo=MediaGallery.publicMedia.PublicMediaRepository(q,mediaType,settings,MediaGallery.publicMedia.PublicMediaJSONPAdapter(q,urls,http),sendWithRetry),repo.setLanguage(i18n.getLang()),repo.setIsWixOnly(settings.isWixUser()),repo.register(biEventNotifier),repo}]),module.controller("publicMedia.ctrls.StaticPublicMediaRootCtrl",["EventNotifier","$rootScope","$scope","$location","$q","StaticPublicMediaRepository","selectedItems","chooseItems",this.MediaGallery.publicMedia.controllers.StaticPublicMediaRootCtrl]),module.controller("publicMedia.ctrls.BreadcrumbsDynamicPublicMediaRootCtrl",["$scope","ApiPublicMediaRepository","selectedItems","chooseItems","search.services.Search",this.MediaGallery.publicMedia.controllers.BreadcrumbsDynamicPublicMediaRootCtrl]),module.controller("publicMedia.ctrls.DynamicPublicMediaRootCtrl",["$scope","ApiPublicMediaRepository","selectedItems","chooseItems","search.services.Search","ErrorNotifier",this.MediaGallery.publicMedia.controllers.DynamicPublicMediaRootCtrl]),module.controller("publicMedia.ctrls.ProceedCtrl",["$scope","selectedItems","chooseItems",this.MediaGallery.publicMedia.controllers.ProceedCtrl])}.call(this),function(){var module;module=angular.module("search",["base"]),module.factory("search.services.Search",["$q",this.MediaGallery.search.services.Search]),module.directive("wixDelayedSearch",["$timeout",this.MediaGallery.search.directives.DelayedSearch]),module.directive("wixSearchResultsTitle",["$timeout",this.MediaGallery.search.directives.SearchResultsTitle])}.call(this),angular.module("templates",[]).run(["$templateCache",function($templateCache){"use strict";$templateCache.put("_footer.html",'<div class="selection" ng-controller="MediaGallery.privateMedia.SelectionCtrl">\n  <div ng-switch on="supportsMultipleItems()">\n    <div ng-switch-when="true">\n      <div ng-switch on="selectedCount()">\n        <div ng-switch-when="0"></div>\n        <div ng-switch-when="1">{{ \'selected_items.single_selected\' | translate }}</div>\n        <div ng-switch-default>{{ \'selected_items.multiple_mode.multiple_selected\' | translate:selectedCount()}}</div>\n      </div>\n    </div>\n    <div ng-switch-default>\n      <div ng-switch on="selectedCount()">\n        <div ng-switch-when="0"></div>\n        <div ng-switch-when="1">{{ \'selected_items.single_selected\' | translate }}</div>\n        <div ng-switch-default>{{ \'selected_items.single_mode.multiple_selected\' | translateSelection:selectedCount() }}</div>\n      </div>\n    </div>\n  </div>\n</div>\n'),$templateCache.put("_header.html",'<a class="close" href="" ng-controller="MediaGallery.ProtocolCtrl.Cancel" ng-click="proceed()" on-keyup="proceed()" keys="[27]"><i></i></a>\n<a class="help" ng-controller="MediaGallery.ProtocolCtrl.Help" href="{{ \'help_url\' | translate }}" ng-click="proceed()" target="_blank"><i></i></a>\n<h1>{{ \'header\' | translate }}</h1>\n<nav ng-controller="MediaGallery.SettingsCtrl">\n  <div class="buttons-container">\n\n    <div class=\'upload-button-wrapper\'\n         ng-show="canShowPrivate()">\n      <a class="upload"\n         ng-controller="MediaGallery.privateMedia.UploadCtrl"\n         wix-upload\n         wix-files-choosen="handleFileSelect(files)"\n         accept="{{getAcceptedFileTypes()}}"\n         wix-bi-event="{ click: \'uploadButtonClicked\' }"\n         wix-flash-fallback-button="upload"\n         wix-flash-accept="{{getFlashAcceptedFileTypes()}}"\n         wix-flash-static-code="{{getStaticCode()}}"\n         wix-flash-media-type="{{getMediaTypeName()}}"\n         wix-folder-id="{{getSelectedFolder().getId()}}"\n          >\n        <i></i>{{ \'upload\' | translate }}\n      </a>\n    </div>\n    <div ng-controller="externalServices.ctrls.Services" ng-show="canShowExternal()">\n      <external-services-list services="services" connect-service="connectTo(service)" disconnect-service="disconnectFrom(service)" />\n    </div>\n  </div>\n  <div class="description">\n    <p ng-if="!canShowExternalForFree()">\n      {{ \'description.first\' | translate }}\n    </p>\n    <p ng-if="canShowExternalForFree()">\n      {{ \'description.with_external_for_free.first\' | translate }}\n    </p>\n    <p ng-if="!canShowExternal()">\n      {{ \'description.second\' | translate }}\n    </p>\n    <p ng-if="canShowExternal()">\n      {{ \'description.with_external.second\' | translate }}\n    </p>\n  </div>\n  <ul>\n    <li ng-show="canShowPrivate()" ng-class="{ active: isCurrentTab(\'my\') }">\n      <a href="#/my" wix-bi-event="{ click: {name: \'tabClicked\', attributes:{name: \'private\'}} }">{{ \'private_media\' | translate }}</a>\n    </li>\n    <li ng-show="canShowFree()" ng-class="{ active: isCurrentTab(\'publicMedia\') }">\n      <a href="#/{{publicMediaPath}}"  wix-bi-event="{ click: {name: \'tabClicked\', attributes:{name: \'public\'}} }">\n        <span ng-bind-html="publicMediaTabName"></span>\n      </a>\n    </li>\n    <li ng-show="canShowExternalForFree()"\n        ng-class="{ active: isCurrentTab(\'external_for_free\') }">\n      <a href="#/external_for_free"\n         wix-bi-event="{ click: {name: \'tabClicked\', attributes:{name: \'external_for_free\'}} }">\n        <span>\n          {{ \'external_free_images\' | translate }}\n        </span>\n      </a>\n    </li>\n    <li ng-show="canShowPhotoStock()"\n        ng-class="{ active: isCurrentTab(\'photo_stock\') }">\n      <a href="#/photo_stock"\n         wix-bi-event="{ click: {name: \'tabClicked\', attributes:{name: \'photo_stock\'}} }">\n        <span>\n          {{ \'photo_stock_title_b\' | translate }}\n        </span>\n      </a>\n    </li>\n  </ul>\n</nav>\n'),$templateCache.put("_notifications.html","\n<ul class='notifications'\n    ng-controller=\"MediaGallery.NotificationsCtrl\" ng-show=\"notifications.length > 0\">\n  <li class='{{notification.type}}'\n      ng-repeat='notification in notifications track by notification.id'\n      ng-animate=\"{leave:'.expire'}\"\n  <span>{{notification.message}}</span>\n  <a class='expire-notification' href=\"\" ng-click='expire(notification)'>&times;</a>\n  </li>\n</ul>"),$templateCache.put("_proceed.html",'<div ng-controller="MediaGallery.ProtocolCtrl.Items">\n  <a wix-tooltip="{posy:\'top\', posx:\'right\', content:\'.proceed-error\', centered:false, event:\'mouseenter\', style:\'error\'}" class="change-image" wix-disabled="!canProceed()" ng-click="proceed()">\n    {{ buttonName() | translate }}\n  </a>\n  <div class="tooltip proceed-error">\n    {{proceedError()}}\n  </div>\n</div>\n'),$templateCache.put("_uploads.html",'<div class="uploads" ng-show="canShowUploads()">\n  <div class="chunk" ng-repeat="(index, chunk) in filesToUpload.chunks()">\n    <a href="" ng-click="clearUploads(chunk.folder.getName())" ng-show="canHideUploads(chunk.folder.getName())" class="close-uploads">&times;</a>\n    <h2>\n      {{ chunk | translateUploadingTo }}\n    </h2>\n    <ul>\n      <li ng-class="filePreviewClass(fileToUpload)"\n          ng-repeat="fileToUpload in chunk.files"\n          ng-animate="{hide: \'.fade-leave\', enter: \'.scroll-to-chunk\'}"\n          ng-show="!fileToUpload.isInFolder()">\n        <div class="image">\n          <div class="no-pic {{getMediaTypeName()}}" ></div>\n          <div class="error-description">\n            {{ \'private_media.not_an_image\' | translate }}\n          </div>\n          <div class="upload-error" wix-tooltip="{posy:\'top\', posx:\'left\', content:\'.upload-error-tooltip\', centered:false, event:\'mouseenter\', style:\'error\'}">\n            {{ \'private_media.upload_error.upload_failed\' | translate }}\n          </div>\n          <div class="tooltip upload-error-tooltip">\n            <div>{{ fileToUpload.getFailureReason() | translateUploadFailureReason }}</div>\n            <a href="" ng-click="retry(fileToUpload)" ng-show="supportsHtml5Uploads && isRetryable(fileToUpload.getFailureReason())">\n              {{ \'private_media.upload_error.retry\' | translate }}\n            </a>\n          </div>\n          <div class="success-indicator"></div>\n          <img alt="" ng-src="{{fileToUpload.getPreview().src}}"/>\n        </div>\n        <div class="feedback">\n          <div class="progress">\n            <div class="bar" ng-style="{ width: fileToUpload.percentUploaded + \'%\' }"></div>\n          </div>\n          <span>{{fileToUpload.getName()}}</span>\n        </div>\n      </li>\n    </ul>\n    <div class="retry-container" ng-if="hasRetriable(chunk.files)">\n      <a class="btn retry-all" href="" ng-click="retryAll(chunk.files)">\n        {{ \'private_media.upload_error.retryAll\' | translate }}\n      </a>\n    </div>\n  </div>\n</div>'),$templateCache.put("change-image-tooltip.html",'<div class="tooltip" wix-tooltip>{{proceedError()}}</div>\n'),$templateCache.put("dragged-item-preview.html",'<div class="drag">\n  <div class="stack-1" ng-show="selection.hasMultipleItems()"></div>\n  <div class="stack-2" ng-show="selection.hasMultipleItems()"></div>\n  <div class="image">\n    <img ng-src="{{item.getThumbnailer().makeThumbnail()}}" alt="">\n    <div class="drag-num" ng-show="selection.hasMultipleItems()">{{selection.selectedItemsSize()}}</div>\n  </div>\n</div>'),$templateCache.put("edit-folder-tooltip.html",'<div class="tooltip" wix-tooltip>\n  <a class="rename-folder" ng-click="renameFolder(folder)" ng-controller="MediaGallery.privateMedia.RenameCtrl">Rename</a>\n  <a class="remove-folder" ng-click="removeFolder(folder)">Remove folder</a>\n</div>\n'),$templateCache.put("edit_or_download.html",'<a class=\'edit-item\'\n   ng-show="canUseAviary"\n   href=""\n   ng-click="editItem(item)"\n   wix-bi-event="{ click: \'privateMediaEditItemClicked\' }">\n    {{ \'private_media.edit\' | translate }}\n</a>\n<a class=\'download-item\'\n   wix-bi-event="{ click: \'privateMediaDownloadItemClicked\' }"\n   title="{{item.title}}"\n   download="{{item.title}}"\n   ng-click="download(item)"\n   target="_blank">\n   {{ \'private_media.download\' | translate }}\n </a>\n<!-- {{ linkToDownloadable(item) }} -->\n'),$templateCache.put("external_image_magnifying_glass.html",'<div class="peek-wrapper">\n  <a class="peek" wix-show-preview preview-name="{{item.getTitle()}}"\n     preview-url="{{item.getThumbnailer().makePreview()}}">Peek</a>\n</div>'),$templateCache.put("font_magnifying_glass.html",'<div class="peek-wrapper">\n  <a class="peek" href="" wix-show-font-preview preview-name="{{item.getTitle()}}" preview-url="{{item | previewUrlOfSize:375:275:\'srb\'}}">Peek</a>\n</div>\n'),$templateCache.put("magnifying_glass.html",'<div class="peek-wrapper">\n  <a class="peek"\n     href=""\n     wix-show-preview\n     preview-subtitle="{{\'private_media.zoom_preview.image_size\' | translate}}: {{item.width}} x {{item.height}}"\n     preview-name="{{item.getTitle()}}"\n     preview-url="{{item | previewUrlOfSize:375:275:\'srb\'}}">Peek</a>\n</div>\n'),$templateCache.put("my_folders.html",'<header ng-include="\'_header.html\'"></header>\n<div class="content" ng-controller="MediaGallery.privateMedia.UploadCtrl">\n  <ul class="actions" ng-if="!isAnyExternalServiceSelected()">\n    <li>\n\n      <wix-delayed-search\n          can-search="canSort()"\n          search="search.perform(query)"\n          clear-search="search.clear()"\n          ></wix-delayed-search>\n    </li>\n    <li>\n      <wix-sort-by\n          can-sort="canSort()"\n          selected-field="getSelectedSortField()"\n          fields="sortFields"\n          bi-prefix="privateMedia"\n          select-field="selectSortField(field)"\n          ></wix-sort-by>\n    </li>\n    <li>\n      <a class="remove-images" ng-controller="MediaGallery.privateMedia.RemoveItemsCtrl" wix-disabled="!canRemoveSelectedItems()" ng-click="removeSelectedItems()"><i></i></a>\n    </li>\n    <li>\n      <wix-select-all\n          can-toggle-selection="canToggleSelection()"\n          is-all-selected="isAllItemsSelected()"\n          select-all="selectAllItems()"\n          select-none="selectNoneItems()"\n          ></wix-select-all>\n    </li>\n  </ul>\n  <div class="main" ng-controller="MediaGallery.SettingsCtrl" ng-class="{ \'no-sidebar\' : !canShowFolders() }">\n    <div ng-show="canShowFolders()" class="folders" ng-controller="MediaGallery.privateMedia.FoldersListCtrl">\n      <div class="collections">\n        <ul>\n          <li ng-class="{ current : selectedAll }">\n            <a class="title all-media" ng-click="selectAll()" wix-bi-event="{ click: \'privateMediaAllItemsClicked\' }">\n              <span class=\'folder-name\'>{{ \'private_media.all\' | translate }}</span>\n              <span class="size" ng-bind="getAllItemsCount()"></span>\n            </a>\n          </li>\n        </ul>\n\n        <!-- Unsorted folder -->\n        <folders-list get-folders="getSystemFolders()"\n                      items-count="getFolderSize(folder)"\n                      can-show-actions="canShowActions(folder)"\n                      on-drop="moveSelectedItems(folder)"\n                      select="selectFolder(folder)"\n                      selected="selectedFolder"\n                      rename="renameFolder(folder, newName, flow)"\n                      remove="removeFolder(folder)"></folders-list>\n\n        <!-- External services -->\n        <folders-list class="external-service"\n                      ng-if="canShowExternal()"\n\n                      get-folders="getExternalServices()"\n                      items-count="getExternalServiceItemsCount(folder)"\n                      on-drop="notifyCantMoveToExternalService(folder)"\n                      select="selectExternalService(folder)"\n                      selected="getSelectedExternalService()"></folders-list>\n\n\n        <!-- User folders -->\n        <folders-list get-folders="getUserFolders()"\n                      items-count="getFolderSize(folder)"\n                      can-show-actions="canShowActions(folder)"\n                      on-drop="moveSelectedItems(folder)"\n                      select="selectFolder(folder)"\n                      selected="selectedFolder"\n                      rename="renameFolder(folder, newName, flow)"\n                      remove="removeFolder(folder)"></folders-list>\n        <ul>\n          <li class="add-folder" ng-class="{ active : isAddingFolder }">\n            <form>\n              <input type="text" folder-name-validate ng-model="folderName" focus-me="isAddingFolder" wix-click-outside-and-commit="addFolder(flow)" />\n              <input type="button" ng-click="cancel()" value="&times;"/>\n              <!-- <input type="submit" value=""/> -->\n            </form>\n          </li>\n        </ul>\n      </div>\n\n      <div class="add-folder" ng-class="{ active : isAddingFolder }">\n        <a ng-click="newFolder()" wix-bi-event="{ click: \'privateMediaNewFolderClicked\' }"><i></i>{{ \'private_media.new_folder\' | translate }}</a>\n      </div>\n\n    </div>\n\n\n\n    <!-- Private Media -->\n\n    <article\n        ng-if="!isAnyExternalServiceSelected()"\n        file-droppable="handleFileSelect(files)"\n        when-scrolled="showMoreItems()"\n        wix-bi-event="{ drop: { name: \'itemsDropped\', attributes: { tab: \'private\', selectedFolder: selectedFolder.getName(), hadItems: items.length > 0 } } }">\n\n\n      <div class="loading" ng-show="!isItemsLoaded()"></div>\n\n      <div ng-include="\'_uploads.html\'"></div>\n\n      <wix-no-items\n          ng-show="search.hasNoResults() && !search.isInProgress() && isItemsLoaded()"\n\n          template-name="no-search-results"\n          search-query="search.getQuery()"\n          folder-name="{{selectedFolderName()}}"\n          ></wix-no-items>\n\n      <div class="gallery private">\n\n        <wix-search-results-title\n            ng-show="search.hasResults() && !search.isInProgress() && isItemsLoaded()"\n\n            search-query="search.getQuery()"\n            clear-search="search.clear()"\n            ></wix-search-results-title>\n\n        <div ng-include="\'_notifications.html\'"></div>\n\n\n        <responsive-grid-items\n            ng-if="!hasNoItems()"\n\n            get-items="getItems"\n            get-folder="getSelectedFolder"\n            bi-prefix="privateMedia"\n            magnifying-glass-template="{{magnifyingGlassTemplate}}"\n\n            double-click="selectItemAndProceed(item)"\n\n            can-edit="canEditItemAtAviary(item)"\n            edit="editItemAtAviary(item)"\n\n            can-rename="canRenameItem(item)"\n            rename="renameItem(item, newName, flow)"\n\n            can-remove="canRemoveItem(item)"\n            remove="removeItem(item)"\n\n            can-download="canDownloadItem(item)"\n            get-download-link="linkToDownloadable(item)"\n\n            can-drag="canDrag(item)"\n            ></responsive-grid-items>\n\n      </div>\n      <div ng-controller="MediaGallery.privateMedia.UploadCtrl">\n        <wix-no-items\n            template-name="{{noItemsTemplate}}"\n            on-files-choose="handleFileSelect(files)"\n            can-upload-files="supportsHtml5Uploads"\n            accept-files-types="getAcceptedFileTypes()"\n            folder-name="{{selectedFolderName()}}"\n            ng-show="hasNoItems() && isItemsLoaded() && !search.hasNoResults() && !(canShowExternal() && isWorkStart())"></wix-no-items>\n\n        <wix-no-items\n            template-name="start-work"\n            on-files-choose="handleFileSelect(files)"\n            can-upload-files="supportsHtml5Uploads"\n            accept-files-types="getAcceptedFileTypes()"\n            connect-external-services="connectExternalServices()"\n            ng-show="canShowExternal() && isWorkStart() && !search.hasNoResults()"></wix-no-items>\n\n      </div>\n\n    </article>\n\n    <!-- External services -->\n    <div class="gallery external"\n         ng-if="isAnyExternalServiceSelected()"\n         ng-include="\'scripts/modules/external_services/external_services.html\'">\n\n    </div>\n\n    <div class="clearfix"></div>\n  </div>\n  <footer>\n    <div ng-include="\'_footer.html\'"></div>\n    <div ng-controller="MediaGallery.ProtocolCtrl.Items">\n      <div ng-controller="MediaGallery.privateMedia.ProceedCtrl">\n        <a wix-tooltip="{posy:\'top\', posx:\'right\', content:\'.proceed-error\', centered:false, event:\'mouseenter\', style:\'error\'}" class="change-image" wix-disabled="!canProceed()" ng-click="proceed()">\n          {{ buttonName() | translate }}\n        </a>\n        <div class="tooltip proceed-error">\n          {{proceedError()}}\n        </div>\n      </div>\n    </div>\n\n  </footer>\n</div>\n'),$templateCache.put("oauth_redirect_end.html",'<!doctype html>\n<html lang="en">\n<head>\n  <meta charset="utf-8">\n  <title>Finishing authentication</title>\n</head>\n<body>\n  <p>Finishing authentication...</p>\n\n  <script>\n\n    function readCookie(name) {\n        var nameEQ = name + "=";\n        var ca = document.cookie.split(\';\');\n        for(var i=0;i < ca.length;i++) {\n            var c = ca[i];\n            while (c.charAt(0)==\' \') {\n                c = c.substring(1,c.length);\n            }\n            if (c.indexOf(nameEQ) == 0) {\n                return c.substring(nameEQ.length,c.length);\n            }\n        }\n        return null;\n    }\n\n    function eraseCookie(name) {\n        var date = new Date();\n        date.setTime(date.getTime() - 1000);\n        var expires = "; expires=" + date.toGMTString();\n        document.cookie = name + "="  + expires + "; path=/";\n    }\n\n    var oauthCallback = readCookie(\'oauthCallback\');\n\n    // remove old cookie oauthCallback parameter\n    document.cookie = eraseCookie(\'oauthCallback\');\n\n    // redirecting with the same GET and hash to this page\n    document.location.href = oauthCallback + document.location.search + document.location.hash;\n  </script>\n</body>\n</html>\n'),$templateCache.put("oauth_redirect_start.html","<!doctype html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"utf-8\">\n  <title>Starting authentication</title>\n</head>\n<body>\n  <p>Starting authentication...</p>\n\n  <script>\n    function createCookie(name, value) {\n        document.cookie = name + \"=\" + value + \"; path=/\";\n    }\n\n    function urlParameter (name) {\n        var pattern = new RegExp(name + '=([^&]+)'),\n            result = document.location.search.match(pattern);\n        return result && result[1] ? decodeURIComponent(result[1]) : null;\n    }\n\n    var callbackUrl = urlParameter('callbackUrl');\n\n    // remove old and set new cookie oauthCallback parameter\n    createCookie('oauthCallback', callbackUrl);\n\n    document.location.href = urlParameter('redirectUrl');\n  </script>\n</body>\n</html>\n"),$templateCache.put("runner.html",'<!doctype html>\n<html lang="en">\n  <head>\n    <title>End2end Test Runner</title>\n    <script src="vendor/angular-scenario.js" ng-autotest></script>\n    <script src="scenarios.js"></script>\n  </head>\n  <body>\n  </body>\n</html>'),$templateCache.put("shape_magnifying_glass.html",'<div class="peek-wrapper">\n  <a class="peek" wix-show-shape-preview preview-name="{{item.getTitle()}}" preview-url="{{item | previewUrlOfSize:375:275:\'srb\'}}">Peek</a>\n</div>\n\n'),$templateCache.put("scripts/directives/actions/select_all.html",'<div class="toggle-all-items-selection dropdown"\n     ng-class="{\'selected\': isAllSelected}"\n     wix-disabled="!canToggleSelection">\n  <div class="checkbox-area"\n       ng-click="toggleSelection()">\n    <input type="checkbox"\n           ng-checked="isAllSelected"\n           ng-disabled="!canToggleSelection"/>\n  </div>\n  <a class="dropdown-toggle"\n     wix-disabled="!canToggleSelection"></a>\n  <div class="dropdown-menu bottom">\n    <div class="arrow"></div>\n    <div class="popover-content">\n      <a ng-click="selectAll()">{{ \'private_media.select_all\' | translate }}</a>\n      <a ng-click="selectNone()">{{ \'private_media.select_none\' | translate }}</a>\n    </div>\n  </div>\n</div>'),$templateCache.put("scripts/directives/actions/sort_by.html",'<span class="sort-by">\n  <a  ng-repeat="field in fields"\n      wix-disabled="!canSort"\n      ng-click="selectField({field: field})"\n      ng-class="{ active : isSelected(field) }"\n      wix-bi-event="{ click: biPrefix + field.biEventName }">{{ field.translationKey | translate }}</a>\n</span>'),$templateCache.put("scripts/directives/folders_list/folders_list.html",'\n<ul>\n  <li class="tooltip-parent"\n      ng-repeat="folder in getFolders() | orderBy:sortOrder"\n      ng-class="{ current : isSelected(folder) }"\n      jqui-drop-commit="onDrop({folder: folder})"\n\n      title="{{folder.getName() == \'/\' ? \'\' : folder.getName()}}">\n\n    <renamable-folder-name\n        folder="folder"\n        rename="rename({folder: folder, newName: newName, flow: flow})"\n        select="select({folder: folder})"\n        is-renaming="isRenaming(folder)"\n        cancel-renaming="cancelRenaming()"\n        items-count="itemsCount({folder: folder})"></renamable-folder-name>\n\n    <a ng-if=\'folder.getName() != "/"\' href=""\n       class="edit-folder"\n       ng-hide="isRenaming(folder) || !canShowActions({folder: folder})"\n'+"       wix-tooltip=\"{posy:'bottom', posx:'right', content:'.edit-folder-actions', centered:'true', event:'click', parent:'.tooltip-parent', style:'menu'}\">#</a>\n    <div class=\"tooltip edit-folder-actions\" ng-switch on=\"canShowActions({folder: folder})\">\n      <div ng-switch-when='true'>\n        <a class=\"rename-folder\"\n           ng-click=\"showRenaming(folder)\"\n           wix-bi-event=\"{ click: biPrefix + 'RenameFolderClicked' }\">{{ 'private_media.folders.rename' | translate }}</a>\n        <a class=\"remove-folder\"\n           ng-click=\"remove({folder: folder})\"\n           wix-bi-event=\"{ click: biPrefix + 'RemoveFolderClicked' }\">{{ 'private_media.folders.remove' | translate }}</a>\n      </div>\n      <div ng-switch-when='false' class='no-folder-actions'>\n        Rename or delete&br;are forbidden while uploading\n      </div>\n    </div>\n  </li>\n</ul>"),$templateCache.put("scripts/directives/folders_list/renamable_folder_name.html",'\n<a class="title"\n   ng-hide="isRenaming"\n   ng-click="select({folder: folder})"\n   wix-bi-event="{ click: biPrefix + \'FolderClicked\' }"\n   ng-class="{unsorted: folder.getName() == \'/\'}">\n  \n  <span ng-if=\'folder.getName() == "/"\' class=\'folder-name\'>\n    {{ \'private_media.unsorted\' | translate }}\n  </span>\n  <span  ng-if=\'folder.getName() != "/"\' class="folder-name">\n    {{folder.getName()}}\n  </span>\n  <span class="size" ng-bind="itemsCount" ng-show="itemsCount != null"></span>\n</a>\n\n<form class="rename-folder">\n\n  <input folder-name-validate\n         wix-click-outside-and-commit="rename({folder: folder, newName: folderName, flow: flow})"\n         ng-model="folderName"\n         type="text"/>\n\n  <input type="button" ng-click="cancelRenaming({folder: folder})" value="&times;"/>\n</form>'),$templateCache.put("scripts/directives/items_list/item_actions.html",'\n<div class="image-actions-wrapper">\n\n  <div class="image-actions">\n\n\n    <div wix-conditional-template="{{magnifyingGlassTemplate}}"/>\n\n    <a class="edit-image-toggle"\n       ng-show="canShowActions()"\n       wix-tooltip="{posy:\'bottom\', posx:\'right\', content:\'.edit-image\', centered:\'true\', event:\'click\', parent:\'.tooltip-parent\', style:\'menu\', fitToElement: \'window\'}">\n      Edit\n    </a>\n    <div class="tooltip edit-image">\n\n      <a class="rename-item"\n         ng-if="canRename"\n         ng-click="showRenaming({item: item})"\n         wix-bi-event="{ click: biPrefix + \'EditItemClicked\' }">\n        {{ \'private_media.items.rename\' | translate }}\n      </a>\n\n      <a class="edit-item"\n         ng-if="canEdit"\n         ng-click="edit({item: item})"\n         wix-bi-event="{ click: biPrefix + \'EditItemClicked\' }">\n        {{ \'private_media.edit\' | translate }}\n      </a>\n\n      <a class=\'download-item\'\n         ng-if="canDownload"\n         title="{{item.getTitle() || \'Untitled\'}}"\n         download="{{item.getTitle() || \'Untitled\'}}"\n         href="{{ getDownloadLink({item: item}) }}"\n         target="_blank"\n         wix-bi-event="{ click: biPrefix + \'DownloadItemClicked\' }">\n        {{ \'private_media.download\' | translate }}\n      </a>\n\n      <a class="remove-item"\n         ng-if="canRemove"\n         ng-click="remove({item: item})"\n         wix-bi-event="{ click: biPrefix + \'RemoveItemClicked\' }">\n        {{ \'private_media.items.remove\' | translate }}\n      </a>\n    </div>\n  </div>\n\n</div>\n\n\n'),$templateCache.put("scripts/directives/items_list/renamable_item_name.html",'\n<span class="name" ng-hide="isRenaming">\n  {{item.getTitle()}}\n</span>\n\n<form class="rename-item">\n\n  <input item-name-validate\n         type="text"\n         wix-click-outside-and-commit="rename({item: item, newName: itemName, flow: flow})"\n         ng-model="itemName"/>\n\n</form>'),$templateCache.put("scripts/directives/items_list/responsive_grid_items.html",'<ul class=\'items\' grid-columns=\'5\' wix-responsive-grid=\'{{getItems().length}}\'>\n  <li class="tooltip-parent {{item.sourceName}} {{item.getMediaType() || item.getSourceType()}}"\n\n      ng-repeat="item in getItems()"\n      ng-class="{ selected: isSelected(item) }"\n      ng-dblclick="doubleClick({item: item})"\n\n      jqui-can-drag="canDrag(item)"\n      jqui-drag-begin="dragStart(item)"\n\n      wix-select-item\n      jqui-helper="selectionHelper(item)"\n      item="item"\n      get-all-items="getItems"\n\n      title="{{item.getTitle()}}">\n\n\n    <item-actions\n        item="item"\n        magnifying-glass-template="magnifyingGlassTemplate"\n\n        can-edit="canEdit({item: item})"\n        can-remove="canRemove({item: item})"\n        can-rename="canRename({item: item})"\n        can-download="canDownload({item: item})"\n\n        edit="edit({item: item})"\n        remove="remove({item: item})"\n        show-renaming="showRenaming(item)"\n        get-download-link="getDownloadLink({item: item})"></item-actions>\n\n\n    <div class=\'transcoding-status\'\n         ng-class=\'item.getTranscodingStatus().toLowerCase()\'>\n     <span>\n       {{ \'private_media.items.transcoding_status\' | translate }}\n       <br>\n       {{item.getTranscodingStatus().toLowerCase()}}\n     </span>\n    </div>\n\n\n    </div>\n    <div class="image-wrapper"\n         covered-background="{{item.getThumbnailer().makeThumbnail()}}"></div>\n\n    <wix-renamable-item-name\n        item="item"\n        rename="rename({item: item, newName: newName, flow: flow})"\n        is-renaming="isRenaming(item)"\n        cancel-renaming="cancelRenaming()"></wix-renamable-item-name>\n  </li>\n</ul>'),$templateCache.put("scripts/directives/no_items/_start-work_connect_social.html","<a ng-click=\"connectExternalServices()\"\n    >{{ 'private_media.start_work.social_networks' | translate }}</a>"),$templateCache.put("scripts/directives/no_items/_start-work_upload.html",'<a wix-upload\n  accept="{{acceptFilesTypes}}"\n  wix-files-choosen="onFilesChoose({files: files})"\n  wix-bi-event="{ click: \'uploadButtonInEmptyFolderClicked\' }"\n  >{{ \'private_media.start_work.desktop\' | translate }}</a>'),$templateCache.put("scripts/directives/no_items/_upload.html",'<a wix-upload\n   accept="{{acceptFilesTypes}}"\n   wix-files-choosen="onFilesChoose({files: files})"\n   wix-bi-event="{ click: \'uploadButtonInEmptyFolderClicked\' }">{{ \'upload\' | translate }}</a>\n'),$templateCache.put("scripts/directives/no_items/no-documents.html","<div class=\"no-images no-documents\">\n  <h3>{{ 'private_media.no_items.header' | translate:folderName }}</h3>\n  <p ng-show=\"canUploadFiles\">\n    {{ 'private_media.no_items.text' | translate }}\n\n    <span ng-include=\"'scripts/directives/no_items/_upload.html'\"></span>\n  </p>\n</div>"),$templateCache.put("scripts/directives/no_items/no-external-images.html","<div class=\"no-images\">\n  <h3>{{ 'private_media.no_items.header' | translate:folderName }}</h3>\n</div>"),$templateCache.put("scripts/directives/no_items/no-fonts.html","<div class=\"no-images no-fonts\">\n  <h3>{{ 'private_media.no_items.header' | translate:folderName }}</h3>\n  <p ng-show=\"canUploadFiles\">\n    {{ 'private_media.no_items.text' | translate }}\n\n    <span ng-include=\"'scripts/directives/no_items/_upload.html'\"></span>\n  </p>\n</div>"),$templateCache.put("scripts/directives/no_items/no-icons.html","<div class=\"no-images no-icons\">\n  <h3>{{ 'private_media.no_items.header' | translate:folderName }}</h3>\n  <p ng-show=\"canUploadFiles\">\n    {{ 'private_media.no_items.text' | translate }}\n\n    <span ng-include=\"'scripts/directives/no_items/_upload.html'\"></span>\n  </p>\n</div>"),$templateCache.put("scripts/directives/no_items/no-images.html","<div class=\"no-images\">\n  <h3>{{ 'private_media.no_items.header' | translate:folderName }}</h3>\n  <p ng-show=\"canUploadFiles\">\n    {{ 'private_media.no_items.text' | translate }}\n\n    <span ng-include=\"'scripts/directives/no_items/_upload.html'\"></span>\n  </p>\n</div>"),$templateCache.put("scripts/directives/no_items/no-items.html","<div class=\"no-images\">\n  <h3>{{ 'private_media.no_items.header' | translate:folderName }}</h3>\n  <p ng-show=\"canUploadFiles\">\n    {{ 'private_media.no_items.text' | translate }}\n\n    <span ng-include=\"'scripts/directives/no_items/_upload.html'\"></span>\n  </p>\n</div>"),$templateCache.put("scripts/directives/no_items/no-music.html","<div class=\"no-images no-music\">\n  <h3>{{ 'private_media.no_items.header' | translate:folderName }}</h3>\n  <p ng-show=\"canUploadFiles\">\n    {{ 'private_media.no_items.text' | translate }}\n\n    <span ng-include=\"'scripts/directives/no_items/_upload.html'\"></span>\n  </p>\n</div>"),$templateCache.put("scripts/directives/no_items/no-search-results.html",'<div class="no-images">\n  <h3 ng-if="folderName">\n    {{ \'private_media.no_search_results.header\' | translate:folderName:searchQuery }}\n  </h3>\n  <h3 ng-if="!folderName">\n    {{ \'public_media.no_search_results.header\' | translate:searchQuery }}\n  </h3>\n</div>'),$templateCache.put("scripts/directives/no_items/no-swf.html","<div class=\"no-images no-swf\">\n  <h3>{{ 'private_media.no_items.header' | translate:folderName }}</h3>\n  <p ng-show=\"canUploadFiles\">\n    {{ 'private_media.no_items.text' | translate }}\n\n    <span ng-include=\"'scripts/directives/no_items/_upload.html'\"></span>\n  </p>\n</div>"),$templateCache.put("scripts/directives/no_items/no-video.html","<div class=\"no-images no-video\">\n  <h3>{{ 'private_media.no_items.header' | translate:folderName }}</h3>\n  <p ng-show=\"canUploadFiles\">\n    {{ 'private_media.no_items.text' | translate }}\n\n    <span ng-include=\"'scripts/directives/no_items/_upload.html'\"></span>\n  </p>\n</div>"),$templateCache.put("scripts/directives/no_items/start-work.html","<div class=\"no-images\">\n  <h3>{{ 'private_media.start_work.header' | translate }}</h3>\n  <p ng-show=\"canUploadFiles\" translate-html=\"{{['private_media.start_work.text', getTemplate('_start-work_upload'), getTemplate('_start-work_connect_social')]}}\">\n\n  </p>\n</div>"),$templateCache.put("scripts/directives/show_previews/font.html",'<div class="preview font-preview">\n  <img />\n  <div>{{previewName}}</div></div>'),$templateCache.put("scripts/directives/show_previews/image.html",'<div class="preview">\n  <img />\n  <div>{{previewName}}</div><div>{{previewSubtitle}}</div></div>'),$templateCache.put("scripts/modules/external_for_free/directives/services_toggles.html",'<div class="services-toggles">\n  <a ng-repeat="service in services | orderBy:serviceSortOrder"\n     class="{{service.getName()}}"\n     ng-class="{ active : isSelected(service) }"\n     ng-click="selectService({service: service})">\n    {{service.getName()}}\n  </a>\n</div>'),$templateCache.put("scripts/modules/external_for_free/directives/start_work.html","<div class=\"no-images start-work\">\n  <h3>{{ 'external_for_free.start_work.header' | translate }}.</h3>\n  <p>\n    {{ 'external_for_free.start_work.description' | translate }}\n  </p>\n  <p>\n    {{ 'external_for_free.start_work.terms' | translate }}\n    <a href=\"\">\n      {{ 'external_for_free.start_work.here' | translate }}\n    </a>\n  </p>\n  <div class=\"arrow\"></div>\n</div>"),$templateCache.put("scripts/modules/external_for_free/external_for_free.html",'<header ng-include="\'_header.html\'"></header>\n\n<!-- Items proceed -->\n<div class="content external-for-free" ng-controller="MediaGallery.ProtocolCtrl.Items">\n\n    <!-- Actions -->\n    <ul class="actions">\n      <li>\n        <wix-delayed-search\n            can-search="true"\n            search="search.perform(query)"\n            clear-search="search.clear()"\n            ></wix-delayed-search>\n      </li>\n      <li>\n        <services-toggles select-service="selectService(service)"\n                          services="services"\n                          selected-service="getSelectedService()"></services-toggles>\n      </li>\n    </ul>\n\n\n    <div class="main no-sidebar" ng-controller="MediaGallery.SettingsCtrl">\n\n      <!-- Items List -->\n      <article when-scrolled="showMoreItems()">\n\n\n        <!-- items -->\n        <div class="gallery">\n\n          <wix-search-results-title\n              ng-show="search.hasResults() && isLoadComplete()"\n\n              search-query="search.getQuery()"\n              clear-search="search.clear()"\n              ></wix-search-results-title>\n\n\n          <responsive-grid-items\n              ng-if="getItems().length > 0"\n\n              get-items="getItems"\n              get-folder="getSelectedService"\n              bi-prefix="externalForFree"\n              magnifying-glass-template="external_image_magnifying_glass.html"\n\n              double-click="selectItemAndProceed(item)"\n\n              ></responsive-grid-items>\n        </div>\n\n        <!-- messages -->\n        <wix-no-items\n            ng-show="search.hasNoResults() && isLoadComplete()"\n\n            template-name="no-search-results"\n            search-query="search.getQuery()"\n            ></wix-no-items>\n\n        <external-for-free-start-work\n            ng-show="search.getQuery() == \'\' && isLoadComplete() && getItems().length == 0"\n            ></external-for-free-start-work>\n\n        <div class="loading" ng-show="!isLoadComplete() && getItems().length == 0"></div>\n        <div class="loading inline" ng-show="!isLoadComplete() && getItems().length > 0"></div>\n      </article>\n\n      <div class="clearfix"></div>\n    </div>\n\n\n    <footer>\n      <div ng-include="\'_footer.html\'"></div>\n      <div ng-controller="MediaGallery.ProtocolCtrl.Items">\n        <a wix-tooltip="{posy:\'top\', posx:\'right\', content:\'.proceed-error\', centered:false, event:\'mouseenter\', style:\'error\'}" class="change-image" wix-disabled="!importingService().canImport()" ng-click="importAndProceedSelected(\'button\')">\n          {{ buttonName() | translate }}\n        </a>\n        <div class="tooltip proceed-error">\n          {{proceedError()}}\n        </div>\n      </div>\n    </footer>\n\n\n    <items-importing-progress importing-service="importingService()" />\n\n</div>\n'),$templateCache.put("scripts/modules/external_services/directives/responsive_grid_folders.html",'<ul class=\'folders\' grid-columns=\'5\' wix-responsive-grid=\'{{folders.length}}\'>\n  <li ng-repeat="folder in folders"\n      ng-click="select({folder: folder})"\n      ng-dblclick="select({folder: folder})"\n      title="{{folder.getName()}} ({{folder.getItemsCount()}})">\n\n    <div class="image-wrapper"\n         covered-background="{{folder.getThumbnailer().makeThumbnail()}}"></div>\n    <span class="name">{{folder.getName()}} ({{folder.getItemsCount()}})</span>\n  </li>\n</ul>'),$templateCache.put("scripts/modules/external_services/directives/services_list.html",'<a class="connect-services"\n   ng-click="showList()"\n   wix-bi-event="{ click: \'connectExternalServicesClicked\' }">\n  <span class="icon facebook"></span>\n  <span class="icon flickr"></span>\n  <span class="icon instagram"></span>\n  <span class="icon picasa"></span>\n</a>\n\n<div class="services-popup" ng-show="isOpened">\n\n  <div class="title">{{ \'external_media.services_list.header\' | translate }}</div>\n\n  <div class="services-container">\n    <table>\n      <tr ng-repeat="service in services | orderBy:serviceSortOrder" class="service {{service.getName().toLowerCase()}}">\n\n        <td class="connect name"\n            ng-click="connectService({service: service})"\n            ng-if="!service.isConnected()">\n          {{service.getName()}}\n        </td>\n        <td class="connect action"\n            ng-click="connectService({service: service})"\n            ng-if="!service.isConnected()">\n          {{ \'external_media.services_list.connect\' | translate }}\n        </td>\n\n\n        <td class="disconnect name"\n            ng-click="disconnectService({service: service})"\n            ng-if="service.isConnected()">\n          {{service.getName()}}\n        </td>\n        <td class="disconnect action"\n            ng-click="disconnectService({service: service})"\n            ng-if="service.isConnected()">\n          {{ \'external_media.services_list.disconnect\' | translate }}\n        </td>\n      </tr>\n    </table>\n  </div>\n\n\n</div>'),$templateCache.put("scripts/modules/external_services/external_services.html",'\n<div ng-controller="externalServices.ctrls.Root" class="items-conteiner">\n\n  <article when-scrolled="showMore()"\n         ng-controller="externalServices.ctrls.Items">\n\n    <div ng-include="\'_uploads.html\'"></div>\n\n    <div ng-include="\'_notifications.html\'"></div>\n\n    <div class="breadcrumbs">\n      <span class="service" ng-show="!selectedExternalFolder">{{selectedExternalService.getName()}} {{ \'external_media.folders\' | translate}}</span>\n      <a class="service" ng-click="unselectFolder()" ng-show="selectedExternalFolder">{{selectedExternalService.getName()}} {{ \'external_media.folders\' | translate}}</a>\n      <span class="folder" ng-show="selectedExternalFolder">{{selectedExternalFolder.getName()}}</span>\n    </div>\n\n\n\n    <!-- messages -->\n    <wix-no-items\n        ng-show="search.hasNoResults() && !search.isInProgress() && isSelectedExternalServiceItemsLoaded() && !isLoading() && !isSelectedFolderEmpty()"\n\n        template-name="no-search-results"\n        folder-name="{{selectedFolderName()}}"\n        search-query="search.getQuery()"\n        ></wix-no-items>\n\n    <wix-no-items\n        ng-show="isSelectedFolderEmpty() && isSelectedExternalServiceItemsLoaded()"\n\n        template-name="no-external-images"\n        folder-name="{{selectedFolderName()}}"\n        ></wix-no-items>\n\n\n    <wix-search-results-title\n        ng-show="search.hasResults() && !search.isInProgress()"\n\n        search-query="search.getQuery()"\n        clear-search="search.clear()"\n        ></wix-search-results-title>\n\n\n    <responsive-grid-items\n        ng-if="getItems().length > 0"\n        ng-show="isAnyFolderSelected()"\n\n        get-items="getItems"\n        get-folder="getSelectedExternalFolder"\n        bi-prefix="externalMedia"\n        magnifying-glass-template="external_image_magnifying_glass.html"\n\n        double-click="selectItemAndProceed(item)"\n\n        can-edit="canEditItemAtAviary(item)"\n        edit="editItemAtAviary(item)"\n\n        can-download="canDownloadItem(item)"\n        get-download-link="getItemDownloadLink(item)"\n\n        can-drag="canDrag(item)"\n        ></responsive-grid-items>\n\n    <external-responsive-grid-folders\n        ng-if="getFolders().length > 0"\n        folders="getFolders()"\n        select="selectFolder(folder)"\n        ng-show="!isAnyFolderSelected()" ></external-responsive-grid-folders>\n\n\n    <div class="loading" ng-show="(!isSelectedExternalServiceItemsLoaded() || isLoading()) && getItems().length == 0"></div>\n    <div class="loading inline" ng-show="(!isSelectedExternalServiceItemsLoaded() || isLoading()) && getItems().length > 0"></div>\n  </article>\n\n  <items-importing-progress importing-service="importingService()" />\n</div>'),$templateCache.put("scripts/modules/import/directives/items_importing_progress.html",'\n<div class="import" ng-show="importingService.isStarted() && !importingService.isSuccess() && !importingService.isFailed()">\n  <div class="progress">\n    <h3>\n      {{ \'external_media.importing.header\' | translate }}\n    </h3>\n    <div class="loading" ng-show="!importingService.isSuccess() && !importingService.isFailed()"></div>\n    <div ng-show="importingService.isSuccess()">\n      {{ \'external_media.importing.done\' | translate }}\n    </div>\n    <!--<div class="completed" ng-show="!importingService.isSuccess() || hasFiledItems()">\n      {{ \'external_media.importing.completed_count\' | translate:getCompletedItemsCount():getAllItemsCount() }}\n    </div>\n    <div class="failed" ng-show="hasFiledItems() && !importingService.isSuccess()">\n      {{ \'external_media.importing.failed_count\' | translate:getFailedItemsCount() }}\n    </div>-->\n  </div>\n</div>'),$templateCache.put("scripts/modules/photo_stock/directives/magnifying_glass.html",'<div class="peek-wrapper">\n  <a class="peek"\n     wix-show-preview\n     preview-url="{{item.getThumbnailer().makePreview()}}"\n     preview-subtitle="{{item.getWidth()}} x {{item.getHeight()}}"\n     preview-name="{{item.getTitle()}}"\n     template-url="scripts/modules/photo_stock/directives/show_preview.html">Peek</a>\n</div>'),$templateCache.put("scripts/modules/photo_stock/directives/responsive_grid_items.html",'<ul class=\'items\' grid-columns=\'5\' wix-responsive-grid=\'{{getItems().length}}\'>\n  <li class="tooltip-parent {{item.sourceName}} {{item.getMediaType() || item.getSourceType()}}"\n\n      ng-repeat="item in getItems()"\n      ng-class="{ selected: isSelected(item) }"\n      ng-dblclick="selectItemAndProceed({item: item})"\n\n      wix-select-item\n      jqui-helper="selectionHelper(item)"\n      item="item"\n      get-all-items="getItems"\n      can-select-multiple="false"\n\n      title="{{item.getTitle()}}">\n\n\n    <item-actions\n        item="item"\n        magnifying-glass-template="magnifyingGlassTemplate"\n\n        can-edit="canEdit({item: item})"\n        can-download="canDownload({item: item})"\n\n        edit="edit({item: item})"\n        get-download-link="getDownloadLink({item: item})"></item-actions>\n\n\n    </div>\n    <div class="image-wrapper"\n         covered-background="{{item.getThumbnailer().makeThumbnail()}}"></div>\n\n\n    <span class="name">\n      {{item.getTitle()}}\n    </span>\n\n    <div class="price" ng-click="selectItemAndProceed({item: item})" title="{{ \'photo_stock.buy\' | translate }}">\n      {{ \'photo_stock.buy_short\' | translate }}\n    </div>\n\n  </li>\n</ul>'),$templateCache.put("scripts/modules/photo_stock/directives/show_preview.html",'<div class="preview">\n  <span class="cut"><img /></span>\n  <table class="description">\n    <tr>\n      <td class="title">\n        {{ \'photo_stock.preview.file_name\' | translate }}:\n      </td>\n      <td>\n        {{previewName}}\n      </td>\n    </tr>\n    <tr>\n      <td class="title">\n        {{ \'private_media.zoom_preview.image_size\' | translate }}:\n      </td>\n      <td>\n        {{previewSubtitle}}\n      </td>\n    </tr>\n  </table>\n</div>'),$templateCache.put("scripts/modules/photo_stock/photo_stock.html",'<header ng-include="\'_header.html\'"></header>\n\n<!-- Items proceed -->\n<div class="content photo-stock" ng-controller="MediaGallery.ProtocolCtrl.Items">\n\n  <!-- Actions -->\n  <ul class="actions">\n    <li>\n      <wix-delayed-search\n          can-search="true"\n          search="search.perform(query)"\n          clear-search="search.clear()"\n          ></wix-delayed-search>\n    </li>\n    <li>\n      <wix-sort-by\n          can-sort="true"\n          selected-field="getSelectedSortField()"\n          fields="sortFields"\n          bi-prefix="photoStock"\n          select-field="selectSortField(field)"\n          ></wix-sort-by>\n    </li>\n    <li>\n      <span class="orientation">\n        <a ng-repeat="orientation in orientations"\n           class="{{orientation.name}}"\n           ng-click="selectOrientation(orientation)"\n           wix-bi-event="{ click: {name: \'photoStockOrientationClicked\', attributes: {name: orientation.name}} }"\n           ng-class="{ active : selectedOrientation == orientation }"><i></i></a>\n      </span>\n    </li>\n  </ul>\n\n\n  <div class="main no-sidebar" ng-controller="MediaGallery.SettingsCtrl">\n\n\n    <!-- User folders -->\n    <div class="folders">\n      <ul>\n        <li ng-class="{ current : !selectedFolder }"\n            ng-click="selectFolder(null)">\n          <a class="title">{{ \'photo_stock.folder.all\' | translate }}</a>\n        </li>\n      </ul>\n      <folders-list get-folders="getFolders()"\n                    can-show-actions="false"\n                    select="selectFolder(folder)"\n                    selected="selectedFolder"></folders-list>\n\n    </div>\n\n\n    <!-- Items List -->\n    <article when-scrolled="showMoreItems()">\n\n      <!-- items -->\n      <div class="gallery">\n\n        <photo-stock-responsive-grid-items\n            ng-if="getItems().length > 0"\n\n            get-items="getItems"\n            get-folder="getSelectedFolder"\n            bi-prefix="photoStock"\n            magnifying-glass-template="scripts/modules/photo_stock/directives/magnifying_glass.html"\n\n            select-item-and-proceed="selectItemAndProceed(item)"\n\n            ></photo-stock-responsive-grid-items>\n      </div>\n\n      <!-- messages -->\n      <wix-no-items\n          ng-show="search.hasNoResults() && isLoadComplete()"\n\n          template-name="no-search-results"\n          search-query="search.getQuery()"\n          ></wix-no-items>\n\n      <div class="loading" ng-show="!isLoadComplete() && getItems().length == 0"></div>\n      <div class="loading inline" ng-show="!isLoadComplete() && getItems().length > 0"></div>\n    </article>\n\n    <div class="clearfix"></div>\n  </div>\n\n\n  <footer>\n    <div ng-include="\'_footer.html\'"></div>\n    <div ng-controller="MediaGallery.ProtocolCtrl.Items">\n      <a wix-tooltip="{posy:\'top\', posx:\'right\', content:\'.proceed-error\', centered:false, event:\'mouseenter\', style:\'error\'}" class="change-image" wix-disabled="!canProceed()" ng-click="buyAndProceedSelected(\'button\')">\n        {{ \'photo_stock.buy\' | translate }}\n      </a>\n      <div class="tooltip proceed-error">\n        {{proceedError()}}\n      </div>\n    </div>\n  </footer>\n\n\n  <div class="buying" ng-show="isBuying()">\n    <div class="progress">\n      <h3>\n        {{ \'photo_stock.buying.header\' | translate }}\n      </h3>\n      <div class="loading"></div>\n    </div>\n  </div>\n\n</div>\n'),$templateCache.put("scripts/modules/public_media/_proceed.html",'<div ng-controller="MediaGallery.ProtocolCtrl.Items">\n  <div ng-controller="publicMedia.ctrls.ProceedCtrl">\n    <a wix-tooltip="{posy:\'top\', posx:\'right\', content:\'.proceed-error\', centered:false, event:\'mouseenter\', style:\'error\'}" class="change-image" wix-disabled="!canProceed()" ng-click="proceed()">\n      {{ buttonName() | translate }}\n    </a>\n    <div class="tooltip proceed-error">\n      {{proceedError()}}\n    </div>\n  </div>\n</div>'),$templateCache.put("scripts/modules/public_media/breadcrumbs_dynamic_public_media.html",'<header ng-include="\'_header.html\'"></header>\n<div class="content">\n  <div class="actions">\n    <div class="search">\n      <wix-delayed-search\n          can-search="canSearch()"\n          search="search.perform(query)"\n          clear-search="search.clear()"\n          ></wix-delayed-search>\n    </div>\n    <ul class="breadcrumbs">\n      <li ng-repeat="category in selectedBranchPath()" ng-class="{ current : isSelectedCategory(category) }">\n        <a href="" ng-click="selectCategory(category)">{{category.getTitle()}}</a>\n      </li>\n    </ul>\n  </div>\n  <div class="main" ng-controller="MediaGallery.SettingsCtrl">\n    <div class="folders">\n      <ul>\n        <li ng-repeat="category in selectedBranchChildren()" ng-class="{ current : isSelectedCategory(category) }">\n          <a class="title" ng-click="selectCategory(category)">\n            {{category.getTitle()}}\n          </a>\n        </li>\n      </ul>\n    </div>\n    <article ng-controller="MediaGallery.privateMedia.UploadCtrl"\n             file-droppable="handleFileSelect(files)"\n             when-scrolled="loadNextPage()">\n\n\n      <div ng-show="getItems().length == 0 && isItemsLoaded()" class="no-images">\n        <h3>{{ \'public_media.no_items.header\' | translate }}</h3>\n      </div>\n\n      <div class="gallery public">\n        <ul class=\'notifications\'\n            wix-notification-collection=\'notifications.length\'\n            ng-controller="MediaGallery.NotificationsCtrl">\n          <li class=\'{{notification.type}}\'\n              wix-expire-notification=\'expire(notification)\'\n              wix-notification=\'notification\'\n              ng-repeat=\'notification in notifications\'\n              wix-animate-expire=\'{{notification.expired}}\'>\n            <span>{{notification.message}}</span>\n            <a class=\'expire-notification\' href="" ng-click=\'expire(notification)\'>&times;</a>\n          </li>\n        </ul>\n\n\n        <responsive-grid-items\n            ng-if="getItems().length > 0"\n\n            get-items="getItems"\n            get-folder="getSelectedFolder"\n            bi-prefix="publicMedia"\n            magnifying-glass-template="{{magnifyingGlassTemplate}}"\n\n            double-click="selectItemAndProceed(item)"\n\n            ></responsive-grid-items>\n\n        <div class="loading" ng-show="!isItemsLoaded() && getItems().length = 0"></div>\n        <div class="loading inline" ng-show="!isItemsLoaded() && getItems().length > 0"></div>\n      </div>\n    </article>\n    <div class="clearfix"></div>\n  </div>\n  <footer>\n    <div ng-include="\'_footer.html\'"></div>\n    <div ng-include="\'scripts/modules/public_media/_proceed.html\'"></div>\n  </footer>\n</div>\n\n'),$templateCache.put("scripts/modules/public_media/dynamic_public_media.html",'<header ng-include="\'_header.html\'"></header>\n<div class="content">\n  <div class="actions">\n    <div class="search">\n      <wix-delayed-search\n          can-search="canSearch()"\n          search="search.perform(query)"\n          clear-search="search.clear()"\n          ></wix-delayed-search>\n    </div>\n    <ul class="types">\n      <li ng-repeat="category in topLevelCategories" ng-class="{ current: isSelectedTopLevelCategory(category) }">\n        <a href="" ng-click="selectTopLevelCategory(category)">{{category.getTitle()}}</a>\n      </li>\n    </ul>\n  </div>\n  <div class="main" ng-controller="MediaGallery.SettingsCtrl">\n    <div class="folders">\n      <ul>\n        <li ng-repeat="category in selectedBranchChildren()" ng-class="{ current : isSelectedCategory(category) }">\n          <a class="title" ng-click="selectCategory(category)">\n            {{category.getTitle()}}\n          </a>\n        </li>\n      </ul>\n    </div>\n    <article ng-controller="MediaGallery.privateMedia.UploadCtrl"\n             file-droppable="handleFileSelect(files)"\n             when-scrolled="loadNextPage()">\n\n\n      <div ng-show="getItems().length == 0 && isItemsLoaded()" class="no-images">\n        <h3>{{ \'public_media.no_items.header\' | translate }}</h3>\n      </div>\n\n      <div class="gallery public">\n        <ul class=\'notifications\'\n            wix-notification-collection=\'notifications.length\'\n            ng-controller="MediaGallery.NotificationsCtrl">\n          <li class=\'{{notification.type}}\'\n              wix-expire-notification=\'expire(notification)\'\n              wix-notification=\'notification\'\n              ng-repeat=\'notification in notifications\'\n              wix-animate-expire=\'{{notification.expired}}\'>\n            <span>{{notification.message}}</span>\n            <a class=\'expire-notification\' href="" ng-click=\'expire(notification)\'>&times;</a>\n          </li>\n        </ul>\n\n\n        <responsive-grid-items\n            ng-if="getItems().length > 0"\n\n            get-items="getItems"\n            get-folder="getSelectedFolder"\n            bi-prefix="publicMedia"\n            magnifying-glass-template="{{magnifyingGlassTemplate}}"\n\n            double-click="selectItemAndProceed(item)"\n\n            ></responsive-grid-items>\n\n        <div class="loading" ng-show="!isItemsLoaded() && getItems().length == 0"></div>\n        <div class="loading inline" ng-show="!isItemsLoaded() && getItems().length > 0"></div>\n      </div>\n    </article>\n    <div class="clearfix"></div>\n  </div>\n  <footer>\n    <div ng-include="\'_footer.html\'"></div>\n    <div ng-include="\'scripts/modules/public_media/_proceed.html\'"></div>\n  </footer>\n</div>\n\n'),$templateCache.put("scripts/modules/public_media/static_public_media.html",'<header ng-include="\'_header.html\'"></header>\n<div class="content">\n  <div class="actions">\n    <ul class="types">\n      <li ng-repeat="folder in folders" ng-class="{ current: isSelectedFolder(folder) }">\n        <a href="" ng-click="selectFolder(folder)" wix-bi-event="{ click: { name: \'publicMediaCategorySelected\', attributes: { name: folder.name } } }">{{folder.name | translateCategory}}</a>\n      </li>\n    </ul>\n  </div>\n  <div class="main" ng-controller="MediaGallery.SettingsCtrl">\n    <div class="folders">\n      <ul>\n        <li ng-repeat="subFolder in selectedFolder.children" ng-class="{ current: isSelectedSubFolder(subFolder) }">\n          <a class="title" ng-click="selectSubFolder(subFolder)" wix-bi-event="{ click: { name: \'publicMediaSubCategorySelected\', attributes: { name: subFolder.name } } }">\n            {{subFolder.name | translateCategory}}\n          </a>\n        </li>\n      </ul>\n    </div>\n    <article ng-controller="MediaGallery.privateMedia.UploadCtrl"\n             when-scrolled="loadItems()"\n             file-droppable="handleFileSelect(files)"\n             wix-bi-event="{ drop: { name: \'itemsDropped\', attributes: { tab: \'public\' } } }">\n      <div>\n\n        <div class="gallery public">\n\n          <div class="loading" ng-show="!isItemsLoaded()"></div>\n\n          <ul class=\'notifications\'\n              wix-notification-collection=\'notifications.length\'\n              ng-controller="MediaGallery.NotificationsCtrl">\n            <li class=\'{{notification.type}}\'\n                wix-expire-notification=\'expire(notification)\'\n                wix-notification=\'notification\'\n                ng-repeat=\'notification in notifications track by notification.id\'\n                ng-animate="{leave:\'.expire-notification\'}"\n              <span>{{notification.message}}</span>\n              <a class=\'expire-notification\' href="" ng-click=\'expire(notification)\'>&times;</a>\n            </li>\n          </ul>\n\n\n          <responsive-grid-items\n              ng-if="getItems().length > 0"\n\n              get-items="getItems"\n              get-folder="getSelectedFolder"\n              bi-prefix="publicMedia"\n              magnifying-glass-template="{{magnifyingGlassTemplate}}"\n\n              double-click="selectItemAndProceed(item)"\n\n              ></responsive-grid-items>\n\n        </div>\n      </div>\n    </article>\n    <div class="clearfix"></div>\n  </div>\n  <footer>\n    <div ng-include="\'_footer.html\'"></div>\n    <div ng-include="\'scripts/modules/public_media/_proceed.html\'"></div>\n  </footer>\n</div>\n\n'),$templateCache.put("scripts/modules/search/directives/delayed_search.html",'<form class="search">\n  <input type="text" maxlength="128" ng-model="query" ng-disabled="!canSearch">\n  <input type="reset" value="&times;" ng-click="clearQuery()" ng-hide="isEmpty()">\n</form>\n'),$templateCache.put("scripts/modules/search/directives/search_results_title.html",'\n<h5 class="search-results-header">\n  <span class="prefix">{{\'private_media.search_results_prefix\' | translate }}</span>\n  <span class="query">{{\'"\' + searchQuery + \'"\'}}</span>\n  <a href="" ng-click="clearSearch()">&times;</a>\n</h5>')
}]),function(){"use strict";var getWixUserID,_this=this;window.MediaGallery||(window.MediaGallery={}),window.MediaGallery.VERSION="MEDIA_GALLERY_VERSION",window.MediaGallery.isBootstrapped=!1,window.settings=function(){var settingsHash;return settingsHash={},{get:function(){return settingsHash},set:function(value){return settingsHash=value}}}(),getWixUserID=function(){var info;return info=_this.getCookie("wixClient"),null==info?"":info.split("|")[6]||""},window.mediaGallery=angular.module("mediaGallery",["ui.bootstrap","ngSanitize","wix.base.dnd","wix.base.whenScrolled","wix.base.fileDroppable","wix.base.fileSelectionChange","apiSwitcher","ngRoute","ngCookies","templates","base","search","import","publicMedia","externalServices","externalForFree","photoStock"]),MediaGallery.appLoadNotifiers.appIsInitialized(),window.mediaGallery.config(["$routeProvider",function($routeProvider){return $routeProvider.when("/free",{template:"&nbsp;",controller:"MediaGallery.ConductorCtrl.PublicMedia",resolve:{initialize:MediaGallery.LoadLocales}}).when("/static_public_media",{templateUrl:"scripts/modules/public_media/static_public_media.htm",controller:"publicMedia.ctrls.StaticPublicMediaRootCtrl",resolve:{initialize:MediaGallery.LoadLocales}}).when("/external_for_free",{templateUrl:"scripts/modules/external_for_free/external_for_free.html",controller:"externalForFree.ctrls.Root",resolve:{initialize:MediaGallery.LoadLocales}}).when("/photo_stock",{templateUrl:"scripts/modules/photo_stock/photo_stock.html",controller:"photoStock.ctrls.Root",resolve:{initialize:MediaGallery.LoadLocales}}).when("/breadcrumbs_dynamic_public_media",{templateUrl:"scripts/modules/public_media/breadcrumbs_dynamic_public_media.html",controller:"publicMedia.ctrls.BreadcrumbsDynamicPublicMediaRootCtrl",resolve:{initialize:MediaGallery.LoadLocales}}).when("/dynamic_public_media",{templateUrl:"scripts/modules/public_media/dynamic_public_media.html",controller:"publicMedia.ctrls.DynamicPublicMediaRootCtrl",resolve:{initialize:MediaGallery.LoadLocales}}).when("/my",{templateUrl:"my_folders.html",controller:"MediaGallery.privateMedia.RootCtrl",resolve:{initialize:MediaGallery.LoadLocales}}).otherwise({controller:"MediaGallery.ConductorCtrl.Root",template:"&nbsp;",resolve:{initialize:MediaGallery.LoadLocales}})}]).config(["$provide",function($provide){return $provide.decorator("$sniffer",["$delegate",function($delegate){var originalFunc;return originalFunc=$delegate.hasEvent,$delegate.hasEvent=function(event){return"input"===event&&9===document.documentMode?!1:originalFunc()},$delegate}])}]),window.dump=function(data){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log(data):void 0},window.ang=function(){return angular.element(document.querySelector("[ng-app]")).injector()}}.call(this),function(){"use strict";window.MediaGallery||(window.MediaGallery={}),MediaGallery.setupDependencies=function(app){return app.value("MediaTypeConstructor",WixPix.MediaTypeConstructor),app.value("Item",MediaGallery.Item),app.value("TranscodableItem",MediaGallery.TranscodableItem),app.value("SingleKeyCache",WixPix.SingleKeyCache),app.factory("Cache",["Settings",WixPix.Cache]),app.factory("sendWithRetry",["$q",MediaGallery.SendWithRetry]),app.factory("PictureMediaType",["MediaTypeConstructor","Urls","Item",WixPix.MediaTypes.Picture]),app.factory("ShapeMediaType",["MediaTypeConstructor","Urls","Item",WixPix.MediaTypes.Shape]),app.factory("WatermarkMediaType",["MediaTypeConstructor","Urls","Item",WixPix.MediaTypes.Watermark]),app.factory("IconMediaType",["MediaTypeConstructor","Urls","Item",WixPix.MediaTypes.Icon]),app.factory("DocumentMediaType",["MediaTypeConstructor","Urls","Item",WixPix.MediaTypes.Document]),app.factory("SecureMusicMediaType",["MediaTypeConstructor","Urls","TranscodableItem",WixPix.MediaTypes.SecureMusic]),app.factory("VideoMediaType",["MediaTypeConstructor","Urls","TranscodableItem",WixPix.MediaTypes.Video]),app.factory("MusicMediaType",["MediaTypeConstructor","Urls","Item",WixPix.MediaTypes.Music]),app.factory("SwfMediaType",["MediaTypeConstructor","Urls","Item",WixPix.MediaTypes.Swf]),app.factory("FontMediaType",["MediaTypeConstructor","Urls","Item",WixPix.MediaTypes.Font]),app.factory("MediaType",["Protocol","Settings","PictureMediaType","ShapeMediaType","WatermarkMediaType","IconMediaType","DocumentMediaType","SecureMusicMediaType","MusicMediaType","SwfMediaType","FontMediaType","VideoMediaType",WixPix.MediaTypeInitialization]),app.factory("Conductor",["MediaType","Settings",MediaGallery.Conductor]),app.provider("Urls",MediaGallery.Urls),app.filter("urlOfSize",[MediaGallery.urlOfSize]),app.filter("previewUrlOfSize",[MediaGallery.previewUrlOfSize]),app.filter("publicUrlOfSize",[MediaGallery.publicUrlOfSize]),app.value("Folder",MediaGallery.Folder),app.factory("ItemFromStaticResponse",["MediaType",WixPix.ItemFromStaticResponse]),app.factory("Aviary",["$rootScope","apiSwitcher.apis","i18n",MediaGallery.Aviary]),app.factory("GetUploadsFileHandlers",["$rootScope","Settings","BINotifyHelpers",WixPix.GetUploadsFileHandlers]),app.factory("UploadsFile",["GetUploadsFileHandlers","$q","HttpErrorInterceptor","BINotifyHelpers","ErrorNotifier","Settings",WixPix.UploadsFile]),app.factory("ItemRepository",["apiSwitcher.apis","$q","OOPEventNotifier",function(apis,q,eventNotifier){var repo;return repo=MediaGallery.privateMedia.ItemRepository(apis,q),repo.register(eventNotifier),repo}]),app.factory("FolderRepository",["apiSwitcher.apis","$q","OOPEventNotifier",function(apis,q,eventNotifier){var repo;return repo=new MediaGallery.privateMedia.FolderRepository(apis,q),repo.register(eventNotifier),repo}]),app.factory("BaseTransaction",["$q",WixPix.BaseTransaction]),app.factory("addFolder",["BaseTransaction","apiSwitcher.apis",MediaGallery.AddFolder]),app.factory("removeFolder",["BaseTransaction","apiSwitcher.apis","CloseUploadGuard",MediaGallery.RemoveFolder]),app.factory("moveItems",["BaseTransaction","apiSwitcher.apis",MediaGallery.MoveItems]),app.factory("moveItemsToUnsorted",["BaseTransaction","apiSwitcher.apis",MediaGallery.MoveItemsToUnsorted]),app.factory("renameFolder",["BaseTransaction","apiSwitcher.apis","CloseUploadGuard",MediaGallery.RenameFolder]),app.factory("removeItem",["BaseTransaction","apiSwitcher.apis",MediaGallery.RemoveItem]),app.factory("renameItem",["BaseTransaction","apiSwitcher.apis",MediaGallery.RenameItem]),app.factory("GetTranscodedFile",["BaseTransaction","apiSwitcher.apis","Settings",MediaGallery.GetTranscodedFile]),app.factory("removeItemCollection",["BaseTransaction","removeItem","$q",MediaGallery.RemoveItemCollection]),app.factory("chooseItems",["BaseTransaction","Protocol","ProtocolItemMapper","Settings",MediaGallery.ChooseItems]),app.factory("selectedItems",["$rootScope","$q","Settings","ItemRepository",MediaGallery.SelectedItems]),app.factory("AllItemsSelection",["selectedItems",MediaGallery.AllItemsSelection]),app.factory("FilesToUpload",["apiSwitcher.apis","FlashUploader","generateUUID",MediaGallery.FilesToUpload]),app.factory("DndHelper",["$templateCache","$compile",WixPix.DndHelper]),app.factory("notifyAndReject",["$rootScope","$q",WixPix.NotifyAndReject]),app.value("generateUUID",function(){return UUID.generate()}),app.value("generateUploadSessionId",function(){return UUID.generate()}),app.factory("ProtocolItemMapper",["Settings",MediaGallery.ProtocolItemMapper]),app.factory("featureDetection",["Settings",MediaGallery.FeatureDetection]),app.value("Timer",WixPix.Timer),app.provider("Settings",MediaGallery.NewSettings),app.factory("i18n",["Settings",MediaGallery.i18nWithPrefix]),app.filter("translate",["i18n",MediaGallery.translate]),app.filter("translateUploadingTo",["i18n",MediaGallery.translateUploadingTo]),app.filter("translateCategory",["i18n",MediaGallery.translateCategory]),app.filter("translateSelection",["i18n",MediaGallery.translateSelection]),app.factory("EventNotifier",["OOPEventNotifier",MediaGallery.FunctionalBIEventNotifier]),app.factory("BINotifyHelpers",["EventNotifier","Timer","$q","Urls",MediaGallery.BINotifyHelpers]),app.factory("OOPEventNotifier",["Urls","$cookies","facebookConnector","flickrConnector","instagramConnector","picasaConnector","Settings",MediaGallery.BIEventNotifier]),app.factory("ErrorNotifier",["Urls",MediaGallery.BIErrorNotifier]),app.factory("HttpErrorInterceptor",["ErrorNotifier",MediaGallery.HttpErrorInterceptor]),app.factory("uiNotifier",["$rootScope","$timeout",WixPix.uiNotifier]),app.factory("UINotifiers.GlobalEvents",["$rootScope","$q","uiNotifier","i18n","addFolder","removeFolder","apiSwitcher.apis","ItemRepository","FolderRepository","FlashUploader",MediaGallery.UINotifiers.GlobalEvents]),app.factory("UINotifiers.Transactions",["uiNotifier","i18n","addFolder","removeFolder","renameFolder","moveItems","moveItemsToUnsorted","removeItem","renameItem",MediaGallery.UINotifiers.Transactions]),app.factory("BINotifiers.Transactions",["Urls","Settings","ErrorNotifier","addFolder","removeFolder","renameFolder","chooseItems","removeItem","FlashUploader","$location","Settings",MediaGallery.BINotifiers.Transactions]),app.factory("BINotifiers.APIs",["$q","Urls","BINotifyHelpers",MediaGallery.BINotifiers.APIs]),app.factory("NotificationSubscriber",["UINotifiers.GlobalEvents","UINotifiers.Transactions","BINotifiers.Transactions",function(UIGlobal,UITransactions,BITransactions){var notifiers;return notifiers=[UIGlobal,UITransactions,BITransactions],{subscribe:function(){return _.each(notifiers,function(notifier){return notifier.subscribe()})}}}]),app.filter("translateUploadFailureReason",["i18n",MediaGallery.translateUploadFailureReason]),app.factory("Protocol",function(){return Protocol.forMediaGallery(window.parent,window)}),app.factory("BuildsPreview133px",["$q","MediaType",function(q,mediaType){return WixPix.BuildsPreview(q,WixPix.BuildsThumbnailWithCanvas(133,133),mediaType)}]),app.factory("CloseUploadGuard",["$rootScope","$dialog","$q","i18n",MediaGallery.CloseUploadGuard]),app.factory("VerifyCORSWorks",["$q","Urls","featureDetection","BINotifyHelpers",MediaGallery.VerifyCORSWorks]),app.factory("NotifyCriticalFail",["ErrorNotifier","$q","$dialog","Protocol",MediaGallery.notifyCriticalFail]),app.factory("FlashUploader",["i18n","apiSwitcher.apis","OOPEventNotifier","Settings",function(i18n,apis,oopEventNotifier,settings){var t;return t=WixPix.FlashUploaderInit(i18n,apis,settings),t.register(oopEventNotifier),t}]),app.factory("allSettled",["$q",WixPix.allSettled]),MediaGallery.appLoadNotifiers.internalComponentsConfigured()},MediaGallery.LoadLocales.$inject=["$q","$http","Settings","i18n"],MediaGallery.ConductorCtrl.Root.$inject=["$rootScope","$location","Conductor"],MediaGallery.ConductorCtrl.PublicMedia.$inject=["$location","Conductor"],MediaGallery.SettingsCtrl.$inject=["$scope","$location","Conductor","MediaType","i18n"],MediaGallery.privateMedia.EditItemCtrl.$inject=["$scope","Aviary","FolderRepository"],MediaGallery.privateMedia.SelectionCtrl.$inject=["$scope","selectedItems"],MediaGallery.privateMedia.UploadCtrl.$inject=["$scope","$q","apiSwitcher.apis","BuildsPreview133px","FilesToUpload","i18n","$location","MediaType","FlashUploader","uiNotifier"],MediaGallery.privateMedia.RootCtrl.$inject=["EventNotifier","$scope","$location","$rootScope","removeItem","FolderRepository","ItemRepository","selectedItems","DndHelper","i18n","chooseItems","$filter","featureDetection","AllItemsSelection","apiSwitcher.apis","FlashUploader","GetTranscodedFile","getExternalServices","BINotifyHelpers","import.services.items","import.services.ImportAndProceed","allSettled","$q","Aviary","renameItem","$dialog","MediaType","search.services.Search","moveItems","moveItemsToUnsorted","removeItemCollection","removeFolder","renameFolder"],MediaGallery.privateMedia.RemoveItemsCtrl.$inject=["EventNotifier","$scope","removeItem","removeItemCollection","selectedItems","$dialog","i18n"],MediaGallery.privateMedia.MoveItemsCtrl.$inject=["$scope","selectedItems"],MediaGallery.privateMedia.FoldersListCtrl.$inject=["$scope","$rootScope","FolderRepository","removeFolder","moveItemsToUnsorted","moveItems","addFolder","CloseUploadGuard","uiNotifier","i18n","renameFolder","selectedItems","apiSwitcher.apis","$dialog"],MediaGallery.privateMedia.ProceedCtrl.$inject=["$scope"],MediaGallery.NotificationsCtrl.$inject=["$scope","uiNotifier"],MediaGallery.ProtocolCtrl.Items.$inject=["EventNotifier","$scope","Protocol","selectedItems","chooseItems","$location","CloseUploadGuard","i18n"],MediaGallery.ProtocolCtrl.Cancel.$inject=["EventNotifier","$scope","Protocol","CloseUploadGuard"],MediaGallery.ProtocolCtrl.Help.$inject=["EventNotifier","$scope","Protocol"]}.call(this),function(){var __slice=[].slice;window.WixPix||(window.WixPix={}),MediaGallery.urlOfSize=function(){return function(item,width,height,resizeMethod){return item?item.getThumbnailer().makeUrlOfSize(width,height,resizeMethod):void 0}},MediaGallery.publicUrlOfSize=function(){return function(item,width,height,resizeMethod){return item?item.getThumbnailer().makePublicUrlOfSize(width,height,resizeMethod):void 0}},MediaGallery.previewUrlOfSize=function(){return function(item,width,height,resizeMethod){return item?item.getThumbnailer().makePreviewUrlOfSize(width,height,resizeMethod):void 0}},MediaGallery.translateUploadingTo=function(i18n){return function(chunk){var folderName;return folderName=chunk.folder.equals(MediaGallery.AllFolder())?i18n.translate("private_media.all"):"/"===chunk.folder.getName()?i18n.translate("private_media.unsorted"):chunk.folder.getName(),i18n.translate("private_media.uploading_to_folder",[chunk.files.length,folderName])}},MediaGallery.translateCategory=function(i18n){return function(input){return i18n.translate("public_media.categories."+input)}},MediaGallery.translateSelection=function(i18n){return function(input,count){return i18n.translate(input,[count,i18n.translate("change")])}},MediaGallery.translateUploadFailureReason=function(i18n){return function(error){return error?i18n.translate("private_media.static_upload_error."+error.errorMessage,[error.errorCode]):void 0}},MediaGallery.translate=function(i18n){return function(){var args,input;return input=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],i18n.translate(input,args)}}}.call(this),function(){mediaGallery.directive("wixSelectAll",function(){return{restrict:"E",scope:{canToggleSelection:"=",isAllSelected:"=",selectAll:"&",selectNone:"&"},link:function(s){return s.toggleSelection=function(){return s.isAllSelected?s.selectNone():s.selectAll()}},templateUrl:"scripts/directives/actions/select_all.html"}})}.call(this),function(){mediaGallery.directive("wixSortBy",function(){return{restrict:"E",scope:{canSort:"=",fields:"=",selectedField:"=",biPrefix:"@",selectField:"&"},controller:function($scope){return $scope.selectedField?void 0:$scope.selectField({field:$scope.fields[0]})},link:function(s){return null==s.canSort&&(s.canSort=!0),s.isSelected=function(field){return field===s.selectedField}},templateUrl:"scripts/directives/actions/sort_by.html"}})}.call(this),function(){var loadImage;loadImage=function(url,callback){var image;return image=new Image,image.onload=callback,image.src=url,image},mediaGallery.directive("coveredBackground",function(){return{restrict:"A",scope:{coveredBackground:"@"},link:function(scope,element){return scope.$watch("coveredBackground",function(url){var image;return image=loadImage(url,function(){var backgroundSize;return element.css("background-image","url("+url+")"),backgroundSize=image.width>=element.innerWidth()&&image.height>=element.innerHeight()?"cover":"auto",element.css("background-size",backgroundSize)})})}}})}.call(this),function(){"use strict";var wixBase;wixBase=angular.module("wix.base.dnd",[]),function(){var evalFn;return evalFn=function(element,scope,exp,property){return property=property||"$token",function(token){var old,retVal;return old=scope.hasOwnProperty(property)?scope[property]:void 0,scope[property]=token,retVal=scope.$eval(exp,element),scope[property]=old,retVal}},wixBase.directive("jquiDragBegin",["$compile",function(){return{link:function(scope,item,attrs){var axisExp,canDrag,canDragExp,dragEnd,dragEndExp,dragStart,dragStartExp,handle,helper,helperExp,token;return canDragExp=attrs.jquiCanDrag||"",canDrag=evalFn(item,scope,canDragExp),canDrag()!==!1?(dragStartExp=attrs.jquiDragBegin||"",dragEndExp=attrs.jquiDragEnd||"",helperExp=attrs.jquiHelper||"original",handle=attrs.jquiHandle||!1,axisExp=attrs.jquiAxis,item.addClass("jqui-dnd-item"),dragStart=evalFn(item,scope,dragStartExp),dragEnd=evalFn(item,scope,dragEndExp),helper=helperExp,"original"!==helper&&"clone"!==helper&&(helper=evalFn(item,scope,helperExp)),token=void 0,item.draggable({appendTo:"body",delay:200,addClass:!1,handle:handle,helper:helper().html,cursorAt:{bottom:30,right:30},start:function(){return item.draggable("option","revertDuration",200),item.addClass("jqui-dnd-item-dragging"),item.data("jqui-dnd-item-token",token=dragStart()),scope.$apply()},stop:function(){return item.removeClass("jqui-dnd-item-dragging"),item.removeClass("jqui-dnd-item-over"),item.removeData("jqui-dnd-item-token"),dragEnd(token),scope.$apply(),token=null},revert:!0}),axisExp?scope.$watch(axisExp,function(newValue){return item.draggable("option","axis",newValue)}):void 0):void 0}}}]).directive("jquiDropCommit",["$compile",function(){return{link:function(scope,target,attrs){var accept,acceptExp,commit,commitExp;return acceptExp=attrs.jquiDropAccept||"true",commitExp=attrs.jquiDropCommit||"",target.addClass("jqui-dnd-target"),accept=evalFn(target,scope,acceptExp),commit=evalFn(target,scope,commitExp),target.droppable({addClass:!1,tolerance:"pointer",greedy:!0,activate:function(event,ui){var token;return token=ui.draggable.data("jqui-dnd-item-token"),target.addClass(accept(token)?"jqui-dnd-target-active":"jqui-dnd-target-disable"),scope.$apply()},deactivate:function(){return target.removeClass("jqui-dnd-target-active"),target.removeClass("jqui-dnd-target-disable"),target.removeClass("jqui-dnd-target-over")},over:function(event,ui){return $(".jqui-dnd-target-active").removeClass("jqui-dnd-target-active"),target.addClass("jqui-dnd-target-active"),target.hasClass("jqui-dnd-target-active")?(target.addClass("jqui-dnd-target-over"),ui.draggable.addClass("jqui-dnd-item-over")):void 0},out:function(event,ui){return target.removeClass("jqui-dnd-target-over"),ui.draggable.removeClass("jqui-dnd-item-over")},drop:function(event,ui){return!target.hasClass("jqui-dnd-target-active")||ui.draggable.hasClass("sortable")||ui.draggable.hasClass("resizable")||(commit(ui.draggable.data("jqui-dnd-item-token")),ui.draggable.draggable("option","revertDuration",0),ui.draggable.css({top:"",left:""}),ui.draggable.draggable("option","stop")()),target.removeClass("jqui-dnd-target-active"),target.removeClass("jqui-dnd-target-disable"),target.removeClass("jqui-dnd-target-over")}})}}}])}()}.call(this),function(){"use strict";angular.module("wix.base.fileDroppable",[]).directive("fileDroppable",["$parse",function($parse){return{link:function(scope,element,attrs){var invoker,scopeExpression;return scopeExpression=attrs.fileDroppable,invoker=$parse(scopeExpression),element.bind("drop",function(e){return e.originalEvent.dataTransfer&&(e.stopPropagation(),e.preventDefault(),e.originalEvent.dataTransfer.files.length)?scope.$apply(function(){var args;return args={},args.files=e.originalEvent.dataTransfer.files,scope.folder&&(args.folder=scope.folder),invoker(scope,args)}):void 0}),element.bind("dragover",function(e){return e.originalEvent.dataTransfer.dropEffect="copy",e.stopPropagation(),e.preventDefault()})}}}])}.call(this),function(){angular.module("wix.base.fileSelectionChange",[]).directive("fileSelectionChange",["$parse",function($parse){return{link:function(scope,element,attrs){var invoker,scopeExpression;return scopeExpression=attrs.fileSelectionChange,invoker=$parse(scopeExpression),element.bind("change",function(e){return 0!==e.originalEvent.target.files.length?scope.$apply(function(){var args;return args={},args.files=e.originalEvent.target.files,scope.folder&&(args.folder=scope.folder),invoker(scope,args)}):void 0})}}}])}.call(this),function(){mediaGallery.directive("foldersList",function(){return{restrict:"E",scope:{getFolders:"&",biPrefix:"@",selected:"=",itemsCount:"&",select:"&",onDrop:"&",remove:"&",rename:"&",canShowActions:"&"},link:function(s){var currentRenamingFolder,rename;return currentRenamingFolder=null,rename=s.rename,s.rename=function(data){return s.cancelRenaming(data.folder),rename.apply(this,arguments)},s.isSelected=function(folder){return folder===s.selected},s.isRenaming=function(folder){return folder===currentRenamingFolder},s.showRenaming=function(folder){return currentRenamingFolder=folder},s.cancelRenaming=function(folder){return currentRenamingFolder===folder?currentRenamingFolder=null:void 0},s.sortOrder=function(folder){return"/"===folder.getName()?"1"+folder.getName():"2"+folder.getName()}},templateUrl:"scripts/directives/folders_list/folders_list.html"}})}.call(this),function(){mediaGallery.directive("renamableFolderName",function($q){return{restrict:"E",scope:{folder:"=",itemsCount:"=",select:"&",rename:"&",isRenaming:"=",cancelRenaming:"&"},link:function(s,element){var $form,$input,cancelRenaming,rename,setDefaultName;return $form=element.find("form"),$input=element.find('[type="text"]'),setDefaultName=function(){return s.folderName=s.folder.getName()},s.$watch("isRenaming",function(val){var _base;val?($form.show(),$input.focus(),"function"==typeof(_base=$input[0]).select&&_base.select()):$form.hide()}),cancelRenaming=s.cancelRenaming,s.cancelRenaming=function(){return setDefaultName(),cancelRenaming.apply(this,arguments)},rename=s.rename,s.rename=function(){var res;return res=rename.apply(this,arguments),$q.when(res)["finally"](function(){return setDefaultName()})},setDefaultName()},templateUrl:"scripts/directives/folders_list/renamable_folder_name.html"}})}.call(this),function(){mediaGallery.directive("itemActions",function(){return{restrict:"E",scope:{item:"=",magnifyingGlassTemplate:"=",canEdit:"=",canRename:"=",canRemove:"=",canDownload:"=",edit:"&",showRenaming:"&",remove:"&",getDownloadLink:"&"},link:function(s){return s.canShowActions=function(){return s.canEdit||s.canRename||s.canRemove||s.canDownload}},templateUrl:"scripts/directives/items_list/item_actions.html"}})}.call(this),function(){mediaGallery.directive("wixRenamableItemName",function($q){return{restrict:"E",scope:{item:"=",isRenaming:"=",rename:"&",cancelRenaming:"&"},link:function(s,element){var $form,$input,cancelRenaming,rename,setDefaultName;return $form=element.find("form"),$input=element.find('[type="text"]'),setDefaultName=function(){return s.itemName=s.item.getTitle()},s.$watch("isRenaming",function(val,oldVal){var _base;(null==oldVal||val!==oldVal)&&(val?($form.show(),$input.focus(),"function"==typeof(_base=$input[0]).select&&_base.select()):$form.hide())}),cancelRenaming=s.cancelRenaming,s.cancelRenaming=function(){return setDefaultName(),cancelRenaming.apply(this,arguments)},rename=s.rename,s.rename=function(){var res;return res=rename.apply(this,arguments),$q.when(res)["finally"](function(){return setDefaultName()})},setDefaultName(),$form.hide()},templateUrl:"scripts/directives/items_list/renamable_item_name.html"}})}.call(this),function(){mediaGallery.directive("responsiveGridItems",function(){return{restrict:"E",scope:{getItems:"=",getFolder:"=",biPrefix:"@",magnifyingGlassTemplate:"@",canDrag:"&",canEdit:"&",canRename:"&",canRemove:"&",canDownload:"&",doubleClick:"&",edit:"&",rename:"&",remove:"&",getDownloadLink:"&"},controller:function($scope,selectedItems,DndHelper){var helpersCache;return $scope.isSelected=function(item){return selectedItems.has(item)},$scope.selection=WixPix.SelectionHelper(selectedItems,DndHelper,$scope),helpersCache={},$scope.selectionHelper=function(item){return helpersCache[item.id]||(helpersCache=$scope.selection.helper(item))},$scope.dragStart=function(item){return $scope.selection.dragStart(item,$scope.getFolder())}},link:function(s){var canDrag,currentRenamingItem,rename;return currentRenamingItem=null,rename=s.rename,s.rename=function(data){return s.cancelRenaming(data.item),rename.apply(this,arguments)},s.isRenaming=function(item){return item===currentRenamingItem},s.showRenaming=function(item){return s.canRename({item:item})?currentRenamingItem=item:void 0},s.cancelRenaming=function(item){return currentRenamingItem===item?currentRenamingItem=null:void 0},canDrag=s.canDrag,s.canDrag=function(){return!!canDrag.apply(this,arguments)}},templateUrl:"scripts/directives/items_list/responsive_grid_items.html"}})}.call(this),function(){"use strict";mediaGallery.directive("wixNoItems",["$compile","$templateCache",function($compile,$templateCache){return{restrict:"EA",scope:{templateName:"@",folderName:"@",searchQuery:"=",canUploadFiles:"=",onFilesChoose:"&",acceptFilesTypes:"=",connectExternalServices:"&"},link:function(scope,element){var el,template;return scope.getTemplate=function(templateName){return $templateCache.get("scripts/directives/no_items/"+templateName+".html")},template=scope.getTemplate(scope.templateName),el=angular.element(template),$compile(el)(scope),element.append(el)}}}])}.call(this),function(){}.call(this),function(){var fontPreview,imagePreview,shapePreview;imagePreview={link:function(scope,element,$templateCache,compile){var _this=this;return element.on("mouseover",function(){return scope.$apply(function(){var preview;return preview=_this.appendPreview(scope),_this.fitAndShowPreview(element,preview.imageWrapper,preview.image)})}),element.on("mouseout",function(){return $(_this.wrapperSelector).html("")}),this.compileTemplate=function(scope){var template;return template=$templateCache.get(scope.templateUrl||_this.templateUrl),compile(template)(scope)}},wrapperSelector:"#preview-wrapper",templateUrl:"scripts/directives/show_previews/image.html",calculatePreviewPosition:function(activationElement,containerToFit){return containerToFit.outerWidth()+activationElement.outerWidth()/2+activationElement.offset().left>=$(window).innerWidth()?($("#preview-wrapper").css({left:activationElement.offset().left}),containerToFit.css({right:"100%",left:"auto"})):containerToFit.css({left:"100%",right:"auto"}),containerToFit.css(containerToFit.outerHeight()+activationElement.outerHeight()/2+activationElement.offset().top>=$(window).innerHeight()?{bottom:"100%",top:"auto"}:{top:"100%",bottom:"auto"})},setWrapperPosition:function(activationElement){return $(this.wrapperSelector).css(MediaGallery.getFlyingTopLeftPosition(activationElement,!0,!1,!1))},appendPreview:function(scope){var image,imageWrapper;return image=new Image,image.src=scope.previewUrl,imageWrapper=this.compileTemplate(scope).addClass("spinner").appendTo($(this.wrapperSelector)),{imageWrapper:imageWrapper,image:image}},fitAndShowPreview:function(element,containerToFit,image){var _this=this;return this.setWrapperPosition(element),this.calculatePreviewPosition(element,containerToFit),containerToFit.show(),containerToFit.children().hide(),image.onload=function(){return containerToFit.find("img").replaceWith(image),containerToFit.removeClass("spinner"),containerToFit.children().show(),(!containerToFit.css("max-width")||image.width<containerToFit.css("max-width"))&&containerToFit.css({width:image.width}),(!containerToFit.css("max-height")||image.height+30<containerToFit.css("max-height"))&&containerToFit.css({height:image.height+30}),_this.calculatePreviewPosition(element,containerToFit)}}},mediaGallery.directive("wixShowPreview",["$templateCache","$compile",function($templateCache,compile){return{restrict:"A",scope:{previewUrl:"@",previewName:"@",previewSubtitle:"@",templateUrl:"@"},link:function(scope,element){return imagePreview.link(scope,element,$templateCache,compile)}}}]),fontPreview=_.extend({},imagePreview,{templateUrl:"scripts/directives/show_previews/font.html",calculatePreviewPosition:function(activationElement,containerToFit){return containerToFit.css({left:-1*activationElement.offset().left+($(window).width()-containerToFit.outerWidth())/2}),containerToFit.css(containerToFit.outerHeight()+8+activationElement.offset().top>=$(window).innerHeight()?{bottom:"100%",top:"auto"}:{top:activationElement.outerHeight(),bottom:"auto"})},setWrapperPosition:function(activationElement){return $(this.wrapperSelector).css(MediaGallery.getFlyingTopLeftPosition(activationElement,!1,!1,!1))}}),shapePreview=_.extend({},imagePreview,{link:function(scope,element,$templateCache){var _this=this;return element.on("mouseover",function(){var preview;return $(_this.wrapperSelector).addClass("svg"),preview=_this.appendPreview(scope),_this.fitAndShowPreview(element,preview.imageWrapper,preview.image)}),element.on("mouseout",function(){return $(_this.wrapperSelector).removeClass("svg"),$(_this.wrapperSelector).html("")}),this.compileTemplate=function(scope){var template;return template=$templateCache.get(_this.templateUrl),template=template.replace(/\{\{([a-z0-9]+)\}\}/gi,function(pattern,attributeName){return scope[attributeName]||""}),angular.element(template)}}}),mediaGallery.directive("wixShowShapePreview",["$templateCache",function($templateCache){return{restrict:"A",scope:{previewUrl:"@",previewName:"@",previewSubtitle:"@"},link:function(scope,element){return shapePreview.link(scope,element,$templateCache)}}}]),mediaGallery.directive("wixShowFontPreview",["$templateCache",function($templateCache){return{restrict:"A",scope:{previewUrl:"@",previewName:"@",previewSubtitle:"@"},link:function(scope,element){return fontPreview.link(scope,element,$templateCache)}}}])}.call(this),function(){var name,nameValidate,_fn,_i,_len,_ref;for(mediaGallery.directive("wixStopPropagation",function(){return function(scope,element){return element.on("click",function(e){return e.stopPropagation()})}}),mediaGallery.directive("translateHtml",function(i18n,$sce,$parse,$compile){return function(scope,element,attrs){var span,val;return val=$parse(attrs.translateHtml)(scope),span=angular.element("<span>"),span.html(i18n.translate(val.shift(),val)),element.html($compile(span)(scope))}}),mediaGallery.directive("wixAlwaysBlur",["$parse",function($parse){return function(scope,element,attr){var fn;return fn=$parse(attr.wixAlwaysBlur),element.on("blur",function(event){return event.isTrigger?void 0:scope.$apply(function(){return fn(scope,{$event:event})["finally"](function(){return element.trigger("blur")})})})}}]),mediaGallery.directive("wixNotificationCollection",function(){return function(scope,element,attributes){return scope.$watch(attributes.wixNotificationCollection,function(value){return value?element.show():element.hide()})}}),mediaGallery.directive("wixAnimateExpire",function(){return function(scope,element,attributes){return attributes.$observe("wixAnimateExpire",function(value){return value?element.animate({opacity:0},500,function(){return scope.$apply(attributes.wixExpireNotification)}):void 0})}}),mediaGallery.directive("wixResponsiveGrid",function(){return function(scope,element,attr){var actualColumnSize,calculateGrid,containerWidth,getGridColumns,setGridColumns,sizes;return attr.$observe("wixResponsiveGrid",function(itemsSize){var checkWidth;return itemsSize>0&&element.is(":visible")?(checkWidth=setInterval(function(){return element.height()>0?(clearInterval(checkWidth),calculateGrid()):void 0},10),$(window).on("resize.responsiveGrid",calculateGrid)):$(window).off(".responsiveGrid")}),sizes={min:120,max:160,margin:.12},containerWidth=function(){return element[0].offsetWidth},getGridColumns=function(){return parseInt(element.attr("grid-columns"))},setGridColumns=function(size){return element.attr("grid-columns",size)},actualColumnSize=function(){return containerWidth()/getGridColumns()*(1-sizes.margin)},calculateGrid=function(){return actualColumnSize()>sizes.max?(setGridColumns(getGridColumns()+1),calculateGrid()):actualColumnSize()<sizes.min?(setGridColumns(getGridColumns()-1),calculateGrid()):void 0
}}}),mediaGallery.animation(".scrollToChunk",function(){return{start:function(element,done){return $(".uploads").parent().scrollTop(element.parents(".chunk").position().top),done()}}}),mediaGallery.directive("wixGallerySearch",function(){return function(scope,element){return $(element).find("input[type='reset']").on("click",function(){return $(element).find("input[type='text']").trigger("blur")}),$(element).find("input[type='text']").on("focus",function(){return $(element).find("input[type='reset']").show()}),$(element).find("input[type='text']").on("blur",function(event){return 0===$(event.target).prop("value").length?$(element).find("input[type='reset']").hide():void 0}),$(element).find("input[type='text']").on("input change paste keyup mouseup",function(){var _ref;return 0===$(this).val().length&&0===(null!=(_ref=scope.items)?_ref.length:void 0)?scope.$apply(function(){return scope.clearSearch()}):void 0})}}),mediaGallery.directive("wixDisabled",function(){return function(scope,element,attrs){return scope.$watch(attrs.wixDisabled,function(value){return value?element.addClass("disabled"):element.removeClass("disabled")})}}),nameValidate=function(regexp){return{require:"ngModel",link:function(scope,el,attrs,ngModel){return ngModel.$parsers.push(function(inputValue){var transformedInput;return transformedInput=inputValue.match(regexp),transformedInput&&(transformedInput=transformedInput.join("")),transformedInput!==inputValue&&(ngModel.$setViewValue(transformedInput),ngModel.$render()),transformedInput})}}},mediaGallery.directive("folderNameValidate",function(){return nameValidate(/.{0,128}/)}),mediaGallery.directive("itemNameValidate",function(){return nameValidate(/.{0,80}/)}),mediaGallery.directive("wixError",["$timeout",function($timeout){return function(scope,el){return $timeout(function(){return el.fadeOut(400,function(){return el.remove()})},5e3)}}]),mediaGallery.directive("wixDblclick",["$parse",function($parse){return function(scope,element,attr){var fn;return fn=$parse(attr.wixDblclick),element.on("dblclick",function(event){return"INPUT"!==event.target.tagName?scope.$apply(function(){return fn(scope,{$event:event})}):void 0})}}]),_ref=["focus","blur","keyup","keydown","keypress","input","change"],_fn=function(name){var directiveName;return directiveName="wix"+name[0].toUpperCase()+name.substr(1),mediaGallery.directive(directiveName,["$parse",function($parse){return function(scope,element,attr){var fn;return fn=$parse(attr[directiveName]),element.on(name,function(event){return scope.$apply(function(){return fn(scope,{$event:event})})})}}])},_i=0,_len=_ref.length;_len>_i;_i++)name=_ref[_i],_fn(name);mediaGallery.directive("wixClickOutsideAndCommit",["$parse",function($parse){return function(scope,element,attr){var click,fn,keyup,register_events,remove_events;return fn=$parse(attr.wixClickOutsideAndCommit),keyup=function(event){return void(13===event.keyCode&&(scope.$apply(function(){return fn(scope,{$event:event,flow:"enter"})}),remove_events()))},click=function(event){return void(event.target!==element[0]&&(scope.$apply(function(){return fn(scope,{$event:event,flow:"clickOutside"})}),remove_events()))},register_events=function(){return element.on("keyup",keyup),angular.element(document.body).on("click",click)},remove_events=function(){return element.off("keyup",keyup),angular.element(document.body).off("click",click)},element.on("focus",function(){return void setTimeout(function(){return register_events()},100)})}}]),mediaGallery.directive("onKeyup",function($document){return function(scope,elm,attrs){var allowedKeys,applyKeyup;return applyKeyup=function(){return scope.$apply(attrs.onKeyup)},allowedKeys=scope.$eval(attrs.keys),$document.on("keyup",function(evt){return allowedKeys&&0!==allowedKeys.length?angular.forEach(allowedKeys,function(key){return key===evt.which?applyKeyup():void 0}):applyKeyup()})}}),mediaGallery.directive("wixBroadcastCtrlAPressed",["$rootScope",function(domainEventPublisher){return{link:function(scope,el){return el.on("keydown",function(event){return $(event.target).is("input")?void 0:(event.metaKey||event.ctrlKey)&&65===event.keyCode?(event.preventDefault(),domainEventPublisher.$broadcast("CtrlAPressed")):void 0})}}}]),mediaGallery.directive("wixSelectItem",["selectedItems","$location",function(selectedItems,location){return{scope:{item:"=",getItem:"=",allItems:"=",getAllItems:"=",canSelectMultiple:"&"},link:function(scope,el,attrs){var allItems,handleClick,handleCtrlClick,handleShiftClick,item,my,performSelection;return null==attrs.canSelectMultiple&&(scope.canSelectMultiple=function(){return!0}),item=scope.item||scope.getItem(),allItems=scope.allItems||scope.getAllItems(),performSelection=function(action){return"TranscodableItem"===item.type&&"READY"===item.getTranscodingStatus()||"Item"===item.type?scope.$apply(function(){return action(item,allItems)}):void 0},my="/my"===location.path(),handleShiftClick=function(){return performSelection(function(item,items){return selectedItems.selectRange(item,items)})},handleCtrlClick=function(){return performSelection(function(item){return selectedItems.selectAdditional(item)})},handleClick=function(){return performSelection(function(item){return scope.canSelectMultiple()||selectedItems.clear(),selectedItems.selectSingle(item)})},el.on("click",function(event){return event.shiftKey&&(selectedItems.supportsMultipleItems()||my)&&scope.canSelectMultiple()?handleShiftClick():(event.metaKey||event.ctrlKey)&&(selectedItems.supportsMultipleItems()||my)&&scope.canSelectMultiple()?handleCtrlClick():handleClick()})}}}]),mediaGallery.directive("wixCommit",["$parse",function($parse){return function(scope,element,attr){var fn;return fn=$parse(attr.wixCommit),element.on("keyup",function(event){return 13===event.keyCode?scope.$apply(function(){return fn(scope,{$event:event})}):void 0})}}]),mediaGallery.directive("wixUpload",["$compile",function($compile){return function(scope,element,attrs){return element.on("click",function(){var input,inputSelector,template;if(!this.attributes.disabled)return inputSelector=element.siblings('input[type="file"]'),inputSelector[0]?input=inputSelector:(template='<input type="file" accept="'+attrs.accept+'" class="actual-upload ng-scope" multiple="true" file-selection-change="'+attrs.wixFilesChoosen+'" />',input=angular.element(template),$compile(input)(scope),element.after(input)),input.click(),input.on("change",function(){return input.replaceWith(input.clone(!0))})})}}]),mediaGallery.directive("wixBiEvent",["$parse","EventNotifier",function(parse,eventNotifier){return function(scope,element,attributes){var events;return events=parse(attributes.wixBiEvent)(scope),_.forEach(events,function(value,event){return element.bind(event,function(){var eventAttributes,eventName;return value=parse(attributes.wixBiEvent)(scope)[event],_.isString(value)?(eventName=value,eventAttributes=void 0):(eventName=value.name,eventAttributes=value.attributes),void eventNotifier(eventName,eventAttributes)})})}}]),mediaGallery.directive("focusMe",["$timeout",function(timeout){return{link:function(scope,element,attrs){return scope.$watch(attrs.focusMe,function(value){return value===!0?timeout(function(){return element.focus()},0):void 0})}}}]),mediaGallery.directive("wixItem",["$compile",function($compile){return function(scope,element,attrs){return attrs.$observe("directiveName",function(directiveName){var el,template;return template="<div "+directiveName+' src="'+attrs.wixItem+'"/>',el=angular.element(template),$compile(el)(scope),element.append(el)})}}]),mediaGallery.directive("wixAutofocus",function(){return function(){return window.focus()}}),mediaGallery.directive("wixClickOutsideNgView",["EventNotifier",function(eventNotifier){return function(scope,element){return element.on("click",function(e){return $(e.target).hasClass("modal-backdrop")?eventNotifier("clickedOutsideOfDialog"):void 0})}}]),mediaGallery.directive("wixConditionalTemplate",["$compile","$templateCache","$q","$http",function($compile,$templateCache,$q,$http){return function(scope,element,attrs){var getTemplatePromise;return getTemplatePromise=function(templateUrl){return $http.get(templateUrl,{cache:$templateCache}).then(function(result){return result.data})},/-no-template\.html$/.test(attrs.wixConditionalTemplate)?void 0:getTemplatePromise(attrs.wixConditionalTemplate).then(function(template){var el;return el=angular.element(template),$compile(el)(scope),element.after(el)})}}]),mediaGallery.directive("wixFlashFallbackButton",["Urls","i18n","featureDetection","VerifyCORSWorks","$injector","Settings","privateRestApi.adapters.Folders",function(urls,i18n,featureDetection,verifyCORSWorks,injector,settings,restApiFoldersAdapter){var nextElementId;return nextElementId=1,{link:function(scope,element,attrs){return verifyCORSWorks.verifyRegular().then(null,function(){var attributes,elementId,elementText,flashElement,flashvars,params,paths,rootFolderId,sendToFlash,swfFileName,swfUrl;return featureDetection.flashUploads()?(flashvars="staticAPI"===settings.getSettingsHash().privateMediaApi?{serverRoot:urls.baseHost()}:{pmServer:urls.privateMediaRestAPI()},params={quality:"high",bgcolor:"#FAFAFA",allowscriptaccess:"always",allowfullscreen:"true",wMode:"transparent",scale:"noScale"},attributes={id:"UploadBTN",name:"UploadBTN",align:"middle"},elementId="mainUploadButton"+nextElementId++,element.hide(),element.after("<div id='"+elementId+"'>"),swfFileName="staticAPI"===settings.getSettingsHash().privateMediaApi?"MediaUploader.swf":"MediaUploaderRest.swf",paths=window.location.pathname.split("/"),swfUrl="media_gallery"===paths[paths.length-2]?"../"+swfFileName:"./"+swfFileName,swfobject.embedSWF(swfUrl,elementId,142,30,"10.0.0",null,flashvars,params,attributes),(flashElement=$("#UploadBTN")[0])?(rootFolderId=null,sendToFlash=function(){var options;return flashElement.sendToFlash?(options={label:elementText,description:"Images",extensions:attrs.wixFlashAccept,macExtensions:attrs.wixFlashAccept,mediaS:attrs.wixFlashStaticCode,wixType:attrs.wixFlashMediaType},"restAPI"===settings.getSettingsHash().privateMediaApi&&(options.mediaType=attrs.wixFlashMediaType,options.folder=attrs.wixFolderId||rootFolderId,options.wixSession=injector.get("$browser").cookies().wixSession),flashElement.sendToFlash("setFileType",options)):setTimeout(sendToFlash,10)},elementText=i18n.translate(attrs.wixFlashFallbackButton),"restAPI"===settings.getSettingsHash().privateMediaApi?restApiFoldersAdapter.getRootFolder(settings.getSettingsHash().mediaType).then(function(folder){return rootFolderId=folder.folder_id,sendToFlash(),attrs.$observe("wixFolderId",sendToFlash)}):sendToFlash()):void 0):void element.replaceWith('<div class="flash-uploads-not-supported">'+i18n.translate("flash_uploads_are_not_supported")+"</div>")})}}}])}.call(this),function(){var hideWhenInactive;MediaGallery.fitsToRight=function(activationElement,containerToFit,boundingWindow){var containerRightBorder,rightBorder;return rightBorder=boundingWindow.innerWidth(),boundingWindow.offset()&&(rightBorder+=boundingWindow.offset().left),containerRightBorder=containerToFit.outerWidth()+activationElement.outerWidth()/2+activationElement.offset().left,rightBorder>containerRightBorder},MediaGallery.fitsToBottom=function(activationElement,containerToFit,boundingWindow){var bottomBorder;return bottomBorder=boundingWindow.innerHeight(),boundingWindow.offset()&&(bottomBorder+=boundingWindow.offset().top),containerToFit.outerHeight()+activationElement.outerHeight()/2+activationElement.offset().top<bottomBorder},MediaGallery.getFlyingTopLeftPosition=function(activationElement,isRight,isBottom,isXCentered){var activationElementTopOffset,posXval,posYval,realOffset;return realOffset=activationElement[0].getBoundingClientRect(),activationElementTopOffset=realOffset.top,isRight?(posXval=realOffset.left+activationElement.outerWidth(),isXCentered&&(posXval-=activationElement.outerWidth()/2)):(posXval=realOffset.left,isXCentered&&(posXval+=activationElement.outerWidth()/2)),posYval=isBottom?realOffset.top+activationElement.height():realOffset.top,{top:posYval,left:posXval}},hideWhenInactive=function(element,selector,hide){return element.on("mouseleave.hideWhenInactive",function(){var checkElement;return checkElement=window.setTimeout(hide,350),$(selector).on("mouseenter.hideWhenInactive",function(){return window.clearTimeout(checkElement)}),$(selector).on("mouseleave.hideWhenInactive",function(){return checkElement=window.setTimeout(hide,100)})})},mediaGallery.directive("wixTooltip",["$parse",function(parse){return function(scope,element,attrs){var content,fitToElement,settings,style,wrapper;return settings=parse(attrs.wixTooltip)(scope),content=function(){return element.siblings(settings.content)},wrapper=$("#tooltip-wrapper"),style=settings.style?settings.style:"",fitToElement=void 0,settings.fitToElement&&(fitToElement=$("window"===settings.fitToElement?window:settings.fitToElement)),element.on(settings.event,function(event){var calculatePosition,fitsBottom,fitsRight,hideTooltip,tooltip;return event.preventDefault(),event.stopPropagation(),content()&&content().html().trim().length&&!element.parent().hasClass("inactive")&&(wrapper.append(content().clone(!0)).attr("class",style),tooltip=wrapper.find(".tooltip"),fitToElement?(fitsRight=MediaGallery.fitsToRight(element,tooltip,fitToElement),fitsBottom=MediaGallery.fitsToBottom(element,tooltip,fitToElement),calculatePosition=function(){return MediaGallery.getFlyingTopLeftPosition(element,fitsRight,fitsBottom,"true"===settings.centered)},wrapper.addClass(fitsRight?"left":"right").addClass(fitsBottom?"bottom":"top").css(calculatePosition())):(calculatePosition=function(){return MediaGallery.getFlyingTopLeftPosition(element,"right"===settings.posx,"bottom"===settings.posy,"true"===settings.centered)},wrapper.addClass(settings.posx).addClass(settings.posy).css(calculatePosition())),tooltip.show(),settings.parent&&element.parents(settings.parent).addClass("active"),wrapper.find(".tooltip").on("click",function(){return hideTooltip()}),wrapper.find("a").on("click",function(){return hideTooltip()})),hideTooltip=function(){return settings.parent&&element.parents(settings.parent).removeClass("active"),wrapper.html(""),element.off(".tooltip"),$(window).off(".tooltip"),$("#tooltip-wrapper .tooltip").off(".hideWhenInactive")},hideWhenInactive(element,"#tooltip-wrapper .tooltip",hideTooltip)})}}])}.call(this),function(){"use strict";angular.module("wix.base.whenScrolled",[]).directive("whenScrolled",function(){return function(scope,element,attrs){var scrollElement;return scrollElement=$(element),scrollElement.on("scroll",function(){return scrollElement.scrollTop()+scrollElement.height()>=element.prop("scrollHeight")-133?scope.$apply(attrs.whenScrolled):void 0})}})}.call(this),function(){var coolaDataSetupthrottled,restartCount,start;MediaGallery.init=function(eventNotifier,domainEventPublisher,protocol,verifyCORSWorks,injector,notificationSubscriber,$location,settings){var isLocalesLoaded,rootScope;return MediaGallery.appLoadNotifiers.appIsRunning(),isLocalesLoaded=!1,rootScope=injector.get("$rootScope"),rootScope.$on("$viewContentLoaded",function(){return protocol.sendOpen(),isLocalesLoaded=!0,$("body").removeClass("hidden")}),notificationSubscriber.subscribe(),eventNotifier("dialogOpened",settings.getSettingsHash()),domainEventPublisher.$on("MultipleSelectionInSingleMode",function(){return eventNotifier("multipleItemsInSingleModeSelected")}),protocol.onInitialize(function(settingsHash){return rootScope.$apply(function(){return start(settingsHash),eventNotifier("dialogOpened",settings.getSettingsHash()),$location.path("#/")})}),protocol.sendFinishedJSLoading()},MediaGallery.setupDependencies(mediaGallery),restartCount=0,coolaDataSetupthrottled=_.throttle(coolaDataSetup,3e3,{trailing:!1}),window.protocol=Protocol.forMediaGallery(window.parent,window),start=function(settingsHash){return MediaGallery.appLoadNotifiers.settingsReceivedFromProtocol(),settings.set(settingsHash),restartCount++,restartCount>1&&coolaDataSetupthrottled(),mediaGallery.config(["SettingsProvider","UrlsProvider",function(SettingsProvider,UrlsProvider){return SettingsProvider.initialize(settings),UrlsProvider.initialize(settings)}]).config(["$httpProvider",function($httpProvider){return $httpProvider.defaults.withCredentials=!0,$httpProvider.interceptors.push("HttpErrorInterceptor")}]),MediaGallery.appLoadNotifiers.externalComponentsConfigured(),mediaGallery.run(["EventNotifier","$rootScope","Protocol","VerifyCORSWorks","$injector","NotificationSubscriber","$location","Settings",MediaGallery.init]),MediaGallery.isBootstrapped?void 0:(document.location.hash="#/",angular.bootstrap("#mediaGalleryApp",["mediaGallery"]),MediaGallery.isBootstrapped=!0)},protocol.onInitialize(start),this.siteId=this.sessionID,protocol.sendReady(),MediaGallery.appLoadNotifiers.sentReadyToProtocol()}.call(this);